{"version":3,"sources":["table/utils/index.js","table/utils/compute.data.js","table/utils/filters.sorts.js","table/MetaDescriptions.js","table/utils/compute.meta.js","table/utils/copy.paste.js","table/utils/utils.js","table/ZebulonTable.menu.js","table/TableHeaders.js","table/Table.events.js","table/Table.menu.js","table/Table.filters.sorts.js","table/Rows.js","table/Search.js","table/Table.js","table/ZebulonTable.js","demo/datasources.js","demo/thirdparties.js","demo/dataset.meta.js","demo/dataset.functions.js","demo/dataset.example.js","table/ZebulonTableAndConfiguration.js","demo/dataset.configuration.js","demo/ZebulonTable.demo.js","index.js"],"names":["_utils__WEBPACK_IMPORTED_MODULE_0__","__webpack_require__","d","__webpack_exports__","_functions__WEBPACK_IMPORTED_MODULE_1__","o","_compute_data__WEBPACK_IMPORTED_MODULE_2__","_compute_meta__WEBPACK_IMPORTED_MODULE_3__","_filters_sorts__WEBPACK_IMPORTED_MODULE_4__","cellData","row","column","status","data","params","focused","editable","deleted_","editable_","editableFunction","select","selectItems","undefined","dataType","value","analytic","id","accessorFunction","includes","Date","selectFunction","utils","isPromise","Array","isArray","isObject","Object","values","primaryKeyAccessorFunction","caption","computeData","meta","startIndex","noDataMutation","arguments","length","foreignObjects","properties","filter","accessor","hidden","_meta$table","table","pk","lk","rwd","forEach","index","index_","indexPk","indexLk","indexRowId","C_Users_thomas_dev_js_table_node_modules_babel_runtime_helpers_esm_objectSpread__WEBPACK_IMPORTED_MODULE_1__","computeRows","aggregation","computeAnalytic","computeAnalytics","concat","groups","sortAccessorFunction","groupByAccessorFunction","sort","rowA","rowB","a","b","x","i","sortFunction","acc","_window","_ref","groupBy","JSON","stringify","comparisonAccessorFunction","ref","startFunction","start","endFunction","end","aggregationFunction","push","group","getRegExp","v","RegExp","replace","String","fromCharCode","stringValue","property","_ref2","isNullOrUndefined","toUpperCase","numberToString","dateToString","computeRowSearch","dataStrings","strings","rowStrings","join","rowSearch","exp","indexes","rowString","test","cellSearch","propertyStart","direction","filtersFunction","getFilters","sortsFunction","getSorts","zebulon_controls__WEBPACK_IMPORTED_MODULE_0__","filters","updatedRows","f","filter_","filterType","vTo","map","facc","foreignKeyAccessorFunction","updated_","new_","errors","n_","isDate","vRow","startsWith","indexOf","filterFunction","hidden_","reduce","columns","sorts","_ref3","fNullValue","nullValue","Infinity","sortOrder","message","_ref4","stringToFunction","functions","functionJS","evalProtectedFunction","functionText","onNext","indexedColumn","rowId","primaryKey","onCompleted","onError","e","isLocal","inherited","inheritedValue","canInherit","isNullValue","react__WEBPACK_IMPORTED_MODULE_1___default","createElement","style","color","metaFunctions","dataset","actions","exportMeta","functionsObject","datasetFunctions","r","buildFunctionsObject","path","object","exportFile","accessors","propertyType","reference","formats","isArrayOrFunction","backgroundColor","fontStyle","aggregations","selects","validators","_ref5","editables","isDataset","_ref6","tp","isNotDataset","_ref7","isAnalytic","_ref8","defaults","functionDescriptor","_ref9","label","exportFunctions","_ref10","dimensions","sortAcc","_ref11","keyAccessor","sortFct","_ref12","custom","_ref13","C_Users_thomas_dev_js_table_node_modules_babel_runtime_helpers_esm_objectSpread__WEBPACK_IMPORTED_MODULE_0__","sortAccessor","_ref14","measures","globals_","is_selected","_ref15","is_new","_ref16","observers","overwrite","setPropertyAccessors","type","keys","key","propertyAccessors","metaDescriptions","source","callbacks","getFunctions","getFunctionsArray","getAccessorsAndProperties","dataAccessors","getFormats","getValidators","noFilter","enable","action","code","onSave","applyProperties","width","mandatory","locked","default","format","applyFunctions","descriptor","onQuit","_ref17","applyMeasures","_ref18","localFormat","_ref19","applyDimensions","_ref20","localLabelAccessor","labelAccessor","_ref21","_ref22","localKeyAccessor","_ref23","localSortAccessor","_ref24","_ref25","localOrderFunctionAccessor","orderFunctionAccessor","_ref26","localSortFunctionAccessor","_ref27","_ref28","_ref29","getSizes","computeMetaPositions","computeMeta","computeMetaFromData","rowHeight","headersLength","findIndex","headersHeight","zoom","lastColumn","rowWidth","position","computedWidth","headersWidth","noStatus","visibleIndexes","lockedIndex","lockedWidth","visibleIndex_","privileges","promises","checkable","getAccessorFunction","onTableChangeFunction","onTableChange","onSaveFunction","onSaveBeforeFunction","onSaveBefore","onSaveAfterFunction","onSaveAfter","logicalKey","descriptorFunction","onQuitFunction","auditFunction","audit","actionFunction","enableFunction","subscription","observableFunction","observable","observerFunctions","observer","config","referencingColumns","formatFunction","foreignObjectFunction","foreignObject","then","pk_","setForeignKeyAccessorFunction","isMap","get","onChangeFunction","onChange","slice","referencedColumn","find","col","defaultFunction","isNumber","Number","groupByAccessor","comparisonAccessor","windowStart","windowEnd","children_","grantPrivilege","toJSON","getDataType","alignement","getSelection","selectedRange","filteredData","columnSeparator","rowStart","Math","min","rows","rowEnd","max","columnStart","columnEnd","outputs","output","iColumn","iRow","buildPasteArray","clipboard","this_","selectCell","state","selectedCell","canQuit","props","lines","split","pop","cells","line","cellsValue","rowCells","rowIndex","columnIndex","cell","_column","stringToDate","columnId","reverse","cellValue","ok_","previousRow","isPasting","forceUpdate","ok","cellV","endCell","item","C_Users_thomas_dev_js_table_node_modules_babel_runtime_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_0__","rollback","rollbackStatus","rowUpdated","n","nErrors","rollbackFiltered","linkFilters","link","rollbackAll","getUpdatedRows","splice","nErrorsServer","getRowStatus","isNaN","setStatus","timeStamp","getTime","manageRowError","error","rowTitle","onServer","existsErrors","errorsServer","existsObject","objectErrors","existsType","getRowErrors","getErrors","errorHandler","modalBody","serverError","excludeProperties","selectFilter","sources","meta_","buildObject","excludes","serverPagination","statusDraggable","f0","f1","fSources","functions_","imports","visibility","name","f_","nm","nm2","fText","getFunction","toString","imp","hasParent","element","parentElement","isEqual","v0","v1","ZebulonTableMenu","_Component","_getPrototypeOf2","_this","classCallCheck","this","_len","args","_key","possibleConstructorReturn","getPrototypeOf","call","apply","handleAudit","audits","setState","loaded","loading","auditedRow","onRowEnter","audited","handleClickMenu","handleCloseAudit","linkedObjects","handleRollback","getCustomMenu","menu","menus","contextualMenu","children","objectSpread","onClick","getMenu","isActive","onActivation","componentId","disable","separation","checked","status_","inherits","Component","console","log","FiFilter","height","filterTo","openFilter","className","classnames","zebulon-table-cell","zebulon-table-header","zebulon-table-filter","zebulon-table-filter-checkbox","zebulon-table-filter-checkbox-undefined","textAlign","div","document","activeElement","react_default","fi","zebulon_controls_lib","inputType","tabIndex","onFocus","header","handleClick","handleDragStart","handleDragOver","handleDrop","Arrow","FiArrowUp","FiArrowDown","onDoubleClick","onDragOver","onDrop","justifyContent","display","paddingRight","draggable","onDragStart","cursor","opacity","auditCell","zebulon-table-cell-audit","zebulon-table-cell-odd","filterEmpty","Headers","double","onSort","clearTimeout","timer","prevent","setTimeout","getColumnIndex","ids","dragId","target","dragType","dragX","pageX","dataTransfer","setData","stopPropagation","preventDefault","onMetaChange","createClass","changingFilter","_this$props$scroll","scroll","shift","_this$props","auditStatus","first","columnWidth","left","overflow","statusCell","handleErrors","isAudit","Glyph","FiX","FiPlus","FiCheck","style_","deleted","shiftKey","onMouseOver","onMouseOut","Status","_Component2","_this2","extension","_this2$props","startRowIndex","selectedIndex","selectRange","stopIndex","checked_","nextProps","loadingPage","noUpdate","_this3","_this$props2","dataLength","statusChanged","indexPage","page","pageStartIndex","ceil","top","zebulon-table-status","zebulon-table-status-selected","ix","diplay","TableEvent","_TableMenu","closeOpenedWindows","keepSearch","openedFilter","text","detail","content","toolTip","search","close","fKeyMap","f12","f11","f10","toggleFilter","hasFocus","getElementById","focus","blur","handleKeyDown","keyCode","which","keyMap","_this$state","isFilter","handleAction","ctrlKey","handleSearch","isNavigationKey","onOk","handleNavigationKeys","defaultPrevented","copy","navigator","writeText","handleCopy","selectionStart","selectionEnd","handlePaste","clipboardData","getData","assertThisInitialized","selectRange_","getDetail","Detail","onClose","doubleClickAction","handleToolTip","out","tagName","relatedTarget","toolTipTimer","offsetLeft","parseInt","clientWidth","statusEnable","getRow","handleDelete","handleNew","handleDuplicate","onAction","_this$state2","defineProperty","onRowDelete","newRow","newRow_","_this$state3","getDataLength","pageLength","filteredDataLength","onRowNew","range","rowDirection","sign","columnDirection","scrollTo","pagination","callbackBefore","callbackAfter","_this$state4","onGetPage","getFilteredDataLength","isInPage","rowsHeight","paginationIsRequired","noFocus","scrollOnKey","onScroll","extention","onScroll_","callback","scrollOnClick","_this$state5","prevEnd","prevStart","endChanged","enter","updated","previousValue","onCellEnter","handleText","constants","AxisType","ROWS","quit","tableUpdated","_this$state6","items","onChange_","onCellQuit","onCellQuit_","cellQuit","foreignColumn","onForeignKey","isOpening","cd","foreignObjectQuit","onRowQuit","onRowQuit_","checkUnicity","keyIndex","_this$state7","onTableEnter","beforeTableClose","onTableClose","confirmationModal","buildMessage","offsetTop","handleTextChange","_this$state$text","resetScroll","TableMenu","function","prevScroll","selectedRow","prevRange","TableFilterSort","_TableEvent","adjustScrollRows","bLoaded","onFilter","getFilterItems","filteredByServer","from","row_","nvl","formatValue","decimals","itemA","itemB","rect","getBoundingClientRect","rectTable","y","openFilter_","persist","onChangeFilter","onChangeFilter_","editedValue","onChangeFilterValues","onChangeFilterValues_","doubleClick","noOrder","onSort_","Rows","_ScrollableGrid","tableEditable","selected","onMouseDown","onMouseUp","_cellData","zebulon-table-cell-selected","zebulon-table-cell-focused","zebulon-table-cell-editable","zebulon-table-cell-select","zebulon-table-cell-checkbox","component","rowRenderer","visibleWidth","isInRange","mouseDown","buttons","noOver","getContent","columnStartIndex","columnShift","scrollbars","vertical","noVerticalScrollbar","onWheel","ScrollableGrid","Search","handleClickNext","rowIndexes","indexRowIndex","cell_","cellRange","handleChange","rowStartIndex","rowStopIndex","input","autoFocus","background","icons","downArrow","backgroundSize","marginTop","marginRight","upArrow","marginLeft","Table","_TableFilterSort","onLoad","onCheckAll","checkAll","getActions","statusBar","actionIcons","Icon","icon","FiAlertCircle","minWidth","margin","jsxFunction","disabled","isModal","filteredData_","selection","callbackForeignKey","visible","nextState","setActions","loadingConfig","_filters$openedFilter","title","border","fontFamily","zIndex","cols","font","paddingLeft","maxWidth","Search_Search","floor","TableHeaders_Status","Rows_Rows","navigationKeyHandler","scrollbarsOnBox","lockedColumns","headers","TableHeaders_Headers","lockedHeaders","statusBarHeader","checkbox","fontWeight","padding","boxSizing","ZebulonTable","_ZebulonTableMenu","setFilters","setSorts","refresh","_isMounted","dataObject","toConsumableArray","initData","sizes","subscribe","resolvePromise","isObservable","subscribeObservable","componentName","Promise","all","initData2","data_","onGetData","initSizes","catch","_subscription$observe","auto","tableSizes","maxHeight","minHeight","scrollbarSize","ScrollbarSize","componentDidMount","getComponent","componentWillUnmount","handleKeyEvent","modal","onEscape","onEnter","isZoom","callbackReDo","handler","conflicts","body","messages","msg","zebulonTable","onConflict","server","callback_","tableChange","onTableChange_","carryOn","_object$state","onSave_","serverData","deleteds","onSaveOk","errorAfter","saveAfter","errorSave","saveBefore","save","errorBefore","onConfirm","button","modalCancel","ForeignObject","_this$state$sizes","conflict","From","client","_this$state$sizes2","onResize","size","getConfiguration","keyEvent","mergeFunctionsObjects","saveConfirmationAnswer","closeRequired","fontSize","rowAudited","Table_Table","onTableQuit","resizable","react_resizable","show","prototype","metaThirdparties","thirdparties","resolve","lb","thirdparty","MyThirdparties","React","cloneElement","ZebulonTable_ZebulonTable","countries","currency_id","vat","country","getCountries","currencies","symbol","rate","currency","getCurrencies","shapes","colors","getColors","products","shape","random","price","currency_sym","getProducts","users","dataPk","get_array","noJoins","nRow","timestamp","thp","thp_","product_id","country_id","thirdparty_id","thirdparty_cd","qty","round","timestamp_","user_","getMockDataset","product","rowId_","parse","rollingAverage","totalAmount","noCache","FiPlusSquare","FiSave","FiRefreshCw","noRefresh","computeAudit","nextRow","audits_","get_subscription","data2","row0","Observable","interval","take","serverErrors","amt_€","amt_cur","windows","since30d","xx","setDate","getDate","onChangeCountry","mth","flag","toLowerCase","dmls","get_promise","get_observable","get_pagination_manager","dataIndex","lastTimeStamp","paginationManager","update","stop","pageData","user","serverIndex_","pKey","result","serverRow","onSaveBefore_","analytics","rolling_avg","total_amt","MyDataset","getLengths","getPageLengths","loadedDataLength","handleTotalAmount","handleRollingAverage","activeTable","handleRefresh","_this$zebulonTable$st","radioDataset","handleRadioDataset","handleUser","userZebulon","privileges_","New","Duplicate","Delete","product_lb","country_cd","2","footer","previousState","readOnly","ZebulonTableAndConfiguration","initTabsState","constructor","tabs","tab","selectedTab","initMeta","onChangeProperties","changedProperties","removeFunction","setInitialFunction","zoomValue","propertiesUpdatedRows","initTabs","configurationMenus","functionUpdatedRows","functionsMeta","functionsData","propertiesMeta","initTabProps","Content","onSelectTab","composeFunction","getFunctionsObject","functionsUpdatedRows","functionsProperties","functionsFunctions","toFixed","cx","zebulon-tabs-tab","zebulon-tabs-tab-selected","MyDatasetConfiguration","metaDataset","ZebulonTableAndConfiguration_ZebulonTableAndConfiguration","paddingTop","ZebulonTableDemo","window","confirm","getTabContent","dataset_example_MyDataset","dataset_configuration_MyDatasetConfiguration","options","toto","setVisibility","addEventListener","removeEventListener","ReactDOM","render","ZebulonTable_demo"],"mappings":"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","file":"static/js/main.fdf69439.chunk.js","sourcesContent":["export * from \"./utils\";\r\nexport * from \"./functions\";\r\nexport * from \"./compute.data\";\r\nexport * from \"./compute.meta\";\r\nexport * from \"./filters.sorts\";\r\nexport * from \"./copy.paste\";\r\n","import { utils } from \"zebulon-controls\";\r\n// ----------------------------------\r\n// common data access (row or fiels)\r\n// ----------------------------------\r\nexport const cellData = (row, column, status, data, params, focused) => {\r\n  const editable =\r\n    // focused &&\r\n    !(status || {}).deleted_ &&\r\n    row.editable_ &&\r\n    (column.editableFunction\r\n      ? column.editableFunction({\r\n          column,\r\n          row,\r\n          status: status || {},\r\n          data,\r\n          params\r\n        })\r\n      : column.editable);\r\n  //  dont use accessor for analytics computed data\r\n  let select =\r\n      column.select && editable && focused\r\n        ? column.selectItems || column.select\r\n        : undefined,\r\n    dataType =\r\n      typeof column.dataType === \"function\"\r\n        ? column.dataType({ row })\r\n        : column.dataType;\r\n\r\n  let value = column.analytic\r\n    ? row[column.id]\r\n    : column.accessorFunction\r\n      ? column.accessorFunction({ column, row, params, status, data })\r\n      : row[column.id];\r\n\r\n  if (\r\n    [\"date\", \"month\", \"year\"].includes(dataType) &&\r\n    typeof value === \"string\"\r\n  ) {\r\n    value = new Date(value);\r\n  }\r\n  //  map the data\r\n  if (select) {\r\n    if (column.selectFunction && editable && focused && !column.selectItems) {\r\n      select = column.selectFunction({\r\n        column,\r\n        row,\r\n        data,\r\n        focused\r\n      });\r\n    }\r\n    if (\r\n      !utils.isPromise(select) &&\r\n      !Array.isArray(select) &&\r\n      utils.isObject(select) &&\r\n      !column.accessorFunction\r\n    ) {\r\n      select = Object.values(select);\r\n    }\r\n    if (column.primaryKeyAccessorFunction) {\r\n      value = {\r\n        value: column.primaryKeyAccessorFunction({\r\n          column,\r\n          row,\r\n          params,\r\n          status,\r\n          data\r\n        }),\r\n        caption: value\r\n      };\r\n    }\r\n  }\r\n  return {\r\n    editable,\r\n    select,\r\n    value: value === undefined ? null : value,\r\n    dataType\r\n  };\r\n};\r\nexport const computeRows = (data, meta, startIndex = 0, noDataMutation) => {\r\n  let foreignObjects = [];\r\n  foreignObjects = meta.properties.filter(\r\n    column =>\r\n      column.accessor !== undefined &&\r\n      ((column.dataType === \"joined object\" && column.select !== undefined) ||\r\n        (column.dataType === \"object\" && column.hidden))\r\n  );\r\n  const { pk, lk, rwd } = meta.table;\r\n\r\n  data.forEach((row, index) => {\r\n    // if (calcIndex) {\r\n    row.index_ = index + (startIndex || 0);\r\n    // }\r\n    if (pk) {\r\n      meta.indexPk[row[pk.id]] = row.index_;\r\n    }\r\n    if (lk) {\r\n      meta.indexLk[row[lk.id]] = row.index_;\r\n    }\r\n    if (rwd) {\r\n      meta.indexRowId[row[rwd.id]] = row.index_;\r\n    }\r\n    foreignObjects.forEach(\r\n      column => (row[column.id] = column.accessorFunction({ row }))\r\n    );\r\n    if (noDataMutation) {\r\n      data[index] = { ...row };\r\n    }\r\n  });\r\n};\r\nexport const computeAnalytics = (data, meta) => {\r\n  const columns = meta.properties.filter(\r\n    column =>\r\n      (column.aggregation || column.analytic) &&\r\n      typeof column.accessorFunction === \"function\" &&\r\n      !column.hidden\r\n  );\r\n  columns.forEach(column => {\r\n    computeAnalytic(data, column);\r\n  });\r\n};\r\nexport const computeData = (data, meta, startIndex, noDataMutation) => {\r\n  computeRows(data, meta, startIndex, noDataMutation);\r\n  computeAnalytics(data, meta);\r\n};\r\n// ----------------------------\r\n//  aggregations\r\n//  ---------------------------\r\n// export const aggregations = {\r\n//   count: values => values.length,\r\n//   sum: values => values.reduce((sum, value) => (sum += value), null),\r\n//   min: values =>\r\n//     values.reduce(\r\n//       (min, value) => (min = min === null || value < min ? value : min),\r\n//       null\r\n//     ),\r\n//   max: values =>\r\n//     values.reduce(\r\n//       (max, value) => (max = max === null || value > max ? value : max),\r\n//       null\r\n//     ),\r\n//   avg: values =>\r\n//     values.length === 0 ? null : aggregations.sum(values) / values.length,\r\n//   weighted_avg: values => {\r\n//     const wavg = values.reduce(\r\n//       (wavg, value) => {\r\n//         wavg.v0 += value.v0;\r\n//         wavg.v1 += value.v1;\r\n//         return wavg;\r\n//       },\r\n//       { v0: null, v1: null }\r\n//     );\r\n//     return wavg.v0 === 0 && wavg.v1 === 0 ? null : wavg.v0 / wavg.v1;\r\n//   },\r\n//   delta: values => {\r\n//     const delta = values.reduce(\r\n//       (delta, value) => {\r\n//         delta.v0 += value.v0;\r\n//         delta.v1 += value.v1;\r\n//         return delta;\r\n//       },\r\n//       { v0: null, v1: null }\r\n//     );\r\n//     return delta.v0 - delta.v1;\r\n//   },\r\n//   prod: values => values.reduce((prod, value) => (prod *= value), null)\r\n// };\r\n// -------------------------------------\r\n// compute new description\r\n// -------------------------------------\r\nconst sortFunction = accessor => (rowA, rowB) => {\r\n  const a = accessor(rowA),\r\n    b = accessor(rowB);\r\n  let x = 0,\r\n    i = 0;\r\n\r\n  while (!x && i < a.length) {\r\n    x = (a[i] > b[i]) - (b[i] > a[i]);\r\n    i++;\r\n  }\r\n\r\n  return x;\r\n};\r\nexport const computeAnalytic = (data, column) => {\r\n  let d = data.concat([]);\r\n  let groups = [[]];\r\n  // sort;\r\n  const accessor = row => {\r\n    let acc = [];\r\n    if (column.groupByAccessorFunction) {\r\n      acc = acc.concat(column.groupByAccessorFunction({ row }));\r\n    }\r\n    if (column.sortAccessorFunction) {\r\n      acc = acc.concat(column.sortAccessorFunction({ row }));\r\n    }\r\n    return acc;\r\n  };\r\n  if (column.sortAccessorFunction || column.groupByAccessorFunction) {\r\n    d.sort(sortFunction(accessor));\r\n  }\r\n  // group by and window interval\r\n  let values = [];\r\n  d.forEach((row, index) => {\r\n    // row._index = groups[groups.length - 1].length;\r\n    row._window = {\r\n      value: (column.accessorFunction || (({ row }) => row[column.accessor]))({\r\n        row\r\n      }),\r\n      groupBy: column.groupByAccessorFunction\r\n        ? JSON.stringify(column.groupByAccessorFunction({ row }))\r\n        : null\r\n    };\r\n    if (column.comparisonAccessorFunction) {\r\n      row._window.ref = column.comparisonAccessorFunction({ row });\r\n      if (column.startFunction) {\r\n        row._window.start = column.startFunction(row._window.ref);\r\n      }\r\n      if (column.endFunction) {\r\n        row._window.end = column.endFunction(row._window.ref);\r\n      }\r\n    }\r\n    if (index > 0 && row._window.groupBy !== d[index - 1]._window.groupBy) {\r\n      if (!column.comparisonAccessorFunction) {\r\n        const value = column.aggregationFunction(values);\r\n        groups[groups.length - 1].forEach(row => (row[column.id] = value));\r\n        values = [];\r\n      }\r\n      groups.push([]);\r\n    }\r\n    if (!column.comparisonAccessorFunction) {\r\n      values.push(row._window.value);\r\n    }\r\n    groups[groups.length - 1].push(row);\r\n  });\r\n  // computation\r\n  if (column.comparisonAccessorFunction) {\r\n    groups.forEach(group =>\r\n      group.forEach((row, index) => {\r\n        let i = index - 1,\r\n          values = [row._window.value];\r\n        while (\r\n          i >= 0 &&\r\n          (row._window.start === undefined ||\r\n            group[i]._window.ref >= row._window.start)\r\n        ) {\r\n          values.push(group[i]._window.value);\r\n          i--;\r\n        }\r\n        i = index + 1;\r\n        while (\r\n          i < group.length &&\r\n          (row._window.end === undefined ||\r\n            group[i]._window.ref <= row._window.end)\r\n        ) {\r\n          values.push(group[i]._window.value);\r\n          i++;\r\n        }\r\n        row[column.id] = column.aggregationFunction(values);\r\n      })\r\n    );\r\n  } else {\r\n    const value = column.aggregationFunction(values);\r\n    groups[groups.length - 1].forEach(row => (row[column.id] = value));\r\n  }\r\n  return data;\r\n};\r\nexport const groupBy = (data, groupByFunction) => {\r\n  let d = data.concat([]);\r\n  const groups = [[]];\r\n  const map = {};\r\n  d.forEach((row, index) => {\r\n    const groupBy = groupByFunction({ row });\r\n    if (!map[groupBy]) {\r\n      map[groupBy] = [];\r\n    }\r\n    map[groupBy].push(row);\r\n  });\r\n  return groups;\r\n};\r\n// export const computeAudit = (rowUpdated, row, meta, audits) => {\r\n//   const rows = [];\r\n//   if (rowUpdated) {\r\n//     rows.push(rowUpdated);\r\n//   }\r\n//   if (audits && audits.length) {\r\n//     const audits_ = [...audits].reverse();\r\n//     let nextRow = row;\r\n//     audits_.forEach(audit => {\r\n//       const { user_, timestamp_, status_ } = audit;\r\n//       rows.push({\r\n//         ...nextRow,\r\n//         user_,\r\n//         time_: new Date(timestamp_),\r\n//         status_\r\n//       });\r\n//       nextRow = { ...nextRow, ...audit.row };\r\n//     });\r\n//     const foreignObjects = meta.properties.filter(\r\n//       column => column.dataType === \"joined object\"\r\n//     );\r\n//     if (foreignObjects.length) {\r\n//       rows.forEach(row => {\r\n//         foreignObjects.forEach(\r\n//           column => (row[column.id] = column.accessorFunction({ row }))\r\n//         );\r\n//       });\r\n//     }\r\n//   } else if (!rowUpdated) {\r\n//     rows.push(row);\r\n//   }\r\n//   return rows;\r\n// };\r\nexport const computeAudit = (rowUpdated, audits) => {\r\n  const rows = [];\r\n  if (rowUpdated) {\r\n    rows.push(rowUpdated);\r\n  }\r\n  if (audits && audits.length) {\r\n    const audits_ = audits.map(audit => ({\r\n      ...audit,\r\n      time_: new Date(audit.timestamp_)\r\n    }));\r\n    audits_.reverse();\r\n    rows.push(...audits_);\r\n  }\r\n  return rows;\r\n};\r\nexport const getRegExp = v =>\r\n  new RegExp(v.replace(\" \", `[${String.fromCharCode(32, 160)}]`), \"i\");\r\nconst stringValue = (property, row) => {\r\n  const accessor = property.accessorFunction || (({ row }) => row[property.id]);\r\n  const v = accessor({ row });\r\n  if (!utils.isNullOrUndefined(v)) {\r\n    if (property.dataType === \"string\") {\r\n      return v.toUpperCase();\r\n    } else if (property.dataType === \"number\") {\r\n      return utils.numberToString(v);\r\n    } else if (property.dataType === \"date\") {\r\n      return utils.dateToString(v);\r\n    } else {\r\n      return null;\r\n    }\r\n  }\r\n};\r\nexport const computeRowSearch = (data, properties, dataStrings) => {\r\n  const strings = [];\r\n  data.forEach((row, index) => {\r\n    if (!dataStrings[row.index_]) {\r\n      let rowStrings = [];\r\n      properties.forEach(property => {\r\n        const v = stringValue(property, row);\r\n        if (!utils.isNullOrUndefined(v)) {\r\n          rowStrings.push(v);\r\n        }\r\n      });\r\n      dataStrings[row.index_] = rowStrings.join(\"~~\");\r\n    }\r\n    strings.push(dataStrings[row.index_]);\r\n  });\r\n  return strings;\r\n};\r\nexport const rowSearch = (dataStrings, exp) => {\r\n  const indexes = [];\r\n  dataStrings.forEach((rowString, index) => {\r\n    if (exp.test(rowString)) {\r\n      indexes.push(index);\r\n    }\r\n  });\r\n  return indexes;\r\n};\r\nexport const cellSearch = (\r\n  row,\r\n  properties,\r\n  exp,\r\n  propertyStart = 0,\r\n  direction = 1\r\n) => {\r\n  let i = propertyStart;\r\n  while (\r\n    properties.length > i &&\r\n    i >= 0 &&\r\n    !exp.test(stringValue(properties[i], row) || \"\")\r\n  ) {\r\n    i += direction;\r\n  }\r\n  return properties.length > i && i >= 0 ? i : null;\r\n};\r\n","import { utils } from \"zebulon-controls\";\r\nimport { getFunction } from \"./compute.meta\";\r\n// ----------------------------\r\n//  filters\r\n//  ---------------------------\r\nexport const filterFunction = (column, params, data, updatedRows) => {\r\n  const facc = row => {\r\n    let f = column.foreignKeyAccessorFunction || column.accessorFunction;\r\n    if (column.id === \"status_\") {\r\n      const status = (updatedRows || {})[row.index_] || {};\r\n      return (\r\n        1 * (status.updated_ || 0) +\r\n        2 * (status.new_ || 0) +\r\n        4 * (status.deleted_ || 0) +\r\n        8 * ((status.errors || { n_: 0 }).n_ > 0)\r\n      );\r\n    }\r\n\r\n    if (!f) {\r\n      if (\r\n        column.dataType === \"date\" ||\r\n        column.dataType === \"month\" ||\r\n        column.dataType === \"year\"\r\n      ) {\r\n        f = ({ row, column }) => new Date(row[column.id]);\r\n      } else {\r\n        f = ({ row, column }) => row[column.id];\r\n      }\r\n    }\r\n    const v = f({\r\n      row,\r\n      column,\r\n      params,\r\n      status: (updatedRows || {})[row.index_],\r\n      data\r\n    });\r\n    if (\r\n      column.select &&\r\n      v !== null &&\r\n      typeof v === \"object\" &&\r\n      !utils.isDate(v)\r\n    ) {\r\n      return v.value;\r\n    }\r\n    return v;\r\n  };\r\n  if (\r\n    column.dataType === \"date\" ||\r\n    column.dataType === \"month\" ||\r\n    column.dataType === \"year\"\r\n  ) {\r\n    if (!utils.isNullOrUndefined(column.v)) {\r\n      column.v.value = new Date(column.v.value);\r\n    }\r\n    if (!utils.isNullOrUndefined(column.vTo)) {\r\n      column.vTo.value = new Date(column.vTo.value);\r\n    }\r\n  }\r\n  if (column.id === \"status_\") {\r\n    column.f = row => {\r\n      const vRow = facc(row);\r\n      return vRow && (vRow & column.v) !== 0;\r\n    };\r\n  } else if (column.filterType === \"values\") {\r\n    column.f = row => column.v[facc(row)] !== undefined;\r\n  } else if (column.dataType === \"boolean\") {\r\n    column.f = row => (facc(row) || false) === column.v.value;\r\n  } else if (column.filterType === \"=\") {\r\n    column.f = row => facc(row) === column.v.value;\r\n  } else if (column.filterType === \">=\") {\r\n    column.f = row => facc(row) >= column.v.value;\r\n  } else if (column.filterType === \"between\") {\r\n    column.f = row => {\r\n      return (\r\n        (!utils.isNullOrUndefined(column.vTo)\r\n          ? facc(row) <= column.vTo.value\r\n          : true) &&\r\n        (!utils.isNullOrUndefined(column.v)\r\n          ? facc(row) >= column.v.value\r\n          : true)\r\n      );\r\n    };\r\n  } else if (column.filterType === \"<=\") {\r\n    column.f = row => facc(row) <= column.v.value;\r\n  } else if (column.filterType === \"starts (case sensitive)\") {\r\n    column.f = row =>\r\n      String(facc(row) || \"\").startsWith(String(column.v.value || \"\"));\r\n  } else if (column.filterType === \"contains\") {\r\n    column.f = row => {\r\n      return (\r\n        String(facc(row) || \"\").indexOf(String(column.v.value || \"\")) !== -1\r\n      );\r\n    };\r\n  } else if (column.filterType === \"starts\") {\r\n    const v = String(column.v.value).toUpperCase() || \"\";\r\n    column.f = row =>\r\n      String(facc(row) || \"\")\r\n        .toUpperCase()\r\n        .startsWith(v);\r\n  }\r\n};\r\n// -----------------------------\r\nexport const filtersFunction = (filters, params, data, updatedRows) => {\r\n  if (!filters) {\r\n    return x => x;\r\n  }\r\n  const f = Object.values(filters)\r\n    .concat((params || {}).filter_ || [])\r\n    .filter(filter => {\r\n      if (filter.dataType === \"boolean\" && filter.v.value === null) {\r\n        return false;\r\n      }\r\n      return (\r\n        !utils.isNullOrUndefined(filter.v) ||\r\n        (filter.filterType === \"between\" &&\r\n          !utils.isNullOrUndefined(filter.vTo))\r\n      );\r\n    })\r\n    .map(filter => {\r\n      filterFunction(filter, params, data, updatedRows);\r\n      return filter;\r\n    });\r\n  if (!f.length) {\r\n    return row => !((updatedRows || {})[row.index_] || {}).hidden_;\r\n  }\r\n  return row => {\r\n    return (\r\n      !((updatedRows || {})[row.index_] || {}).hidden_ &&\r\n      f.reduce((acc, filter) => acc && filter.f(row), true)\r\n    );\r\n  };\r\n};\r\n// -----------------------------\r\nexport const getFilters = (columns, filters) => {\r\n  if (!columns.length) {\r\n    return filters;\r\n  }\r\n  return columns\r\n    .filter(column => column.v || column.vTo)\r\n    .reduce((acc, column) => {\r\n      let v = column.v,\r\n        vTo = column.vTo,\r\n        filterType = column.filterType;\r\n      if (filters[column.id]) {\r\n        v = filters[column.id].v;\r\n        vTo = filters[column.id].vTo;\r\n        filterType = filters[column.id].filterType;\r\n      }\r\n      if (\r\n        !utils.isNullOrUndefined(v) ||\r\n        (column.filterType === \"between\" &&\r\n          !utils.isNullOrUndefined(column.vTo))\r\n      ) {\r\n        acc[column.id] = {\r\n          id: column.id,\r\n          dataType: column.dataType,\r\n          filterType,\r\n          v,\r\n          vTo,\r\n          accessor: column.accessor,\r\n          accessorFunction: column.accessorFunction\r\n        };\r\n      }\r\n      return acc;\r\n    }, {});\r\n};\r\n// ----------------------------\r\n//  sorts\r\n//  ---------------------------\r\nexport const sortsFunction = sorts => {\r\n  return (rowA, rowB) =>\r\n    sorts.reduce((acc, sort) => {\r\n      const accessor = sort.accessor || (({ row }) => row[sort.id]);\r\n      if (acc === 0) {\r\n        const a = accessor({ row: rowA }),\r\n          b = accessor({ row: rowB });\r\n        acc = ((a > b) - (b > a)) * (sort.direction === \"asc\" ? 1 : -1);\r\n      }\r\n      return acc;\r\n    }, 0);\r\n};\r\n// -----------------------------------------\r\nexport const getSorts = columns => {\r\n  const sorts = columns\r\n    .filter(column => column.sort !== undefined)\r\n    .map(column => {\r\n      let fNullValue = x => utils.nullValue(x, \"\");\r\n      if (column.dataType === \"number\" || column.dataType === \"boolean\") {\r\n        fNullValue = x => utils.nullValue(x, -Infinity);\r\n      } else if (column.dataType === \"date\") {\r\n        fNullValue = x => utils.nullValue(x, new Date(null));\r\n      }\r\n      // else if (column.dataType === \"string\") {\r\n      //   nullValue = \"\";\r\n      // }\r\n      return {\r\n        id: column.id,\r\n        sortOrder: column.sortOrder,\r\n        direction: column.sort,\r\n        accessor:\r\n          column.sortAccessorFunction || column.accessorFunction\r\n            ? message => fNullValue(column.accessorFunction(message))\r\n            : ({ row }) => fNullValue(row[column.id])\r\n      };\r\n    });\r\n  sorts.sort(\r\n    (a, b) => (a.sortOrder > b.sortOrder) - (b.sortOrder > a.sortOrder)\r\n  );\r\n  return sorts;\r\n};\r\n","import React from \"react\";\r\nimport { utils } from \"zebulon-controls\";\r\nimport { buildObject, buildFunctionsObject } from \"./utils/utils\";\r\n// import { datasetFunctions } from \"../demo/dataset.functions\";\r\n\r\nconst stringToFunction = (row, functions) => {\r\n\trow.functionJS = functions.evalProtectedFunction(row.functionText);\r\n\treturn true;\r\n};\r\nexport const onNext = (data, message) => {\r\n\tconst indexedColumn =\r\n\t\tmessage.meta.table.rowId || message.meta.table.primaryKey;\r\n\tdata.forEach(row => {\r\n\t\t//  a voir deleted row on server side + conflict (zebulon table) => recreation of the row (new_=true) index_=...\r\n\t\tif (message.index) {\r\n\t\t\tconst index = message.index[row[indexedColumn]];\r\n\t\t\tif (index !== undefined) {\r\n\t\t\t\trow.index_ = index;\r\n\t\t\t\tconst status = message.updatedRows[index];\r\n\t\t\t\tif (status) {\r\n\t\t\t\t\tstatus.row = row;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tmessage.data[index] = row;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tmessage.index[row[message.meta.table.primaryKey]] =\r\n\t\t\t\t\tmessage.data.length;\r\n\t\t\t\tmessage.data.push(row);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tmessage.data.push(row);\r\n\t\t}\r\n\t});\r\n};\r\nexport const onCompleted = message => {};\r\nexport const onError = (e, message) => {};\r\nconst isLocal = ({ row, status }) => (status || {}).new_ || row.isLocal;\r\nconst inherited = (value, inheritedValue, canInherit) => {\r\n\tif (\r\n\t\tcanInherit &&\r\n\t\tutils.isNullValue(value) &&\r\n\t\t!utils.isNullValue(inheritedValue)\r\n\t) {\r\n\t\treturn <div style={{ color: \"blue\" }}>{inheritedValue}</div>;\r\n\t}\r\n\treturn value;\r\n};\r\nexport const metaFunctions = {\r\n\tdataset: {\r\n\t\tactions: {\r\n\t\t\texportMeta: functionsObject => {\r\n\t\t\t\treturn ({ meta, datasetFunctions }) => {\r\n\t\t\t\t\t// const excludes = {\r\n\t\t\t\t\t// \tserverPagination: true,\r\n\t\t\t\t\t// \tzoom: true,\r\n\t\t\t\t\t// \tindexRowId: true,\r\n\t\t\t\t\t// \tcomputedWidth: true,\r\n\t\t\t\t\t// \trwd: true,\r\n\t\t\t\t\t// \ttp: true,\r\n\t\t\t\t\t// \tvisibleIndexes: true,\r\n\t\t\t\t\t// \tstatusDraggable: true,\r\n\t\t\t\t\t// \tvisibleIndex_: true,\r\n\t\t\t\t\t// \tindex_: true,\r\n\t\t\t\t\t// \tposition: true\r\n\t\t\t\t\t// };\r\n\t\t\t\t\tconst r = buildFunctionsObject(meta, functionsObject, [\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tpath: \"../demo/dataset.functions\",\r\n\t\t\t\t\t\t\tobject: datasetFunctions\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t]);\r\n\t\t\t\t\t// const r =\r\n\t\t\t\t\t// \t\"userMeta = {meta : \" +\r\n\t\t\t\t\t// \tJSON.stringify(buildObject(meta, excludes)) +\r\n\t\t\t\t\t// \t\",\" +\r\n\t\t\t\t\t// \tfunctions;\r\n\t\t\t\t\t// functions\r\n\t\t\t\t\t// \t.slice(1, functions.length - 1)\r\n\t\t\t\t\t// \t.replace(/\\\\\"/g, '\"') +\r\n\t\t\t\t\t// \";\";\r\n\t\t\t\t\t// console.log(meta, r);\r\n\t\t\t\t\tutils.exportFile(r, \"meta.txt\", \"text\");\r\n\t\t\t\t\treturn r;\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\tproperties: {\r\n\t\taccessors: {\r\n\t\t\tpropertyType: ({ row, status, meta }) => {\r\n\t\t\t\tif (row.reference) {\r\n\t\t\t\t\treturn row.reference;\r\n\t\t\t\t} else if (row.analytic) {\r\n\t\t\t\t\treturn \"analytic\";\r\n\t\t\t\t} else if (row.accessor || (status || {}).new_) {\r\n\t\t\t\t\treturn \"computed\";\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn \"dataset\";\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tsorts: {},\r\n\t\tformats: {\r\n\t\t\tisArrayOrFunction: ({ value }) => {\r\n\t\t\t\tif (typeof value === \"function\" || Array.isArray(value)) {\r\n\t\t\t\t\treturn (\r\n\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\tstyle={{\r\n\t\t\t\t\t\t\t\tbackgroundColor: \"#f5f7da\",\r\n\t\t\t\t\t\t\t\tfontStyle: \"italic\"\r\n\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t{Array.isArray(value) ? \"array[]\" : \"fct()\"}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t\treturn value;\r\n\t\t\t}\r\n\t\t},\r\n\t\taggregations: {},\r\n\t\tselects: {},\r\n\t\tvalidators: {\r\n\t\t\trow: ({ row, status, data, params }) => {}\r\n\t\t},\r\n\t\teditables: {\r\n\t\t\tisDataset: ({ row }) => row.tp === \"Dataset\",\r\n\t\t\tisNotDataset: ({ row }) => row.tp !== \"Dataset\",\r\n\t\t\tisAnalytic: ({ row }) => row.tp === \"Analytic\"\r\n\t\t},\r\n\t\tdefaults: {},\r\n\t\trow: () => {},\r\n\t\ttable: () => {}\r\n\t},\r\n\tfunctions: {\r\n\t\taccessors: {\r\n\t\t\tfunctionDescriptor: ({ row }) => {\r\n\t\t\t\tlet label;\r\n\t\t\t\tif (row.tp === \"accessor\") {\r\n\t\t\t\t\tlabel = \"Parameters: ({row,status,data,params,utils})\";\r\n\t\t\t\t} else if (row.tp === \"editable\") {\r\n\t\t\t\t\tlabel = \"Parameters: ({row,status,data,params})\";\r\n\t\t\t\t} else if (row.tp === \"select\") {\r\n\t\t\t\t\tlabel = \"Parameters: ({row,status,data,params})\";\r\n\t\t\t\t} else if (row.tp === \"validator\") {\r\n\t\t\t\t\tlabel = \"Parameters: ({row,status,data,params})\";\r\n\t\t\t\t} else if (row.tp === \"format\") {\r\n\t\t\t\t\tlabel = \"Parameters: (value,row,status,data,params)\";\r\n\t\t\t\t} else if (row.tp === \"aggregation\") {\r\n\t\t\t\t\tlabel = \"Parameters: ([values])\";\r\n\t\t\t\t} else if (row.tp === \"sort\") {\r\n\t\t\t\t\tlabel = \"Parameters: (rowA, rowB)\";\r\n\t\t\t\t} else if (row.tp === \"window\") {\r\n\t\t\t\t\tlabel = \"Parameters: (value)\";\r\n\t\t\t\t}\r\n\t\t\t\treturn `${row.caption || row.id} : ${label}`;\r\n\t\t\t},\r\n\t\t\tisLocal\r\n\t\t},\r\n\t\tvalidators: {\r\n\t\t\tstringToFunction\r\n\t\t},\r\n\t\tactions: {\r\n\t\t\texportFunctions: ({ data }) =>\r\n\t\t\t\t\"functions = \" + buildFunctionsObject(data)\r\n\t\t},\r\n\t\teditables: { isLocal }\r\n\t},\r\n\tdimensions: {\r\n\t\taccessors: {\r\n\t\t\tsortAcc: ({ row }) => (row.sort || {}).keyAccessor,\r\n\t\t\tsortFct: ({ row }) => (row.sort || {}).custom,\r\n\t\t\tisLocal\r\n\t\t},\r\n\t\tvalidators: {\r\n\t\t\tsortAcc: ({ row }) =>\r\n\t\t\t\t(row.sort = {\r\n\t\t\t\t\t...(row.sort || {}),\r\n\t\t\t\t\tkeyAccessor: row.sortAccessor\r\n\t\t\t\t}),\r\n\t\t\tsortFct: ({ row }) =>\r\n\t\t\t\t(row.sort = {\r\n\t\t\t\t\t...(row.sort || {}),\r\n\t\t\t\t\tcustom: row.sortFunction\r\n\t\t\t\t})\r\n\t\t},\r\n\t\teditables: {\r\n\t\t\tisLocal\r\n\t\t}\r\n\t},\r\n\tmeasures: {\r\n\t\taccessors: {\r\n\t\t\tisLocal\r\n\t\t},\r\n\t\teditables: {\r\n\t\t\tisLocal\r\n\t\t}\r\n\t},\r\n\tglobals_: {\r\n\t\teditables: {\r\n\t\t\tis_selected: ({ row }) => row.index_ !== undefined,\r\n\t\t\tis_new: ({ status }) => status.new_\r\n\t\t},\r\n\t\tobservers: {\r\n\t\t\tonNext,\r\n\t\t\tonCompleted,\r\n\t\t\tonError\r\n\t\t},\r\n\t\tvalidators: {\r\n\t\t\toverwrite: x => true\r\n\t\t}\r\n\t}\r\n};\r\n\r\nexport const setPropertyAccessors = (properties, data) => {\r\n\tconst accessors = {};\r\n\tproperties.forEach(property => {\r\n\t\taccessors[property.id] = {\r\n\t\t\tid: `row.${property.id}`,\r\n\t\t\tcaption: `${property.id}`,\r\n\t\t\ttype: \"property\"\r\n\t\t};\r\n\t\tif (\r\n\t\t\tdata &&\r\n\t\t\t(property.dataType === \"object\" ||\r\n\t\t\t\tproperty.dataType === \"joined object\")\r\n\t\t) {\r\n\t\t\tdata.forEach(row => {\r\n\t\t\t\tif (!utils.isNullValue(row[property.id])) {\r\n\t\t\t\t\tObject.keys(row[property.id]).forEach(key => {\r\n\t\t\t\t\t\taccessors[property.id + \".\" + key] = {\r\n\t\t\t\t\t\t\tid: `row.${property.id}.${key}`,\r\n\t\t\t\t\t\t\tcaption: `${property.id}.${key}`,\r\n\t\t\t\t\t\t\ttype: \"object property\"\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n\tpropertyAccessors = accessors;\r\n};\r\nlet propertyAccessors = {};\r\n\r\nexport const metaDescriptions = (object, source, functions, callbacks = {}) => {\r\n\tconst getFunctions = type => {\r\n\t\treturn functions\r\n\t\t\t.getFunctionsArray(object, type, source)\r\n\t\t\t.reduce((acc, f) => {\r\n\t\t\t\tacc[f.id] = {\r\n\t\t\t\t\tid: f.id,\r\n\t\t\t\t\tcaption: f.caption || f.id,\r\n\t\t\t\t\ttype: \"function\",\r\n\t\t\t\t\tstyle: { color: \"blue\" }\r\n\t\t\t\t};\r\n\t\t\t\treturn acc;\r\n\t\t\t}, {});\r\n\t};\r\n\tconst getAccessorsAndProperties = () => {\r\n\t\tconst dataAccessors = propertyAccessors;\r\n\t\tconst accessors = getFunctions(\"accessors\");\r\n\t\treturn {\r\n\t\t\t...dataAccessors,\r\n\t\t\t...accessors\r\n\t\t};\r\n\t};\r\n\tconst getAggregations = () => getFunctions(\"aggregations\");\r\n\tconst getFormats = () => getFunctions(\"formats\");\r\n\tconst getSorts = () => getFunctions(\"sorts\");\r\n\tconst getWindowFunctions = () => getFunctions(\"windows\");\r\n\tconst getSelects = () => getFunctions(\"selects\");\r\n\tconst getValidators = () => getFunctions(\"validators\");\r\n\tconst getDefaults = () => getFunctions(\"defaults\");\r\n\tconst getAnalytics = () => getFunctions(\"analytics\");\r\n\tconst getForeignObjects = () => getFunctions(\"foreignObjects\");\r\n\treturn {\r\n\t\tdataset: {\r\n\t\t\ttable: {\r\n\t\t\t\tobject: \"dataset\",\r\n\t\t\t\teditable: true,\r\n\t\t\t\tnoFilter: false,\r\n\t\t\t\t// caption: \"Dataset\",\r\n\t\t\t\tactions: [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\ttype: \"insert\",\r\n\t\t\t\t\t\tcaption: \"New\",\r\n\t\t\t\t\t\tenable: true,\r\n\t\t\t\t\t\tkey: \"f2\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\ttype: \"delete\",\r\n\t\t\t\t\t\tcaption: \"Delete\",\r\n\t\t\t\t\t\tenable: \"is_selected\",\r\n\t\t\t\t\t\tkey: \"f3\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\ttype: \"duplicate\",\r\n\t\t\t\t\t\tcaption: \"Duplicate\",\r\n\t\t\t\t\t\tenable: \"is_selected\",\r\n\t\t\t\t\t\tkey: \"f4\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\ttype: \"save\",\r\n\t\t\t\t\t\tcaption: \"Save\",\r\n\t\t\t\t\t\tenable: true,\r\n\t\t\t\t\t\tkey: \"f12\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\ttype: \"refresh\",\r\n\t\t\t\t\t\tcaption: \"Refresh\",\r\n\t\t\t\t\t\tenable: true,\r\n\t\t\t\t\t\tkey: \"10\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\ttype: \"action\",\r\n\t\t\t\t\t\tenable: true,\r\n\t\t\t\t\t\thidden: true,\r\n\t\t\t\t\t\taction: \"toggleFilter\",\r\n\t\t\t\t\t\tkey: \"f11\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\ttype: \"action\",\r\n\t\t\t\t\t\tcaption: \"Export Meta\",\r\n\t\t\t\t\t\tenable: true,\r\n\t\t\t\t\t\taction: \"exportMeta\"\r\n\t\t\t\t\t}\r\n\t\t\t\t]\r\n\t\t\t},\r\n\t\t\trow: {},\r\n\t\t\tproperties: []\r\n\t\t},\r\n\t\tproperties: {\r\n\t\t\ttable: {\r\n\t\t\t\tobject: \"properties\",\r\n\t\t\t\teditable: true,\r\n\t\t\t\tprimaryKey: \"id\",\r\n\t\t\t\tcode: \"caption\",\r\n\t\t\t\tnoDataMutation: true,\r\n\t\t\t\tonSave: callbacks.applyProperties,\r\n\t\t\t\tactions: [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\ttype: \"insert\",\r\n\t\t\t\t\t\tcaption: \"New\",\r\n\t\t\t\t\t\tenable: true,\r\n\t\t\t\t\t\tkey: \"f2\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\ttype: \"delete\",\r\n\t\t\t\t\t\tcaption: \"Delete\",\r\n\t\t\t\t\t\tenable: \"isNotDataset\",\r\n\t\t\t\t\t\tkey: \"f3\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\ttype: \"duplicate\",\r\n\t\t\t\t\t\tcaption: \"Duplicate\",\r\n\t\t\t\t\t\tenable: \"is_selected\",\r\n\t\t\t\t\t\tkey: \"f4\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\ttype: \"action\",\r\n\t\t\t\t\t\tenable: true,\r\n\t\t\t\t\t\thidden: true,\r\n\t\t\t\t\t\taction: \"toggleFilter\",\r\n\t\t\t\t\t\tkey: \"f11\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\ttype: \"save\",\r\n\t\t\t\t\t\tcaption: \"Apply\",\r\n\t\t\t\t\t\tenable: true,\r\n\t\t\t\t\t\tkey: \"f12\"\r\n\t\t\t\t\t}\r\n\t\t\t\t]\r\n\t\t\t},\r\n\t\t\trow: {},\r\n\t\t\tproperties: [\r\n\t\t\t\t{\r\n\t\t\t\t\tid: \"id\",\r\n\t\t\t\t\tcaption: \"Column\",\r\n\t\t\t\t\twidth: 100,\r\n\t\t\t\t\tdataType: \"string\",\r\n\t\t\t\t\teditable: \"isNotDataset\",\r\n\t\t\t\t\tmandatory: true,\r\n\t\t\t\t\tlocked: true\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tid: \"tp\",\r\n\t\t\t\t\tcaption: \"Type\",\r\n\t\t\t\t\twidth: 150,\r\n\t\t\t\t\tdataType: \"string\",\r\n\t\t\t\t\teditable: false,\r\n\t\t\t\t\tdefault: \"Computed\",\r\n\t\t\t\t\taccessor: \"propertyType\",\r\n\t\t\t\t\tfilterType: \"values\"\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tid: \"dataType\",\r\n\t\t\t\t\tcaption: \"Data type\",\r\n\t\t\t\t\twidth: 100,\r\n\t\t\t\t\tdataType: \"string\",\r\n\t\t\t\t\teditable: \"isNotDataset\",\r\n\t\t\t\t\tfilterType: \"values\",\r\n\t\t\t\t\tselect: [\r\n\t\t\t\t\t\t\"number\",\r\n\t\t\t\t\t\t\"string\",\r\n\t\t\t\t\t\t\"text\",\r\n\t\t\t\t\t\t\"date\",\r\n\t\t\t\t\t\t\"boolean\",\r\n\t\t\t\t\t\t\"object\",\r\n\t\t\t\t\t\t\"joined object\"\r\n\t\t\t\t\t]\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tid: \"caption\",\r\n\t\t\t\t\tcaption: \"Caption\",\r\n\t\t\t\t\twidth: 150,\r\n\t\t\t\t\tdataType: \"string\",\r\n\t\t\t\t\teditable: true\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tid: \"editable\",\r\n\t\t\t\t\tcaption: \"Editable\",\r\n\t\t\t\t\twidth: 80,\r\n\t\t\t\t\tdataType: \"boolean\",\r\n\t\t\t\t\teditable: true,\r\n\t\t\t\t\tdefault: false\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tid: \"mandatory\",\r\n\t\t\t\t\tcaption: \"Mandatory\",\r\n\t\t\t\t\twidth: 90,\r\n\t\t\t\t\tdataType: \"boolean\",\r\n\t\t\t\t\teditable: true,\r\n\t\t\t\t\tdefault: true\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tid: \"hidden\",\r\n\t\t\t\t\tcaption: \"Hidden\",\r\n\t\t\t\t\twidth: 80,\r\n\t\t\t\t\tdataType: \"boolean\",\r\n\t\t\t\t\teditable: true,\r\n\t\t\t\t\tdefault: false\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tid: \"width\",\r\n\t\t\t\t\tcaption: \"Width\",\r\n\t\t\t\t\twidth: 60,\r\n\t\t\t\t\tdataType: \"number\",\r\n\t\t\t\t\teditable: true,\r\n\t\t\t\t\tdefault: 100\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tid: \"format\",\r\n\t\t\t\t\tcaption: \"Format\",\r\n\t\t\t\t\twidth: 100,\r\n\t\t\t\t\tdataType: \"string\",\r\n\t\t\t\t\teditable: true,\r\n\t\t\t\t\tfilterType: \"values\",\r\n\t\t\t\t\tselect: getFormats\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tid: \"filterType\",\r\n\t\t\t\t\tcaption: \"Filter\",\r\n\t\t\t\t\twidth: 100,\r\n\t\t\t\t\tdataType: \"string\",\r\n\t\t\t\t\teditable: true,\r\n\t\t\t\t\tselect: [\r\n\t\t\t\t\t\t\"starts\",\r\n\t\t\t\t\t\t\"starts (case sensitive)\",\r\n\t\t\t\t\t\t\"contains\",\r\n\t\t\t\t\t\t\"=\",\r\n\t\t\t\t\t\t\">=\",\r\n\t\t\t\t\t\t\"<=\",\r\n\t\t\t\t\t\t\"between\",\r\n\t\t\t\t\t\t\"values\"\r\n\t\t\t\t\t]\r\n\t\t\t\t},\r\n\t\t\t\t// only for new properties\r\n\t\t\t\t{\r\n\t\t\t\t\tid: \"accessor\",\r\n\t\t\t\t\tcaption: \"Accessor\",\r\n\t\t\t\t\twidth: 150,\r\n\t\t\t\t\tdataType: \"string\",\r\n\t\t\t\t\teditable: \"isNotDataset\",\r\n\t\t\t\t\thidden: false,\r\n\t\t\t\t\tfilterType: \"values\",\r\n\t\t\t\t\tselect: getAccessorsAndProperties,\r\n\t\t\t\t\tformat: \"isArrayOrFunction\"\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tid: \"select\",\r\n\t\t\t\t\tcaption: \"Select\",\r\n\t\t\t\t\twidth: 100,\r\n\t\t\t\t\tdataType: \"string\",\r\n\t\t\t\t\teditable: true,\r\n\t\t\t\t\tfilterType: \"values\",\r\n\t\t\t\t\tselect: getSelects,\r\n\t\t\t\t\tformat: \"isArrayOrFunction\"\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tid: \"default\",\r\n\t\t\t\t\tcaption: \"Default\",\r\n\t\t\t\t\twidth: 100,\r\n\t\t\t\t\tdataType: \"string\",\r\n\t\t\t\t\teditable: true,\r\n\t\t\t\t\t// hidden: true,\r\n\t\t\t\t\tfilterType: \"values\",\r\n\t\t\t\t\tselect: getDefaults\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tid: \"foreignObject\",\r\n\t\t\t\t\tcaption: \"Foreign object\",\r\n\t\t\t\t\twidth: 150,\r\n\t\t\t\t\tdataType: \"string\",\r\n\t\t\t\t\teditable: true,\r\n\t\t\t\t\tselect: getForeignObjects,\r\n\t\t\t\t\tformat: \"isArrayOrFunction\"\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tid: \"analytic\",\r\n\t\t\t\t\tcaption: \"Analytic function\",\r\n\t\t\t\t\twidth: 150,\r\n\t\t\t\t\tdataType: \"string\",\r\n\t\t\t\t\teditable: true,\r\n\t\t\t\t\tselect: getAnalytics,\r\n\t\t\t\t\tformat: \"isArrayOrFunction\"\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tid: \"onChange\",\r\n\t\t\t\t\tcaption: \"On change\",\r\n\t\t\t\t\twidth: 100,\r\n\t\t\t\t\tdataType: \"string\",\r\n\t\t\t\t\teditable: true,\r\n\t\t\t\t\tfilterType: \"values\",\r\n\t\t\t\t\tselect: getValidators,\r\n\t\t\t\t\tformat: \"isArrayOrFunction\"\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tid: \"onQuit\",\r\n\t\t\t\t\tcaption: \"On cell quit\",\r\n\t\t\t\t\twidth: 100,\r\n\t\t\t\t\tdataType: \"string\",\r\n\t\t\t\t\teditable: true,\r\n\t\t\t\t\tfilterType: \"values\",\r\n\t\t\t\t\tselect: getValidators,\r\n\t\t\t\t\tformat: \"isArrayOrFunction\"\r\n\t\t\t\t}\r\n\t\t\t]\r\n\t\t},\r\n\t\tfunctions: {\r\n\t\t\ttable: {\r\n\t\t\t\tobject: \"functions\",\r\n\t\t\t\teditable: true,\r\n\t\t\t\tprimaryKey: \"id\",\r\n\t\t\t\tcode: \"caption\",\r\n\t\t\t\tonSave: callbacks.applyFunctions,\r\n\t\t\t\tactions: [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\ttype: \"insert\",\r\n\t\t\t\t\t\tcaption: \"New\",\r\n\t\t\t\t\t\tenable: true,\r\n\t\t\t\t\t\tkey: \"f2\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\ttype: \"delete\",\r\n\t\t\t\t\t\tcaption: \"Delete\",\r\n\t\t\t\t\t\tenable: \"isLocal\",\r\n\t\t\t\t\t\tkey: \"f3\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\ttype: \"duplicate\",\r\n\t\t\t\t\t\tcaption: \"Duplicate\",\r\n\t\t\t\t\t\tenable: \"is_selected\",\r\n\t\t\t\t\t\tkey: \"f4\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\ttype: \"save\",\r\n\t\t\t\t\t\tcaption: \"Apply\",\r\n\t\t\t\t\t\tenable: true,\r\n\t\t\t\t\t\thidden: !callbacks.applyFunctions,\r\n\t\t\t\t\t\tkey: \"f12\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\ttype: \"action\",\r\n\t\t\t\t\t\tcaption: \"Export functions\",\r\n\t\t\t\t\t\taction: \"exportFunctions\",\r\n\t\t\t\t\t\thidden: true\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\ttype: \"action\",\r\n\t\t\t\t\t\tenable: true,\r\n\t\t\t\t\t\thidden: true,\r\n\t\t\t\t\t\taction: \"toggleFilter\",\r\n\t\t\t\t\t\tkey: \"f11\"\r\n\t\t\t\t\t}\r\n\t\t\t\t]\r\n\t\t\t},\r\n\t\t\trow: { descriptor: \"functionDescriptor\" },\r\n\t\t\tproperties: [\r\n\t\t\t\t{\r\n\t\t\t\t\tid: \"id\",\r\n\t\t\t\t\tcaption: \"Code\",\r\n\t\t\t\t\twidth: 100,\r\n\t\t\t\t\tdataType: \"string\",\r\n\t\t\t\t\teditable: \"isLocal\",\r\n\t\t\t\t\tmandatory: true,\r\n\t\t\t\t\tlocked: true\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tid: \"caption\",\r\n\t\t\t\t\tcaption: \"Caption\",\r\n\t\t\t\t\twidth: 150,\r\n\t\t\t\t\tdataType: \"string\",\r\n\t\t\t\t\teditable: true,\r\n\t\t\t\t\tfilterType: \"between\"\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tid: \"visibility\",\r\n\t\t\t\t\tcaption: \"Visibility\",\r\n\t\t\t\t\twidth: 150,\r\n\t\t\t\t\tdataType: \"string\",\r\n\t\t\t\t\teditable: \"isLocal\",\r\n\t\t\t\t\tselect: source\r\n\t\t\t\t\t\t? [object, source, \"globals_\"]\r\n\t\t\t\t\t\t: [object, \"globals_\"],\r\n\t\t\t\t\tfilterType: \"values\",\r\n\t\t\t\t\tmandatory: true,\r\n\t\t\t\t\tdefault: \"global\"\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tid: \"tp\",\r\n\t\t\t\t\tcaption: \"Type\",\r\n\t\t\t\t\twidth: 150,\r\n\t\t\t\t\tdataType: \"string\",\r\n\t\t\t\t\teditable: \"isLocal\",\r\n\t\t\t\t\tfilterType: \"values\",\r\n\t\t\t\t\tselect: [\r\n\t\t\t\t\t\t\"actions\",\r\n\t\t\t\t\t\t\"accessors\",\r\n\t\t\t\t\t\t\"aggregations\",\r\n\t\t\t\t\t\t\"formats\",\r\n\t\t\t\t\t\t\"sorts\",\r\n\t\t\t\t\t\t\"windows\",\r\n\t\t\t\t\t\t\"selects\",\r\n\t\t\t\t\t\t\"validators\",\r\n\t\t\t\t\t\t\"editables\",\r\n\t\t\t\t\t\t\"defaults\",\r\n\t\t\t\t\t\t\"descriptors\",\r\n\t\t\t\t\t\t\"dmls\"\r\n\t\t\t\t\t]\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tid: \"isLocal\",\r\n\t\t\t\t\tcaption: \"Local\",\r\n\t\t\t\t\taccessor: \"isLocal\",\r\n\t\t\t\t\twidth: 80,\r\n\t\t\t\t\tdataType: \"boolean\",\r\n\t\t\t\t\tdefault: true\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tid: \"functionText\",\r\n\t\t\t\t\tcaption: \"Function\",\r\n\t\t\t\t\t// accessor: \"functionToString\",\r\n\t\t\t\t\tonQuit: ({ row }) => stringToFunction(row, functions),\r\n\t\t\t\t\twidth: 500,\r\n\t\t\t\t\tdataType: \"text\",\r\n\t\t\t\t\teditable: \"isLocal\"\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tid: \"functionJS\",\r\n\t\t\t\t\tcaption: \"Function\",\r\n\t\t\t\t\t// accessor: \"functionToString\",\r\n\t\t\t\t\t// onQuit: \"stringToFunction\",\r\n\t\t\t\t\thidden: true\r\n\t\t\t\t}\r\n\t\t\t]\r\n\t\t},\r\n\t\tmeasures: {\r\n\t\t\ttable: {\r\n\t\t\t\tobject: \"measures\",\r\n\t\t\t\teditable: true,\r\n\t\t\t\tprimaryKey: \"id\",\r\n\t\t\t\tcode: \"caption\",\r\n\t\t\t\tonSave: callbacks.applyMeasures,\r\n\t\t\t\tactions: [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\ttype: \"insert\",\r\n\t\t\t\t\t\tcaption: \"New\",\r\n\t\t\t\t\t\tenable: true,\r\n\t\t\t\t\t\tkey: \"f2\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\ttype: \"delete\",\r\n\t\t\t\t\t\tcaption: \"Delete\",\r\n\t\t\t\t\t\tenable: \"is_selected\",\r\n\t\t\t\t\t\tkey: \"f3\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\ttype: \"duplicate\",\r\n\t\t\t\t\t\tcaption: \"Duplicate\",\r\n\t\t\t\t\t\tenable: \"is_selected\",\r\n\t\t\t\t\t\tkey: \"f4\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\ttype: \"save\",\r\n\t\t\t\t\t\tcaption: \"Apply\",\r\n\t\t\t\t\t\tenable: true,\r\n\t\t\t\t\t\tkey: \"f12\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\ttype: \"action\",\r\n\t\t\t\t\t\tenable: true,\r\n\t\t\t\t\t\thidden: true,\r\n\t\t\t\t\t\taction: \"toggleFilter\",\r\n\t\t\t\t\t\tkey: \"f11\"\r\n\t\t\t\t\t}\r\n\t\t\t\t]\r\n\t\t\t},\r\n\t\t\trow: {},\r\n\t\t\tproperties: [\r\n\t\t\t\t{\r\n\t\t\t\t\tid: \"id\",\r\n\t\t\t\t\tcaption: \"id\",\r\n\t\t\t\t\twidth: 100,\r\n\t\t\t\t\tdataType: \"string\",\r\n\t\t\t\t\teditable: \"isLocal\",\r\n\t\t\t\t\tmandatory: true\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tid: \"caption\",\r\n\t\t\t\t\tcaption: \"caption\",\r\n\t\t\t\t\twidth: 150,\r\n\t\t\t\t\tdataType: \"string\",\r\n\t\t\t\t\teditable: true\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tid: \"valueAccessor\",\r\n\t\t\t\t\tcaption: \"Value accessor\",\r\n\t\t\t\t\twidth: 150,\r\n\t\t\t\t\tdataType: \"string\",\r\n\t\t\t\t\teditable: \"isLocal\",\r\n\t\t\t\t\tmandatory: true,\r\n\t\t\t\t\tfilterType: \"values\",\r\n\t\t\t\t\tselect: getAccessorsAndProperties\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tid: \"localFormat\",\r\n\t\t\t\t\tcaption: \"format\",\r\n\t\t\t\t\twidth: 150,\r\n\t\t\t\t\tdataType: \"string\",\r\n\t\t\t\t\teditable: true,\r\n\t\t\t\t\tfilterType: \"values\",\r\n\t\t\t\t\tselect: getFormats,\r\n\t\t\t\t\taccessor: ({ row }) =>\r\n\t\t\t\t\t\tutils.nullValue(row.localFormat, row.format),\r\n\t\t\t\t\tonQuit: \"overwrite\",\r\n\t\t\t\t\tformat: ({ value, row }) =>\r\n\t\t\t\t\t\tinherited(row.localFormat, row.format)\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tid: \"aggregation\",\r\n\t\t\t\t\tcaption: \"aggregation\",\r\n\t\t\t\t\twidth: 150,\r\n\t\t\t\t\tdataType: \"string\",\r\n\t\t\t\t\teditable: \"isLocal\",\r\n\t\t\t\t\tmandatory: true,\r\n\t\t\t\t\tdefault: \"sum\",\r\n\t\t\t\t\tfilterType: \"values\",\r\n\t\t\t\t\tselect: getAggregations\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tid: \"isLocal\",\r\n\t\t\t\t\tcaption: \"Local\",\r\n\t\t\t\t\taccessor: \"isLocal\",\r\n\t\t\t\t\twidth: 80,\r\n\t\t\t\t\tdataType: \"boolean\",\r\n\t\t\t\t\tdefault: true\r\n\t\t\t\t}\r\n\t\t\t]\r\n\t\t},\r\n\t\tdimensions: {\r\n\t\t\ttable: {\r\n\t\t\t\tobject: \"dimensions\",\r\n\t\t\t\teditable: true,\r\n\t\t\t\tprimaryKey: \"id\",\r\n\t\t\t\tcode: \"caption\",\r\n\t\t\t\tonSave: callbacks.applyDimensions,\r\n\t\t\t\tactions: [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\ttype: \"insert\",\r\n\t\t\t\t\t\tcaption: \"New\",\r\n\t\t\t\t\t\tenable: true,\r\n\t\t\t\t\t\tkey: \"f2\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\ttype: \"delete\",\r\n\t\t\t\t\t\tcaption: \"Delete\",\r\n\t\t\t\t\t\tenable: \"is_selected\",\r\n\t\t\t\t\t\tkey: \"f3\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\ttype: \"duplicate\",\r\n\t\t\t\t\t\tcaption: \"Duplicate\",\r\n\t\t\t\t\t\tenable: \"is_selected\",\r\n\t\t\t\t\t\tkey: \"f4\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\ttype: \"save\",\r\n\t\t\t\t\t\tcaption: \"Apply\",\r\n\t\t\t\t\t\t// action: callbacks.applyDimensions,\r\n\t\t\t\t\t\tenable: true,\r\n\t\t\t\t\t\tkey: \"f12\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\ttype: \"action\",\r\n\t\t\t\t\t\tenable: true,\r\n\t\t\t\t\t\thidden: true,\r\n\t\t\t\t\t\taction: \"toggleFilter\",\r\n\t\t\t\t\t\tkey: \"f11\"\r\n\t\t\t\t\t}\r\n\t\t\t\t]\r\n\t\t\t},\r\n\t\t\trow: {},\r\n\t\t\tproperties: [\r\n\t\t\t\t{\r\n\t\t\t\t\tid: \"id\",\r\n\t\t\t\t\tcaption: \"Dimension\",\r\n\t\t\t\t\twidth: 100,\r\n\t\t\t\t\tdataType: \"string\",\r\n\t\t\t\t\teditable: \"isLocal\"\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tid: \"caption\",\r\n\t\t\t\t\tcaption: \"Caption\",\r\n\t\t\t\t\twidth: 150,\r\n\t\t\t\t\tdataType: \"string\",\r\n\t\t\t\t\teditable: true\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tid: \"keyAccessor\",\r\n\t\t\t\t\tcaption: \"Key accessor\",\r\n\t\t\t\t\twidth: 150,\r\n\t\t\t\t\tdataType: \"string\",\r\n\t\t\t\t\teditable: \"isLocal\",\r\n\t\t\t\t\tfilterType: \"values\",\r\n\t\t\t\t\tselect: getAccessorsAndProperties\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tid: \"localLabelAccessor\",\r\n\t\t\t\t\tcaption: \"Label accessor\",\r\n\t\t\t\t\twidth: 150,\r\n\t\t\t\t\tdataType: \"string\",\r\n\t\t\t\t\teditable: \"isLocal\",\r\n\t\t\t\t\tselect: getAccessorsAndProperties,\r\n\t\t\t\t\taccessor: ({ row }) =>\r\n\t\t\t\t\t\tutils.nullValue(\r\n\t\t\t\t\t\t\trow.localLabelAccessor,\r\n\t\t\t\t\t\t\trow.labelAccessor\r\n\t\t\t\t\t\t),\r\n\t\t\t\t\tonQuit: \"overwrite\",\r\n\t\t\t\t\tformat: ({ value, row }) =>\r\n\t\t\t\t\t\tinherited(\r\n\t\t\t\t\t\t\trow.localLabelAccessor,\r\n\t\t\t\t\t\t\trow.labelAccessor,\r\n\t\t\t\t\t\t\t!row.isLocal\r\n\t\t\t\t\t\t)\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tid: \"sort\",\r\n\t\t\t\t\tcaption: \"sort\",\r\n\t\t\t\t\twidth: 100,\r\n\t\t\t\t\tdataType: \"object\",\r\n\t\t\t\t\thidden: true,\r\n\t\t\t\t\teditable: true\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tid: \"localSortAccessor\",\r\n\t\t\t\t\tcaption: \"Sort accessor\",\r\n\t\t\t\t\twidth: 150,\r\n\t\t\t\t\tdataType: \"string\",\r\n\t\t\t\t\teditable: true,\r\n\t\t\t\t\tfilterType: \"values\",\r\n\t\t\t\t\tselect: getAccessorsAndProperties,\r\n\t\t\t\t\taccessor: ({ row }) =>\r\n\t\t\t\t\t\tutils.nullValue(\r\n\t\t\t\t\t\t\trow.sort.localKeyAccessor,\r\n\t\t\t\t\t\t\trow.sort.keyAccessor\r\n\t\t\t\t\t\t),\r\n\t\t\t\t\tonQuit: ({ row }) => {\r\n\t\t\t\t\t\tif (!row.sort) {\r\n\t\t\t\t\t\t\trow.sort = {};\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\trow.sort.localKeyAccessor = row.localSortAccessor;\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t},\r\n\t\t\t\t\tformat: ({ row }) =>\r\n\t\t\t\t\t\tinherited(\r\n\t\t\t\t\t\t\trow.sort.localKeyAccessor,\r\n\t\t\t\t\t\t\trow.sort.keyAccessor,\r\n\t\t\t\t\t\t\t!row.isLocal\r\n\t\t\t\t\t\t)\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tid: \"localSortFunctionAccessor\",\r\n\t\t\t\t\tcaption: \"Sort function\",\r\n\t\t\t\t\twidth: 150,\r\n\t\t\t\t\tdataType: \"string\",\r\n\t\t\t\t\teditable: true,\r\n\t\t\t\t\tfilterType: \"values\",\r\n\t\t\t\t\tselect: getSorts,\r\n\t\t\t\t\taccessor: ({ row }) =>\r\n\t\t\t\t\t\tutils.nullValue(\r\n\t\t\t\t\t\t\trow.sort.localOrderFunctionAccessor,\r\n\t\t\t\t\t\t\trow.sort.orderFunctionAccessor\r\n\t\t\t\t\t\t),\r\n\t\t\t\t\tonQuit: ({ row }) => {\r\n\t\t\t\t\t\tif (!row.sort) {\r\n\t\t\t\t\t\t\trow.sort = {};\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\trow.sort.localOrderFunctionAccessor =\r\n\t\t\t\t\t\t\trow.localSortFunctionAccessor;\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t},\r\n\t\t\t\t\tformat: ({ value, row }) =>\r\n\t\t\t\t\t\tinherited(\r\n\t\t\t\t\t\t\trow.sort.localOrderFunctionAccessor,\r\n\t\t\t\t\t\t\trow.sort.orderFunctionAccessor,\r\n\t\t\t\t\t\t\t!row.isLocal\r\n\t\t\t\t\t\t)\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tid: \"localFormat\",\r\n\t\t\t\t\tcaption: \"format\",\r\n\t\t\t\t\twidth: 150,\r\n\t\t\t\t\tdataType: \"string\",\r\n\t\t\t\t\teditable: true,\r\n\t\t\t\t\tfilterType: \"values\",\r\n\t\t\t\t\tselect: getFormats,\r\n\t\t\t\t\taccessor: ({ row }) =>\r\n\t\t\t\t\t\tutils.nullValue(row.localFormat, row.format),\r\n\t\t\t\t\tonQuit: \"overwrite\",\r\n\t\t\t\t\tformat: ({ value, row }) =>\r\n\t\t\t\t\t\tinherited(row.localFormat, row.format, !row.isLocal)\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tid: \"isLocal\",\r\n\t\t\t\t\tcaption: \"Local\",\r\n\t\t\t\t\taccessor: \"isLocal\",\r\n\t\t\t\t\twidth: 80,\r\n\t\t\t\t\tdataType: \"boolean\",\r\n\t\t\t\t\tdefault: true\r\n\t\t\t\t}\r\n\t\t\t]\r\n\t\t}\r\n\t};\r\n};\r\n","import { utils } from \"zebulon-controls\";\r\n\r\nexport const getSizes = (meta, rowHeight) => {\r\n  const headersLength =\r\n    1 +\r\n    !meta.table.noFilter *\r\n      (1 +\r\n        (meta.properties.findIndex(\r\n          column => column.filterType === \"between\" && !column.hidden\r\n        ) !==\r\n          -1));\r\n  const headersHeight =\r\n    (meta.table.caption ? 30 : 0) +\r\n    headersLength * rowHeight * meta.zoom +\r\n    ((meta.table.actions || []).length ? 30 : 0);\r\n\r\n  const lastColumn = meta.properties[meta.properties.length - 1];\r\n  const rowWidth = lastColumn.position + lastColumn.computedWidth;\r\n  const headersWidth = !meta.table.noStatus * rowHeight * meta.zoom;\r\n  return {\r\n    headersHeight,\r\n    headersWidth,\r\n    rowWidth,\r\n    rowHeight: rowHeight * meta.zoom\r\n  };\r\n};\r\nexport const computeMetaPositions = (meta, zoom) => {\r\n  let position = 0;\r\n  meta.visibleIndexes = [];\r\n  meta.lockedIndex = null;\r\n  meta.lockedWidth = null;\r\n  meta.properties.forEach((column, index) => {\r\n    column.index_ = index;\r\n    column.position = position;\r\n    if (column.dataType === \"object\" || column.dataType === \"joined object\") {\r\n      column.hidden = true;\r\n    }\r\n    if (zoom !== undefined) {\r\n      column.computedWidth = zoom * (column.hidden ? 0 : column.width || 0);\r\n    }\r\n    if (column.computedWidth !== 0) {\r\n      column.visibleIndex_ = meta.visibleIndexes.length;\r\n      meta.visibleIndexes.push(column.index_);\r\n    }\r\n    position += column.computedWidth;\r\n    if (column.locked) {\r\n      meta.lockedIndex = column.index_;\r\n      meta.lockedWidth = position;\r\n    }\r\n  });\r\n  return meta.visibleIndexes;\r\n};\r\nconst grantPrivilege = (meta, privileges) => {\r\n  if (privileges) {\r\n    let b = privileges && privileges.children_ && privileges.children_.actions;\r\n    meta.table.actions.forEach(action => {\r\n      action.enable =\r\n        b &&\r\n        (privileges.children_.actions[action.id] || { enable: false }).enable;\r\n      action.hidden =\r\n        !b ||\r\n        !!(privileges.children_.actions[action.id] || { hidden: true }).hidden;\r\n      if (!action.enable) {\r\n        action.enableFunction = () => false;\r\n      }\r\n    });\r\n    b = privileges && privileges.children_ && privileges.children_.properties;\r\n    meta.properties.forEach(property => {\r\n      property.editable =\r\n        b &&\r\n        privileges.editable &&\r\n        property.editable &&\r\n        (privileges.children_.properties[property.id] || { editable: false })\r\n          .editable;\r\n      property.hidden =\r\n        !b ||\r\n        !!(privileges.children_.properties[property.id] || { hidden: true })\r\n          .hidden;\r\n      if (!property.editable) {\r\n        property.editableFunction = () => false;\r\n      }\r\n    });\r\n  }\r\n};\r\nexport const computeMeta = (meta, zoom = 1, functions, privileges) => {\r\n  let position = 0;\r\n  const object = meta.table.object;\r\n  meta.promises = [];\r\n  // functions.setVisibility(object);\r\n  meta.visibleIndexes = [];\r\n  meta.table.editable = meta.table.editable && !meta.table.checkable;\r\n  meta.zoom = zoom;\r\n  meta.table.selectFunction = functions.getAccessorFunction(\r\n    object,\r\n    \"dmls\",\r\n    meta.table.select\r\n  );\r\n  meta.table.onTableChangeFunction = functions.getAccessorFunction(\r\n    object,\r\n    \"dmls\",\r\n    meta.table.onTableChange\r\n  );\r\n  meta.table.onSaveFunction = functions.getAccessorFunction(\r\n    object,\r\n    \"dmls\",\r\n    meta.table.onSave\r\n  );\r\n  meta.table.onSaveBeforeFunction = functions.getAccessorFunction(\r\n    object,\r\n    \"dmls\",\r\n    meta.table.onSaveBefore\r\n  );\r\n  meta.table.onSaveAfterFunction = functions.getAccessorFunction(\r\n    object,\r\n    \"dmls\",\r\n    meta.table.onSaveAfter\r\n  );\r\n  if (!meta.indexPk && !utils.isNullValue(meta.table.primaryKey)) {\r\n    meta.indexPk = {};\r\n  }\r\n  if (!meta.indexLk && !utils.isNullValue(meta.table.logicalKey)) {\r\n    meta.indexLk = {};\r\n  }\r\n  if (!meta.indexRowId && !utils.isNullValue(meta.table.rowId)) {\r\n    meta.indexRowId = {};\r\n  }\r\n  meta.row.descriptorFunction = functions.getAccessorFunction(\r\n    object,\r\n    \"accessors\",\r\n    meta.row.descriptor\r\n  );\r\n  // row\r\n  meta.row.onQuitFunction = functions.getAccessorFunction(\r\n    object,\r\n    \"validators\",\r\n    meta.row.onQuit\r\n  );\r\n  meta.row.auditFunction = functions.getAccessorFunction(\r\n    object,\r\n    \"accessors\",\r\n    meta.row.audit\r\n  );\r\n  meta.row.editableFunction = functions.getAccessorFunction(\r\n    object,\r\n    \"editable\",\r\n    meta.row.editable\r\n  );\r\n  if (meta.table.actions) {\r\n    meta.table.actions.forEach(action => {\r\n      if (action.action) {\r\n        action.actionFunction =\r\n          typeof action.action === \"function\"\r\n            ? action.action\r\n            : functions.getAccessorFunction(object, \"actions\", action.action);\r\n      }\r\n      action.enableFunction = functions.getAccessorFunction(\r\n        object,\r\n        \"editables\",\r\n        action.enable\r\n      );\r\n    });\r\n  }\r\n  if (meta.table.subscription) {\r\n    meta.table.subscription.observableFunction = functions.getAccessorFunction(\r\n      object,\r\n      \"dmls\",\r\n      meta.table.subscription.observable\r\n    );\r\n    meta.table.subscription.observerFunctions = {\r\n      onNext: functions.getAccessorFunction(\r\n        object,\r\n        \"observers\",\r\n        (meta.table.subscription.observer || { onNext: \"onNext\" }).onNext\r\n      ),\r\n      onCompleted: functions.getAccessorFunction(\r\n        object,\r\n        \"observers\",\r\n        (meta.table.subscription.observer || { onCompleted: \"onCompleted\" })\r\n          .onCompleted\r\n      ),\r\n      onError: functions.getAccessorFunction(\r\n        object,\r\n        \"observers\",\r\n        (meta.table.subscription.observer || { onError: \"onError\" }).onError\r\n      )\r\n    };\r\n  }\r\n  meta.properties.forEach((column, index) => {\r\n    column.index_ = index;\r\n    if (meta.config) {\r\n      column.width = meta.config[column.id].width;\r\n      column.locked = meta.config[column.id].locked;\r\n      column.index_ = meta.config[column.id].index_;\r\n    }\r\n  });\r\n  if (meta.config) {\r\n    meta.properties.sort(\r\n      (a, b) => (a.index_ > b.index_) - (b.index_ > a.index_)\r\n    );\r\n  }\r\n  // properties\r\n  meta.properties.forEach((column, index) => {\r\n    if (column.deleted_) {\r\n      column.hidden = true;\r\n      column.mandatory = false;\r\n    }\r\n    if (column.id === \"index_\" && column.hidden === undefined) {\r\n      column.hidden = true;\r\n    }\r\n    if (\r\n      !utils.isNullOrUndefined(column.id) &&\r\n      column.id === meta.table.primaryKey\r\n    ) {\r\n      meta.table.pk = column;\r\n    }\r\n    if (\r\n      !utils.isNullOrUndefined(column.id) &&\r\n      column.id === meta.table.logicalKey\r\n    ) {\r\n      meta.table.lk = column;\r\n    }\r\n    if (!utils.isNullOrUndefined(column.id) && column.id === meta.table.rowId) {\r\n      column.dataType = \"number\";\r\n      column.hidden = true;\r\n      meta.table.rwd = column;\r\n    }\r\n    if (column.dataType === \"object\" || column.dataType === \"joined object\") {\r\n      column.hidden = true;\r\n      column.referencingColumns = [];\r\n    }\r\n\r\n    const width = zoom * (column.hidden ? 0 : column.width || 0);\r\n    column.computedWidth = width;\r\n    column.position = position;\r\n\r\n    position += width;\r\n    if (column.locked) {\r\n      meta.lockedIndex = column.index_;\r\n      meta.lockedWidth = position;\r\n    }\r\n    if (width !== 0) {\r\n      column.visibleIndex_ = meta.visibleIndexes.length;\r\n      meta.visibleIndexes.push(column.index_);\r\n    }\r\n    if (!meta.table.editable) {\r\n      column.editable = false;\r\n    } else if (column.editable === undefined) {\r\n      column.editable = true;\r\n    }\r\n    column.editableFunction = functions.getAccessorFunction(\r\n      object,\r\n      \"editables\",\r\n      column.editable\r\n    );\r\n    if (column.format) {\r\n      column.formatFunction = functions.getAccessorFunction(\r\n        object,\r\n        \"formats\",\r\n        column.format\r\n      );\r\n    }\r\n    // a voir bricole avec les joined objects\r\n    if (column.select === \" \") {\r\n      column.select = undefined;\r\n    }\r\n    column.selectFunction = functions.getAccessorFunction(\r\n      object,\r\n      \"selects\",\r\n      column.select\r\n    );\r\n    column.foreignObjectFunction = functions.getAccessorFunction(\r\n      object,\r\n      \"foreignObjects\",\r\n      column.foreignObject\r\n    );\r\n    // select items can be defined as\r\n    // - an array\r\n    // - an object {id:caption...}\r\n    // - an object {items:[select items],filter:[function to filter items with parameters as row,data...\r\n    // if (Array.isArray(column.select)) {\r\n    column.accessorFunction = functions.getAccessorFunction(\r\n      object,\r\n      \"accessors\",\r\n      column.accessor\r\n    );\r\n    column.selectItems = column.select;\r\n    if (column.selectFunction) {\r\n      if (typeof column.selectFunction === \"function\") {\r\n        column.selectItems = column.selectFunction({ meta });\r\n      } else {\r\n        column.selectItems = column.selectFunction;\r\n      }\r\n      //  promises must be resolved before compute data\r\n      if (utils.isPromise(column.selectItems)) {\r\n        column.selectItems.then(data => {\r\n          column.selectItems = data;\r\n          (column.referencingColumns || []).forEach(\r\n            column => (column.selectItems = data)\r\n          );\r\n          return data;\r\n        });\r\n        meta.promises.push(column.selectItems);\r\n      }\r\n    }\r\n    if (column.dataType === \"joined object\" && column.select) {\r\n      column.primaryKeyAccessorFunction = ({ row }) => row.pk_;\r\n      const f = column.accessorFunction;\r\n      column.setForeignKeyAccessorFunction = message => {\r\n        const { value, row } = message;\r\n        row[column.accessor.replace(\"row.\", \"\")] = value;\r\n      };\r\n      column.accessorFunction = ({ row }) => {\r\n        const v = f({ row });\r\n        return utils.isMap(column.selectItems)\r\n          ? column.selectItems.get(v)\r\n          : column.selectItems[v];\r\n      };\r\n    }\r\n    column.onChangeFunction = functions.getAccessorFunction(\r\n      object,\r\n      \"validators\",\r\n      column.onChange\r\n    );\r\n    // reference to an object\r\n    if (column.accessor && typeof column.accessor === \"string\") {\r\n      let accessor = column.accessor;\r\n      let index = column.accessor.indexOf(\".\");\r\n      if (index !== -1 && accessor.slice(0, index) === \"row\") {\r\n        accessor = accessor.slice(index + 1);\r\n        index = accessor.indexOf(\".\");\r\n      }\r\n      if (index !== -1) {\r\n        column.reference = accessor.slice(0, accessor.indexOf(\".\"));\r\n        const referencedColumn = meta.properties.find(\r\n          col => col.id === column.reference\r\n        );\r\n        if (referencedColumn) {\r\n          column.primaryKeyAccessorFunction = functions.getAccessorFunction(\r\n            object,\r\n            \"accessors\",\r\n            referencedColumn.accessor\r\n          );\r\n          // referencedColumn.accessorFunction;\r\n          column.setForeignKeyAccessorFunction = ({ value, row }) => {\r\n            row[referencedColumn.accessor.slice(4)] = value;\r\n          };\r\n          if (referencedColumn.dataType === \"joined object\") {\r\n            column.select = \" \";\r\n            // if (utils.isPromise(referencedColumn.selectItems)) {\r\n            //   referencedColumn.selectItems.then(data => {\r\n            //     column.selectItems = data;\r\n            //     referencedColumn.selectItems = data;\r\n            //     return data;\r\n            //   });\r\n            //   meta.promises.push(referencedColumn.selectItems);\r\n            // } else {\r\n            referencedColumn.referencingColumns.push(column);\r\n            column.selectItems = referencedColumn.selectItems;\r\n            // }\r\n            if (column.editable) {\r\n              column.mandatory = column.mandatory || referencedColumn.mandatory;\r\n              const f = column.onChangeFunction || (x => true);\r\n              column.onChangeFunction = ({ value, row, column }) => {\r\n                row[column.reference] = column.selectItems[value.value];\r\n                row[column.id] = column.accessorFunction({ column, row });\r\n                column.setForeignKeyAccessorFunction({\r\n                  value: value.value,\r\n                  row\r\n                });\r\n                return f({ value, row, column });\r\n              };\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n    // column.sortAccessorFunction = functions.getAccessorFunction(\r\n    //   object,\r\n    //   \"accessors\",\r\n    //   column.sortAccessor || column.accessor\r\n    // );\r\n    column.defaultFunction = functions.getAccessorFunction(\r\n      object,\r\n      \"defaults\",\r\n      column.default\r\n    );\r\n\r\n    column.onQuitFunction = functions.getAccessorFunction(\r\n      object,\r\n      \"validators\",\r\n      column.onQuit\r\n    );\r\n\r\n    if (!column.defaultFunction && column.default) {\r\n      column.defaultFunction = () => {\r\n        if (\r\n          typeof column.default === \"string\" &&\r\n          !(column.dataType === \"string\" || column.dataType === \"text\")\r\n        ) {\r\n          if (column.dataType === \"boolean\") {\r\n            return column.default === \"true\";\r\n          } else if (\r\n            column.dataType === \"number\" &&\r\n            utils.isNumber(column.default)\r\n          ) {\r\n            return Number(column.default);\r\n          } else if (\r\n            column.dataType === \"date\" &&\r\n            utils.isDate(column.default)\r\n          ) {\r\n            return new Date(column.default);\r\n          } else {\r\n            return null;\r\n          }\r\n        } else {\r\n          return column.default;\r\n        }\r\n      };\r\n    }\r\n    if (column.analytic) {\r\n      const analytic = functions.getAccessorFunction(\r\n        meta.table.object,\r\n        \"analytics\",\r\n        column.analytic\r\n      );\r\n      column.groupByAccessorFunction = functions.getAccessorFunction(\r\n        meta.table.object,\r\n        \"accessors\",\r\n        analytic.groupByAccessor\r\n      );\r\n      column.aggregationFunction = functions.getAccessorFunction(\r\n        meta.table.object,\r\n        \"aggregations\",\r\n        analytic.aggregation\r\n      );\r\n      // window\r\n      if (analytic.comparisonAccessor) {\r\n        column.comparisonAccessorFunction = functions.getAccessorFunction(\r\n          meta.table.object,\r\n          \"accessors\",\r\n          analytic.comparisonAccessor\r\n        );\r\n        column.sortAccessorFunction = functions.getAccessorFunction(\r\n          meta.table.object,\r\n          \"accessors\",\r\n          analytic.sortAccessor\r\n        );\r\n        column.startFunction = functions.getAccessorFunction(\r\n          meta.table.object,\r\n          \"windows\",\r\n          analytic.windowStart\r\n        );\r\n        column.endFunction = functions.getAccessorFunction(\r\n          meta.table.object,\r\n          \"windows\",\r\n          analytic.windowEnd\r\n        );\r\n      }\r\n    }\r\n    if (column.filterType && column.filterType.startsWith(\"values:\")) {\r\n      column.foreignKeyAccessorFunction = functions.getAccessorFunction(\r\n        meta.table.object,\r\n        \"accessors\",\r\n        column.filterType.slice(7)\r\n      );\r\n      column.filterType = \"values\";\r\n    }\r\n    if (\r\n      column.accessor &&\r\n      !column.reference &&\r\n      !column.onQuit &&\r\n      !column.onChange\r\n    ) {\r\n      column.editable = false;\r\n    }\r\n  });\r\n  grantPrivilege(meta, privileges);\r\n};\r\n// return meta;\r\n// };\r\nexport const getDataType = value => {\r\n  let dataType = typeof value;\r\n  if (dataType === \"object\") {\r\n    if (utils.isDate(value)) {\r\n      dataType = \"date\";\r\n    } else if (Array.isArray(value)) {\r\n      dataType = \"array\";\r\n    } else {\r\n      dataType = \"object\";\r\n    }\r\n  } else if (dataType === \"string\" && value === new Date(value).toJSON()) {\r\n    dataType = \"date\";\r\n  }\r\n  return dataType;\r\n};\r\nexport const computeMetaFromData = (\r\n  data,\r\n  meta,\r\n  zoom,\r\n  functions,\r\n  privileges\r\n) => {\r\n  let position = 0;\r\n  if (!meta.properties.length && data && data.length) {\r\n    const row = data[0];\r\n    Object.keys(row).forEach((key, index) => {\r\n      let dataType = getDataType(row[key]),\r\n        filterType = \"\";\r\n\r\n      let alignement = \"unset\";\r\n      if (dataType === \"string\") {\r\n        alignement = \"left\";\r\n      } else if (dataType === \"number\") {\r\n        alignement = \"right\";\r\n        filterType = \"between\";\r\n      } else if (\r\n        dataType === \"date\" ||\r\n        dataType === \"month\" ||\r\n        dataType === \"year\"\r\n      ) {\r\n        alignement = \"center\";\r\n        filterType = \"between\";\r\n      }\r\n      const width = 100;\r\n      meta.properties.push({\r\n        id: key,\r\n        caption: key,\r\n        tp: \"Dataset\",\r\n        width,\r\n        dataType,\r\n        alignement,\r\n        hidden:\r\n          dataType === \"object\" ||\r\n          dataType === \"joined object\" ||\r\n          dataType === \"array\" ||\r\n          key === \"index_\" ||\r\n          key === \"timestamp_\" ||\r\n          key === \"rowId_\",\r\n        position,\r\n        editable: !!meta.table.editables,\r\n        index_: index,\r\n        formatFunction: ({ value }) => `${value}`,\r\n        selectFunction: undefined,\r\n        filterType,\r\n        v: null,\r\n        vTo: null\r\n      });\r\n      position += width;\r\n    });\r\n  }\r\n  computeMeta(meta, zoom, functions, privileges);\r\n};\r\n// -----------------------------------------------------------\r\n// build a table of functions from the initial function object\r\n// -----------------------------------------------------------\r\n// const functionsByObject = (object, functions) => {\r\n//   const f = functions[object];\r\n//   // const accessor = accessor => {\r\n//   //   return f.accessors[accessor];\r\n//   // };\r\n//   const f_ = [];\r\n//   Object.keys(f).forEach(type => {\r\n//     const tp = type.slice(0, type.length - 1);\r\n//     Object.keys(f[type]).forEach(code => {\r\n//       const functionJS = f[type][code];\r\n//       if (functionJS) {\r\n//         f_.push({\r\n//           id: code,\r\n//           visibility: object === \"globals_\" ? \"global\" : object,\r\n//           caption: code,\r\n//           tp,\r\n//           functionJS\r\n//         });\r\n//       }\r\n//     });\r\n//   });\r\n//   return f_;\r\n// };\r\n// export const functionsTable = functions => {\r\n//   if (functions === undefined) {\r\n//     return [];\r\n//   }\r\n//   return Object.keys(functions).reduce(\r\n//     (acc, object) => acc.concat(functionsByObject(object, functions)),\r\n//     []\r\n//   );\r\n// };\r\n","import { utils } from \"zebulon-controls\";\r\nimport { cellData } from \"./compute.data\";\r\nexport const getSelection = (\r\n  type = \"xls\",\r\n  selectedRange,\r\n  columns,\r\n  filteredData,\r\n  updatedRows,\r\n  data,\r\n  params\r\n) => {\r\n  const columnSeparator = type === \"csv\" ? \",\" : \"\\t\";\r\n  const rowStart = Math.min(selectedRange.start.rows, selectedRange.end.rows);\r\n  const rowEnd = Math.max(selectedRange.start.rows, selectedRange.end.rows);\r\n  const columnStart = Math.min(\r\n    selectedRange.start.columns,\r\n    selectedRange.end.columns\r\n  );\r\n  const columnEnd = Math.max(\r\n    selectedRange.start.columns,\r\n    selectedRange.end.columns\r\n  );\r\n  const outputs = [];\r\n  let output = \"\";\r\n  for (let iColumn = columnStart; iColumn <= columnEnd; iColumn++) {\r\n    if (!columns[iColumn].hidden) {\r\n      output += columnSeparator + JSON.stringify(columns[iColumn].caption);\r\n    }\r\n  }\r\n  outputs.push(output.slice(1));\r\n  for (let iRow = rowStart; iRow <= rowEnd; iRow++) {\r\n    const row = filteredData[iRow];\r\n    output = \"\";\r\n    for (let iColumn = columnStart; iColumn <= columnEnd; iColumn++) {\r\n      const column = columns[iColumn];\r\n      if (!column.hidden) {\r\n        let value = cellData(\r\n          row,\r\n          column,\r\n          updatedRows[row.index_],\r\n          data,\r\n          params,\r\n          true\r\n        ).value;\r\n        if (utils.isNullOrUndefined(value)) {\r\n          value = \"\";\r\n        } else if (column.dataType === \"date\" && value !== null) {\r\n          value = utils.dateToString(value, undefined || \"dd/mm/yyyy\");\r\n        } else if (utils.isObject(value)) {\r\n          value = value.caption;\r\n        }\r\n        output += columnSeparator + JSON.stringify(value);\r\n      }\r\n    }\r\n    outputs.push(output.slice(1));\r\n  }\r\n  return outputs.join(\"\\n\");\r\n};\r\nexport const buildPasteArray = (type = \"xls\", clipboard, this_, selectCell) => {\r\n  const columns = this_.state.meta.properties,\r\n    selectedCell = this_.state.selectedRange.end,\r\n    onChange = this_.onChange,\r\n    canQuit = this_.canQuit,\r\n    filteredData = this_.state.filteredData,\r\n    updatedRows = this_.state.updatedRows,\r\n    data = this_.state.data,\r\n    params = this_.props.params;\r\n  const columnSeparator = type === \"csv\" ? \",\" : \"\\t\"; // a voir detection du separateur\r\n  const lines = clipboard.replace(/\\r/g, \"\").split(\"\\n\");\r\n  lines.pop();\r\n  const cells = lines.map(line => line.split(columnSeparator));\r\n\r\n  const cellsValue = [];\r\n  cells.forEach((rowCells, rowIndex) => {\r\n    const row = filteredData[selectedCell.rows + rowIndex];\r\n    let columnIndex = 0;\r\n    rowCells.forEach(value => {\r\n      let col = selectedCell.columns + columnIndex < columns.length;\r\n      let column = columns[selectedCell.columns + columnIndex];\r\n      while (col && column.hidden && column.index_ + 1 < columns.length) {\r\n        columnIndex++;\r\n        col = selectedCell.columns + columnIndex < columns.length;\r\n        column = columns[selectedCell.columns + columnIndex];\r\n      }\r\n      const cell = {\r\n        rows: selectedCell.rows + rowIndex,\r\n        columns: column.index_\r\n      };\r\n      const editable =\r\n        col && column.editableFunction\r\n          ? column.editableFunction({\r\n              column,\r\n              row,\r\n              status: updatedRows[row.index_] || {},\r\n              data,\r\n              params\r\n            })\r\n          : column.editable;\r\n      if (editable) {\r\n        let v = value;\r\n        const { dataType, format } = column;\r\n        if (dataType === \"boolean\") {\r\n          v = v === \"true\";\r\n        } else if (dataType === \"date\") {\r\n          v = utils.stringToDate(v, format);\r\n        } else if (dataType === \"number\") {\r\n          v = v === \"\" ? null : Number(value);\r\n        }\r\n        cell.value = v;\r\n        cell.columnId = column.id;\r\n        cellsValue.push(cell);\r\n      }\r\n      columnIndex++;\r\n    });\r\n  });\r\n  //  mangement of callback and users interractions\r\n  cellsValue.reverse();\r\n  const cellValue = (ok_, previousRow) => {\r\n    if (!ok_ || cellsValue.length === 0) {\r\n      this_.isPasting = false;\r\n      this_.forceUpdate();\r\n      return;\r\n    }\r\n    let ok = ok_;\r\n    const cell = cellsValue.pop();\r\n    this_.isPasting = true;\r\n    const cellV = ok_ => {\r\n      const endCell = ok_ => {\r\n        if (ok_) {\r\n          cellValue(ok_, cell.rows);\r\n        }\r\n      };\r\n      if (!ok_) {\r\n        return false;\r\n      }\r\n      selectCell(cell);\r\n      const row = filteredData[cell.rows];\r\n      const column = columns[cell.columns];\r\n      // can change value\r\n      if (!onChange({ value: { value: cell.value }, row, column })) {\r\n        return false;\r\n      }\r\n      row[cell.columnId] = cell.value;\r\n      // object in select input\r\n      if (column.reference && column.selectItems) {\r\n        const item = Object.values(column.selectItems).find(\r\n          item =>\r\n            column.accessorFunction({ row: { [column.reference]: item } }) ===\r\n            cell.value\r\n        );\r\n        row[column.reference] = item;\r\n        if (column.setForeignKeyAccessorFunction) {\r\n          column.setForeignKeyAccessorFunction({\r\n            value: item.pk_,\r\n            row\r\n          });\r\n          // column.setForeignKeyAccessorFunction({\r\n          //   value: column.primaryKeyAccessorFunction({\r\n          //     row: { [column.reference]: item }\r\n          //   }),\r\n          //   row\r\n          // });\r\n        }\r\n      }\r\n      // can quit cell\r\n      const ok = canQuit(\"cellQuit\", endCell);\r\n      if (ok !== undefined) {\r\n        endCell(ok);\r\n      }\r\n    };\r\n    // can quit row\r\n    if (previousRow !== undefined && previousRow !== cell.rows) {\r\n      ok = canQuit(\"rowQuit\", cellV);\r\n    }\r\n    if (ok !== undefined) {\r\n      cellV(ok);\r\n    }\r\n  };\r\n  cellValue(true, undefined);\r\n  this_.isPasting = false;\r\n\r\n  return cells;\r\n};\r\n","import React from \"react\";\r\nimport { utils, accessors, functions as functions_ } from \"zebulon-controls\";\r\nimport { metaFunctions } from \"../MetaDescriptions\";\r\n// import { functions } from \"./functions\";\r\n// -----------------------------------------------------------\r\n// Error management\r\n// -----------------------------------------------------------\r\nexport const rollback = (updatedRows, index) => {\r\n  rollbackStatus(updatedRows, updatedRows[index]);\r\n};\r\nexport const rollbackStatus = (updatedRows, status) => {\r\n  if (!status.new_) {\r\n    Object.keys(status.rowUpdated).forEach(\r\n      key => (status.rowUpdated[key] = null)\r\n    );\r\n    Object.keys(status.rowUpdated).forEach(\r\n      key => (status.rowUpdated[key] = status.row[key])\r\n    );\r\n  } else {\r\n    status.hidden_ = true;\r\n  }\r\n  const n = status.errors ? status.errors.n_ || 0 : 0;\r\n  status.deleted_ = false;\r\n  status.updated_ = false;\r\n  // if (!status.new_) {\r\n  status.errors = {};\r\n  if (updatedRows.nErrors) {\r\n    updatedRows.nErrors -= n;\r\n  }\r\n  // }\r\n};\r\nexport const rollbackFiltered = (updatedRows, filters) => {\r\n  const linkFilters = Object.values(filters).filter(filter => filter.link);\r\n  const filtersFunction = status =>\r\n    linkFilters.length\r\n      ? linkFilters.reduce(\r\n          (acc, filter) =>\r\n            acc &&\r\n            (status.row || status.rowUpdated) &&\r\n            (status.row || status.rowUpdated)[filter.id] === filter.v,\r\n          true\r\n        )\r\n      : true;\r\n  Object.values(updatedRows)\r\n    .filter(filtersFunction)\r\n    .forEach(status => rollbackStatus(updatedRows, status));\r\n};\r\nexport const rollbackAll = (updatedRows, data) => {\r\n  getUpdatedRows(updatedRows).forEach(status => {\r\n    if (status.new_) {\r\n      data.splice(status.rowUpdated.index_, 1);\r\n      delete updatedRows[status.rowUpdated.index_];\r\n    } else if (status.updated_) {\r\n      rollback(updatedRows, status.row.index_);\r\n    }\r\n  });\r\n  delete updatedRows.nErrors;\r\n  delete updatedRows.nErrorsServer;\r\n  updatedRows.errors = {};\r\n};\r\n\r\nexport const getRowStatus = (updatedRows, row) => {\r\n  let status = updatedRows[row.index_];\r\n  if (!status) {\r\n    status = {\r\n      // updated_: true,\r\n      rowUpdated: row,\r\n      row: { ...row },\r\n      errors: {}\r\n    };\r\n    updatedRows[row.index_] = status;\r\n  }\r\n  return status;\r\n};\r\nexport const getUpdatedRows = updatedRows =>\r\n  Object.keys(updatedRows)\r\n    .filter(\r\n      key =>\r\n        !Number.isNaN(Number(key)) &&\r\n        (updatedRows[key].deleted_ ||\r\n          updatedRows[key].new_ ||\r\n          updatedRows[key].updated_) &&\r\n        !(updatedRows[key].new_ && updatedRows[key].deleted_)\r\n    )\r\n    .map(key => updatedRows[key]);\r\nexport const setStatus = (status, type) => {\r\n  status[type] = true;\r\n  status.timeStamp = new Date().getTime();\r\n};\r\n//------------------------------------------------------------\r\nexport const manageRowError = (\r\n  updatedRows,\r\n  index,\r\n  column,\r\n  type,\r\n  error,\r\n  rowTitle,\r\n  onServer\r\n) => {\r\n  const status = updatedRows[index] || {};\r\n  if (rowTitle) {\r\n    status.rowTitle = rowTitle;\r\n  }\r\n  const existsErrors = !utils.isNullOrUndefined(\r\n    onServer ? status.errorsServer : status.errors\r\n  );\r\n  const errors = (onServer ? status.errorsServer : status.errors) || {};\r\n  const existsObject = !utils.isNullOrUndefined(errors[column.id]);\r\n  const objectErrors = errors[column.id] || {};\r\n  const existsType = !utils.isNullOrUndefined(objectErrors[type]);\r\n  if (error) {\r\n    objectErrors[type] = error;\r\n    if (!existsType) {\r\n      objectErrors.n_ = (objectErrors.n_ || 0) + 1;\r\n      if (!existsObject) {\r\n        errors[column.id] = objectErrors;\r\n      }\r\n      errors.n_ = (errors.n_ || 0) + 1;\r\n      if (!existsErrors) {\r\n        if (onServer) {\r\n          status.errorsServer = errors;\r\n        } else {\r\n          status.errors = errors;\r\n        }\r\n      }\r\n      if (onServer) {\r\n        updatedRows.nErrorsServer = (updatedRows.nErrorsServer || 0) + 1;\r\n      } else {\r\n        updatedRows.nErrors = (updatedRows.nErrors || 0) + 1;\r\n      }\r\n    }\r\n  } else {\r\n    if (existsType) {\r\n      delete objectErrors[type];\r\n      objectErrors.n_--;\r\n      if (objectErrors.n_ === 0) {\r\n        delete errors[column.id];\r\n      }\r\n      errors.n_--;\r\n      if (onServer) {\r\n        updatedRows.nErrorsServer = (updatedRows.nErrorsServer || 0) - 1;\r\n      } else {\r\n        updatedRows.nErrors = (updatedRows.nErrors || 0) - 1;\r\n      }\r\n    }\r\n  }\r\n};\r\nexport const getRowErrors = (status, rowIndex) => {\r\n  if (rowIndex === undefined) {\r\n    return [];\r\n  } else {\r\n    const errors = [];\r\n    if (!status.deleted_ && status.errors) {\r\n      Object.keys(status.errors).forEach(column => {\r\n        if (status.errors[column] || column !== \"n_\") {\r\n          Object.keys(status.errors[column]).forEach(type => {\r\n            if (type !== \"n_\") {\r\n              errors.push({\r\n                column,\r\n                type,\r\n                error: status.errors[column][type],\r\n                rowIndex\r\n              });\r\n            }\r\n          });\r\n        }\r\n      });\r\n    }\r\n    if (!status.deleted_ && status.errorsServer) {\r\n      Object.keys(status.errorsServer).forEach(column => {\r\n        if (status.errorsServer[column] || column !== \"n_\") {\r\n          Object.keys(status.errorsServer[column]).forEach(type => {\r\n            if (type !== \"n_\") {\r\n              errors.push({\r\n                column,\r\n                type,\r\n                error: status.errorsServer[column][type],\r\n                rowIndex\r\n              });\r\n            }\r\n          });\r\n        }\r\n      });\r\n    }\r\n    return errors;\r\n  }\r\n};\r\nexport const getErrors = updatedRows => {\r\n  let errors = [];\r\n  if (updatedRows.errors) {\r\n    Object.keys(updatedRows.errors).forEach(type => {\r\n      if (updatedRows.errors[type].length) {\r\n        errors.push({\r\n          type,\r\n          error: updatedRows.errors[type]\r\n        });\r\n      }\r\n    });\r\n  }\r\n  getUpdatedRows(updatedRows).forEach(status => {\r\n    if (!status.deleted_ && (status.errors || {}).n_) {\r\n      errors = errors.concat(getRowErrors(status, status.rowUpdated.index_));\r\n    }\r\n  });\r\n  return errors;\r\n};\r\nexport const errorHandler = {\r\n  onTableChange: message => {\r\n    if (message.type !== \"sort\") {\r\n      message.modalBody = `Do you want to save before ${message.type}?`;\r\n    }\r\n    return true;\r\n  },\r\n  onSaveBefore: message => {\r\n    const { meta, updatedRows } = message;\r\n    const key = meta.table.lk || meta.table.pk;\r\n    const errors = getErrors(updatedRows).map(error => {\r\n      if (error.rowIndex === undefined) {\r\n        return `\\n${meta.table.caption || meta.table.object} : ${error.error}`;\r\n      } else {\r\n        const rowUpdated = updatedRows[error.rowIndex].rowUpdated;\r\n        let rowTitle = updatedRows[error.rowIndex].rowTitle;\r\n        if (!rowTitle && key) {\r\n          rowTitle = `${key.caption} ${rowUpdated[key.id]}`;\r\n        }\r\n        return `\\n${rowTitle} : ${error.error}`;\r\n      }\r\n    });\r\n    if (errors.length) {\r\n      message.modalBody = [\"Can't save with errors: \"].concat(errors);\r\n      return false;\r\n    } else {\r\n      message.modalBody = null;\r\n    }\r\n    return true;\r\n  },\r\n  onSave: message => {\r\n    if (message.serverError) {\r\n      message.modalBody = message.serverError;\r\n      return false;\r\n    }\r\n    return true;\r\n  }\r\n};\r\n// -----------------------------------------------------------\r\n// Export configuration\r\n// -----------------------------------------------------------\r\nconst excludeProperties = {\r\n  visibleIndexes: true,\r\n  selectItems: true,\r\n  selectFilter: true,\r\n  // accessorFunction: true,\r\n  // formatFunction: true,\r\n  // defaultFunction: true,\r\n  // alignement: true,\r\n  position: true,\r\n  index_: true,\r\n  visibleIndex_: true\r\n};\r\n// const hasFunction = {\r\n//   editable: true,\r\n//   accessor: true,\r\n//   select: true,\r\n//   format: true,\r\n//   disable: true,\r\n//   action: true,\r\n//   onChange: true,\r\n//   onQuit: true,\r\n//   descriptor: true\r\n// };\r\n// const getItem = (key, value, parent, functions) => {\r\n//   let v = value;\r\n//   if (!utils.isNullOrUndefined(v) && !excludes.includes(key)) {\r\n//     if (typeof v === \"function\") {\r\n//       v: parent;\r\n//       // manage function\r\n//     } else if (typeof v === \"function\") {\r\n//       v: parent;\r\n//       // manage function\r\n//     } else if (typeof v === \"function\") {\r\n//       v: parent;\r\n//       // manage function\r\n//     }\r\n//   }\r\n// };\r\nexport const buildObject = (item, excludes = excludeProperties) => {\r\n  if (Array.isArray(item)) {\r\n    return item.map(item => buildObject(item, excludes));\r\n  } else if (typeof item === \"object\") {\r\n    return Object.keys(item).reduce((acc, key) => {\r\n      if (!utils.isNullOrUndefined(item[key]) && !excludes[key]) {\r\n        acc[key] = buildObject(item[key], excludes);\r\n      }\r\n      return acc;\r\n    }, {});\r\n  } else {\r\n    return item;\r\n  }\r\n};\r\n\r\nexport const buildFunctionsObject = (meta, functions, sources) => {\r\n  const excludes = {\r\n    serverPagination: true,\r\n    zoom: true,\r\n    indexRowId: true,\r\n    computedWidth: true,\r\n    rwd: true,\r\n    tp: true,\r\n    visibleIndexes: true,\r\n    statusDraggable: true,\r\n    visibleIndex_: true,\r\n    index_: true,\r\n    position: true\r\n  };\r\n  const meta_ = JSON.stringify(buildObject(meta, excludes));\r\n  const f = [];\r\n  const f0 = [];\r\n  const f1 = {};\r\n  // const fAcc = functions.functions([accessors]);\r\n  // const fMeta = functions.functions([metaFunctions]);\r\n  const fSources = [\r\n    { path: \"zebulon-controls\", object: accessors },\r\n    { path: \"../MetaDescriptions\", object: metaFunctions }\r\n  ].concat(sources || []);\r\n  fSources.forEach(\r\n    source => (source.functions = functions_.functions([source.object]))\r\n  );\r\n  fSources.reverse();\r\n  const imports = {};\r\n  // const impMeta = [];\r\n  const functionsObject = Object.keys(functions).reduce((acc, visibility) => {\r\n    // if (!acc[visibility]) {\r\n    //   acc[visibility] = {};\r\n    // }\r\n    acc[visibility] = Object.keys(functions[visibility]).reduce((acc, type) => {\r\n      // if (!acc[type]) {\r\n      //   acc[type] = {};\r\n      // }\r\n      acc[type] = Object.keys(\r\n        functions[visibility][type]\r\n      ).reduce((acc, name) => {\r\n        if (type === \"analytics\") {\r\n        } else {\r\n          const f_ = functions[visibility][type][name];\r\n          const nm = f_.f.name || name;\r\n          let nm2 = nm;\r\n          if (!f_.fText && !f0.includes(f_.f)) {\r\n            f1[nm] = f1[nm] === undefined ? 0 : f1[nm] + 1;\r\n            if (f1[nm]) {\r\n              nm2 = `${nm}_${f1[nm]}`;\r\n            }\r\n            const imported = fSources.reduce((acc, source) => {\r\n              if (acc) {\r\n                return true;\r\n              }\r\n              const f = source.functions.getFunction(visibility, type, name);\r\n              if (f) {\r\n                if (!imports[source.path]) {\r\n                  imports[source.path] = [];\r\n                }\r\n                imports[source.path].push(\r\n                  name !== nm2 ? name + \" as \" + nm2 : name\r\n                );\r\n              }\r\n              return !!f;\r\n            }, false);\r\n            if (!imported) {\r\n              f.push(`const ${nm2}=${f_.f.toString()};`);\r\n            }\r\n            f0.push(f_.f);\r\n          }\r\n          acc[name] = `~~~${f_.fText || nm2}~~~`;\r\n        }\r\n        return acc;\r\n      }, {});\r\n      return acc;\r\n    }, {});\r\n    return acc;\r\n  }, {});\r\n  // const f = {};\r\n  // functions.forEach(fct => {\r\n  //   if (!f[fct.visibility]) f[fct.visibility] = {};\r\n  //   if (!f[fct.visibility][fct.tp]) f[fct.visibility][fct.tp] = {};\r\n  //   f[fct.visibility][fct.tp][fct.id] = \"~~~\" + String(fct.functionJS) + \"~~~\";\r\n  // });\r\n  const imports_ = Object.keys(imports)\r\n    .map(imp => `// import {${imports[imp].join(\",\")}} from \"${imp}\";\\n`)\r\n    .join(\" \");\r\n  return (\r\n    imports_ +\r\n    \"userMeta={meta: \" +\r\n    meta_ +\r\n    \",functions : \" +\r\n    JSON.stringify(functionsObject)\r\n      .replace(/\"~~~/g, \"\")\r\n      .replace(/~~~\"/g, \"\")\r\n      .replace(/\\\\\"/g, '\"') +\r\n    \"};\" +\r\n    f\r\n      .join(\" \")\r\n      .replace(/\\\\n/g, \"\")\r\n      .replace(/\\\\t/g, \"\")\r\n  );\r\n};\r\n// ----------------------------------\r\n// common data access (row or fiels)\r\n// ----------------------------------\r\nexport const loadFileButton = ({\r\n  disabled,\r\n  index,\r\n  style,\r\n  onClick,\r\n  className\r\n}) => {\r\n  const onLoad = e => {\r\n    const file = document.getElementById(\"file-selector\").files[0];\r\n    const reader = new FileReader();\r\n    reader.onload = ee => {\r\n      onClick({ ...ee, file, text: reader.result });\r\n    };\r\n    reader.readAsText(file);\r\n  };\r\n  return (\r\n    <div key={index} style={{ ...style, display: \"inherit\" }}>\r\n      <input\r\n        type=\"file\"\r\n        id=\"file-selector\"\r\n        onChange={onLoad}\r\n        style={{ display: \"none\" }}\r\n      />\r\n      <button\r\n        style={{ width: \"inherit\" }}\r\n        className={className}\r\n        disabled={disabled}\r\n        onClick={() => document.getElementById(\"file-selector\").click()}\r\n      >\r\n        Load\r\n      </button>\r\n    </div>\r\n  );\r\n};\r\n// -------------------------------------------\r\n// miscelaneous\r\n// -------------------------------------------\r\nexport const hasParent = (element, id) => {\r\n  if (!element.parentElement) {\r\n    return false;\r\n  } else if (element.parentElement.id.slice(0, id.length) === id) {\r\n    return true;\r\n  } else {\r\n    return hasParent(element.parentElement, id);\r\n  }\r\n};\r\nexport const isEqual = (v0, v1) => {\r\n  if (\r\n    v0 === v1 ||\r\n    (utils.isDate(v0) && utils.isDate(v1) && v0.getTime() === v1.getTime()) ||\r\n    (utils.isDate(v0) &&\r\n      typeof v1 === \"string\" &&\r\n      v0.getTime() === new Date(v1).getTime()) ||\r\n    (utils.isDate(v1) &&\r\n      typeof v0 === \"string\" &&\r\n      v1.getTime() === new Date(v0).getTime()) ||\r\n    (typeof v0 === \"object\" &&\r\n      typeof v1 === \"object\" &&\r\n      Object.keys(v0).length === Object.keys(v1).length &&\r\n      Object.keys(v0).reduce(\r\n        (acc, key) => acc && isEqual(v0[key], v1[key], true)\r\n      ))\r\n  ) {\r\n    return true;\r\n  }\r\n  return false;\r\n};\r\n","import { Component } from \"react\";\r\nimport { utils } from \"zebulon-controls\";\r\nimport { computeMetaPositions } from \"./utils/compute.meta\";\r\n// import { rollback } from \"./utils/utils\";\r\n\r\nexport class ZebulonTableMenu extends Component {\r\n    handleAudit = (props, item) => {\r\n        const { status } = props;\r\n        // console.log(\"zebtable\", this.state);\r\n        const row = status.row || status.rowUpdated;\r\n        const audits = this.state.meta.row.auditFunction({ row });\r\n        if (utils.isPromise(audits)) {\r\n            this.setState({\r\n                status: { loaded: false, loading: true }\r\n            });\r\n            audits.then(audits => {\r\n                this.setState({\r\n                    auditedRow: row,\r\n                    audits: audits || [],\r\n                    status: { loaded: true, loading: false }\r\n                });\r\n                if (this.props.onRowEnter) {\r\n                    this.props.onRowEnter({\r\n                        audited: true,\r\n                        row: (audits || [])[0]\r\n                    });\r\n                }\r\n            });\r\n        } else {\r\n            this.setState({\r\n                auditedRow: row,\r\n                audits: audits || [],\r\n                status: { loaded: true, loading: false }\r\n            });\r\n            if (this.props.onRowEnter) {\r\n                this.props.onRowEnter({\r\n                    audited: true,\r\n                    row: (audits || [])[0]\r\n                });\r\n            }\r\n        }\r\n        this.table.handleClickMenu(props, item);\r\n    };\r\n    handleCloseAudit = (props, item) => {\r\n        this.setState({\r\n            auditedRow: undefined,\r\n            audits: undefined\r\n        });\r\n        if (this.props.linkedObjects) {\r\n            this.props.linkedObjects.forEach(object =>\r\n                object.setState({\r\n                    auditedRow: undefined,\r\n                    audits: undefined\r\n                })\r\n            );\r\n        }\r\n        this.table.handleClickMenu(props, item);\r\n    };\r\n    // handleClickMenu = (props, item) => {\r\n    //     const a = 1;\r\n    //     console.log(\"zebtable\", this.state);\r\n    //     return true;\r\n    // };\r\n    handleRollback = (props, item) => {\r\n        this.rollback(this.state.updatedRows, props.row.index_);\r\n        this.table.handleClickMenu(props, item);\r\n    };\r\n\r\n    getCustomMenu = (menu, menus) => {\r\n        if (this.props.contextualMenu && this.props.contextualMenu[menu]) {\r\n            this.props.contextualMenu[menu].forEach((menu, index) => {\r\n                const id = menu.id || 1000000 + menus.length;\r\n                const children =\r\n                    menu.children ||\r\n                    (menu.type === \"sub-menu\" ? [] : undefined);\r\n                const item = {\r\n                    ...menu,\r\n                    id: menu.id || 1000000 + menus.length,\r\n                    children\r\n                };\r\n                item.onClick = e =>\r\n                    (menu.onClick || this.handleClickMenu)(e, item);\r\n                menus.push(item);\r\n            });\r\n        }\r\n    };\r\n    getMenu = (menu, data) => {\r\n        // console.log(this.state, this.table.state);\r\n        const menus = [];\r\n        if (!this.props.isActive && this.props.onActivation) {\r\n            this.props.onActivation(\r\n                this.props.componentId || `zebulon-table-${this.props.id}`\r\n            );\r\n        }\r\n        if (menu === \"row-header-menu\") {\r\n            if (this.state.meta.table.editable) {\r\n                menus.push({\r\n                    id: menus.length,\r\n                    type: \"menu-item\",\r\n                    disable: !(data.status || {}).updated_,\r\n                    separation: false,\r\n                    caption: `Rollback row updates`,\r\n                    onClick: this.handleRollback\r\n                });\r\n            }\r\n            if (this.state.meta.row.audit) {\r\n                menus.push({\r\n                    id: menus.length,\r\n                    type: \"menu-item\",\r\n                    disable: this.state.auditedRow !== undefined,\r\n                    // separation: false,\r\n                    caption: `Audit`,\r\n                    onClick: this.handleAudit\r\n                });\r\n            }\r\n        } else if (menu === \"column-header-menu\") {\r\n            menus.push({\r\n                id: menus.length,\r\n                type: \"menu-item\",\r\n                disable: utils.isNullOrUndefined(\r\n                    this.table.state.meta.lockedIndex\r\n                ),\r\n                separation: false,\r\n                caption: `Unlock columns`,\r\n                onClick: this.table.handleClickMenu\r\n            });\r\n            menus.push({\r\n                id: menus.length,\r\n                type: \"menu-item\",\r\n                separation: false,\r\n                caption: `Lock columns until ${data.column.caption}`,\r\n                onClick: this.table.handleClickMenu\r\n            });\r\n        } else if (menu === \"top-left-corner-menu\") {\r\n            if (this.state.meta.table.editable) {\r\n                menus.push({\r\n                    id: menus.length,\r\n                    type: \"menu-item\",\r\n                    checked: this.table.state.filters.status_ === undefined,\r\n                    caption: `No status filter`,\r\n                    onClick: this.table.handleClickMenu\r\n                });\r\n                const checked = i =>\r\n                    (i |\r\n                        (this.table.state.filters.status_ || {\r\n                            v: 0\r\n                        }).v) ===\r\n                    (this.table.state.filters.status_ || { v: 0 }).v;\r\n                menus.push({\r\n                    id: menus.length,\r\n                    type: \"sub-menu\",\r\n                    separation: menus.length > 0,\r\n                    caption: `Status filters`,\r\n                    children: [\r\n                        {\r\n                            id: 101,\r\n                            type: \"menu-item\",\r\n                            checked: checked(1),\r\n                            separation: false,\r\n                            caption: `Updated rows`,\r\n                            onClick: this.table.handleClickMenu\r\n                        },\r\n                        {\r\n                            id: 102,\r\n                            type: \"menu-item\",\r\n                            checked: checked(2),\r\n                            separation: false,\r\n                            caption: `New rows`,\r\n                            onClick: this.table.handleClickMenu\r\n                        },\r\n                        {\r\n                            id: 104,\r\n                            type: \"menu-item\",\r\n                            checked: checked(4),\r\n                            separation: false,\r\n                            caption: `Deleted rows`,\r\n                            onClick: this.table.handleClickMenu\r\n                        },\r\n                        {\r\n                            id: 108,\r\n                            type: \"menu-item\",\r\n                            // disable: utils.isNullOrUndefined(this.state.meta.lockedIndex),\r\n                            checked: checked(8),\r\n                            separation: false,\r\n                            caption: `Rows with errors`,\r\n                            onClick: this.table.handleClickMenu\r\n                        }\r\n                    ]\r\n                });\r\n            }\r\n            if (this.state.meta.row.audit) {\r\n                menus.push({\r\n                    id: menus.length,\r\n                    type: \"menu-item\",\r\n                    disable: this.state.auditedRow === undefined,\r\n                    separation: this.state.meta.table.editable,\r\n                    caption: `Close audit`,\r\n                    onClick: this.handleCloseAudit\r\n                });\r\n            }\r\n        }\r\n        this.getCustomMenu(menu, menus);\r\n        if (menus.length) {\r\n            return {\r\n                type: \"menu\",\r\n                position: \"bottom\",\r\n                children: menus\r\n            };\r\n        } else {\r\n            return null;\r\n        }\r\n    };\r\n}\r\n","import React, { Component } from \"react\";\r\nimport {\r\n  utils,\r\n  ContextualMenuClient,\r\n  Input,\r\n  icons,\r\n  CheckBoxInput\r\n} from \"zebulon-controls\";\r\n// import { Input } from \"./Input\";\r\nimport { computeMetaPositions } from \"./utils/compute.meta\";\r\nimport { cellData } from \"./utils/compute.data\";\r\nimport { getRowErrors, getRowStatus } from \"./utils/utils\";\r\nimport classnames from \"classnames\";\r\nimport {\r\n  FiFilter,\r\n  FiArrowUp,\r\n  FiArrowDown,\r\n  FiPlus,\r\n  FiCheck,\r\n  FiX\r\n} from \"react-icons/fi\";\r\nconsole.log(FiFilter);\r\nconst filter = (\r\n  column,\r\n  position,\r\n  height,\r\n  width,\r\n  filterTo,\r\n  onChange,\r\n  openFilter,\r\n  // focusedId,\r\n  componentId\r\n) => {\r\n  const className = classnames({\r\n    \"zebulon-table-cell\": true,\r\n    \"zebulon-table-header\": true,\r\n    \"zebulon-table-filter\": true,\r\n    \"zebulon-table-filter-checkbox\": column.dataType === \"boolean\",\r\n    \"zebulon-table-filter-checkbox-undefined\":\r\n      column.dataType === \"boolean\" && (!column.v || column.v.value === null)\r\n  });\r\n  let textAlign = column.alignement || \"left\";\r\n  if (!column.alignement) {\r\n    if (column.dataType === \"number\") textAlign = \"right\";\r\n    else if (\r\n      column.dataType === \"date\" ||\r\n      column.dataType === \"month\" ||\r\n      column.dataType === \"year\" ||\r\n      column.dataType === \"boolean\"\r\n    )\r\n      textAlign = \"center\";\r\n  }\r\n  const id = `filter${filterTo ? \"To\" : \"\"}: ${componentId}--${column.index_}`;\r\n  const focused = (document.activeElement || {}).id === id;\r\n  let value = column.v,\r\n    div;\r\n  // <div\r\n  //   style={{\r\n  //     background: FiFilter, //icons.filter,\r\n  //     backgroundSize: \"cover\",\r\n  //     height: \"1em\",\r\n  //     width: \"1em\",\r\n  //     marginTop: \"0.1em\",\r\n  //     marginRight: \"0.1em\"\r\n  //   }}\r\n  // />\r\n\r\n  if (column.filterType === \"values\" && column.v) {\r\n    div = (\r\n      <div\r\n        style={{\r\n          height,\r\n          width\r\n        }}\r\n        id={id}\r\n        key={id}\r\n        className={className}\r\n        onClick={e => openFilter(e, column)}\r\n      >\r\n        <FiFilter />\r\n      </div>\r\n    );\r\n  } else {\r\n    if (filterTo) {\r\n      value = column.vTo;\r\n    } else if (column.filterType === \"values\") {\r\n      value = \"\";\r\n    }\r\n    div = (\r\n      <Input\r\n        column={column}\r\n        id={id + \"-\"}\r\n        key={id}\r\n        className={className}\r\n        style={{\r\n          height,\r\n          width,\r\n          textAlign\r\n        }}\r\n        editable={true}\r\n        focused={focused}\r\n        inputType=\"filter\"\r\n        tabIndex={column.index_ * 2 + (filterTo || 0) + 100}\r\n        value={value === undefined ? { caption: \"\" } : value}\r\n        filterTo={filterTo}\r\n        onChange={onChange}\r\n        onFocus={e => {\r\n          openFilter(e, column);\r\n        }}\r\n      />\r\n    );\r\n  }\r\n\r\n  return div;\r\n};\r\nconst header = (\r\n  column,\r\n  position,\r\n  height,\r\n  width,\r\n  handleClick,\r\n  handleDragStart,\r\n  handleDragOver,\r\n  handleDrop,\r\n  componentId\r\n  // handleDragEnd\r\n) => {\r\n  let Arrow = () => null;\r\n  if (column.sort === \"asc\") {\r\n    Arrow = FiArrowUp;\r\n    // sort = \"↑\";\r\n  } else if (column.sort === \"desc\") {\r\n    // sort = \"↓\";\r\n    Arrow = FiArrowDown;\r\n  }\r\n  const id = `header: ${componentId}--${column.index_}`;\r\n  return (\r\n    <ContextualMenuClient\r\n      key={id}\r\n      id={id}\r\n      className=\"zebulon-table-cell zebulon-table-header\"\r\n      onClick={() => handleClick(column, false)}\r\n      onDoubleClick={() => handleClick(column, true)}\r\n      onDragOver={handleDragOver}\r\n      onDrop={handleDrop}\r\n      style={{\r\n        height,\r\n        width,\r\n        justifyContent: \"space-between\",\r\n        display: \"flex\",\r\n        paddingRight: \"unset\"\r\n      }}\r\n      column={column}\r\n      menu=\"column-header-menu\"\r\n      componentId={componentId}\r\n    >\r\n      <div\r\n        id={id}\r\n        key={0}\r\n        style={{ width: width - 15 }}\r\n        draggable={true}\r\n        onDragStart={e => handleDragStart(e, \"move\")}\r\n      >\r\n        {column.caption || column.id}\r\n      </div>\r\n      <Arrow />\r\n      <div\r\n        id={id}\r\n        key={2}\r\n        style={{\r\n          width: 6,\r\n          cursor: \"col-resize\",\r\n          opacity: 0\r\n        }}\r\n        draggable={true}\r\n        onDragStart={e => handleDragStart(e, \"resize\")}\r\n      />\r\n    </ContextualMenuClient>\r\n  );\r\n};\r\nconst auditCell = (row, column, status, data, params, style, componentId) => {\r\n  const { value } = cellData(row, column, status, data, params, false);\r\n  let textAlign = column.alignement || \"left\";\r\n  if (!column.alignement) {\r\n    if (column.dataType === \"number\") {\r\n      textAlign = \"right\";\r\n    } else if (\r\n      column.dataType === \"date\" ||\r\n      column.dataType === \"month\" ||\r\n      column.dataType === \"year\" ||\r\n      column.dataType === \"boolean\"\r\n    ) {\r\n      textAlign = \"center\";\r\n    }\r\n  }\r\n  style.textAlign = textAlign;\r\n  const className = classnames({\r\n    \"zebulon-table-cell\": true,\r\n    \"zebulon-table-cell-audit\": true,\r\n    \"zebulon-table-cell-odd\": true\r\n    // \"zebulon-table-cell-selected\": selected,\r\n    // \"zebulon-table-cell-focused\": focused,\r\n    // \"zebulon-table-cell-editable\": editable && focused\r\n  });\r\n  // if (column.dataType === \"boolean\") value = value || false;\r\n  const id = `audit-cell: ${componentId}-${row.index_}-${column.index_}`;\r\n  return (\r\n    <Input\r\n      row={row}\r\n      column={column}\r\n      style={style}\r\n      className={className}\r\n      value={value}\r\n      key={id}\r\n      id={id}\r\n    />\r\n  );\r\n};\r\nconst filterEmpty = (id, position, width, height) => {\r\n  return (\r\n    <div\r\n      key={`${id}-filter-empty`}\r\n      className=\"zebulon-table-cell zebulon-table-header zebulon-table-filter-empty\"\r\n      style={{\r\n        height,\r\n        width\r\n        // ,\r\n        // border: \"0.02em solid rgba(0, 0, 0, 0.2) \",\r\n        // borderRight\r\n      }}\r\n    />\r\n  );\r\n};\r\n\r\n// ↑↓\r\nexport class Headers extends Component {\r\n  shouldComponentUpdate() {\r\n    return !this.props.changingFilter;\r\n  }\r\n  handleClick = (column, double) => {\r\n    if (!this.props.isActive && this.props.onActivation) {\r\n      this.props.onActivation(this.props.componentId);\r\n    }\r\n    const { onSort } = this.props;\r\n    if (!double) {\r\n      this.timer = setTimeout(() => {\r\n        if (!this.prevent) {\r\n          onSort(column, false);\r\n        }\r\n        this.prevent = false;\r\n      }, 200);\r\n    } else {\r\n      clearTimeout(this.timer);\r\n      this.prevent = true;\r\n      onSort(column, true);\r\n    }\r\n  };\r\n  getColumnIndex = id => {\r\n    const ids = id.split(\"-\");\r\n    return ids[ids.length - 1];\r\n  };\r\n  handleDragStart = (e, type) => {\r\n    this.dragId = e.target.id;\r\n    this.dragType = type;\r\n    this.dragX = e.pageX;\r\n    e.dataTransfer.setData(\"text\", this.dragId);\r\n    e.stopPropagation();\r\n  };\r\n\r\n  handleDragOver = e => {\r\n    if (\r\n      this.dragType === \"move\" ||\r\n      (this.dragType === \"resize\" &&\r\n        this.props.meta.properties[this.getColumnIndex(this.dragId)]\r\n          .computedWidth +\r\n          e.pageX -\r\n          this.dragX >\r\n          20)\r\n    ) {\r\n      e.preventDefault();\r\n    }\r\n  };\r\n\r\n  handleDrop = e => {\r\n    e.preventDefault();\r\n    const meta = this.props.meta.properties;\r\n    if (this.dragType) {\r\n      if (\r\n        this.dragType === \"move\" &&\r\n        !utils.isNullOrUndefined(this.dragId) &&\r\n        this.dragId !== e.target.id\r\n      ) {\r\n        meta[this.getColumnIndex(this.dragId)].index_ =\r\n          meta[this.getColumnIndex(e.target.id)].index_ + 0.1;\r\n        meta.sort((a, b) => a.index_ - b.index_);\r\n        computeMetaPositions(this.props.meta);\r\n        this.props.onMetaChange();\r\n      } else if (\r\n        this.dragType === \"resize\" &&\r\n        !utils.isNullOrUndefined(this.dragX) &&\r\n        !utils.isNullOrUndefined(e.pageX)\r\n      ) {\r\n        const column = meta[this.getColumnIndex(this.dragId)];\r\n        const zoom = column.computedWidth / column.width;\r\n        column.computedWidth += e.pageX - this.dragX;\r\n        column.width = column.computedWidth / zoom;\r\n        computeMetaPositions(this.props.meta);\r\n        this.props.onMetaChange();\r\n      }\r\n    }\r\n    this.dragId = null;\r\n    this.dragType = null;\r\n    this.dragX = null;\r\n  };\r\n\r\n  render() {\r\n    let { shift, startIndex: index } = this.props.scroll;\r\n    const {\r\n      meta,\r\n      width,\r\n      height,\r\n      onChange,\r\n      openFilter,\r\n      // focusedId,\r\n      headersLength,\r\n      locked,\r\n      auditedRow,\r\n      auditStatus,\r\n      componentId,\r\n      id,\r\n      data,\r\n      params\r\n    } = this.props;\r\n    const cells = [];\r\n    let position = 0,\r\n      first = true;\r\n    if (!locked) {\r\n      index = Math.max(\r\n        index,\r\n        utils.isNullOrUndefined(meta.lockedIndex) ? 0 : meta.lockedIndex + 1\r\n      );\r\n    } else {\r\n      index = 0;\r\n      shift = 0;\r\n    }\r\n    while (index < meta.properties.length && position < width) {\r\n      const column = meta.properties[index];\r\n      const columnWidth = Math.max(\r\n        Math.min(\r\n          first ? column.computedWidth + shift : column.computedWidth,\r\n          width - position\r\n        ),\r\n        0\r\n      );\r\n      let div = null;\r\n      if (!column.hidden && columnWidth) {\r\n        first = false;\r\n        div = header(\r\n          column,\r\n          position,\r\n          height / headersLength,\r\n          columnWidth,\r\n          this.handleClick,\r\n          this.handleDragStart,\r\n          this.handleDragOver,\r\n          this.handleDrop,\r\n          componentId || id\r\n        );\r\n        if (headersLength > 1) {\r\n          if (auditedRow) {\r\n            div = [div];\r\n            const style = {\r\n              // position: \"absolute\",\r\n              // left: position,\r\n              width: columnWidth,\r\n              // top: height / 2,\r\n              height: height / 2\r\n            };\r\n            div.push(\r\n              auditCell(\r\n                auditedRow,\r\n                column,\r\n                auditStatus,\r\n                data,\r\n                params,\r\n                style,\r\n                componentId || id\r\n              )\r\n            );\r\n          } else {\r\n            div = [div];\r\n            if (\r\n              ![\"object\", \"array\", \"function\", \"text\"].includes(\r\n                utils.nullValue(column.dataType, \"object\")\r\n              )\r\n            ) {\r\n              //  filter (or filter from0\r\n              div.push(\r\n                filter(\r\n                  column,\r\n                  position,\r\n                  height / headersLength,\r\n                  columnWidth,\r\n                  false,\r\n                  onChange,\r\n                  openFilter,\r\n                  componentId\r\n                )\r\n              );\r\n              // empty cell\r\n            } else {\r\n              div.push(\r\n                filterEmpty(\r\n                  column.id,\r\n                  position,\r\n                  columnWidth,\r\n                  height / headersLength\r\n                )\r\n              );\r\n            }\r\n            // filter \"to\" (between)\r\n            if (headersLength === 3) {\r\n              if (\r\n                column.filterType === \"between\" &&\r\n                ![\"object\", \"array\", \"function\", \"text\"].includes(\r\n                  utils.nullValue(column.dataType, \"object\")\r\n                )\r\n              ) {\r\n                div.push(\r\n                  filter(\r\n                    column,\r\n                    position,\r\n                    height / headersLength,\r\n                    columnWidth,\r\n                    column.filterType === \"between\",\r\n                    onChange,\r\n                    openFilter,\r\n                    componentId\r\n                  )\r\n                );\r\n                // empty cell\r\n              } else {\r\n                div.push(\r\n                  filterEmpty(\r\n                    `${column.id}-to`,\r\n                    position,\r\n                    columnWidth,\r\n                    height / headersLength\r\n                  )\r\n                );\r\n              }\r\n            }\r\n          }\r\n          div = (\r\n            <div\r\n              key={column.id || `undefined ${column.index_}`}\r\n              style={{\r\n                // position: \"absolute\", toto\r\n                left: position,\r\n                display: \"block\",\r\n                width: columnWidth,\r\n                height\r\n              }}\r\n            >\r\n              {div}\r\n            </div>\r\n          );\r\n        }\r\n        cells.push(div);\r\n        position += columnWidth;\r\n      }\r\n      index += 1;\r\n    }\r\n    const style = {\r\n      width,\r\n      height,\r\n      // overflow: \"hidden\",\r\n      display: \"flex\"\r\n    };\r\n    if (!locked) {\r\n      style.overflow = \"hidden\";\r\n    }\r\n\r\n    if (cells.length) {\r\n      return (\r\n        <div\r\n          id=\"tutut\"\r\n          key={-2 - locked}\r\n          className={locked ? \"zebulon-locked-headers\" : \"\"}\r\n          // id={type + filterTo ? \"To\" : \"\"}\r\n          style={{ ...this.props.style, ...style, position: \"relative\" }}\r\n        >\r\n          {cells}\r\n        </div>\r\n      );\r\n    } else {\r\n      return null;\r\n    }\r\n  }\r\n}\r\nexport const statusCell = (\r\n  style,\r\n  className,\r\n  index,\r\n  status,\r\n  onClick,\r\n  onDoubleClick,\r\n  handleErrors,\r\n  componentId,\r\n  checkable,\r\n  checked,\r\n  onChange,\r\n  isAudit,\r\n  draggable,\r\n  handleDragStart\r\n) => {\r\n  let Glyph = () => null;\r\n  if (status.deleted_) {\r\n    Glyph = FiX;\r\n  } else if (status.new_) {\r\n    Glyph = FiPlus;\r\n  } else if (status.updated_) {\r\n    Glyph = FiCheck;\r\n  }\r\n  const errors = getRowErrors(status, status.rowUpdated.index_);\r\n  const style_ = errors.length && !status.deleted ? { color: \"red\" } : {};\r\n  //   style.color = \"red\";\r\n  // }\r\n  if (checkable) {\r\n    Glyph = () => (\r\n      <input\r\n        type=\"checkbox\"\r\n        checked={checked || false}\r\n        onChange={() => onChange(status.rowUpdated.index_)}\r\n        // style={{ height: 20 }}\r\n      />\r\n    );\r\n  }\r\n  const id = `status: ${componentId}-${index}-`;\r\n  return (\r\n    <ContextualMenuClient\r\n      id={id}\r\n      key={id}\r\n      index={index}\r\n      className={className}\r\n      style={style}\r\n      onClick={e => onClick(index, e.shiftKey)}\r\n      onMouseOver={e => handleErrors(e, errors)}\r\n      onMouseOut={e => {\r\n        return handleErrors(e, []);\r\n      }}\r\n      onDoubleClick={\r\n        onDoubleClick ? e => onDoubleClick(e, status.rowUpdated) : () => {}\r\n      }\r\n      draggable={draggable}\r\n      onDragStart={handleDragStart}\r\n      status={status}\r\n      // row={row}\r\n      menu=\"row-header-menu\"\r\n      componentId={componentId}\r\n    >\r\n      <Glyph style={style_} id={id} />\r\n    </ContextualMenuClient>\r\n  );\r\n};\r\nexport class Status extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    // this.state = { updatedRows: this.props.updatedRows };\r\n  }\r\n  // componentWillReceiveProps(nextProps) {\r\n  //   if (this.state.updatedRows !== nextProps.updatedRows) {\r\n  //     this.setState({ updatedRows: nextProps.updatedRows });\r\n  //   }\r\n  // }\r\n  shouldComponentUpdate(nextProps) {\r\n    return !nextProps.status.loadingPage && !nextProps.noUpdate;\r\n  }\r\n  onClick = (index, extension) => {\r\n    const { meta, scroll } = this.props;\r\n    const columns = (meta.visibleIndexes || [0])[0];\r\n    const startRowIndex = extension ? this.props.selectedIndex : index;\r\n    this.props.selectRange(\r\n      {\r\n        end: { rows: index, columns },\r\n        start: { rows: startRowIndex, columns: meta.properties.length - 1 }\r\n      },\r\n      undefined,\r\n      undefined,\r\n      undefined,\r\n      false,\r\n      index === scroll.startIndex || index === this.stopIndex\r\n    );\r\n  };\r\n  onChange = index => {\r\n    if (this.props.checkable) {\r\n      // const updatedRows = this.state.updatedRows;\r\n      const updatedRows = this.props.updatedRows;\r\n      // if (!updatedRows[index]) {\r\n      //   updatedRows[index] = { errors: {} };\r\n      // }\r\n      const checked = !updatedRows[index].rowUpdated.checked_;\r\n      // updatedRows[index].checked_ = checked;\r\n      updatedRows[index].rowUpdated.checked_ = checked;\r\n      if (this.props.checkable === 2) {\r\n        // updatedRows[index + 1 - 2 * (index % 2)].checked_ = !checked;\r\n        updatedRows[index + 1 - 2 * (index % 2)].rowUpdated.checked_ = !checked;\r\n      }\r\n      // this.setState({ updatedRows });\r\n    }\r\n  };\r\n  handleDragStart = e => {\r\n    e.stopPropagation();\r\n    e.dataTransfer.setData(\"text\", `status: ${e.target.id}`);\r\n  };\r\n  render() {\r\n    const {\r\n      height,\r\n      rowHeight,\r\n      data,\r\n      scroll,\r\n      selectedIndex,\r\n      handleErrors,\r\n      dataLength,\r\n      componentId,\r\n      checkable,\r\n      onDoubleClick,\r\n      isAudit,\r\n      draggable,\r\n      statusChanged\r\n    } = this.props;\r\n    const updatedRows = this.props.updatedRows;\r\n    let index = 0,\r\n      indexPage = 0,\r\n      rows = data;\r\n    if (typeof data === \"object\" && data.page) {\r\n      rows = data.page;\r\n      indexPage = data.pageStartIndex;\r\n    }\r\n    const cells = [];\r\n    while (\r\n      index < Math.min(dataLength || data.length, Math.ceil(height / rowHeight))\r\n    ) {\r\n      const style = {\r\n        // position: \"relative\",\r\n        top: index === 0 ? 0 : scroll.shift + index * rowHeight,\r\n        width: rowHeight,\r\n        height:\r\n          index === 0\r\n            ? rowHeight + scroll.shift\r\n            : Math.min(rowHeight, height - (scroll.shift + index * rowHeight))\r\n      };\r\n      if (index + scroll.startIndex - indexPage < rows.length) {\r\n        const row = rows[index + scroll.startIndex - indexPage];\r\n        const status_ = getRowStatus(updatedRows, row); //updatedRows[index].checked_updatedRows[row.index_];\r\n\r\n        // if (checkable) {\r\n        //   if (row.checked_ !== undefined && updatedRow.checked_ === undefined) {\r\n        //     updatedRow.checked_ = row.checked_;\r\n        //   } else if (\r\n        //     row.checked_ === undefined &&\r\n        //     updatedRow.checked_ !== undefined\r\n        //   ) {\r\n        //     row.checked_ = updatedRow.checked_;\r\n        //   }\r\n        // }\r\n\r\n        const className = classnames({\r\n          \"zebulon-table-status\": true,\r\n          \"zebulon-table-status-selected\":\r\n            selectedIndex === index + scroll.startIndex\r\n        });\r\n        const ix = index;\r\n        cells.push(\r\n          statusCell(\r\n            style,\r\n            className,\r\n            ix + scroll.startIndex,\r\n            status_,\r\n            this.onClick,\r\n            onDoubleClick,\r\n            (e, errors) => handleErrors(e, ix, errors),\r\n            componentId,\r\n            checkable,\r\n            row.checked_,\r\n            this.onChange,\r\n            isAudit,\r\n            draggable\r\n          )\r\n        );\r\n      }\r\n      index += 1;\r\n    }\r\n    this.stopIndex = index + scroll.startIndex - 1;\r\n    return (\r\n      <div\r\n        key={\"status: \" + componentId}\r\n        id={\"status: \" + componentId}\r\n        style={{\r\n          width: rowHeight,\r\n          height,\r\n          // overflow: \"hidden\",\r\n          position: \"relative\",\r\n          diplay: \"flex\"\r\n        }}\r\n      >\r\n        {cells}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","import React from \"react\";\r\nimport { utils, constants } from \"zebulon-controls\";\r\nimport { computeData } from \"./utils/compute.data\";\r\nimport { buildPasteArray, getSelection } from \"./utils/copy.paste\";\r\nimport {\r\n  hasParent,\r\n  getUpdatedRows,\r\n  manageRowError,\r\n  rollback,\r\n  getRowStatus,\r\n  setStatus\r\n} from \"./utils/utils\";\r\nimport { TableMenu } from \"./Table.menu\";\r\nexport class TableEvent extends TableMenu {\r\n  // ------------------------------------\r\n  // Navigation\r\n  // ------------------------------------\r\n  closeOpenedWindows = (keepSearch, column, row) => {\r\n    // console.log(\"close\", row, column);\r\n    if (this.state.openedFilter) {\r\n      this.setState({ openedFilter: undefined });\r\n    }\r\n    if (\r\n      this.state.text.top !== undefined &&\r\n      !(column && column.dataType === \"text\")\r\n    ) {\r\n      this.setState({ text: {} });\r\n    }\r\n    if (this.state.detail.content !== undefined) {\r\n      this.setState({ detail: {} });\r\n    }\r\n    if (this.state.toolTip !== undefined) {\r\n      this.setState({ toolTip: undefined });\r\n    }\r\n    if (!keepSearch && this.state.search !== undefined) {\r\n      this.setState({ search: undefined });\r\n    }\r\n    if (this.props.contextualMenu) {\r\n      this.props.contextualMenu.close();\r\n    }\r\n  };\r\n  fKeyMap = {\r\n    f12: \"save\",\r\n    f11: \"filter\",\r\n    f10: \"refresh\"\r\n  };\r\n  toggleFilter = () => {\r\n    if (this.hasFocus) {\r\n      const element = document.getElementById(\r\n        `filter: ${this.props.id}--${this.state.selectedRange.end.columns}`\r\n      );\r\n      if (element && element.children[0]) {\r\n        element.children[0].focus();\r\n        this.hasFocus = false;\r\n      }\r\n    } else {\r\n      document.activeElement.blur();\r\n      this.hasFocus = true;\r\n      this.setState({ selectedRange: this.state.selectedRange });\r\n    }\r\n  };\r\n  handleKeyDown = e => {\r\n    // a voir\r\n    const keyCode = e.which || e.keyCode;\r\n    const key = utils.keyMap[keyCode];\r\n    if (key === undefined) {\r\n      return;\r\n    }\r\n    const { openedFilter, detail } = this.state;\r\n    const isFilter = hasParent(document.activeElement, \"filter\");\r\n    if (key === \"Escape\") {\r\n      if (openedFilter) {\r\n        this.hasFocus = true;\r\n      }\r\n      this.closeOpenedWindows();\r\n    }\r\n    if (key === \"Tab\" && (openedFilter || detail.content || isFilter)) {\r\n      this.hasFocus = false;\r\n      return false;\r\n    }\r\n    if (\r\n      key === \"Enter\" &&\r\n      this.column &&\r\n      this.row &&\r\n      this.column.foreignObjectFunction\r\n    ) {\r\n      this.foreignObject(\"none\", {\r\n        row: this.row,\r\n        column: this.column,\r\n        value:\r\n          this.row[this.column.id] !== undefined\r\n            ? this.row[this.column.id]\r\n            : this.column.accessorFunction({ row: this.row }),\r\n        id: this.props.componentId\r\n      });\r\n      // const { id, value, column, row, cellQuit } = message;\r\n      e.preventDefault();\r\n      return false;\r\n    }\r\n    //function Keys\r\n    if (keyCode > 112 && keyCode < 124) {\r\n      const action = this.state.meta.table.actions.find(\r\n        action => action.key === key\r\n      );\r\n      if (action) {\r\n        e.preventDefault();\r\n        this.handleAction(action);\r\n      }\r\n    }\r\n    // ctrl+F\r\n    if (70 === (e.which || e.keyCode) && e.ctrlKey) {\r\n      this.hasFocus = false;\r\n      this.handleSearch(e);\r\n    } else if (\r\n      // can't garantee that the focus in on the selected cell\r\n      key === \"Space\" &&\r\n      this.hasFocus &&\r\n      this.column.dataType === \"boolean\" &&\r\n      document.activeElement.id !==\r\n        `cell: ${this.props.componentId || this.props.id}-${this.row.index_}-${\r\n          this.column.index_\r\n        }`\r\n    ) {\r\n      e.preventDefault();\r\n      this.onChange({\r\n        row: this.row,\r\n        column: this.column,\r\n        value: { value: !this.row[this.column.id] }\r\n      });\r\n    } else if (utils.isNavigationKey(e)) {\r\n      if (openedFilter) {\r\n        if (key === \"Enter\") {\r\n          e.preventDefault();\r\n          this.hasFocus = true;\r\n          return this.openedFilter.onOk();\r\n        } else {\r\n          return this.openedFilter.values.handleNavigationKeys(e);\r\n        }\r\n      } else if (isFilter && [\"ArrowLeft\", \"ArrowRight\"].includes(key)) {\r\n        return false;\r\n      } else if (this.rows) {\r\n        return this.rows.handleNavigationKeys(e);\r\n      }\r\n    }\r\n    console.log(\"te\", key, e.defaultPrevented, this.state.meta);\r\n  };\r\n  copy = function copy(text) {\r\n    try {\r\n      // var bodyElement = document.getElementsByTagName(\"body\")[0];\r\n      // var clipboardTextArea = document.createElement(\"textarea\");\r\n      // clipboardTextArea.style.position = \"absolute\";\r\n      // // clipboardTextArea.style.left = \"-10000px\";\r\n      // bodyElement.appendChild(clipboardTextArea);\r\n      // clipboardTextArea.innerHTML = text;\r\n      // clipboardTextArea.select();\r\n      // document.execCommand(\"copy\");\r\n      navigator.clipboard.writeText(text).then(x => console.log(x));\r\n      // window.setTimeout(function() {\r\n      //   bodyElement.removeChild(clipboardTextArea);\r\n      // }, 0);\r\n    } catch (error) {\r\n      /* eslint-disable no-console */\r\n      console.error(\"error during copy\", error);\r\n      /* eslint-enable */\r\n    }\r\n  };\r\n  handleCopy = e => {\r\n    if (e.target.selectionStart !== e.target.selectionEnd) {\r\n      return;\r\n    }\r\n    e.preventDefault();\r\n    this.copy(\r\n      getSelection(\r\n        \"xls\",\r\n        this.state.selectedRange,\r\n        this.state.meta.properties,\r\n        this.state.filteredData,\r\n        this.state.updatedRows,\r\n        this.state.data,\r\n        this.props.params\r\n      )\r\n    );\r\n  };\r\n  handlePaste = e => {\r\n    const clipboard = e.clipboardData.getData(\"text\");\r\n    // existing carriage return ->cells copy else default behaviour\r\n    if (!clipboard.includes(\"\\r\")) {\r\n      return;\r\n    }\r\n    e.preventDefault();\r\n    const cells = buildPasteArray(\"xls\", clipboard, this, cell =>\r\n      this.selectRange_({ start: cell, end: cell }, x => x, undefined, \"enter\")\r\n    );\r\n    return cells;\r\n  };\r\n  handleSearch = e => {\r\n    e.preventDefault();\r\n    this.setState({ search: true });\r\n  };\r\n  //-----------------------------------------\r\n  // buttons and actions management\r\n  //-----------------------------------------\r\n  getDetail = ({\r\n    Detail,\r\n    row,\r\n    data,\r\n    meta,\r\n    status,\r\n    params,\r\n    top,\r\n    onClose,\r\n    onChange\r\n  }) => {\r\n    return (\r\n      <Detail\r\n        row={row}\r\n        data={data}\r\n        meta={meta}\r\n        params={params}\r\n        status={status}\r\n        onChange={onChange}\r\n        close={onClose}\r\n        top={top}\r\n      />\r\n    );\r\n  };\r\n  onDoubleClick = (e, row, column) => {\r\n    if (this.props.onDoubleClick) {\r\n      this.props.onDoubleClick(row, column);\r\n    } else if (this.doubleClickAction) {\r\n      this.handleAction(this.doubleClickAction, e, row, column);\r\n    }\r\n  };\r\n  onFocus = (e, row, column) => {\r\n    // console.log(row, column);\r\n    this.closeOpenedWindows(true, column);\r\n  };\r\n  handleToolTip = (action, e, out) => {\r\n    if (\r\n      e.target.tagName === \"svg\" &&\r\n      !(\r\n        e.relatedTarget &&\r\n        e.relatedTarget.parentElement &&\r\n        e.relatedTarget.parentElement.id === e.target.id\r\n      )\r\n    ) {\r\n      if (!out) {\r\n        if (action.toolTip) {\r\n          const toolTip = {\r\n            type: \"text\",\r\n            top: 20,\r\n            // +\r\n            // rowIndex * this.rowHeight +\r\n            // this.state.scroll.rows.shift,\r\n            left:\r\n              e.target.parentElement.offsetLeft +\r\n              (1 + parseInt(e.target.id)) * (e.target.clientWidth + 10) -\r\n              15, // this.rowHeight,\r\n            // rowIndex,\r\n            content:\r\n              typeof action.toolTip === \"function\"\r\n                ? action.toolTip(e)\r\n                : action.toolTip\r\n          };\r\n          this.toolTipTimer = setTimeout(() => {\r\n            this.setState({ toolTip });\r\n            this.toolTipTimer = undefined;\r\n          }, 500);\r\n\r\n          console.log(\r\n            \"tooltip\",\r\n            e.target.tagName,\r\n            e.target.id,\r\n            e.relatedTarget.parentElement.id,\r\n            toolTip\r\n          );\r\n        }\r\n      } else if (this.state.toolTip) {\r\n        console.log(\r\n          \"tooltip2\",\r\n          e.target.tagName,\r\n          e.target.id,\r\n          e.relatedTarget.parentElement.id,\r\n          this.state.toolTip\r\n        );\r\n        this.setState({ toolTip: null });\r\n        this.toolTipTimer = undefined;\r\n      } else if (this.toolTipTimer) {\r\n        clearTimeout(this.toolTipTimer);\r\n        this.toolTipTimer = undefined;\r\n      }\r\n    }\r\n  };\r\n  handleAction = (action, e, row, column) => {\r\n    if (action.statusEnable === false || action.enable === false) {\r\n      return false;\r\n    }\r\n    this.closeOpenedWindows();\r\n    const rowIndex = this.state.selectedRange.end.rows;\r\n    // let row = {};\r\n    if (!row && rowIndex !== undefined) {\r\n      row = this.getRow(rowIndex);\r\n    }\r\n    if (\r\n      this.state.selectedRange ||\r\n      !(action.type === \"delete\" || action.type === \"select\")\r\n    ) {\r\n      if (action.type === \"delete\") {\r\n        return this.handleDelete(row);\r\n      } else if (action.type === \"insert\") {\r\n        return this.handleNew(rowIndex || 0);\r\n      } else if (action.type === \"duplicate\") {\r\n        return this.handleDuplicate(rowIndex || 0);\r\n      } else if (action.type === \"save\") {\r\n        return this.props.onSave();\r\n      } else if (action.type === \"refresh\") {\r\n        this.props.onTableChange(\"refresh\");\r\n      } else {\r\n        if (action.type === \"detail\" && action.content) {\r\n          this.setState({ detail: action });\r\n        } else if (\r\n          action.action ||\r\n          (action.type === \"action\" && this.props.onAction)\r\n        ) {\r\n          const {\r\n            selectedRange,\r\n            updatedRows,\r\n            data,\r\n            meta,\r\n            filters\r\n          } = this.state;\r\n          const f = () =>\r\n            (this.props.onAction || action.actionFunction || (() => {}))(\r\n              {\r\n                action,\r\n                row: row || this.row,\r\n                column,\r\n                selectedRange,\r\n                updatedRows,\r\n                filters,\r\n                data,\r\n                meta,\r\n                params: this.props.params,\r\n                action: action,\r\n                ref: this\r\n              },\r\n              e\r\n            );\r\n          // if changes save is required\r\n          if (action.onTableChange) {\r\n            this.props.onTableChange(action.onTableChange, ok => {\r\n              if (ok) {\r\n                f();\r\n              }\r\n            });\r\n          } else {\r\n            f();\r\n          }\r\n          this.setState({ status: this.state.status });\r\n        }\r\n      }\r\n    }\r\n  };\r\n\r\n  handleDelete = row => {\r\n    const status = getRowStatus(this.state.updatedRows, row);\r\n    if (status.deleted_) {\r\n      status.deleted_ = false;\r\n    } else {\r\n      if (!status.new_) {\r\n        rollback(this.state.updatedRows, row.index_);\r\n      }\r\n      setStatus(status, \"deleted_\");\r\n    }\r\n    this.setState({ status: this.state.status });\r\n    if (this.props.onRowDelete) {\r\n      const message = {\r\n        row,\r\n        status,\r\n        meta: this.state.meta,\r\n        data: this.state.data,\r\n        params: this.props.params\r\n      };\r\n      this.props.onRowDelete(message);\r\n    }\r\n  };\r\n  newRow = (row, index) => {\r\n    const ok = this.canQuit(\"new\", ok => {\r\n      if (ok) {\r\n        this.newRow_(row, index);\r\n      }\r\n    });\r\n    if (ok) {\r\n      this.newRow_(row, index);\r\n    }\r\n  };\r\n\r\n  newRow_ = (row, index) => {\r\n    const {\r\n      selectedRange,\r\n      updatedRows,\r\n      filteredData,\r\n      meta,\r\n      data,\r\n      scroll\r\n    } = this.state;\r\n    const status = {\r\n      new_: true,\r\n      errors: {},\r\n      rowUpdated: row,\r\n      timeStamp: new Date().getTime()\r\n    };\r\n    if (this.state.meta.table.rowId) {\r\n      row[this.state.meta.table.rowId] = undefined;\r\n    }\r\n    if (this.state.meta.table.primaryKey) {\r\n      row[this.state.meta.table.primaryKey] = null;\r\n    }\r\n    let rows = filteredData,\r\n      ix = index;\r\n    updatedRows[this.getDataLength()] = status;\r\n    if (!meta.serverPagination) {\r\n      rows = filteredData;\r\n      data.push(row);\r\n    } else {\r\n      rows = filteredData.page;\r\n      ix = index - filteredData.pageStartIndex;\r\n      filteredData.pageLength++;\r\n      filteredData.filteredDataLength++;\r\n      filteredData.dataLength++;\r\n    }\r\n    rows.splice(ix, 0, row);\r\n    if (meta.serverPagination) {\r\n      filteredData.page = rows;\r\n      this.setState({ filteredData });\r\n    } else {\r\n      this.setState({ filteredData: rows });\r\n    }\r\n    if (this.onRowNew(row)) {\r\n      const columns = (meta.visibleIndexes || [0])[0];\r\n      const range = {\r\n        end: { rows: selectedRange.end.rows || 0, columns },\r\n        start: {\r\n          rows: selectedRange.end.rows,\r\n          columns: meta.properties.length - 1\r\n        }\r\n      };\r\n      const rowDirection = Math.sign(\r\n        range.end.rows - (scroll.rows.startIndex || 0)\r\n      );\r\n      const columnDirection = Math.sign(\r\n        range.end.columns - scroll.columns.startIndex\r\n      );\r\n      this.selectRange(range, undefined, row, \"enter\", false);\r\n      this.rowUpdated = true;\r\n      this.scrollTo(\r\n        range.end.rows,\r\n        rowDirection,\r\n        range.end.columns,\r\n        columnDirection\r\n      );\r\n    }\r\n  };\r\n  handleNew = index => {\r\n    const row = { index_: this.getDataLength() };\r\n    //  default values\r\n    this.state.meta.properties\r\n      .filter(column => column.defaultFunction)\r\n      .forEach(\r\n        column =>\r\n          (row[column.id] = column.defaultFunction({\r\n            column,\r\n            row,\r\n            params: this.props.params\r\n          }))\r\n      );\r\n    this.newRow(row, index);\r\n  };\r\n  handleDuplicate = index => {\r\n    if (this.row) {\r\n      const row = { ...this.row, index_: this.getDataLength() };\r\n      this.newRow(row, index);\r\n    }\r\n  };\r\n  // ------------------------------------------------------\r\n  // selection and validations\r\n  // ------------------------------------------------------\r\n  pagination = ({\r\n    startIndex,\r\n    stopIndex,\r\n    callbackBefore,\r\n    callbackAfter,\r\n    filters,\r\n    sorts\r\n  }) => {\r\n    const { updatedRows, filteredData, meta } = this.state;\r\n    this.setState({\r\n      status: { loaded: false, loading: false, loadingPage: true }\r\n    });\r\n    this.state\r\n      .data({\r\n        startIndex,\r\n        stopIndex,\r\n        filters,\r\n        sorts,\r\n        updatedRows\r\n      })\r\n      .then(data => {\r\n        if (callbackBefore) {\r\n          callbackBefore(data);\r\n        }\r\n        filteredData.page = data.page;\r\n        filteredData.pageLength = data.pageLength;\r\n        filteredData.filteredDataLength = data.filteredDataLength;\r\n        filteredData.pageStartIndex = data.pageStartIndex;\r\n        computeData(data.page, meta, 0);\r\n        if (this.props.onGetPage) {\r\n          this.props.onGetPage(data);\r\n        }\r\n        // console.log(\"page\", startIndex, stopIndex, filteredData);\r\n        if (callbackAfter) {\r\n          callbackAfter(data);\r\n        }\r\n        this.setState({\r\n          filteredDataLength: filteredData.filteredDataLength,\r\n          status: { loaded: true, loading: false, loadingPage: false }\r\n        });\r\n      });\r\n  };\r\n  getDataLength = () =>\r\n    this.state.meta.serverPagination\r\n      ? this.state.filteredData.dataLength\r\n      : this.state.data.length;\r\n  getFilteredDataLength = () =>\r\n    this.state.meta.serverPagination\r\n      ? this.state.filteredData.filteredDataLength\r\n      : this.state.filteredData.length;\r\n  getRow = index => {\r\n    const rows = this.state.filteredData;\r\n    if (this.state.meta.serverPagination) {\r\n      return rows.page[index - rows.pageStartIndex] || { index_: undefined };\r\n    } else {\r\n      return rows[index] || { index_: undefined };\r\n    }\r\n  };\r\n  isInPage = scroll => {\r\n    return (\r\n      !this.state.meta.serverPagination ||\r\n      (scroll.startIndex >= this.state.filteredData.pageStartIndex &&\r\n        scroll.startIndex + Math.ceil(this.rowsHeight / this.rowHeight) - 1 <\r\n          this.state.filteredData.pageStartIndex +\r\n            this.state.filteredData.pageLength)\r\n    );\r\n  };\r\n  paginationIsRequired = ({ startIndex, stopIndex }) => {\r\n    return (\r\n      this.state.meta.serverPagination &&\r\n      (startIndex < this.state.filteredData.pageStartIndex ||\r\n        stopIndex >=\r\n          this.state.filteredData.pageStartIndex +\r\n            this.state.filteredData.pageLength)\r\n    );\r\n  };\r\n  scrollTo = (\r\n    rowIndex,\r\n    rowDirection,\r\n    columnIndex,\r\n    columnDirection,\r\n    noFocus,\r\n    dataLength\r\n  ) => {\r\n    // console.log(\"scroll\", rowIndex, noFocus);\r\n    if (this.rows && (rowDirection || columnDirection)) {\r\n      this.rows.scrollOnKey(\r\n        { rows: rowIndex, columns: columnIndex },\r\n        null,\r\n        rowDirection,\r\n        columnDirection,\r\n        false,\r\n        dataLength\r\n      );\r\n    }\r\n    if (noFocus) {\r\n      this.hasFocus = false;\r\n    }\r\n  };\r\n  onScroll = (scroll, cell, extention) => {\r\n    const startIndex = scroll.rows.startIndex;\r\n    const stopIndex =\r\n      startIndex + Math.ceil(this.rowsHeight / this.rowHeight) - 1;\r\n    if (this.paginationIsRequired({ startIndex, stopIndex })) {\r\n      this.pagination({\r\n        startIndex,\r\n        stopIndex,\r\n        callbackAfter: () => this.onScroll_(scroll, cell, extention)\r\n      });\r\n    } else {\r\n      this.onScroll_(scroll, cell, extention);\r\n    }\r\n  };\r\n  onScroll_ = (scroll, cell, extension) => {\r\n    this.closeOpenedWindows(true);\r\n    const range = { ...this.state.selectedRange };\r\n    if (cell) {\r\n      range.end = cell;\r\n      if (!extension) {\r\n        range.start = cell;\r\n      }\r\n      this.selectRange_(range, x => x);\r\n    }\r\n    this.setState({ scroll });\r\n  };\r\n  selectRange = (range, callback, row, type, noFocus, scrollOnClick) => {\r\n    // console.log(\"selectRange\", type, noFocus);\r\n    if (!this.state.status.loadingPage && !this.state.status.loading) {\r\n      const startIndex = range.end.rows,\r\n        stopIndex = range.end.rows;\r\n      if (this.paginationIsRequired({ startIndex, stopIndex })) {\r\n        this.pagination({\r\n          startIndex,\r\n          stopIndex,\r\n          callbackAfter: () =>\r\n            this.selectRange_(\r\n              range,\r\n              callback || (x => x),\r\n              row,\r\n              type,\r\n              noFocus,\r\n              scrollOnClick\r\n            )\r\n        });\r\n      } else {\r\n        this.closeOpenedWindows(true);\r\n        const ok = this.selectRange_(\r\n          range,\r\n          callback || (x => x),\r\n          row,\r\n          type,\r\n          noFocus,\r\n          scrollOnClick\r\n        );\r\n        if (ok !== undefined) {\r\n          if (callback) {\r\n            return callback(ok);\r\n          } else {\r\n            return ok;\r\n          }\r\n        }\r\n      }\r\n    }\r\n  };\r\n  selectRange_ = (range, callback, row, type, noFocus, scrollOnClick) => {\r\n    if (noFocus !== undefined) {\r\n      this.hasFocus = !noFocus;\r\n    }\r\n    if (\r\n      !this.props.isActive &&\r\n      this.props.onActivation &&\r\n      noFocus !== undefined\r\n    ) {\r\n      this.props.onActivation(this.props.componentId || this.props.id);\r\n    }\r\n    let { selectedRange, scroll } = this.state;\r\n    const meta = this.state.meta;\r\n    // if (this.state.auditedRow) {\r\n    //   selectedRange = this.state.selectedRangeAudit;\r\n    //   scroll = this.state.scrollAudit;\r\n    // }\r\n    // this.hasFocus = !noFocus && !search;\r\n\r\n    const prevEnd = selectedRange.end;\r\n    const prevStart = selectedRange.start;\r\n    const endChanged =\r\n      prevEnd.rows !== range.end.rows || prevEnd.columns !== range.end.columns;\r\n    const enter = ok => {\r\n      if (!ok) {\r\n        callback(false);\r\n        return false;\r\n      }\r\n      if (endChanged || type) {\r\n        if (prevEnd.rows !== range.end.rows || type === \"enter\") {\r\n          this.rowUpdated = false;\r\n          if (range.end.rows !== undefined) {\r\n            this.row = row || this.getRow(range.end.rows);\r\n            this.previousRow = { ...this.row };\r\n          } else {\r\n            this.row = undefined;\r\n            this.previousRow = undefined;\r\n          }\r\n        }\r\n        this.updated = false;\r\n        if (range.end.rows !== undefined) {\r\n          this.column = meta.properties[range.end.columns];\r\n          this.previousValue = this.row[this.column.id];\r\n          if (prevEnd.rows !== range.end.rows || type === \"enter\") {\r\n            this.onRowEnter(this.row);\r\n          }\r\n          this.onCellEnter(this.previousValue, this.row, this.column);\r\n          if (meta.properties[range.end.columns].dataType === \"text\") {\r\n            this.handleText(range.end, this.row, this.column);\r\n          }\r\n          if (scrollOnClick) {\r\n            this.rows.scrollOnKey(\r\n              { rows: range.end.rows, columns: range.end.columns },\r\n              constants.AxisType.ROWS\r\n            );\r\n          }\r\n        } else {\r\n          this.column = undefined;\r\n          this.previousValue = undefined;\r\n        }\r\n      }\r\n      if (\r\n        endChanged ||\r\n        prevStart.rows !== range.start.rows ||\r\n        prevStart.columns !== range.start.columns\r\n      ) {\r\n        // if (this.state.auditedRow) {\r\n        //   this.setState({ selectedRangeAudit: range });\r\n        // } else {\r\n        this.setState({ selectedRange: range });\r\n      }\r\n      this.range = range;\r\n      // }\r\n      callback(true);\r\n      return true;\r\n    };\r\n    const quit = () => {\r\n      const action =\r\n        prevEnd.rows !== range.end.rows || row ? \"rowQuit\" : \"cellQuit\";\r\n      const ok = this.canQuit(action, enter);\r\n      if (ok !== undefined) {\r\n        return enter(ok);\r\n      }\r\n    };\r\n    if (type === \"enter\" || !endChanged) {\r\n      return enter(true);\r\n    }\r\n    return quit();\r\n  };\r\n  // -------------------------------\r\n  //  Cell events\r\n  //  -------------------------------\r\n  onChange = ({ value, row, column }) => {\r\n    this.updated = true;\r\n    this.rowUpdated = true;\r\n    this.tableUpdated = true;\r\n    const { updatedRows, data, meta, dataStrings } = this.state;\r\n    delete dataStrings[row.index_];\r\n    const status = getRowStatus(updatedRows, row);\r\n    if (!status.updated_) {\r\n      setStatus(status, \"updated_\");\r\n      this.setState({ statusChanged: !this.state.statusChanged });\r\n    }\r\n    // console.log(\"change\", status);\r\n    column.items = undefined;\r\n    const message = {\r\n      value,\r\n      previousValue: this.previousValue,\r\n      row,\r\n      status,\r\n      column,\r\n      meta: meta,\r\n      data: data,\r\n      params: this.props.params\r\n    };\r\n    return (\r\n      this.onChange_(message) && this.props.errorHandler(message, \"onChange\")\r\n    );\r\n  };\r\n  onChange_ = message => {\r\n    const { row, column, value } = message;\r\n    row[column.id] = value.value;\r\n    if (\r\n      !column.foreignObjectFunction &&\r\n      column.onChangeFunction &&\r\n      column.onChangeFunction(message) === false\r\n    ) {\r\n      return false;\r\n    }\r\n    if (this.props.onChange) {\r\n      if (this.props.onChange(message) === false) {\r\n        return false;\r\n      }\r\n    }\r\n    return true;\r\n  };\r\n  onCellQuit = message => this.onCellQuit_(message, message.callback);\r\n  foreignObject = (select, message) => {\r\n    const { id, value, column, row, cellQuit } = message;\r\n    let element = document.activeElement;\r\n    const col = column.foreignColumn || \"cd\";\r\n    const filters = {\r\n      [col]: {\r\n        id: col,\r\n        filterType: \"starts\",\r\n        v: { value }\r\n      }\r\n    };\r\n    const callback = (ok, data) => {\r\n      if (!ok) {\r\n        this.noUpdate = true;\r\n        element = document.getElementById(\r\n          `cell: ${id}-${row.index_}-${column.index_}`\r\n        );\r\n        // if (element) {\r\n        //   element = element.children[0];\r\n        // }\r\n      } else if (column.onChangeFunction) {\r\n        column.onChangeFunction({ value: data, row });\r\n      } else {\r\n        row[column.reference] = data;\r\n      }\r\n      if (element) {\r\n        this.isOpening = true;\r\n        element.focus();\r\n        this.isOpening = false;\r\n      }\r\n      return cellQuit ? cellQuit(ok) : null;\r\n    };\r\n    this.props.onForeignKey(\r\n      column.foreignObjectFunction,\r\n      filters,\r\n      select,\r\n      callback\r\n    );\r\n    return;\r\n  };\r\n  onCellQuit_ = (message, callback) => {\r\n    const cellQuit = ok_ => {\r\n      message.status = this.state.updatedRows[message.row.index_];\r\n      const onCellQuit = this.props.onCellQuit || message.column.onQuitFunction;\r\n      let ok = onCellQuit && ok_ ? onCellQuit(message) : ok_;\r\n      ok = ok && this.props.errorHandler(message, \"onCellQuit\");\r\n      if (ok !== undefined && callback) {\r\n        return callback(ok);\r\n      }\r\n      return ok;\r\n    };\r\n    const foreignObjectQuit = ok_ => {\r\n      const { column, row } = message;\r\n      const id = this.props.componentId;\r\n      const value = row[column.id];\r\n      if (!column.foreignObjectFunction) {\r\n        return cellQuit(ok_);\r\n      }\r\n      if (utils.isNullValue(value)) {\r\n        if (column.onChangeFunction) {\r\n          column.onChangeFunction({ value: { id: null, cd: null }, row });\r\n        }\r\n        return cellQuit(ok_);\r\n      }\r\n      this.foreignObject(this.isPasting ? \"match\" : \"quit\", {\r\n        id,\r\n        value,\r\n        column,\r\n        row,\r\n        cellQuit\r\n      });\r\n      // let element = document.activeElement;\r\n      // const col = column.foreignColumn || \"cd\";\r\n      // const filters = {\r\n      //   [col]: {\r\n      //     id: col,\r\n      //     filterType: \"starts\",\r\n      //     v: value\r\n      //   }\r\n      // };\r\n      // const callback = (ok, data) => {\r\n      //   if (!ok) {\r\n      //     this.noUpdate = true;\r\n      //     element = document.getElementById(\r\n      //       `cell: ${id}-${row.index_}-${column.index_}`\r\n      //     );\r\n      //     // if (element) {\r\n      //     //   element = element.children[0];\r\n      //     // }\r\n      //   } else if (column.onChangeFunction) {\r\n      //     column.onChangeFunction({ value: data, row });\r\n      //   } else {\r\n      //     row[column.reference] = data;\r\n      //   }\r\n      //   if (element) {\r\n      //     this.isOpening = true;\r\n      //     element.focus();\r\n      //     this.isOpening = false;\r\n      //   }\r\n      //   return cellQuit(ok);\r\n      // };\r\n      // this.props.onForeignKey(column.foreignObjectFunction, filters, callback);\r\n      return;\r\n    };\r\n    if (!message.row || !message.updated) {\r\n      return true;\r\n    }\r\n    return foreignObjectQuit(true);\r\n  };\r\n  onCellEnter = (value, row, column) => {\r\n    const status = this.state.updatedRows[row.index_];\r\n    const message = {\r\n      value,\r\n      row,\r\n      status,\r\n      column,\r\n      meta: this.state.meta,\r\n      data: this.state.data,\r\n      params: this.props.params\r\n    };\r\n    if (this.props.onCellEnter) this.props.onCellEnter(message);\r\n  };\r\n  // -------------------------------\r\n  //  row events\r\n  //  -------------------------------\r\n  onRowQuit = message => this.onRowQuit_(message, message.callback);\r\n  checkUnicity = (type, key, message) => {\r\n    const keyIndex = message.meta[type][message.row[key.id]];\r\n    const error = keyIndex !== message.row.index_ && keyIndex !== undefined;\r\n    manageRowError(\r\n      message.updatedRows,\r\n      message.row.index_,\r\n      key,\r\n      \"duplicate key\",\r\n      error ? `${key.caption}: duplicate key.` : null\r\n    );\r\n    if (!error) {\r\n      delete message.meta[type][message.previousRow[key.id]];\r\n      message.meta[type][message.row[key.id]] = message.row.index_;\r\n    }\r\n  };\r\n  onRowQuit_ = (message, callback) => {\r\n    const { meta, updatedRows, row, rowUpdated } = message;\r\n    if (rowUpdated) {\r\n      message.status = updatedRows[row.index_];\r\n      // mandatory data\r\n      meta.properties\r\n        .filter(property => property.mandatory)\r\n        .forEach(property => {\r\n          manageRowError(\r\n            updatedRows,\r\n            row.index_,\r\n            property,\r\n            \"mandatory\",\r\n            utils.isNullValue(\r\n              property.accessorFunction\r\n                ? property.accessorFunction({ row: message.row })\r\n                : row[property.id]\r\n            ) && !message.status.deleted_\r\n              ? (property.caption || property.id) + \": mandatory data.\"\r\n              : null\r\n          );\r\n        });\r\n      // duplicate key\r\n      const pk = meta.table.pk;\r\n      const lk = meta.table.lk;\r\n\r\n      //  A voir\r\n      //\r\n      //\r\n      // if (pk && !pk.hidden) {\r\n      //   this.checkUnicity(\"indexPk\", pk, message);\r\n      // }\r\n      // if (lk && !lk.hidden) {\r\n      //   this.checkUnicity(\"indexLk\", lk, message);\r\n      // }\r\n      const onRowQuit = this.props.onRowQuit || meta.row.onQuitFunction;\r\n      let ok = onRowQuit ? onRowQuit(message) : true;\r\n      ok = ok && this.props.errorHandler(message, \"onRowQuit\", callback);\r\n\r\n      if (ok !== undefined && callback) {\r\n        return callback(ok);\r\n      }\r\n      return ok;\r\n    }\r\n    return true;\r\n  };\r\n  onRowEnter = row => {\r\n    const { meta, data, updatedRows } = this.state;\r\n    const status = getRowStatus(updatedRows, row);\r\n    const params = this.props.params;\r\n    const message = {\r\n      row,\r\n      status,\r\n      meta,\r\n      data,\r\n      params\r\n    };\r\n    row.editable_ = meta.row.editableFunction\r\n      ? meta.row.editableFunction({\r\n          row,\r\n          status,\r\n          data,\r\n          params\r\n        })\r\n      : meta.row.editable === undefined\r\n      ? true\r\n      : meta.row.editable;\r\n    if (this.props.onRowEnter) {\r\n      this.props.onRowEnter(message);\r\n    }\r\n  };\r\n  onRowNew = row => {\r\n    const status = getRowStatus(this.state.updatedRows, row);\r\n    const message = {\r\n      row,\r\n      status,\r\n      meta: this.state.meta,\r\n      data: this.state.data,\r\n      filteredData: this.state.filteredData,\r\n      params: this.props.params\r\n    };\r\n    if (this.props.onRowNew)\r\n      if (this.props.onRowNew(message) === false) return false;\r\n    return true;\r\n  };\r\n  // -------------------------------\r\n  //  Table  events\r\n  //  -------------------------------\r\n  // onTableQuit_ = (message, callback) => {\r\n  //   if (message.tableUpdated) {\r\n  //     const onTableQuit =\r\n  //       this.props.onTableQuit || this.state.meta.table.onQuitFunction;\r\n  //     let ok = onRowQuit ? onRowQuit(message) : true;\r\n  //     ok = ok && this.props.errorHandler(message, \"onRowQuit\", callback);\r\n\r\n  //     if (ok !== undefined && callback) {\r\n  //       return callback(ok);\r\n  //     }\r\n  //     return ok;\r\n  //   }\r\n  //   return true;\r\n  // };\r\n  onTableEnter = () => {\r\n    const message = {\r\n      updatedRows: this.state.updatedRows,\r\n      meta: this.state.meta,\r\n      data: this.state.data,\r\n      params: this.props.params\r\n    };\r\n    this.tableUpdated = false;\r\n    this.rowUpdated = false;\r\n    this.updated = false;\r\n    if (this.props.onTableEnter) {\r\n      this.props.onTableEnter(message);\r\n    }\r\n  };\r\n  beforeTableClose = () => {\r\n    const message = {\r\n      updatedRows: this.state.updatedRows,\r\n      meta: this.state.meta,\r\n      data: this.state.data,\r\n      params: this.props.params\r\n    };\r\n    if (this.props.beforeTableClose) {\r\n      this.props.beforeTableClose(message);\r\n    }\r\n  };\r\n  onTableClose = () => {\r\n    const message = {\r\n      updatedRows: this.state.updatedRows,\r\n      meta: this.state.meta,\r\n      data: this.state.data,\r\n      params: this.props.params\r\n    };\r\n    if (getUpdatedRows(this.state.updatedRows).length) {\r\n      this.setState({ confirmationModal: true });\r\n      return false;\r\n    } else {\r\n      if (this.props.onTableClose) {\r\n        this.props.onTableClose(message);\r\n      }\r\n    }\r\n  };\r\n  // ---------------------------------------------------------\r\n  // successive checks and validations\r\n  // with callbacks to manage users interraction\r\n  // and asynchronous processes\r\n  // ---------------------------------------------------------\r\n  buildMessage = callback => {\r\n    const message = {\r\n      updated: this.updated,\r\n      rowUpdated: this.rowUpdated,\r\n      tableUpdated: this.tableUpdated,\r\n      previousValue: this.previousValue,\r\n      row: this.row,\r\n      previousRow: this.previousRow,\r\n      column: this.column,\r\n      meta: this.state.meta,\r\n      data: this.state.data,\r\n      params: this.props.params,\r\n      updatedRows: this.state.updatedRows,\r\n      callback\r\n    };\r\n    return message;\r\n  };\r\n  canQuit = (action, callback) => {\r\n    const message = this.buildMessage(callback || (() => {}));\r\n    const rowQuit = ok_ => {\r\n      const callback = ok => {\r\n        if (ok) {\r\n          this.rowUpdated = false;\r\n        }\r\n        message.callback(ok);\r\n      };\r\n      const ok =\r\n        ok_ && (!this.rowUpdated || this.onRowQuit_(message, callback));\r\n      if (ok !== undefined) {\r\n        return callback(ok);\r\n      }\r\n    };\r\n\r\n    const cellQuit = ok_ => {\r\n      let ok = true;\r\n      const callback = ok => {\r\n        if (ok) {\r\n          this.updated = false;\r\n        }\r\n        return (action === \"cellQuit\" ? message.callback : rowQuit)(ok);\r\n      };\r\n      // if (!utils.isNullValue(this.range.end.rows)) {\r\n      ok = ok_ && (!this.updated || this.onCellQuit_(message, callback));\r\n      if (ok !== undefined) {\r\n        return callback(ok);\r\n      }\r\n    };\r\n    return cellQuit(true);\r\n  };\r\n\r\n  handleErrors = (e, rowIndex, errors) => {\r\n    if (\r\n      e.target.className === \"zebulon-table-status\" &&\r\n      !(e.relatedTarget && e.relatedTarget.id === e.target.id)\r\n    ) {\r\n      if (errors.length) {\r\n        const toolTip = {\r\n          type: \"error\",\r\n          top:\r\n            e.target.parentElement.offsetTop +\r\n            rowIndex * this.rowHeight +\r\n            this.state.scroll.rows.shift,\r\n          left: this.rowHeight,\r\n          rowIndex,\r\n          content: errors\r\n        };\r\n        this.setState({ toolTip });\r\n        console.log(\r\n          \"tooltip\",\r\n          rowIndex,\r\n          e.type,\r\n          e.target,\r\n          this.state.toolTip,\r\n          toolTip\r\n        );\r\n      } else if (this.state.toolTip) {\r\n        console.log(\"tooltip2\", rowIndex, e.type, e.target, this.state.toolTip);\r\n        this.setState({ toolTip: null });\r\n      }\r\n    }\r\n  };\r\n  //-------------------------------------------\r\n  // end events\r\n  handleText = (cell, row, column) => {\r\n    let label;\r\n    if (this.state.meta.row.descriptorFunction)\r\n      label = this.state.meta.row.descriptorFunction({ row });\r\n    const text = {\r\n      top:\r\n        (3 + cell.rows - this.state.scroll.rows.startIndex) * this.rowHeight +\r\n        this.state.scroll.rows.shift,\r\n      left:\r\n        column.position + this.rowHeight - this.state.scroll.columns.position,\r\n      v: (column.accessorFunction || (({ row }) => row[column.id]))({ row }),\r\n      label,\r\n      editable: column.editable,\r\n      row,\r\n      column\r\n    };\r\n    this.setState({ text });\r\n  };\r\n  handleTextChange = e => {\r\n    const { row, column } = this.state.text;\r\n    this.setState({ text: { ...this.state.text, v: e.target.value } });\r\n    this.onChange(e.target.value, row, column);\r\n  };\r\n  onMetaChange = resetScroll => {\r\n    const bReset = false;\r\n    // console.log(\"onMetaChange\", this.state.scroll.rows);\r\n    this.setState({\r\n      scroll: {\r\n        rows: this.state.scroll.rows,\r\n        columns:\r\n          resetScroll || bReset\r\n            ? {\r\n                index: 0,\r\n                direction: 1,\r\n                startIndex: 0,\r\n                shift: 0,\r\n                position: 0\r\n              }\r\n            : this.state.scroll.columns\r\n      }\r\n    });\r\n  };\r\n}\r\n","import { Component } from \"react\";\r\nimport { utils } from \"zebulon-controls\";\r\nimport { computeMetaPositions } from \"./utils/compute.meta\";\r\nimport { rollback } from \"./utils/utils\";\r\n\r\nexport class TableMenu extends Component {\r\n    handleClickMenu = (props, item) => {\r\n        if (props.menu === \"column-header-menu\") {\r\n            const column = props.column;\r\n            const { data, meta, params, scroll } = this.state;\r\n            if (item.id <= 1) {\r\n                if (!utils.isNullOrUndefined(meta.lockedIndex)) {\r\n                    meta.properties[meta.lockedIndex].locked = false;\r\n                }\r\n                if (item.id) {\r\n                    meta.properties[column.index_].locked = true;\r\n                }\r\n                computeMetaPositions(meta);\r\n                this.setState({\r\n                    scroll: {\r\n                        ...scroll,\r\n                        columns: {\r\n                            direction: 1,\r\n                            index: 0,\r\n                            position: 0,\r\n                            shift: 0,\r\n                            startIndex: 0\r\n                        }\r\n                    }\r\n                });\r\n            } else {\r\n                item.function({ data, meta, params, column, table: this });\r\n            }\r\n        } else if (props.menu === \"row-header-menu\") {\r\n            const { row, status, index } = props;\r\n            const { data, meta, params, updatedRows } = this.state;\r\n            if (item.id === 0) {\r\n                // this.rollback(updatedRows, row.index_);\r\n                this.setState({ scroll: this.state.scroll });\r\n            } else if (item.id === 1) {\r\n                const prevScroll = this.state.scroll;\r\n                const selectedRow = {\r\n                    rows: index,\r\n                    columns: (this.state.meta.visibleIndexes || [0])[0]\r\n                };\r\n                const rows = index;\r\n                // const startRowIndex = extension ? this.props.selectedIndex : index;\r\n                const prevRange = { end: selectedRow, start: selectedRow };\r\n                const selectedRange = {\r\n                    start: { rows: 0, columns: 0 },\r\n                    end: { rows: 0, columns: 0 }\r\n                };\r\n                const scroll = {\r\n                    rows: {\r\n                        index: 0,\r\n                        direction: 1,\r\n                        startIndex: 0,\r\n                        shift: 0,\r\n                        position: 0\r\n                    },\r\n                    columns: {\r\n                        index: 0,\r\n                        direction: 1,\r\n                        startIndex: 0,\r\n                        shift: 0,\r\n                        position: 0\r\n                    }\r\n                };\r\n                this.setState({\r\n                    scroll,\r\n                    prevScroll,\r\n                    selectedRange,\r\n                    prevRange\r\n                });\r\n            } else {\r\n                return item.function({\r\n                    data,\r\n                    meta,\r\n                    params,\r\n                    row,\r\n                    status,\r\n                    table: this\r\n                });\r\n            }\r\n        } else if (props.menu === \"top-left-corner-menu\") {\r\n            const { filters, data, meta, params, updatedRows } = this.state;\r\n            let filter = filters.status_;\r\n            if (!filter) {\r\n                filter = { id: \"status_\", v: 0 };\r\n            }\r\n            const v = item.id % 100;\r\n            if (filter.v & v) {\r\n                filter.v -= v;\r\n            } else {\r\n                filter.v += v;\r\n            }\r\n            if (item.id === 2) {\r\n                const scroll = this.state.prevScroll;\r\n                const selectedRange = this.state.prevRange;\r\n                // computeMetaPositions(meta);\r\n                this.setState({\r\n                    scroll,\r\n                    prevScroll: undefined,\r\n                    selectedRange,\r\n                    prevRange: undefined\r\n                });\r\n            } else if (item.id === 0 || (item.id >= 100 && item.id < 104)) {\r\n                if (item.id === 0 || filter.v === 0) {\r\n                    delete filters.status_;\r\n                } else if (item.id >= 100) {\r\n                    filters.status_ = filter;\r\n                }\r\n                this.setState({\r\n                    filteredData: this.filters(\r\n                        data,\r\n                        filters,\r\n                        false,\r\n                        updatedRows\r\n                    )\r\n                });\r\n            } else {\r\n                item.function({ data, meta, params, table: this });\r\n            }\r\n        } else if (props.menu === \"cell-menu\") {\r\n            const { row, column } = props;\r\n            const { data, meta, params } = this.state;\r\n            item.function({ data, meta, params, row, column, table: this });\r\n        }\r\n    };\r\n}\r\n//     getCustomMenu = (menu, menus) => {\r\n//         if (this.customContextualMenu && this.customContextualMenu[menu]) {\r\n//             this.customContextualMenu[menu].forEach((menu, index) => {\r\n//                 const item = {\r\n//                     id: 1000000 + menus.length,\r\n//                     separation: index === 0 && menus.length > 0,\r\n//                     type: menu.type,\r\n//                     caption: menu.caption,\r\n//                     onClick: this.handleClickMenu,\r\n//                     function: menu.function,\r\n//                     children: menu.type === \"sub-menu\" ? [] : undefined\r\n//                 };\r\n//                 menus.push(item);\r\n//             });\r\n//         }\r\n//     };\r\n//     getMenu = (menu, data) => {\r\n//         console.log(this.state, this.table.state);\r\n//         const menus = [];\r\n//         if (menu === \"row-header-menu\") {\r\n//             if (this.state.meta.table.editable) {\r\n//                 menus.push({\r\n//                     id: menus.length,\r\n//                     type: \"menu-item\",\r\n//                     disable: !(data.status || {}).updated_,\r\n//                     separation: false,\r\n//                     caption: `Rollback row updates`,\r\n//                     onClick: this.table.handleClickMenu\r\n//                 });\r\n//             }\r\n//             if (this.state.meta.row.audit) {\r\n//                 menus.push({\r\n//                     id: menus.length,\r\n//                     type: \"menu-item\",\r\n//                     disable: this.state.auditedRow !== undefined,\r\n//                     // separation: false,\r\n//                     caption: `Audit`,\r\n//                     onClick: this.handleAudit\r\n//                 });\r\n//             }\r\n//         } else if (menu === \"column-header-menu\") {\r\n//             menus.push({\r\n//                 id: menus.length,\r\n//                 type: \"menu-item\",\r\n//                 disable: utils.isNullOrUndefined(\r\n//                     this.table.state.meta.lockedIndex\r\n//                 ),\r\n//                 separation: false,\r\n//                 caption: `Unlock columns`,\r\n//                 onClick: this.table.handleClickMenu\r\n//             });\r\n//             menus.push({\r\n//                 id: menus.length,\r\n//                 type: \"menu-item\",\r\n//                 separation: false,\r\n//                 caption: `Lock columns until ${data.column.caption}`,\r\n//                 onClick: this.table.handleClickMenu\r\n//             });\r\n//         } else if (menu === \"top-left-corner-menu\") {\r\n//             if (this.state.meta.table.editable) {\r\n//                 menus.push({\r\n//                     id: menus.length,\r\n//                     type: \"menu-item\",\r\n//                     checked: this.table.state.filters.status_ === undefined,\r\n//                     caption: `No status filter`,\r\n//                     onClick: this.table.handleClickMenu\r\n//                 });\r\n//                 const checked = i =>\r\n//                     (i |\r\n//                         (this.table.state.filters.status_ || {\r\n//                             v: 0\r\n//                         }).v) ===\r\n//                     (this.table.state.filters.status_ || { v: 0 }).v;\r\n//                 menus.push({\r\n//                     id: menus.length,\r\n//                     type: \"sub-menu\",\r\n//                     separation: menus.length > 0,\r\n//                     caption: `Status filters`,\r\n//                     children: [\r\n//                         {\r\n//                             id: 101,\r\n//                             type: \"menu-item\",\r\n//                             checked: checked(1),\r\n//                             separation: false,\r\n//                             caption: `Updated rows`,\r\n//                             onClick: this.table.handleClickMenu\r\n//                         },\r\n//                         {\r\n//                             id: 102,\r\n//                             type: \"menu-item\",\r\n//                             checked: checked(2),\r\n//                             separation: false,\r\n//                             caption: `New rows`,\r\n//                             onClick: this.table.handleClickMenu\r\n//                         },\r\n//                         {\r\n//                             id: 104,\r\n//                             type: \"menu-item\",\r\n//                             checked: checked(4),\r\n//                             separation: false,\r\n//                             caption: `Deleted rows`,\r\n//                             onClick: this.table.handleClickMenu\r\n//                         },\r\n//                         {\r\n//                             id: 108,\r\n//                             type: \"menu-item\",\r\n//                             // disable: utils.isNullOrUndefined(this.state.meta.lockedIndex),\r\n//                             checked: checked(8),\r\n//                             separation: false,\r\n//                             caption: `Rows with errors`,\r\n//                             onClick: this.table.handleClickMenu\r\n//                         }\r\n//                     ]\r\n//                 });\r\n//             }\r\n//             if (this.state.meta.row.audit) {\r\n//                 menus.push({\r\n//                     id: menus.length,\r\n//                     type: \"menu-item\",\r\n//                     disable: this.state.auditedRow === undefined,\r\n//                     separation: this.state.meta.table.editable,\r\n//                     caption: `Close audit`,\r\n//                     onClick: this.handleCloseAudit\r\n//                 });\r\n//             }\r\n//         }\r\n//         this.getCustomMenu(menu, menus);\r\n//         if (menus.length) {\r\n//             return {\r\n//                 type: \"menu\",\r\n//                 position: \"bottom\",\r\n//                 children: menus\r\n//             };\r\n//         } else {\r\n//             return null;\r\n//         }\r\n//     };\r\n// }\r\n","import { TableEvent } from \"./Table.events\";\r\nimport { utils } from \"zebulon-controls\";\r\nimport {\r\n  filtersFunction,\r\n  getSorts,\r\n  sortsFunction\r\n} from \"./utils/filters.sorts\";\r\n\r\nexport class TableFilterSort extends TableEvent {\r\n  // ----------------------------------------\r\n  // filtering\r\n  // ----------------------------------------\r\n  adjustScrollRows = filteredData => {\r\n    if (this.state) {\r\n      const { selectedRange, scroll, meta } = this.state;\r\n      const { componentId, id } = this.props;\r\n      // let { rows, columns } = scroll;\r\n      if (!filteredData.length) {\r\n        selectedRange.end = {};\r\n        selectedRange.start = {};\r\n        this.hasFocus = false;\r\n        this.bLoaded = undefined;\r\n        const column = meta.properties[(meta.visibleIndexes || [0])[0]];\r\n        const element = document.getElementById(\r\n          `filter: ${componentId || id}--${column.index_}-`\r\n        );\r\n        if (element && element.children[0]) {\r\n          element.children[0].focus();\r\n        }\r\n      } else if (selectedRange.end.rows === undefined) {\r\n        const columns = (meta.visibleIndexes || [0])[0];\r\n        selectedRange.end = { rows: 0, columns };\r\n        selectedRange.start = { rows: 0, columns };\r\n        this.bLoaded = true;\r\n        this.scrollTo(\r\n          selectedRange.end.rows,\r\n          1,\r\n          selectedRange.end.columns,\r\n          scroll.columns.direction,\r\n          false,\r\n          filteredData.length\r\n        );\r\n        this.setState({ scroll: { ...scroll } });\r\n      } else if (selectedRange.end.rows > filteredData.length - 1) {\r\n        selectedRange.end.rows = filteredData.length - 1;\r\n        this.scrollTo(\r\n          0,\r\n          -1,\r\n          selectedRange.end.columns,\r\n          scroll.columns.direction,\r\n          false,\r\n          filteredData.length\r\n        );\r\n      } else if (\r\n        scroll.rows.index + this.rowsHeight / this.rowHeight >\r\n        filteredData.length - 1\r\n      ) {\r\n        this.scrollTo(\r\n          selectedRange.end.rows,\r\n          scroll.rows.direction,\r\n          selectedRange.end.columns,\r\n          scroll.columns.direction,\r\n          false,\r\n          filteredData.length\r\n        );\r\n      } else {\r\n        this.setState({ scroll: { ...scroll } });\r\n      }\r\n      this.selectRange(\r\n        selectedRange,\r\n        undefined,\r\n        filteredData[selectedRange.end.rows],\r\n        \"enter\"\r\n      );\r\n      this.row = filteredData[selectedRange.end.rows];\r\n      return this.row;\r\n    }\r\n  };\r\n  filters = (data, filters, noFocus, updatedRows) => {\r\n    if (!Array.isArray(data)) {\r\n      return [];\r\n    }\r\n    const filter = filtersFunction(\r\n      filters,\r\n      this.props.params,\r\n      data,\r\n      updatedRows\r\n    );\r\n    const filteredData = data.filter(filter);\r\n    if (this.props.onFilter) {\r\n      this.props.onFilter({\r\n        filters,\r\n        filteredData,\r\n        data,\r\n        params: this.props.params,\r\n        updatedRows\r\n      });\r\n    }\r\n    return filteredData;\r\n  };\r\n  // a voir si pagination server ???\r\n  //\r\n  getFilterItems = (filter, column) => {\r\n    const { meta, updatedRows } = this.state;\r\n    let data = this.props.data;\r\n    // if (!meta.serverPagination) {\r\n    if (!filter || !filter.items) {\r\n      if (meta.table.filteredByServer && column.selectItems) {\r\n        if (utils.isMap(column.selectItems)) {\r\n          data = Array.from(column.selectItems).map(row => row[1]);\r\n        } else if (utils.isObject(column.selectItems)) {\r\n          data = Object.values(column.selectItems);\r\n        } else {\r\n          data = column.selectItems;\r\n        }\r\n        if (column.reference) {\r\n          data = data.map(row => ({ [column.reference]: row }));\r\n        }\r\n      }\r\n      const items = {};\r\n      data.forEach(row_ => {\r\n        const row = utils.isObject(row_) ? row_ : { [column.id]: row_ };\r\n        let id = (column.foreignKeyAccessorFunction ||\r\n            column.accessorFunction ||\r\n            (({ row }) => row[column.id]))({\r\n            row,\r\n            column,\r\n            status: updatedRows[row.index_],\r\n            params: this.props.params,\r\n            data: data\r\n          }),\r\n          label = (column.accessorFunction || (({ row }) => row[column.id]))({\r\n            row,\r\n            column,\r\n            status: updatedRows[row.index_],\r\n            params: this.props.params,\r\n            data: data\r\n          }),\r\n          sort = id,\r\n          nvl = \"\"; // a voir status\r\n        if (typeof (id || undefined) === \"object\") {\r\n          label = id.caption;\r\n          sort = id.caption;\r\n          id = id.value;\r\n        } else {\r\n          label = (column.formatFunction ||\r\n            (({ value }) => utils.formatValue(value, null, column.decimals)))({\r\n            value: label,\r\n            column,\r\n            row,\r\n            params: this.props.params,\r\n            status: updatedRows[row.index_],\r\n            data: data\r\n          });\r\n        }\r\n        if (column.dataType === \"date\") {\r\n          nvl = new Date(null);\r\n        } else if (column.dataType === \"number\") {\r\n          nvl = -Infinity;\r\n        }\r\n        items[id] = {\r\n          id,\r\n          label,\r\n          sort: sort || nvl\r\n        };\r\n      });\r\n      column.items = Object.values(items);\r\n      column.items.sort((itemA, itemB) => {\r\n        return (itemA.sort > itemB.sort) - (itemA.sort < itemB.sort);\r\n      });\r\n      filter = column;\r\n      // }\r\n    }\r\n    // else {\r\n    //   column.items = [];\r\n    //   filter = column;\r\n    // }\r\n    return filter;\r\n  };\r\n  openFilter = (e, column) => {\r\n    if (this.isOpening) {\r\n      return;\r\n    }\r\n\r\n    let filter = this.state.filters[column.id];\r\n    filter = this.getFilterItems(filter, column);\r\n    // filter.top = this.rowHeight + (this.state.meta.table.caption ? 30 : 0); // e.target.offsetParent.offsetTop; //this.nFilterRows * this.rowHeight;\r\n    const rect = e.target.getBoundingClientRect();\r\n    const rectTable = document\r\n      .getElementById(`table-${this.props.id}`)\r\n      .getBoundingClientRect();\r\n    filter.top = rect.y - rectTable.y;\r\n    filter.left = rect.x - rectTable.x; //+ window.scrollX;\r\n    // filter.left = e.target.offsetLeft;\r\n    const ok = this.canQuit(\"rowQuit\", ok => {\r\n      if (ok) {\r\n        return this.openFilter_(e, column, filter);\r\n      }\r\n    });\r\n    if (ok) {\r\n      return this.openFilter_(e, column, filter);\r\n    }\r\n  };\r\n  openFilter_ = (e, column, filter) => {\r\n    if (column.filterType !== \"values\") {\r\n      // e.target.focus();\r\n      this.hasFocus = false;\r\n      return this.closeOpenedWindows();\r\n    }\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    e.persist();\r\n    // column.position + this.rowHeight - this.state.scroll.columns.position;\r\n    // console.log(\"filtersort\", this.hasFocus);\r\n    this.hasFocus = false;\r\n    this.setState({\r\n      openedFilter: column.id,\r\n      filters: { ...this.state.filters, [column.id]: filter }\r\n    });\r\n  };\r\n  onChangeFilter = ({ value, row, column, filterTo }) => {\r\n    if (this.state.status.loaded) {\r\n      const ok = this.props.onTableChange(\"filter\", ok => {\r\n        if (ok) {\r\n          this.onChangeFilter_(value, row, column, filterTo);\r\n        }\r\n      });\r\n      if (ok) {\r\n        this.onChangeFilter_(value, row, column, filterTo);\r\n      }\r\n    }\r\n  };\r\n  onChangeFilter_ = (value, row, column, filterTo) => {\r\n    const { selectedRange, filters, meta, data, updatedRows } = this.state;\r\n    // const ok = this.selectRange(selectedRange, undefined, this.row, \"quit\");\r\n    // return false;\r\n    this.closeOpenedWindows();\r\n    const v = value;\r\n    if (v && v.value === undefined && v.editedValue !== undefined) {\r\n      return;\r\n    }\r\n    if ((v !== column.v && !filterTo) || (v !== column.vTo && filterTo)) {\r\n      this.hasFocus = false;\r\n      if (column.filterType === \"between\" && filterTo) {\r\n        column.vTo = v;\r\n      } else {\r\n        column.v = v;\r\n      }\r\n      filters[column.id] = column;\r\n      // this.changingFilter = true;\r\n      const filteredData = this.filters(data, filters, true, updatedRows);\r\n      // if (!meta.serverPagination) {\r\n      this.sorts(filteredData, meta.properties);\r\n      this.setState({ filteredData });\r\n      this.selectRange(\r\n        selectedRange,\r\n        undefined,\r\n        this.adjustScrollRows(filteredData),\r\n        \"enter\",\r\n        true\r\n      );\r\n      // }\r\n    }\r\n  };\r\n  onChangeFilterValues = filter => {\r\n    const openedFilter = this.state.openedFilter;\r\n    this.setState({ openedFilter: undefined });\r\n    const ok = this.props.onTableChange(\"filter\", ok => {\r\n      if (ok) {\r\n        this.onChangeFilterValues_(openedFilter, filter);\r\n      }\r\n    });\r\n    if (ok) {\r\n      this.onChangeFilterValues_(openedFilter, filter);\r\n    }\r\n  };\r\n  onChangeFilterValues_ = (openedFilter, filter) => {\r\n    const { filters, meta, data } = this.state;\r\n    const column = filters[openedFilter];\r\n    column.v = filter;\r\n    filters[column.id] = column;\r\n    const filteredData = this.filters(data, filters);\r\n    // if (!meta.serverPagination) {\r\n    this.sorts(filteredData, meta.properties);\r\n    this.setState({ filteredData });\r\n    this.selectRange(\r\n      this.range,\r\n      undefined,\r\n      this.adjustScrollRows(filteredData),\r\n      \"enter\",\r\n      true\r\n    );\r\n    // }\r\n  };\r\n  // ----------------------------------------\r\n  //sorting\r\n  // ----------------------------------------\r\n  sorts = (data, columns) => {\r\n    const sorts = getSorts(columns);\r\n    if (!Array.isArray(data)) {\r\n      if (this.state && this.state.meta.serverPagination) {\r\n        return this.pagination({\r\n          sorts,\r\n          callbackAfter: () => {\r\n            this.selectRange_(\r\n              this.range,\r\n              undefined,\r\n              undefined,\r\n              \"enter\",\r\n              this.hasFocus\r\n            );\r\n          }\r\n        });\r\n      }\r\n      return [];\r\n    }\r\n    if (sorts.length) {\r\n      data.sort(sortsFunction(sorts));\r\n    }\r\n    if (this.props.onSort) {\r\n      this.props.onSort({\r\n        sorts: columns,\r\n        filteredData: data,\r\n        data: this.props.data,\r\n        params: this.props.params\r\n      });\r\n    }\r\n  };\r\n  onSort = (column, doubleClick) => {\r\n    if (!this.state.meta.table.noOrder) {\r\n      const ok = this.props.onTableChange(\"sort\", ok => {\r\n        if (ok) {\r\n          this.onSort_(column, doubleClick);\r\n        }\r\n      });\r\n      if (ok) {\r\n        this.onSort_(column, doubleClick);\r\n      }\r\n    }\r\n  };\r\n  onSort_ = (column, doubleClick) => {\r\n    const { filteredData, meta } = this.state;\r\n    this.closeOpenedWindows();\r\n    if (\r\n      this.selectRange(\r\n        this.range,\r\n        undefined,\r\n        this.row,\r\n        \"quit\",\r\n        this.hasFocus\r\n      ) === false\r\n    ) {\r\n      return false;\r\n    }\r\n    const columns = meta.properties;\r\n    let sorts = [];\r\n    columns.forEach(col => {\r\n      if (doubleClick && col.id !== column.id) {\r\n        col.sort = undefined;\r\n        col.sortOrder = undefined;\r\n      }\r\n      if (col.id === column.id) {\r\n        if (col.sort === undefined) {\r\n          col.sort = \"asc\";\r\n        } else if (col.sort === \"asc\") {\r\n          col.sort = \"desc\";\r\n        } else if (col.sort === \"desc\") {\r\n          col.sort = undefined;\r\n          col.sortOrder = undefined;\r\n        }\r\n      }\r\n      if (col.sort !== undefined) {\r\n        sorts.push({\r\n          index: col.index_,\r\n          sortOrder: col.sortOrder === undefined ? 1000 : col.sortOrder\r\n        });\r\n      }\r\n    });\r\n    sorts.sort(\r\n      (a, b) => (a.sortOrder > b.sortOrder) - (b.sortOrder > a.sortOrder)\r\n    );\r\n    sorts.forEach((col, index) => (columns[col.index].sortOrder = index));\r\n    this.sorts(filteredData, columns);\r\n    if (!meta.serverPagination) {\r\n      this.selectRange(\r\n        this.range,\r\n        undefined,\r\n        undefined,\r\n        \"enter\",\r\n        this.hasFocus\r\n      );\r\n      this.setState({ filteredData: filteredData });\r\n    }\r\n  };\r\n}\r\n// const dataStrings = computeRowSearch(this.state.data, this.state.meta, {});\r\n//    const indexes = rowSearch(dataStrings, \"22/02\");\r\n","import React from \"react\";\r\nimport classnames from \"classnames\";\r\nimport { ScrollableGrid, utils, Input } from \"zebulon-controls\";\r\nimport { cellData } from \"./utils/compute.data\";\r\nexport class Rows extends ScrollableGrid {\r\n  shouldComponentUpdate(nextProps) {\r\n    return !nextProps.status.loadingPage && !nextProps.noUpdate;\r\n  }\r\n  componentDidUpdate() {\r\n    // if (this.focused) {\r\n    //   // console.log(\"focus\", this.focused, this.props.hasFocus);\r\n    //   // document.getElementById(this.focused).focus();\r\n    //   // document.getElementById(this.focused).children[0].focus();\r\n    //   this.focused = undefined;\r\n    // }\r\n    this.noOver = false;\r\n  }\r\n  cell = (\r\n    tableEditable,\r\n    row,\r\n    column,\r\n    status,\r\n    data,\r\n    params,\r\n    style,\r\n    focused,\r\n    hasFocus,\r\n    selected,\r\n    onMouseDown,\r\n    onMouseUp,\r\n    onMouseOver,\r\n    onChange,\r\n    onFocus,\r\n    rowIndex,\r\n    onDoubleClick,\r\n    componentId\r\n  ) => {\r\n    const { editable, value, select, dataType } = cellData(\r\n      row,\r\n      column,\r\n      status,\r\n      data,\r\n      params,\r\n      focused\r\n    );\r\n    const className = classnames({\r\n      \"zebulon-table-cell\": true,\r\n      \"zebulon-table-cell-odd\": rowIndex % 2 === 1,\r\n      \"zebulon-table-cell-selected\": selected,\r\n      \"zebulon-table-cell-focused\": focused,\r\n      \"zebulon-table-cell-editable\": editable && focused,\r\n      \"zebulon-table-cell-select\": editable && focused && select,\r\n      \"zebulon-table-cell-checkbox\": dataType === \"boolean\"\r\n    });\r\n    const id = `cell: ${componentId}-${row.index_}-${column.index_}`;\r\n    if (focused && hasFocus && editable) {\r\n      this.focused = id;\r\n    }\r\n    return (\r\n      <Input\r\n        row={row}\r\n        column={column}\r\n        style={style}\r\n        className={className}\r\n        value={value}\r\n        editable={editable && tableEditable}\r\n        focused={focused}\r\n        hasFocus={hasFocus}\r\n        select={select}\r\n        dataType={dataType}\r\n        inputType=\"cell\"\r\n        id={id}\r\n        key={id}\r\n        onChange={onChange}\r\n        onMouseDown={onMouseDown}\r\n        onMouseUp={onMouseUp}\r\n        onMouseOver={onMouseOver}\r\n        onFocus={onFocus}\r\n        onDoubleClick={\r\n          onDoubleClick ? e => onDoubleClick(e, row, column) : () => {}\r\n        }\r\n        menu=\"cell-menu\"\r\n        component={componentId}\r\n      />\r\n    );\r\n  };\r\n  rowRenderer = (\r\n    tableEditable,\r\n    row,\r\n    status,\r\n    meta,\r\n    startIndex,\r\n    shift,\r\n    visibleWidth,\r\n    rowHeight,\r\n    rowIndex,\r\n    hasFocus,\r\n    componentId\r\n  ) => {\r\n    const cells = [];\r\n    let left = shift,\r\n      index = startIndex;\r\n    const selectedRange = this.selectedRange();\r\n    while (index < meta.length && left < visibleWidth) {\r\n      const column = meta[index];\r\n      if (!column.hidden) {\r\n        let textAlign = column.alignement || \"left\";\r\n        if (!column.alignement) {\r\n          if (column.dataType === \"number\") {\r\n            textAlign = \"right\";\r\n          } else if (\r\n            column.dataType === \"date\" ||\r\n            column.dataType === \"month\" ||\r\n            column.dataType === \"year\" ||\r\n            column.dataType === \"boolean\"\r\n          ) {\r\n            textAlign = \"center\";\r\n          }\r\n        }\r\n        const columnIndex = index;\r\n        const selected = utils.isInRange(\r\n            { columns: index, rows: rowIndex },\r\n            selectedRange.start,\r\n            selectedRange.end\r\n          ),\r\n          focused =\r\n            selectedRange.end.rows === rowIndex &&\r\n            selectedRange.end.columns === index,\r\n          onMouseDown = e => {\r\n            // e.preventDefault();\r\n            this.selectCell(\r\n              { rows: rowIndex, columns: columnIndex },\r\n              e.shiftKey,\r\n              false\r\n            );\r\n          },\r\n          onMouseOver = e => {\r\n            if (\r\n              (e.buttons & 1) === 1 &&\r\n              !(this.noOver || this.props.openedFilter)\r\n            ) {\r\n              // e.preventDefault();\r\n              this.selectCell({ rows: rowIndex, columns: columnIndex }, false);\r\n            }\r\n          },\r\n          onMouseUp = e => {\r\n            // e.preventDefault();\r\n            this.mouseDown = false;\r\n          };\r\n        cells.push(\r\n          this.cell(\r\n            tableEditable,\r\n            row,\r\n            column,\r\n            status,\r\n            this.props.data,\r\n            this.props.params,\r\n            {\r\n              position: \"absolute\", //, toto\r\n              left,\r\n              width: Math.min(\r\n                false ? column.computedWidth + shift : column.computedWidth,\r\n                visibleWidth - left\r\n              ),\r\n              height: rowHeight,\r\n              textAlign\r\n            },\r\n            focused,\r\n            hasFocus && focused,\r\n            selected,\r\n            onMouseDown,\r\n            onMouseUp,\r\n            onMouseOver,\r\n            this.props.onChange,\r\n            this.props.onFocus,\r\n            rowIndex,\r\n            this.props.onDoubleClick,\r\n            componentId\r\n          )\r\n        );\r\n        left += column.computedWidth;\r\n      }\r\n      index += 1;\r\n    }\r\n    return (\r\n      <div\r\n        key={rowIndex}\r\n        id={rowIndex}\r\n        style={{\r\n          display: \"flex\",\r\n          height: rowHeight\r\n        }}\r\n      >\r\n        {cells}\r\n      </div>\r\n    );\r\n  };\r\n\r\n  getContent = () => {\r\n    // this.noOver = true;\r\n    const items = [];\r\n    const {\r\n      data,\r\n      meta,\r\n      height,\r\n      rowHeight,\r\n      width,\r\n      updatedRows,\r\n      hasFocus,\r\n      componentId,\r\n      locked\r\n    } = this.props;\r\n    // console.log(\"render rows\", locked, this.selectedRange(), meta);\r\n    let i = 0,\r\n      index = this.props.scroll.rows.startIndex,\r\n      indexPage = 0,\r\n      rows = data,\r\n      columnStartIndex = this.props.scroll.columns.startIndex,\r\n      columnShift = this.props.scroll.columns.shift;\r\n    if (typeof data === \"object\" && data.page) {\r\n      rows = data.page;\r\n      indexPage = data.pageStartIndex;\r\n    }\r\n    const visibleWidth = width - this.scrollbars.vertical.width;\r\n    if (!this.props.noVerticalScrollbar) {\r\n      columnStartIndex = Math.max(\r\n        columnStartIndex,\r\n        utils.isNullOrUndefined(meta.lockedIndex) ? 0 : meta.lockedIndex + 1\r\n      );\r\n    } else {\r\n      columnStartIndex = 0;\r\n      columnShift = 0;\r\n    }\r\n    while (index < rows.length && i < height / rowHeight) {\r\n      let row = rows[index - indexPage];\r\n      const status = updatedRows[row.index_];\r\n      if (meta.serverPagination && status && status.rowUpdated) {\r\n        row = status.rowUpdated;\r\n      }\r\n      items.push(\r\n        this.rowRenderer(\r\n          meta.table.editable,\r\n          row,\r\n          status,\r\n          meta.properties,\r\n          columnStartIndex,\r\n          columnShift,\r\n          visibleWidth,\r\n          rowHeight,\r\n          index,\r\n          hasFocus,\r\n          componentId\r\n        )\r\n      );\r\n      index++;\r\n      i++;\r\n    }\r\n    const style = {\r\n      top: this.props.scroll.rows.shift || 0,\r\n      width: visibleWidth,\r\n      position: \"inherit\",\r\n      height: \"inherit\"\r\n    };\r\n    console.log(\"render row\");\r\n    return (\r\n      <div\r\n        id=\"content\"\r\n        style={style}\r\n        onWheel={this.onWheel}\r\n        className={locked ? \"zebulon-locked-columns\" : \"\"}\r\n      >\r\n        {items}\r\n      </div>\r\n    );\r\n  };\r\n}\r\n","import React, { Component } from \"react\";\r\nimport { icons, utils } from \"zebulon-controls\";\r\nimport {\r\n  computeRowSearch,\r\n  rowSearch,\r\n  cellSearch,\r\n  getRegExp\r\n} from \"./utils/compute.data\";\r\nexport class Search extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    const {\r\n      filteredData,\r\n      meta,\r\n      dataStrings,\r\n      rowStartIndex,\r\n      rowStopIndex\r\n    } = props;\r\n    const properties = meta.properties.filter(property => !property.hidden);\r\n    this.state = {\r\n      dataStrings: computeRowSearch(filteredData, properties, dataStrings),\r\n      value: \"\",\r\n      properties,\r\n      cell: {},\r\n      rowStartIndex,\r\n      rowStopIndex\r\n    };\r\n  }\r\n  handleClickNext = direction => {\r\n    const { cell, value, rowIndexes, indexRowIndex, properties } = this.state;\r\n    const exp = getRegExp(value);\r\n    const cell_ = { ...cell };\r\n    let index = indexRowIndex;\r\n    cell_.columns = cellSearch(\r\n      this.props.filteredData[cell_.rows],\r\n      properties,\r\n      exp,\r\n      cell_.columns + direction,\r\n      direction\r\n    );\r\n    if (\r\n      cell_.columns === null &&\r\n      ((direction === 1 && index < rowIndexes.length - 1) ||\r\n        (direction === -1 && index !== 0))\r\n    ) {\r\n      index += direction;\r\n      cell_.rows = rowIndexes[index];\r\n      cell_.columns = cellSearch(\r\n        this.props.filteredData[cell_.rows],\r\n        properties,\r\n        exp,\r\n        direction === -1 ? properties.length - 1 : 0,\r\n        direction\r\n      );\r\n    }\r\n    if (cell_.columns !== null) {\r\n      const cellRange = { ...cell_, columns: properties[cell_.columns].index_ };\r\n      this.props.scrollTo(\r\n        cellRange.rows,\r\n        Math.sign(cellRange.rows - (this.state.cell.rows || 0)),\r\n        cellRange.columns,\r\n        Math.sign(cellRange.columns - (this.props.selectedCell.columns || 0))\r\n      );\r\n      this.setState({ cell: cell_, indexRowIndex: index });\r\n    }\r\n  };\r\n  handleChange = e => {\r\n    const value = e.target.value;\r\n    const exp = getRegExp(value);\r\n    const cell = { rows: undefined, columns: undefined };\r\n    let ix = -1;\r\n    if (!utils.isNullValue(value && value !== this.state.value)) {\r\n      const { rowStartIndex, rowStopIndex, filteredData } = this.props;\r\n      const rows = this.state.dataStrings;\r\n      const rowIndexes = rowSearch(rows, exp);\r\n      this.setState({ value, rowIndexes });\r\n      if (rowIndexes.length) {\r\n        ix = rowIndexes.findIndex(\r\n          index => index >= rowStartIndex && index <= rowStopIndex\r\n        );\r\n        if (ix === -1) {\r\n          if (rowIndexes[rowIndexes.length - 1] > rowStopIndex) {\r\n            ix = rowIndexes.findIndex(index => index > rowStopIndex);\r\n          } else {\r\n            ix = rowIndexes.length - 1;\r\n          }\r\n        }\r\n        cell.rows = rowIndexes[ix];\r\n        const row = filteredData[cell.rows];\r\n        cell.columns = cellSearch(row, this.state.properties, exp);\r\n        const cellRange = {\r\n          ...cell,\r\n          columns: this.state.properties[cell.columns].index_\r\n        };\r\n        this.props.scrollTo(\r\n          cellRange.rows,\r\n          Math.sign(cellRange.rows - (this.props.selectedCell.rows || 0)),\r\n          cellRange.columns,\r\n          Math.sign(cellRange.columns - (this.props.selectedCell.columns || 0)),\r\n          true\r\n        );\r\n      }\r\n      this.setState({ value, rowIndexes, cell, indexRowIndex: ix });\r\n    } else {\r\n      this.setState({ value, rowIndexes: [], cell, indexRowIndex: -1 });\r\n    }\r\n    this.input.focus();\r\n  };\r\n  render() {\r\n    return (\r\n      <div style={{ display: \"flex\" }}>\r\n        <input\r\n          style={{ width: 200 }}\r\n          onChange={e => this.handleChange(e)}\r\n          value={this.state.value}\r\n          autoFocus={true}\r\n          ref={ref => (this.input = ref)}\r\n        />\r\n        <div\r\n          style={{\r\n            background: icons.downArrow,\r\n            backgroundSize: \"cover\",\r\n            height: \"1em\",\r\n            width: \"1em\",\r\n            marginTop: \"0.1em\",\r\n            marginRight: \"0.1em\"\r\n          }}\r\n          onClick={() => this.handleClickNext(1)}\r\n        />\r\n        <div\r\n          style={{\r\n            background: icons.upArrow,\r\n            backgroundSize: \"cover\",\r\n            height: \"1em\",\r\n            width: \"1em\",\r\n            marginTop: \"0.4em\",\r\n            marginRight: \"0.1em\",\r\n            zoom: 0.7\r\n          }}\r\n          onClick={() => this.handleClickNext(-1)}\r\n        />\r\n        <div\r\n          style={{\r\n            background: icons.close,\r\n            backgroundSize: \"cover\",\r\n            height: \"1em\",\r\n            width: \"1em\",\r\n            marginTop: \"0.7em\",\r\n            zoom: 0.5,\r\n            marginRight: \"0.1em\",\r\n            marginLeft: \".6em\"\r\n          }}\r\n          onClick={this.props.onClose}\r\n        />\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","import React from \"react\";\r\nimport { Headers, Status } from \"./TableHeaders\";\r\nimport { TableFilterSort } from \"./Table.filters.sorts\";\r\nimport { Rows } from \"./Rows\";\r\nimport { Search } from \"./Search\";\r\n\r\nimport { utils, Filter, ContextualMenuClient } from \"zebulon-controls\";\r\nimport { computeData } from \"./utils/compute.data\";\r\nimport { computeMetaPositions } from \"./utils/compute.meta\";\r\nimport { FiAlertCircle } from \"react-icons/fi\";\r\n// import { utils } from \"zebulon-controls\";\r\nexport class Table extends TableFilterSort {\r\n  constructor(props) {\r\n    super(props);\r\n    let filteredData = this.filters(props.data, props.filters);\r\n    // if (props.meta.serverPagination && props.status.loaded) {\r\n    //   status = {\r\n    //     loaded: false,\r\n    //     loading: true\r\n    //   };\r\n    //   props.data({ startIndex: 0 }).then(filteredData => {\r\n    //     computeData(filteredData.page, props.meta, 0);\r\n    //     if (props.onGetPage) {\r\n    //       props.onGetPage(filteredData);\r\n    //     }\r\n    //     this.setState({\r\n    //       filteredData,\r\n    //       filteredDataLength: filteredData.filteredDataLength,\r\n    //       status: { loaded: true, loading: false }\r\n    //     });\r\n    //   });\r\n    // }\r\n    //  else if (this.props.callbackForeignKey && filteredData.length < 2) {\r\n    //   this.props.callbackForeignKey(\r\n    //     filteredData.length ? filteredData.length[0] : false\r\n    //   );\r\n    // } // a voir serverPagination\r\n    this.sorts(filteredData, props.meta.properties);\r\n    const columns =\r\n      props.meta && props.meta.visibleIndexes\r\n        ? props.meta.visibleIndexes[0]\r\n        : 0;\r\n    this.state = {\r\n      data: props.data,\r\n      filteredData,\r\n      params: props.params,\r\n      meta: props.meta,\r\n      filters: props.filters || {},\r\n      status: props.status,\r\n      updatedRows: props.updatedRows,\r\n      scroll: {\r\n        rows: {\r\n          index: 0,\r\n          direction: 1,\r\n          startIndex: 0,\r\n          shift: 0,\r\n          position: 0\r\n        },\r\n        columns: {\r\n          index: 0,\r\n          direction: 1,\r\n          startIndex: 0,\r\n          shift: 0,\r\n          position: 0\r\n        }\r\n      },\r\n      selectedRange: {\r\n        start: { rows: undefined, columns },\r\n        end: { rows: undefined, columns }\r\n      },\r\n      detail: {},\r\n      text: {},\r\n      checkAll: false,\r\n      search: false,\r\n      dataStrings: {}\r\n    };\r\n    // this.state.selectedRangeAudit = this.state.selectedRange;\r\n    // this.state.scrollAudit = this.state.scroll;\r\n    this.rowHeight = this.props.rowHeight;\r\n    this.range = { start: {}, end: {} };\r\n    this.onTableEnter();\r\n    if (props.status && props.status.loaded) {\r\n      this.bLoaded = true;\r\n    }\r\n    this.hasFocus = true;\r\n    // if (this.props.contextualMenu) {\r\n    //   if (typeof this.props.contextualMenu === \"function\") {\r\n    //     this.customContextualMenu = this.props.contextualMenu(\r\n    //       this.state,\r\n    //       props\r\n    //     );\r\n    //   } else {\r\n    //     this.customContextualMenu = this.props.contextualMenu;\r\n    //   }\r\n    // }\r\n  }\r\n\r\n  componentWillReceiveProps(nextProps) {\r\n    if (\r\n      nextProps.data !== this.props.data ||\r\n      nextProps.meta !== this.props.meta ||\r\n      nextProps.status !== this.props.status ||\r\n      nextProps.updatedRows !== this.props.updatedRows ||\r\n      nextProps.filters !== this.props.filters\r\n    ) {\r\n      // const filteredData = this.filters(nextProps.data, nextProps.filters);\r\n      let filteredData = [];\r\n      let status = nextProps.status;\r\n\r\n      filteredData = this.filters(\r\n        nextProps.data,\r\n        nextProps.filters,\r\n        undefined,\r\n        nextProps.updatedRows\r\n      );\r\n      if (\r\n        nextProps.status.loaded &&\r\n        nextProps.isModal &&\r\n        this.props.onDoubleClick &&\r\n        this.props.onRowEnter\r\n      ) {\r\n        let filteredData_ = filteredData,\r\n          filter_ = Object.values(nextProps.filters)[0];\r\n        if (\r\n          filteredData_.length === 1 &&\r\n          [\"quit\", \"match\"].includes(nextProps.selection)\r\n        ) {\r\n          this.props.onRowEnter({ row: filteredData_[0] });\r\n          this.props.onDoubleClick();\r\n        } else if (\r\n          filteredData_.length >= 1 &&\r\n          nextProps.selection === \"match\"\r\n        ) {\r\n          filteredData_ = filteredData_.filter(\r\n            row => row[filter_.id] === filter_.v\r\n          );\r\n          if (filteredData_.length === 1) {\r\n            this.props.onRowEnter({ row: filteredData_[0] });\r\n            this.props.onDoubleClick();\r\n          }\r\n        }\r\n      }\r\n      this.sorts(filteredData, nextProps.meta.properties);\r\n      // }\r\n\r\n      this.setState({\r\n        data: nextProps.data || [],\r\n        filteredData,\r\n        filteredDataLength: filteredData.length,\r\n        filters: nextProps.filters || {},\r\n        meta: nextProps.meta,\r\n        status,\r\n        updatedRows: nextProps.updatedRows\r\n        // scroll: this.state.scroll\r\n        // selectedRange: { start: {}, end: {} },\r\n        // scroll: {\r\n        //   rows: {\r\n        //     index: 0,\r\n        //     direction: 1,\r\n        //     startIndex: 0,\r\n        //     shift: 0,\r\n        //     position: 0\r\n        //   },\r\n        //   columns: {\r\n        //     index: 0,\r\n        //     direction: 1,\r\n        //     startIndex: 0,\r\n        //     shift: 0,\r\n        //     position: 0\r\n        //   }\r\n        // }\r\n      });\r\n      if (\r\n        (status && status.loaded && this.bLoaded === undefined) ||\r\n        nextProps.filters !== this.state.filters\r\n      ) {\r\n        this.bLoaded = true;\r\n      }\r\n      if (status && status.loading) {\r\n        this.bLoaded = undefined;\r\n      }\r\n      if (\r\n        status.loaded &&\r\n        this.props.callbackForeignKey &&\r\n        filteredData.length < 2\r\n      ) {\r\n        this.props.callbackForeignKey(\r\n          filteredData.length === 1,\r\n          filteredData[0]\r\n        );\r\n        return null;\r\n      }\r\n    }\r\n    this.rowHeight = nextProps.rowHeight;\r\n    if (nextProps.visible && !this.props.visible) this.onTableEnter();\r\n    // else if (!nextProps.visible && this.props.visible) {\r\n    //   this.onTableQuit();\r\n    // }\r\n    if (!nextProps.isActive && this.props.isActive) {\r\n      this.closeOpenedWindows();\r\n      // this.hasFocus = false;\r\n    }\r\n  }\r\n\r\n  shouldComponentUpdate(nextProps, nextState) {\r\n    return !this.isPasting;\r\n  }\r\n  componentWillUnmount() {\r\n    return this.onTableClose();\r\n  }\r\n  onLoad = () => {\r\n    if (this.bLoaded) {\r\n      this.updated = false;\r\n      this.rowUpdated = false;\r\n      this.tableUpdated = false;\r\n      this.adjustScrollRows(this.state.filteredData);\r\n      this.bLoaded = null;\r\n    }\r\n  };\r\n  componentDidMount() {\r\n    this.onLoad();\r\n    if (this.props.setActions) {\r\n      this.props.setActions(this.getActions(\"null\"));\r\n    }\r\n  }\r\n  componentDidUpdate() {\r\n    this.onLoad();\r\n    console.log(\"tableUpdated\");\r\n    this.changingFilter = false;\r\n  }\r\n  onCheckAll = () => {\r\n    const checked_ = !this.state.checkAll;\r\n\r\n    this.state.filteredData.forEach(row => (row.checked_ = checked_));\r\n    this.setState({ checkAll: checked_, updatedRows: this.state.updatedRows });\r\n  };\r\n  getActions = (caption, statusBar, width, key, id) => {\r\n    const { meta, status, selectedRange, updatedRows } = this.state;\r\n    let actions = meta.table.actions;\r\n    const actionIcons = meta.table.actionIcons && caption;\r\n    actions = actions.map((action, index) => {\r\n      if (!this.doubleClickAction && action.doubleClick) {\r\n        this.doubleClickAction = action;\r\n      }\r\n      let enable = action.enable || false;\r\n      if (status.loadingPage) {\r\n        enable = false;\r\n      } else if (action.enableFunction) {\r\n        const row =\r\n          selectedRange.end.rows !== undefined\r\n            ? this.getRow(selectedRange.end.rows)\r\n            : { index_: undefined };\r\n        const status = updatedRows[row.index_];\r\n        enable = action.enableFunction({ row, status });\r\n      }\r\n      action.statusEnable = action.enable && enable;\r\n      const lastColumn = meta.properties[meta.properties.length - 1];\r\n      const className = enable\r\n        ? \".zebulon-action-button\"\r\n        : \".zebulon-action-button-disabled\";\r\n      if (actionIcons) {\r\n        const Icon = action.icon || FiAlertCircle;\r\n        return (\r\n          <Icon\r\n            style={{ marginRight: 10 }}\r\n            className={className}\r\n            onClick={e => this.handleAction(action, e)}\r\n            key={index}\r\n            id={index}\r\n            onMouseOver={e => {\r\n              this.handleToolTip(action, e, false);\r\n            }}\r\n            onMouseOut={e => {\r\n              this.handleToolTip(action, e, true);\r\n            }}\r\n          />\r\n        );\r\n      } else if (caption !== \"null\") {\r\n        const actionsWidth =\r\n          Math.min(\r\n            lastColumn.position +\r\n              lastColumn.computedWidth +\r\n              this.rowHeight * (statusBar !== null),\r\n            width - 4 * actions.length\r\n          ) / actions.length || 0;\r\n        const style = {\r\n          width: actionsWidth,\r\n          minWidth: 50,\r\n          margin: 2,\r\n          marginTop: 3,\r\n          height: 22\r\n        };\r\n\r\n        if (action.jsxFunction) {\r\n          return action.jsxFunction({\r\n            disabled: !enable,\r\n            className,\r\n            index,\r\n            style,\r\n            onClick: e => this.handleAction(action, e)\r\n          });\r\n        }\r\n        key = `action-${id}-${index}`;\r\n        return (\r\n          <button\r\n            id={key}\r\n            key={key}\r\n            disabled={!enable}\r\n            className={className}\r\n            style={style}\r\n            draggable={false}\r\n            onClick={e => {\r\n              return this.handleAction(action, e);\r\n            }}\r\n          >\r\n            {action.caption}\r\n          </button>\r\n        );\r\n      }\r\n    });\r\n    if (actions.length && actionIcons) {\r\n      actions = <div style={{ display: \"flex\" }}>{actions}</div>;\r\n    } else if (actions.length) {\r\n      actions = (\r\n        <div\r\n          id={\"actions\"}\r\n          style={{ height: actionIcons ? 0 : 30, display: \"flex\" }}\r\n        >\r\n          {actions}\r\n        </div>\r\n      );\r\n    } else {\r\n      actions = null;\r\n    }\r\n    return actions;\r\n  };\r\n  render() {\r\n    const { height, width, isModal, visible, params, id } = this.props;\r\n    let {\r\n        status,\r\n        meta,\r\n        selectedRange,\r\n        updatedRows,\r\n        data,\r\n        auditedRow,\r\n        audits,\r\n        scroll,\r\n        statusChanged\r\n      } = this.state,\r\n      filteredData,\r\n      filteredDataLength;\r\n    const caption =\r\n      this.props.caption === \"\"\r\n        ? null\r\n        : this.props.caption || meta.table.caption;\r\n    let { selectRange, onScroll } = this;\r\n    let headersLength =\r\n      1 +\r\n      !meta.table.noFilter *\r\n        (1 +\r\n          (meta.properties.findIndex(\r\n            column => column.filterType === \"between\" && !column.hidden\r\n          ) !==\r\n            -1));\r\n    let key;\r\n\r\n    filteredData = this.state.filteredData;\r\n    filteredDataLength = this.state.filteredData.length;\r\n    // }\r\n    //  actions\r\n    let actions =\r\n      auditedRow || isModal || meta.properties.length === 0\r\n        ? []\r\n        : meta.table.actions.filter(action => !action.hidden) || [];\r\n    const actionIcons = meta.table.actionIcons && caption;\r\n    if (!visible) {\r\n      return null;\r\n    } else if (status.loading || status.loadingConfig) {\r\n      return <div>Loading data...</div>;\r\n    } else if (status.error) {\r\n      if (status.error.message === \"No rows retrieved\") {\r\n        return <div style={{ width: \"max-content\" }}>No rows retrieved</div>;\r\n      } else {\r\n        return (\r\n          <div style={{ color: \"red\", width: \"max-content\" }}>\r\n            <p>{status.error.type}</p>\r\n            <p>{status.error.message}</p>\r\n          </div>\r\n        );\r\n      }\r\n    } else if (data.length === 0 && meta.properties.length === 0) {\r\n      return null;\r\n    }\r\n    const noUpdate = !this.isInPage(scroll.rows) || this.noUpdate;\r\n    this.noUpdate = false;\r\n    // -----------------------------------\r\n    // Filter check list\r\n    // -----------------------------------\r\n    const { openedFilter, filters } = this.state;\r\n    this.openedFilter = null;\r\n    if (openedFilter !== undefined && filters[openedFilter]) {\r\n      const { top, left, items, v, caption, computedWidth } = filters[\r\n        openedFilter\r\n      ];\r\n      key = `filter-${id}`;\r\n      this.filter = (\r\n        <Filter\r\n          id={key}\r\n          key={key}\r\n          items={items}\r\n          title={caption}\r\n          filter={v}\r\n          style={{\r\n            position: \"absolute\",\r\n            border: \"solid 0.1em rgba(0, 0, 0, 0.5)\",\r\n            backgroundColor: \"white\",\r\n            fontFamily: \"inherit\",\r\n            top,\r\n            left,\r\n            // width: Math.max(computedWidth * 1.5, 150),\r\n            zIndex: 3,\r\n            opacity: 1\r\n          }}\r\n          onOk={this.onChangeFilterValues}\r\n          ref={ref => (this.openedFilter = ref)}\r\n        />\r\n      );\r\n    } else {\r\n      this.filter = null;\r\n    }\r\n    // ------------------------\r\n    // text area\r\n    // ------------------------\r\n    const { top, left, v, editable, label } = this.state.text;\r\n    if (top !== undefined) {\r\n      key = `textarea-${id}`;\r\n      this.text = (\r\n        <div\r\n          id={key}\r\n          key={key}\r\n          style={{\r\n            // position: \"absolute\", toto\r\n            border: \"solid 0.1em rgba(0, 0, 0, 0.5)\",\r\n            backgroundColor: \"white\",\r\n            top: top + (headersLength - 2) * this.rowHeight,\r\n            left,\r\n            zIndex: 3,\r\n            opacity: 1\r\n          }}\r\n        >\r\n          <div>{label} </div>\r\n          <textarea\r\n            rows=\"10\"\r\n            cols=\"80\"\r\n            id={\"textarea\"}\r\n            tabIndex={0}\r\n            style={{ top, left, font: \"inherit\" }}\r\n            disabled={!editable}\r\n            autoFocus={true}\r\n            value={v || \"\"}\r\n            onChange={this.handleTextChange}\r\n            // ref={ref => (this.focused = ref)}\r\n          />\r\n        </div>\r\n      );\r\n    } else {\r\n      this.text = undefined;\r\n    }\r\n    // ------------------------\r\n    // Detail\r\n    // ------------------------\r\n    let detail = this.state.detail.content;\r\n    if (detail) {\r\n      const row =\r\n        selectedRange.end.rows !== undefined\r\n          ? this.getRow(selectedRange.end.rows)\r\n          : {};\r\n      const status = updatedRows[row.index_];\r\n      //       top: (3 + rowIndex) * this.rowHeight + scroll.rows.shift,\r\n      // left:\r\n      //   column.position + this.rowHeight - scroll.columns.position\r\n      detail = this.getDetail({\r\n        Detail: detail,\r\n        row,\r\n        data: data,\r\n        meta: meta.properties,\r\n        status,\r\n        params: params,\r\n        top:\r\n          (2 +\r\n            headersLength +\r\n            selectedRange.end.rows -\r\n            scroll.rows.startIndex) *\r\n            this.rowHeight +\r\n          scroll.rows.shift,\r\n        onChange: meta.row.onChange,\r\n        onClose: this.closeOpenedWindows\r\n      });\r\n    }\r\n    // ------------------------\r\n    // errors\r\n    // ------------------------\r\n    let toolTip = this.state.toolTip || null;\r\n    if (toolTip) {\r\n      let content = toolTip.content;\r\n      if (toolTip.type === \"error\") {\r\n        content = (\r\n          <ul style={{ paddingLeft: 20, maxWidth: 300 }}>\r\n            {toolTip.content.map((error, index) => {\r\n              return <li key={index}>{error.error}</li>;\r\n            })}\r\n          </ul>\r\n        );\r\n      }\r\n      key = `tooltip-${id}`;\r\n      toolTip = (\r\n        <div\r\n          id={key}\r\n          key={key}\r\n          className=\"zebulon-tool-tip\"\r\n          style={{\r\n            top: toolTip.top,\r\n            left: toolTip.left\r\n            // position: \"absolute\" toto\r\n          }}\r\n        >\r\n          {content}\r\n        </div>\r\n      );\r\n    }\r\n    this.rowsHeight =\r\n      height -\r\n      (caption ? 30 : 0) -\r\n      headersLength * this.rowHeight -\r\n      (actions.length && (!meta.table.actionIcons || caption === undefined)\r\n        ? 30\r\n        : 0);\r\n    // ------------------------\r\n    // search\r\n    // ------------------------\r\n    let search = null;\r\n\r\n    if (this.state.search) {\r\n      const { filteredData, meta, dataStrings, scroll } = this.state;\r\n      key = `search-${id}`;\r\n      const content = (\r\n        <Search\r\n          id={key}\r\n          key={key}\r\n          filteredData={filteredData}\r\n          meta={meta}\r\n          dataStrings={dataStrings}\r\n          scroll={scroll}\r\n          rowStartIndex={\r\n            scroll.rows.startIndex + scroll.rows.shift === 0 ? 0 : 1\r\n          }\r\n          rowStopIndex={Math.min(\r\n            scroll.rows.startIndex +\r\n              Math.floor(this.rowsHeight / this.rowHeight) -\r\n              (scroll.rows.shift === 0 ? 1 : 0),\r\n            filteredData.length - 1\r\n          )}\r\n          onClose={() => this.setState({ search: false })}\r\n          // selectRange={this.selectRange_}\r\n          selectedCell={this.state.selectedRange.end}\r\n          scrollTo={this.scrollTo}\r\n        />\r\n      );\r\n      search = (\r\n        <div\r\n          id={key}\r\n          key={key}\r\n          className=\"zebulon-tool-tip\"\r\n          style={{\r\n            top: 0,\r\n            left: 0,\r\n            position: \"absolute\"\r\n          }}\r\n        >\r\n          {content}\r\n        </div>\r\n      );\r\n    }\r\n\r\n    // ----------------------------------\r\n    // Status bar\r\n    // ----------------------------------\r\n    let statusBar;\r\n    if (meta.table.noStatus) {\r\n      statusBar = null;\r\n    } else {\r\n      key = `statusbar-${id}`;\r\n      statusBar = (\r\n        <Status\r\n          id={key}\r\n          key={key}\r\n          data={filteredData}\r\n          status={status}\r\n          dataLength={filteredDataLength}\r\n          height={this.rowsHeight}\r\n          rowHeight={this.rowHeight}\r\n          scroll={scroll.rows}\r\n          updatedRows={updatedRows}\r\n          selectRange={this.selectRange}\r\n          selectedIndex={selectedRange.end.rows}\r\n          meta={meta}\r\n          handleErrors={this.handleErrors}\r\n          noUpdate={noUpdate}\r\n          componentId={this.props.componentId}\r\n          checkable={meta.table.checkable}\r\n          onDoubleClick={this.onDoubleClick}\r\n          draggable={meta.table.statusDraggable}\r\n          isAudit={auditedRow ? true : false}\r\n          statusChanged={statusChanged}\r\n        />\r\n      );\r\n    }\r\n    // -----------------------------\r\n    //   action buttons\r\n    // -----------------------------\r\n    actions = this.props.setActions\r\n      ? null\r\n      : this.getActions(caption, statusBar, width, key, id);\r\n\r\n    // -----------------------------\r\n    //   rows\r\n    // -----------------------------\r\n    // let style = {};\r\n    const locked =\r\n      !utils.isNullOrUndefined(meta.lockedIndex) && !!meta.lockedWidth;\r\n    key = `rows-${id}`;\r\n    const rows = (\r\n      <Rows\r\n        id={key}\r\n        key={key}\r\n        meta={meta}\r\n        data={filteredData}\r\n        status={status}\r\n        dataLength={filteredDataLength}\r\n        height={this.rowsHeight}\r\n        width={\r\n          width -\r\n          this.rowHeight * (statusBar !== null) -\r\n          (meta.lockedWidth || 0)\r\n        }\r\n        rowHeight={this.rowHeight}\r\n        scroll={scroll}\r\n        onScroll={onScroll}\r\n        selectedRange={selectedRange}\r\n        selectRange={selectRange}\r\n        onChange={this.onChange}\r\n        onFocus={(e, row, column) => this.closeOpenedWindows(true, column, row)}\r\n        hasFocus={this.hasFocus && this.props.isActive !== false}\r\n        updatedRows={updatedRows}\r\n        params={params}\r\n        navigationKeyHandler={this.props.navigationKeyHandler}\r\n        ref={ref => (this.rows = ref)}\r\n        noUpdate={noUpdate}\r\n        // style={style}\r\n        onDoubleClick={this.onDoubleClick}\r\n        componentId={this.props.componentId}\r\n        openedFilter={this.state.openedFilter}\r\n        scrollbarsOnBox={this.props.scrollbarsOnBox}\r\n      />\r\n    );\r\n    let lockedColumns = null;\r\n    if (locked) {\r\n      key = `locked-columns-${id}`;\r\n      lockedColumns = (\r\n        <Rows\r\n          id={key}\r\n          key={key}\r\n          meta={meta}\r\n          data={filteredData}\r\n          status={status}\r\n          dataLength={filteredDataLength}\r\n          height={this.rowsHeight}\r\n          width={meta.lockedWidth}\r\n          rowHeight={this.rowHeight}\r\n          scroll={scroll}\r\n          onScroll={onScroll}\r\n          selectedRange={selectedRange}\r\n          selectRange={selectRange}\r\n          onChange={this.onChange}\r\n          onFocus={(e, row, column) => this.closeOpenedWindows(true, column)}\r\n          hasFocus={this.hasFocus && this.props.isActive !== false}\r\n          updatedRows={updatedRows}\r\n          params={params}\r\n          noUpdate={noUpdate}\r\n          noVerticalScrollbar={true}\r\n          onDoubleClick={this.onDoubleClick}\r\n          locked={locked}\r\n          componentId={this.props.componentId}\r\n          openedFilter={this.state.openedFilter}\r\n          scrollbarsOnBox={this.props.scrollbarsOnBox}\r\n        />\r\n      );\r\n    }\r\n    // -----------------------------\r\n    //   headers\r\n    // -----------------------------\r\n    key = `headers-${id}`;\r\n    const headers = (\r\n      <Headers\r\n        id={key}\r\n        key={key}\r\n        onSort={this.onSort}\r\n        meta={meta}\r\n        data={data}\r\n        height={this.rowHeight * headersLength}\r\n        width={\r\n          width -\r\n          this.rowHeight * (statusBar !== null) -\r\n          (meta.lockedWidth || 0)\r\n        }\r\n        scroll={scroll.columns}\r\n        headersLength={headersLength}\r\n        onMetaChange={this.onMetaChange}\r\n        openFilter={this.openFilter}\r\n        onChange={this.onChangeFilter}\r\n        // style={style}\r\n        componentId={this.props.componentId}\r\n        // auditedRow={auditedRow}\r\n        // auditStatus={{}}\r\n        isActive={this.props.isActive}\r\n        onActivation={this.props.onActivation}\r\n        changingFilter={this.changingFilter}\r\n      />\r\n    );\r\n    let lockedHeaders = null;\r\n    if (!utils.isNullOrUndefined(meta.lockedIndex) && meta.lockedWidth) {\r\n      key = `locked-headers-${id}`;\r\n      lockedHeaders = (\r\n        <Headers\r\n          id={key}\r\n          key={key}\r\n          onSort={this.onSort}\r\n          meta={meta}\r\n          data={data}\r\n          height={this.rowHeight * headersLength}\r\n          width={meta.lockedWidth}\r\n          scroll={scroll.columns}\r\n          headersLength={headersLength}\r\n          onMetaChange={this.onMetaChange}\r\n          openFilter={this.openFilter}\r\n          onChange={this.onChangeFilter}\r\n          locked={true}\r\n          componentId={this.props.componentId}\r\n          // auditedRow={auditedRow}\r\n          // auditStatus={{}}\r\n          isActive={this.props.isActive}\r\n          onActivation={this.props.onActivation}\r\n          changingFilter={this.changingFilter}\r\n        />\r\n      );\r\n    }\r\n    // -----------------------------\r\n    //   status bar\r\n    // -----------------------------\r\n    let statusBarHeader = [];\r\n    if (statusBar !== null) {\r\n      for (let i = 0; i < headersLength; i++) {\r\n        let checkbox = null;\r\n        if (i === 0 && meta.table.checkable === true) {\r\n          checkbox = (\r\n            <input\r\n              type=\"checkbox\"\r\n              checked={this.state.checkAll}\r\n              onChange={this.onCheckAll}\r\n            />\r\n          );\r\n        }\r\n        key = `status-bar-headers-${id}-${i}`;\r\n        statusBarHeader.push(\r\n          <div\r\n            id={key}\r\n            key={key}\r\n            className=\"zebulon-table-corner\"\r\n            style={{\r\n              width: this.rowHeight,\r\n              height: this.rowHeight,\r\n              top: i * this.rowHeight\r\n              // border: \"0.02em solid rgba(0, 0, 0, 0.3)\",\r\n              // padding: 4\r\n            }}\r\n          >\r\n            {checkbox}\r\n          </div>\r\n        );\r\n      }\r\n      key = `header-status-${id}`;\r\n      statusBarHeader = (\r\n        <ContextualMenuClient\r\n          id={key}\r\n          key={key}\r\n          menu=\"top-left-corner-menu\"\r\n          componentId={this.props.componentId}\r\n        >\r\n          {statusBarHeader}\r\n        </ContextualMenuClient>\r\n      );\r\n    } else {\r\n      statusBarHeader = null;\r\n    }\r\n    // -----------------------------\r\n    //   title\r\n    // -----------------------------\r\n    let title = null;\r\n    if (caption) {\r\n      key = `title-${id}`;\r\n      title = (\r\n        <ContextualMenuClient\r\n          id={key}\r\n          key={key}\r\n          className=\"zebulon-table-title\"\r\n          style={{\r\n            display: \"flex\",\r\n            fontWeight: \"bold\",\r\n            textAlign: \"center\",\r\n            padding: 4,\r\n            border: \"solid 0.03em rgba(0,0,0,.2)\",\r\n            height: 30,\r\n            width,\r\n            boxSizing: \"border-box\",\r\n            justifyContent: \"space-between\"\r\n          }}\r\n          menu=\"title-menu\"\r\n          componentId={this.props.componentId}\r\n          onClick={() => {\r\n            if (this.props.onActivation) {\r\n              this.props.onActivation(this.props.componentId || id);\r\n            }\r\n          }}\r\n        >\r\n          <div style={{ textAlign: \"center\", width: \"inherit\" }}>{caption}</div>\r\n          {actionIcons ? actions : null}\r\n        </ContextualMenuClient>\r\n      );\r\n    }\r\n    // const className = \"zebulon-table\";\r\n    return (\r\n      <div\r\n        id={id}\r\n        // style={{\r\n        //   width: \"max-content\",\r\n        //   height: \"fit-content\",\r\n        //   ...this.props.style\r\n        // }}\r\n        style={{\r\n          width,\r\n          height,\r\n          ...this.props.style\r\n        }}\r\n      >\r\n        <div\r\n          id={`table-${id}`}\r\n          style={{\r\n            width,\r\n            height,\r\n            display: \"block\",\r\n            position: \"absolute\"\r\n          }}\r\n        >\r\n          {detail}\r\n          {this.filter}\r\n          {this.text}\r\n\r\n          {search}\r\n          {title}\r\n          <div id={\"columns\"} style={{ display: \"flex\" }}>\r\n            {statusBarHeader}\r\n            {lockedHeaders}\r\n            {headers}\r\n          </div>\r\n          <div id={\"rows\"} style={{ display: \"flex\" }}>\r\n            {statusBar}\r\n            {lockedColumns}\r\n            {rows}\r\n          </div>\r\n          {actionIcons ? null : actions}\r\n        </div>\r\n        {toolTip}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","import React, { Component } from \"react\";\r\nimport ReactDOM from \"react-dom\";\r\nimport { ZebulonTableMenu } from \"./ZebulonTable.menu\";\r\nimport { Table } from \"./Table\";\r\nimport { computeMetaPositions } from \"./utils/compute.meta\";\r\nimport { ResizableBox } from \"react-resizable\";\r\n\r\nimport \"./index.css\";\r\nimport {\r\n  utils,\r\n  ConfirmationModal,\r\n  accessors,\r\n  constants,\r\n  functions,\r\n  ContextualMenu,\r\n  EventHandler\r\n} from \"zebulon-controls\";\r\nimport { metaFunctions } from \"./MetaDescriptions\";\r\nimport {\r\n  getFilters,\r\n  getSorts,\r\n  computeData,\r\n  // computeMeta,\r\n  computeMetaFromData,\r\n  getSizes\r\n} from \"./utils\";\r\nimport {\r\n  rollback,\r\n  rollbackAll,\r\n  rollbackFiltered,\r\n  errorHandler,\r\n  getUpdatedRows\r\n} from \"./utils/utils\";\r\nexport class ZebulonTable extends ZebulonTableMenu {\r\n  constructor(props) {\r\n    super(props);\r\n    // this.onClose.bind(this);\r\n    this.state = {\r\n      meta: props.meta,\r\n      updatedRows: props.updatedRows || {},\r\n      sizes: props.sizes || { auto: true },\r\n      keyEvent: props.keyEvent,\r\n      confirmationModal: false,\r\n      params: props.params || {},\r\n      sorts: props.sorts || {},\r\n      filters: props.filters || {},\r\n      status: { loaded: false, loading: true }\r\n    };\r\n    this.state.sizes.zoom = this.state.sizes.zoom || 1;\r\n    this.state.sizes.rowHeight = this.state.sizes.rowHeight || 25;\r\n    this.state.functions = props.functions || functions.functions([]);\r\n    this.state.functions.mergeFunctionsObjects([accessors, metaFunctions]);\r\n    // this.sorts = this.state.sorts;\r\n    this.config = props.config;\r\n    if (this.config && this.config.sizes) {\r\n      this.state.sizes = { ...this.state.sizes, ...this.config.sizes };\r\n    }\r\n    this.state.data = props.data;\r\n    this.getData(props);\r\n    this.saveConfirmationAnswer = ok => ok;\r\n  }\r\n  setFilters = (filters, columns) => {\r\n    columns.forEach(column => {\r\n      if (filters[column.id]) {\r\n        column.filterType = filters[column.id].filterType;\r\n        column.v = filters[column.id].v;\r\n        column.vTo = filters[column.id].vTo;\r\n        column.link = filters[column.id].link;\r\n        filters[column.id] = column;\r\n      } else if (\r\n        !utils.isNullOrUndefined(column.v) ||\r\n        (column.filterType === \"between\" &&\r\n          !utils.isNullOrUndefined(column.vTo))\r\n      ) {\r\n        filters[column.id] = column;\r\n      }\r\n    });\r\n    return filters;\r\n  };\r\n  setSorts = (sorts, columns) => {\r\n    columns.forEach(column => {\r\n      if (sorts[column.id]) {\r\n        column.sortOrder = sorts[column.id].sortOrder;\r\n        column.sort = sorts[column.id].direction;\r\n      } else {\r\n        column.sortOrder = undefined;\r\n        column.sort = undefined;\r\n      }\r\n    });\r\n  };\r\n  refresh = () => this.setState(this.getData(this.props));\r\n  getData = props => {\r\n    if (this._isMounted) {\r\n      this.setState({\r\n        status: { loaded: false, loading: true }\r\n      });\r\n    }\r\n    this.observable = null;\r\n    let { data, meta, params, filteredData } = props;\r\n    const { sorts, filters } = this.state;\r\n    if (props.filters) {\r\n      Object.values(props.filters)\r\n        .filter(filter => filter.link)\r\n        .forEach(filter => (filters[filter.id] = filter));\r\n    }\r\n    const message = {\r\n      dataObject: meta.table.object,\r\n      params,\r\n      meta,\r\n      filters: getFilters(meta.properties, filters || {}),\r\n      sorts: sorts ? Object.values(sorts) : getSorts(meta.properties),\r\n      props,\r\n      state: this.state\r\n    };\r\n    if (typeof data === \"function\") {\r\n      data = data(message);\r\n    } else if (\r\n      !Array.isArray(data) &&\r\n      ((meta && props.select) || meta.table.select)\r\n    ) {\r\n      data =\r\n        props.select ||\r\n        this.state.functions.getAccessorFunction(\r\n          meta.table.object,\r\n          \"dmls\",\r\n          meta.table.select\r\n        );\r\n      data = data(message);\r\n    }\r\n    if (Array.isArray(data)) {\r\n      if (meta.table.noDataMutation) {\r\n        data = [...data];\r\n      }\r\n      this.initData(\r\n        data,\r\n        meta,\r\n        this.state.sizes.zoom,\r\n        this.state.functions,\r\n        0,\r\n        filters\r\n      );\r\n      this.subscribe(message, this.state.meta.table.subscription);\r\n    } else if (utils.isPromise(data)) {\r\n      this.resolvePromise(data, message);\r\n    } else if (utils.isObservable(data)) {\r\n      this.subscribeObservable(data, message);\r\n      data = [];\r\n    } else {\r\n      data = [];\r\n    }\r\n    // }\r\n    return { data, meta, filters, sorts, updatedRows: {} };\r\n  };\r\n  initData = (data, meta, zoom, functions, startIndex, filters) => {\r\n    if (Array.isArray(data)) {\r\n      meta.config = this.config ? this.config.properties : undefined;\r\n      computeMetaFromData(\r\n        data,\r\n        meta,\r\n        zoom,\r\n        functions,\r\n        this.props.privileges\r\n          ? this.props.privileges.get(this.props.componentName)\r\n          : null\r\n      );\r\n      this.config = undefined;\r\n      Promise.all(meta.promises).then(values => {\r\n        this.initData2(data, meta, zoom, functions, startIndex, filters);\r\n      });\r\n    }\r\n  };\r\n  initData2 = (data_, meta, zoom, functions, startIndex) => {\r\n    // !! filters may have change after getData call\r\n    const filters = this.state.filters;\r\n    if (Array.isArray(data_)) {\r\n      const data = meta.table.noDataMutation ? [...data_] : data_;\r\n      computeData(data, meta, startIndex, meta.table.noDataMutation);\r\n      if (this.props.filteredData && meta.indexPk) {\r\n        const updatedRows = this.state.updatedRows;\r\n        Object.values(this.props.filteredData).forEach(\r\n          data => (updatedRows[meta.indexPk[data.id]] = data)\r\n        );\r\n      }\r\n      if (this.props.onGetData) {\r\n        this.props.onGetData({\r\n          data,\r\n          meta,\r\n          updatedRows: this.state.updatedRows\r\n        });\r\n      }\r\n\r\n      this.initSizes(meta, data, this.state.sizes);\r\n      if (filters && meta.properties.length !== 0) {\r\n        this.setFilters(filters, meta.properties);\r\n      }\r\n      // sorts are applied only the first time\r\n      if (this.state.sorts && meta.properties.length !== 0) {\r\n        this.setSorts(this.state.sorts, meta.properties);\r\n        // this.sorts = null;\r\n      }\r\n      if (this._isMounted) {\r\n        this.setState({\r\n          data,\r\n          status: { loaded: true, loading: false },\r\n          filters\r\n        });\r\n      } else {\r\n        this.state.data = data;\r\n        this.state.filters = filters;\r\n        this.state.status = { loaded: true, loading: false };\r\n      }\r\n    }\r\n  };\r\n  resolvePromise = (data, message) => {\r\n    data\r\n      .then(data => {\r\n        const { meta, functions, sizes } = this.state;\r\n        this.initData(data, meta, sizes.zoom, functions, 0, message.filters);\r\n        this.subscribe(message, meta.table.subscription);\r\n        return data;\r\n      })\r\n      .catch(error =>\r\n        this.setState({\r\n          data: [],\r\n          status: { loaded: false, loading: false, error }\r\n        })\r\n      );\r\n  };\r\n  subscribeObservable = (observable, message) => {\r\n    this.observable = observable;\r\n    this.observable.subscribe(\r\n      x => {\r\n        this.initData(\r\n          x,\r\n          this.state.meta,\r\n          this.state.sizes.zoom,\r\n          this.state.functions,\r\n          this.state.data.length,\r\n          this.state.filters\r\n        );\r\n        if (this.observable) {\r\n          this.setState({\r\n            data: this.state.data.concat(x),\r\n            meta: this.state.meta\r\n          });\r\n        }\r\n      },\r\n      e =>\r\n        this.setState({\r\n          data: [],\r\n          status: { loaded: false, loading: false, error: e }\r\n        }),\r\n      () => {\r\n        this.setState({ status: { loaded: true, loading: false } });\r\n        this.subscribe(message, this.state.meta.table.subscription);\r\n      }\r\n    );\r\n  };\r\n  subscribe = (message, subscription) => {\r\n    if (subscription) {\r\n      const { data, meta, updatedRows } = this.state;\r\n      message.index = meta.indexRowId || meta.indexPk;\r\n      message.data = data;\r\n      message.updatedRows = updatedRows;\r\n      this.observable = subscription.observableFunction(message);\r\n      const { onNext, onError, onCompleted } = subscription.observerFunctions;\r\n      const onNextFunction = data => {\r\n        onNext(data, message);\r\n        this.setState({ status: { loaded: true, loading: false } });\r\n      };\r\n      const onErrorFunction = error => {\r\n        onError(error, message);\r\n        this.setState({ status: { loaded: false, loading: false, error } });\r\n      };\r\n      this.observable.subscribe(onNextFunction, onErrorFunction, () =>\r\n        onCompleted(message)\r\n      );\r\n    }\r\n  };\r\n  initSizes = (meta, data, sizes) => {\r\n    if (sizes.auto) {\r\n      sizes.height = null;\r\n      sizes.width = null;\r\n    }\r\n    if (!sizes.height || !sizes.width) {\r\n      const tableSizes = getSizes(\r\n        meta,\r\n        sizes.rowHeight || meta.row.height || 25\r\n      );\r\n      if (!sizes.height && data) {\r\n        sizes.height =\r\n          meta.table.height ||\r\n          Math.min(\r\n            sizes.maxHeight || 1000,\r\n            Math.max(\r\n              sizes.minHeight || 100,\r\n              tableSizes.headersHeight + data.length * tableSizes.rowHeight\r\n            )\r\n          );\r\n      }\r\n      if (!sizes.width) {\r\n        const scrollbarSize =\r\n          tableSizes.headersHeight + data.length * tableSizes.rowHeight >\r\n          (sizes.maxHeight || 1000)\r\n            ? constants.ScrollbarSize\r\n            : 0;\r\n        sizes.width =\r\n          meta.row.width ||\r\n          Math.min(\r\n            sizes.maxWidth || 2000,\r\n            Math.max(\r\n              sizes.minWidth || 100,\r\n              tableSizes.headersWidth + tableSizes.rowWidth + scrollbarSize\r\n            )\r\n          );\r\n      }\r\n    }\r\n  };\r\n  componentDidMount = () => {\r\n    this._isMounted = true;\r\n    if (this.props.getComponent) {\r\n      this.props.getComponent(this);\r\n    }\r\n  };\r\n  componentWillUnmount = () => (this._isMounted = false);\r\n  componentWillReceiveProps(nextProps) {\r\n    const {\r\n      data,\r\n      meta,\r\n      sizes,\r\n      keyEvent,\r\n      updatedRows,\r\n      filters,\r\n      status,\r\n      closeRequired,\r\n      refresh,\r\n      config\r\n    } = nextProps;\r\n    if (config !== this.props.config) {\r\n      this.config = config;\r\n    }\r\n    if (updatedRows && this.props.updatedRows !== updatedRows) {\r\n      this.setState({ updatedRows });\r\n    }\r\n    if (\r\n      this.props.data !== data ||\r\n      (this.props.status !== status && status.loaded) ||\r\n      (this.props.filters !== filters && meta.table.filteredByServer) ||\r\n      (this.props.refresh !== refresh && refresh !== undefined)\r\n    ) {\r\n      let ok = true;\r\n      // if (!closeRequired && !this.props.closeRequired) {\r\n      ok = this.onTableChange(\"refresh\", ok => {\r\n        if (ok) {\r\n          // this.sorts = this.state.sorts;\r\n          if (this.props.filters !== filters && meta.table.filteredByServer) {\r\n            const state = this.state;\r\n            state.filters = filters;\r\n          }\r\n          this.getData(nextProps);\r\n          if (this.props.linkedObjects) {\r\n            this.props.linkedObjects.forEach(object => object.refresh());\r\n          }\r\n        }\r\n      });\r\n      // }\r\n      if (ok) {\r\n        this.getData(nextProps);\r\n      }\r\n    } else {\r\n      if (this.props.sizes !== sizes) {\r\n        this.setState({ sizes });\r\n      }\r\n    }\r\n    if (this.props.filters !== filters) {\r\n      this.setState({ filters });\r\n    }\r\n    // }\r\n    if (\r\n      nextProps.auditedRow &&\r\n      nextProps.auditedRow !== this.state.auditedRow\r\n    ) {\r\n      this.setState({ auditedRow: nextProps.auditedRow, audits: undefined });\r\n      if (nextProps.auditedRow) {\r\n        let audits = this.state.meta.row.auditFunction({\r\n          row: nextProps.auditedRow,\r\n          type: 2,\r\n          filters: nextProps.filters\r\n        });\r\n        if (utils.isPromise(audits)) {\r\n          this.setState({ status: { loaded: false, loading: true } });\r\n          audits.then(audits => {\r\n            this.setState({\r\n              auditedRow: nextProps.auditedRow,\r\n              audits: audits || [],\r\n              status: { loaded: true, loading: false }\r\n            });\r\n          });\r\n        } else {\r\n          this.setState({\r\n            auditedRow: nextProps.auditedRow,\r\n            audits: audits || []\r\n          });\r\n        }\r\n      }\r\n    }\r\n    // if (closeRequired && !this.props.closeRequired) {\r\n    //   this.onClose(closeRequired);\r\n    // }\r\n  }\r\n  handleKeyEvent = e => {\r\n    if (this.state.confirmationModal && this.modal) {\r\n      if ((e.which || e.keyCode) === 27) {\r\n        // escape\r\n        e.preventDefault();\r\n        this.modal.onEscape();\r\n      }\r\n      if ((e.which || e.keyCode) === 13) {\r\n        // enter\r\n        e.preventDefault();\r\n        this.modal.onEnter();\r\n      } else if (this.modal.component && this.modal.component.handleKeyDown) {\r\n        this.modal.component.handleKeyDown(e);\r\n      }\r\n      return;\r\n    }\r\n    const zoom = utils.isZoom(e);\r\n    if (zoom && (this.props.isActive === undefined || this.props.isActive)) {\r\n      e.preventDefault();\r\n      const sizes = this.state.sizes;\r\n      sizes.zoom *= zoom === 1 ? 1.1 : 1 / 1.1;\r\n      computeMetaPositions(this.state.meta, sizes.zoom);\r\n      this.setState({ sizes: { ...sizes } });\r\n      return;\r\n    }\r\n    if (!this.table) {\r\n      return;\r\n    } else if (e.type === \"copy\") {\r\n      this.handleCopy(e);\r\n    } else if (e.type === \"paste\") {\r\n      this.handlePaste(e);\r\n    } else if (e.type === \"keydown\") {\r\n      this.handleKeyDown(e);\r\n    }\r\n  };\r\n  handleKeyDown = e => {\r\n    if (\r\n      !e.defaultPrevented &&\r\n      this.table &&\r\n      this.table.handleKeyDown &&\r\n      (this.props.isActive === undefined || this.props.isActive)\r\n    ) {\r\n      this.table.handleKeyDown(e);\r\n    }\r\n  };\r\n  handleCopy = e => {\r\n    if (\r\n      !e.defaultPrevented &&\r\n      this.table &&\r\n      this.table.handleCopy &&\r\n      (this.props.isActive === undefined || this.props.isActive)\r\n    ) {\r\n      // e.preventDefault();\r\n      this.table.handleCopy(e);\r\n    }\r\n  };\r\n  handlePaste = e => {\r\n    if (\r\n      !e.defaultPrevented &&\r\n      this.table &&\r\n      this.table.handlePaste &&\r\n      (this.props.isActive === undefined || this.props.isActive)\r\n    ) {\r\n      // e.preventDefault();\r\n      this.table.handlePaste(e);\r\n    }\r\n  };\r\n  // ----------------------------------------\r\n  // comunication with server\r\n  // ----------------------------------------\r\n  rollback = (updatedRows, index) => {\r\n    rollback(updatedRows, index);\r\n    if (this.props.linkedObjects) {\r\n      this.props.linkedObjects.forEach(object => object.rollbackFiltered());\r\n    }\r\n  };\r\n  rollbackFiltered = () => {\r\n    rollbackFiltered(this.state.updatedRows, this.props.filters);\r\n    this.setState({ status: this.state.status });\r\n  };\r\n  errorHandler = (message, action, callback, callbackReDo) => {\r\n    let handler = (this.props.errorHandler || errorHandler)[action];\r\n    if (\r\n      (action === \"onTableQuit\" && !(message.updatedRows || {}).nErrors) ||\r\n      (action === \"onSave\" &&\r\n        !(message.updatedRows || {}).nErrorsServer &&\r\n        !message.conflicts)\r\n    ) {\r\n      handler = null;\r\n    } else if (\r\n      action === \"onRowQuit\" &&\r\n      !((message.status || {}).errors || {}).n_\r\n    ) {\r\n      handler = null;\r\n    }\r\n    if (handler) {\r\n      const ok = handler(message);\r\n      const body = message.modalBody;\r\n      message.modalBody = null;\r\n      const conflicts = message.conflicts;\r\n      message.conflicts = null;\r\n      if (ok === false) {\r\n        if (body) {\r\n          this.setState({\r\n            confirmationModal: true,\r\n            modal: { body, type: \"Ok\" }\r\n          });\r\n        }\r\n        return false;\r\n      } else if (body) {\r\n        const type = action === \"onTableChange\" ? \"YesNoCancel\" : \"YesNo\";\r\n        this.setState({\r\n          confirmationModal: true,\r\n          modal: { body, type, callback }\r\n        });\r\n        return;\r\n      } else if (conflicts) {\r\n        const resolveConflicts = updatedRows => (ok, data) => {\r\n          if (ok) {\r\n            // back to server version\r\n            data.forEach(index => {\r\n              const row = conflicts.data[index].server;\r\n              row.index_ = index;\r\n              updatedRows[index].row = row;\r\n              this.rollback(updatedRows, index);\r\n            });\r\n            (action === \"onSave\" && callbackReDo ? callbackReDo : callback)(ok);\r\n          }\r\n        };\r\n        const index = message.messages.findIndex(\r\n          msg => msg.meta.table.object === conflicts.object\r\n        );\r\n        const zebulonTable =\r\n          message.meta.table.object === conflicts.object\r\n            ? this\r\n            : this.props.linkedObjects.find(\r\n                object => object.state.meta.table.object === conflicts.object\r\n              );\r\n        // zebulonTable.confirmationModal = true;\r\n        zebulonTable.setState({\r\n          confirmationModal: true,\r\n          modal: {\r\n            body: zebulonTable.onConflict(conflicts.data),\r\n            type: \"conflict\",\r\n            callback: resolveConflicts(message.messages[index].updatedRows)\r\n          }\r\n        });\r\n        return;\r\n      }\r\n    }\r\n    return true;\r\n  };\r\n  onClose = callback_ => this.onTableChange(\"close\", callback_);\r\n  onTableChange = (type, callback_) => {\r\n    const tableChange = this.onTableChange_;\r\n    const ok = this.table.canQuit(\"rowQuit\", ok => {\r\n      if (ok) {\r\n        this.onTableChange_(type, callback_);\r\n      }\r\n    });\r\n    if (ok) {\r\n      tableChange(type, callback_);\r\n    }\r\n  };\r\n  rollbackAll = () => {\r\n    rollbackAll(this.state.updatedRows, this.state.data);\r\n    this.setState({ updatedRows: {} });\r\n    if (this.table) {\r\n      this.table.updated = false;\r\n      this.table.rowUpdated = false;\r\n      this.table.tableUpdated = false;\r\n      this.table.adjustScrollRows(this.table.state.filteredData);\r\n    }\r\n    if (this.props.linkedObjects) {\r\n      this.props.linkedObjects.forEach(object => {\r\n        if (object.rollbackAll) {\r\n          object.rollbackAll();\r\n        }\r\n      });\r\n    }\r\n  };\r\n  onTableChange_ = (type, callback_) => {\r\n    const callback =\r\n      !callback_ && type === \"refresh\"\r\n        ? ok => {\r\n            if (ok) {\r\n              this.getData(this.props);\r\n              this.table.updated = false;\r\n              this.table.rowUpdated = false;\r\n              this.table.tableUpdated = false;\r\n              if (this.props.linkedObjects) {\r\n                this.props.linkedObjects.forEach(object => {\r\n                  if (object.refresh) {\r\n                    object.refresh();\r\n                  }\r\n                });\r\n              }\r\n            }\r\n          }\r\n        : callback_;\r\n    if (!getUpdatedRows(this.state.updatedRows).length) {\r\n      return callback(true);\r\n    }\r\n    const message = {\r\n      updatedRows: this.state.updatedRows,\r\n      meta: this.state.meta,\r\n      data: this.state.data,\r\n      params: this.props.params,\r\n      type\r\n    };\r\n    const save = (carryOn, ok) => {\r\n      if (carryOn && ok) {\r\n        this.onSave(callback);\r\n      } else if (carryOn) {\r\n        this.rollbackAll();\r\n        callback(true);\r\n      } else {\r\n        callback(false);\r\n      }\r\n    };\r\n    const ok = this.errorHandler(message, \"onTableChange\", save);\r\n    if (ok !== undefined) {\r\n      callback(ok);\r\n    }\r\n  };\r\n  onSave = callback => {\r\n    const message = {\r\n      messages: [\r\n        {\r\n          updatedRows: this.state.updatedRows,\r\n          // linkedUpdatedRows: this.props.linkedUpdatedRows,\r\n          meta: this.state.meta,\r\n          data: this.state.data,\r\n          params: this.props.params,\r\n          table: this.table\r\n        }\r\n      ],\r\n      updatedRows: this.state.updatedRows,\r\n      meta: this.state.meta,\r\n      data: this.state.data,\r\n      params: this.props.params,\r\n      table: this.table\r\n    };\r\n    if (this.props.linkedObjects) {\r\n      this.props.linkedObjects.forEach(object => {\r\n        const { meta, data } = object.state;\r\n        if (\r\n          meta &&\r\n          meta.table.object &&\r\n          (meta.table.onSaveFunction || this.props.onSave)\r\n        ) {\r\n          message.messages.push({\r\n            updatedRows: object.state.updatedRows,\r\n            meta,\r\n            data,\r\n            params: this.props.params,\r\n            table: object.table\r\n          });\r\n        }\r\n      });\r\n    }\r\n    if (this.onSave_(message, callback)) {\r\n      return true;\r\n    }\r\n    return false;\r\n  };\r\n  onSave_ = (message, callback) => {\r\n    // in layouts save can be done without \"data\" as  data to update may be not anymore in the grid\r\n    // in this case, refresh is required as we can't recompute data\r\n    const end = ok_ => {\r\n      if (ok_) {\r\n        message.messages.forEach(message => {\r\n          const { data, meta, serverData, updatedRows } = message;\r\n          const deleteds = [];\r\n          // deleteds new rows are not sent to the server\r\n          Object.keys(message.updatedRows)\r\n            .filter(\r\n              key =>\r\n                !Number.isNaN(Number(key)) &&\r\n                message.updatedRows[key].new_ &&\r\n                message.updatedRows[key].deleted_\r\n            )\r\n            .forEach(key =>\r\n              deleteds.push(message.updatedRows[key].rowUpdated.index_)\r\n            );\r\n          // retrieve changes made on server\r\n          if (serverData) {\r\n            serverData.forEach(row => {\r\n              if (row.status_ === \"deleted\") {\r\n                deleteds.push(row.index_);\r\n                if (!data) {\r\n                  updatedRows[row.index_].hidden_ = true;\r\n                }\r\n              } else {\r\n                delete row.status_;\r\n                const rowUpdated = updatedRows[row.index_].rowUpdated;\r\n                Object.keys(row).forEach(key => (rowUpdated[key] = row[key]));\r\n              }\r\n            });\r\n          } else {\r\n            Object.values(message.updatedRows)\r\n              .filter(status => status.deleted_)\r\n              .forEach((status, index) => {\r\n                deleteds.push(status.rowUpdated.index_);\r\n              });\r\n          }\r\n          if (deleteds.length && data) {\r\n            deleteds.sort((x, y) => (x > y) - (y > x));\r\n            deleteds.forEach((index_, index) => data.splice(index_ - index, 1));\r\n          }\r\n          // a voir startIndex en mode pagination\r\n          // this.setState({ updatedRows: {} });\r\n          Object.keys(message.updatedRows).forEach(\r\n            key => delete message.updatedRows[key]\r\n          );\r\n          if (message.table) {\r\n            const filteredData = message.table.state.filteredData;\r\n            if (deleteds.length) {\r\n              deleteds.forEach(index_ => {\r\n                const index = filteredData.findIndex(\r\n                  row => row.index_ === index_\r\n                );\r\n                if (index !== -1) {\r\n                  filteredData.splice(index, 1);\r\n                }\r\n              });\r\n              message.table.adjustScrollRows(filteredData);\r\n              message.table.updated = false;\r\n              message.table.rowUpdated = false;\r\n              message.table.tableUpdated = false;\r\n            }\r\n            message.table.setState({ filteredDataLength: filteredData.length });\r\n          }\r\n          if (data) {\r\n            computeData(data, meta, 0);\r\n          }\r\n        });\r\n      }\r\n      if (this.props.onSaveOk) {\r\n        this.props.onSaveOk(message);\r\n      }\r\n      if (callback) {\r\n        callback(ok_);\r\n      }\r\n    };\r\n    const errorAfter = ok_ => {\r\n      const ok = ok_ && this.errorHandler(message, \"onSaveAfter\", end);\r\n      if (ok !== undefined) {\r\n        end(ok);\r\n      }\r\n    };\r\n    const saveAfter = ok_ => {\r\n      const onSaveAfter =\r\n        this.props.onSaveAfter ||\r\n        this.state.meta.table.onSaveAfterFunction ||\r\n        (() => true);\r\n      const ok = ok_ && onSaveAfter(message, errorAfter);\r\n      if (ok !== undefined) {\r\n        errorAfter(ok);\r\n      }\r\n    };\r\n    const errorSave = ok_ => {\r\n      const ok =\r\n        ok_ && this.errorHandler(message, \"onSave\", saveAfter, saveBefore);\r\n      if (ok !== undefined) {\r\n        saveAfter(ok);\r\n      }\r\n    };\r\n    const save = ok_ => {\r\n      const onSave =\r\n        this.props.onSave ||\r\n        this.state.meta.table.onSaveFunction ||\r\n        (() => true);\r\n      const ok = ok_ && onSave(message, errorSave);\r\n      if (ok !== undefined) {\r\n        errorSave(ok);\r\n      }\r\n    };\r\n    const errorBefore = ok_ => {\r\n      const ok = ok_ && this.errorHandler(message, \"onSaveBefore\", save);\r\n      if (ok !== undefined) {\r\n        save(ok);\r\n      }\r\n    };\r\n    const saveBefore = ok_ => {\r\n      const updatedRows = message.updatedRows;\r\n      if (!getUpdatedRows(updatedRows).length) {\r\n        return end(true);\r\n      }\r\n      const onSaveBefore =\r\n        this.props.onSaveBefore ||\r\n        this.state.meta.table.onSaveBeforeFunction ||\r\n        (() => true);\r\n      const ok = ok_ && onSaveBefore(message, errorBefore);\r\n      if (ok !== undefined) {\r\n        errorBefore(ok);\r\n      }\r\n    };\r\n    const canQuit = ok_ => {\r\n      const ok = ok_ && this.table.canQuit(\"rowQuit\", saveBefore);\r\n      if (ok !== undefined) {\r\n        saveBefore(ok);\r\n      }\r\n    };\r\n    canQuit(true);\r\n  };\r\n  // confirmation modal management\r\n  onConfirm = (button, type) => {\r\n    this.setState({\r\n      modalCancel: false,\r\n      modal: null,\r\n      confirmationModal: false\r\n    });\r\n    // this.confirmationModal = false;\r\n  };\r\n  // foreign key modal\r\n  onForeignKey = (ForeignObject, filters, selection, callback) => {\r\n    const { rowHeight, zoom, height, width } = this.state.sizes;\r\n    const body = (\r\n      <ForeignObject\r\n        sizes={{\r\n          minHeight: 200,\r\n          maxHeight: height,\r\n          minWidth: 300,\r\n          maxWidth: width,\r\n          rowHeight: rowHeight * zoom\r\n        }}\r\n        filters={filters}\r\n        functions={this.props.functions}\r\n      />\r\n    );\r\n    // this.confirmationModal = true;\r\n    const state = this.state;\r\n    state.confirmationModal = true;\r\n    state.modal = { body, type: \"foreignKey\", selection, callback };\r\n    this.setState({\r\n      confirmationModal: true,\r\n      modal: { body, type: \"foreignKey\", selection, callback }\r\n    });\r\n  };\r\n  onConflict = conflicts => {\r\n    const properties = [{ id: \"From\", width: 55 }];\r\n    this.state.meta.properties.forEach(property =>\r\n      properties.push({ ...property })\r\n    );\r\n    const meta = {\r\n      ...this.state.meta,\r\n      indexPk: {},\r\n      table: {\r\n        ...this.state.meta.table,\r\n        editable: false,\r\n        checkable: 2,\r\n        select: undefined,\r\n        subscription: undefined,\r\n        noFilter: true,\r\n        caption: `Conflicts resolution.`\r\n      },\r\n      properties\r\n    };\r\n    const data = [];\r\n    let index = 0,\r\n      updatedRows = {};\r\n\r\n    Object.keys(conflicts).forEach(index_ => {\r\n      const conflict = conflicts[index_];\r\n      conflict.server.From = conflict.server.deleted_ ? (\r\n        <div style={{ color: \"red\" }}>Server</div>\r\n      ) : (\r\n        \"Server\"\r\n      );\r\n      updatedRows[index] = { checked_: true, index_ };\r\n      const ix = index;\r\n      conflict.server.index_ = ix;\r\n      data.push(conflict.server);\r\n      updatedRows[index + 1] = { checked_: false };\r\n      data.push({\r\n        ...conflict.client,\r\n        From: conflict.client.deleted_ ? (\r\n          <div style={{ color: \"red\" }}>Client</div>\r\n        ) : (\r\n          \"Client\"\r\n        ),\r\n        index_: ix + 1\r\n      });\r\n      index += 2;\r\n    });\r\n    const { rowHeight, zoom, height, width } = this.state.sizes;\r\n    return (\r\n      <ZebulonTable\r\n        sizes={{\r\n          minHeight: 200,\r\n          maxHeight: height,\r\n          minWidth: 300,\r\n          maxWidth: width,\r\n          rowHeight: rowHeight * zoom\r\n        }}\r\n        meta={meta}\r\n        data={data}\r\n        isModal={true}\r\n        functions={this.state.functions}\r\n        updatedRows={updatedRows}\r\n      />\r\n    );\r\n  };\r\n  onResize = (e, data) => {\r\n    this.setState({\r\n      sizes: {\r\n        ...this.state.sizes,\r\n        height: data.size.height,\r\n        width: data.size.width\r\n      }\r\n    });\r\n  };\r\n\r\n  // getConfiguration_ = (configuration, layout) => {\r\n  //   const {\r\n  //     height,\r\n  //     width,\r\n  //     display,\r\n  //     tabs,\r\n  //     ratioHeight,\r\n  //     ratioWidth,\r\n  //     layouts,\r\n  //     content,\r\n  //     caption\r\n  //   } = layout;\r\n\r\n  //   configuration.height = height;\r\n  //   configuration.width = width;\r\n  //   configuration.display = display;\r\n  //   configuration.tabs = tabs;\r\n  //   configuration.ratioHeight = ratioHeight;\r\n  //   configuration.ratioWidth = ratioWidth;\r\n  //   configuration.content = content;\r\n  //   configuration.caption = caption;\r\n  //   if (layouts && layouts.length) {\r\n  //     configuration.layouts = [];\r\n  //     layouts.forEach((layout, index) => {\r\n  //       configuration.layouts.push({});\r\n  //       this.getConfiguration_(configuration.layouts[index], layout);\r\n  //     });\r\n  //   }\r\n  // };\r\n  getConfiguration = () => ({\r\n    sizes: {\r\n      ...this.state.sizes,\r\n      auto: false,\r\n      minHeight: null,\r\n      maxHeight: null,\r\n      minWidth: null,\r\n      maxWidth: null\r\n    },\r\n    properties: this.state.meta.properties.reduce((acc, property) => {\r\n      acc[property.id] = {\r\n        index_: property.index_,\r\n        width: property.width,\r\n        locked: property.locked\r\n      };\r\n      return acc;\r\n    }, {})\r\n  });\r\n  render() {\r\n    const style = {\r\n      fontSize: `${(this.props.isModal ? 1 : this.state.sizes.zoom) * 100}%`,\r\n      position: \"relative\",\r\n      height: \"fitContent\"\r\n    };\r\n    let {\r\n      data,\r\n      meta,\r\n      filters,\r\n      updatedRows,\r\n      sizes,\r\n      status,\r\n      auditedRow,\r\n      audits\r\n    } = this.state;\r\n    if (auditedRow && audits) {\r\n      meta = {\r\n        ...meta,\r\n        table: {\r\n          ...meta.table,\r\n          editable: false,\r\n          noOrder: true,\r\n          actions: [],\r\n          caption: `${meta.table.caption || meta.table.object} (audit :${\r\n            meta.row.descriptorFunction\r\n              ? meta.row.descriptorFunction({ row: auditedRow })\r\n              : auditedRow.index_\r\n          })`\r\n        }\r\n      };\r\n      // linked object\r\n      data = audits;\r\n      filters = {};\r\n      updatedRows = {};\r\n      if (this.props.auditedRow) {\r\n        meta.table.caption = `${meta.table.caption || meta.table.object}`;\r\n      } else {\r\n        meta.properties = [\r\n          {\r\n            id: \"user_\",\r\n            caption: \"User\",\r\n            width: 80\r\n          },\r\n          {\r\n            id: \"timestamp_\",\r\n            caption: \"Time\",\r\n            dataType: \"number\",\r\n            format: \"time\",\r\n            formatFunction: ({ value }) =>\r\n              utils.formatValue(\r\n                new Date(value / 1000000),\r\n                \"dd/mm/yyyy hh:mi:ss\"\r\n              ),\r\n            width: 150,\r\n            sort: \"desc\"\r\n          },\r\n          {\r\n            id: \"status_\",\r\n            caption: \"Status\",\r\n            dataType: \"string\",\r\n            width: 70,\r\n            locked: true\r\n          },\r\n          ...meta.properties.map(property => ({\r\n            ...property,\r\n            locked: false,\r\n            v: undefined\r\n          }))\r\n        ];\r\n        computeMetaPositions(meta, this.state.sizes.zoom);\r\n        meta.lockedIndex = 2;\r\n        meta.lockedWidth = 300 * this.state.sizes.zoom;\r\n        let rowAudited = updatedRows[auditedRow.index_];\r\n        if (\r\n          rowAudited &&\r\n          (rowAudited.deleted_ || rowAudited.updated_ || rowAudited.new_) &&\r\n          !(rowAudited.deleted_ && rowAudited.new_)\r\n        ) {\r\n          rowAudited = {\r\n            ...rowAudited.rowUpdated,\r\n            status_: rowAudited.deleted_\r\n              ? \"deleted\"\r\n              : rowAudited.new_\r\n              ? \"inserted\"\r\n              : \"updated\"\r\n          };\r\n          data = [rowAudited].concat(data);\r\n        }\r\n      }\r\n\r\n      sizes = { ...sizes };\r\n      this.initSizes(meta, data, sizes);\r\n    }\r\n    const componentId =\r\n      this.props.componentId || `zebulon-table-${this.props.id}`;\r\n\r\n    // const modal = null;\r\n    let div = (\r\n      <EventHandler\r\n        id={componentId}\r\n        component={this}\r\n        style={style}\r\n        className=\"zebulon-table\"\r\n        componentId={componentId}\r\n      >\r\n        <ContextualMenu\r\n          key=\"table-menu\"\r\n          getMenu={this.getMenu}\r\n          componentId={componentId}\r\n          id=\"table-menu\"\r\n          ref={ref => (this.contextualMenu = ref)}\r\n        />\r\n        <Table\r\n          id={this.props.id}\r\n          componentId={componentId}\r\n          style={this.props.style}\r\n          status={status}\r\n          data={data}\r\n          meta={meta}\r\n          params={this.props.params}\r\n          filters={filters}\r\n          updatedRows={updatedRows}\r\n          key={this.props.id}\r\n          visible={this.props.visible === undefined ? true : this.props.visible}\r\n          // sizes={this.state.sizes}\r\n          width={sizes.width}\r\n          height={sizes.height}\r\n          zoom={sizes.zoom}\r\n          rowHeight={\r\n            (this.state.sizes.rowHeight || 25) * (this.state.sizes.zoom || 1)\r\n          }\r\n          caption={this.props.caption}\r\n          isActive={this.props.isActive}\r\n          onActivation={this.props.onActivation}\r\n          ref={ref => (this.table = ref)}\r\n          getActions={this.props.getActions}\r\n          onChange={this.props.onChange}\r\n          onDoubleClick={this.props.onDoubleClick}\r\n          onCellEnter={this.props.onCellEnter}\r\n          onCellQuit={this.props.onCellQuit}\r\n          onRowNew={this.props.onRowNew}\r\n          onRowDelete={this.props.onRowDelete}\r\n          onRowEnter={this.props.onRowEnter}\r\n          onRowQuit={this.props.onRowQuit}\r\n          onTableEnter={this.props.onTableEnter}\r\n          onTableChange={this.onTableChange}\r\n          onTableQuit={this.props.onTableQuit}\r\n          onTableClose={this.props.onTableClose}\r\n          onFilter={this.props.onFilter}\r\n          onSort={this.props.onSort}\r\n          select={this.props.select}\r\n          onGetData={this.props.onGetData}\r\n          onGetPage={this.props.onGetPage}\r\n          onSave={this.onSave}\r\n          onAction={this.props.onAction}\r\n          callbacks={this.props.callbacks}\r\n          errorHandler={this.errorHandler}\r\n          navigationKeyHandler={this.props.navigationKeyHandler}\r\n          contextualMenu={this.contextualMenu} // {this.props.contextualMenu}\r\n          callbackForeignKey={this.props.callbackForeignKey}\r\n          onForeignKey={this.onForeignKey}\r\n          isModal={this.props.isModal}\r\n          modal={this.state.confirmationModal || this.state.modalCancel}\r\n          selection={this.props.selection}\r\n          scrollbarsOnBox={this.props.scrollbarsOnBox}\r\n          setActions={this.props.setActions}\r\n        />\r\n      </EventHandler>\r\n    );\r\n    if (this.props.resizable || this.props.resizable === undefined) {\r\n      div = (\r\n        <ResizableBox\r\n          width={sizes.width || 100}\r\n          height={sizes.height || 30}\r\n          onResize={this.onResize}\r\n        >\r\n          {div}\r\n        </ResizableBox>\r\n      );\r\n    }\r\n    console.log(\"render zt\", meta.table, this.state.modal);\r\n    return (\r\n      // confirmation modal must be outside of previous elements\r\n      // else it doesnt render in some cases???\r\n      <div>\r\n        {div}\r\n        <ConfirmationModal\r\n          show={this.state.confirmationModal}\r\n          detail={this.state.modal}\r\n          onConfirm={this.onConfirm}\r\n          ref={ref => (this.modal = ref)}\r\n          id={`modal-${this.props.id}`}\r\n          key={`modal-${this.props.id}`}\r\n        />\r\n      </div>\r\n    );\r\n  }\r\n}\r\nZebulonTable.prototype[\"getState\"] = function() {\r\n  return this.state;\r\n};\r\n","// import React from \"react\";\r\nimport { Observable } from \"rx-lite\";\r\n// import { getMockDatasource } from \"./mock\";\r\nimport { filtersFunction, sortsFunction } from \"../table/utils/filters.sorts\";\r\n// import { computeData } from \"../table/utils/compute.data\";\r\nimport { utils } from \"zebulon-controls\";\r\nimport { thirdparties } from \"./thirdparties\";\r\nimport { getUpdatedRows } from \"../table/utils/utils\";\r\n// import { computeAudit } from \"./dataset.functions\";\r\n// -------------------------------------------\r\n// simulation of the different ways to provide\r\n// a dataset to the table and server communication\r\n// -------------------------------------------\r\n// array\r\n// -------------------------------------------\r\nexport const countries = [\r\n\t{ id: 0, code: \"FR\", label: \"France\", currency_id: 0, vat: 0.2 },\r\n\t{ id: 1, code: \"GB\", label: \"United kingdom\", currency_id: 1, vat: 0.15 },\r\n\t{\r\n\t\tid: 2,\r\n\t\tcode: \"US\",\r\n\t\tlabel: \"United states of America\",\r\n\t\tcurrency_id: 2,\r\n\t\tvat: 0.05\r\n\t},\r\n\t{ id: 3, code: \"CA\", label: \"Canada\", currency_id: 3, vat: 0.12 },\r\n\t{ id: 4, code: \"CN\", label: \"China\", currency_id: 4, vat: 0.3 },\r\n\t{ id: 5, code: \"IT\", label: \"Italy\", currency_id: 0, vat: 0.15 },\r\n\t{ id: 6, code: \"DE\", label: \"Germany\", currency_id: 0, vat: 0.17 },\r\n\t{ id: 7, code: \"BE\", label: \"Belgium\", currency_id: 0, vat: 0.2 },\r\n\t{ id: 8, code: \"IE\", label: \"Ireland\", currency_id: 0, vat: 0.15 },\r\n\t{ id: 9, code: \"ES\", label: \"Spain\", currency_id: 0, vat: 0.15 },\r\n\t{ id: 10, code: \"NL\", label: \"Netherland\", currency_id: 0, vat: 0.18 },\r\n\t{ id: 11, code: \"JP\", label: \"Japan\", currency_id: 5, vat: 0.25 },\r\n\t{ id: 11, code: \"CH\", label: \"Switzerland\", currency_id: 6, vat: 0.1 }\r\n].reduce((acc, country) => {\r\n\tcountry.pk_ = country.id;\r\n\tcountry.caption = country.code;\r\n\tacc[country.id] = country;\r\n\treturn acc;\r\n}, {});\r\nexport const getCountries = () => countries;\r\nexport const currencies = [\r\n\t{ id: 0, code: \"EUR\", label: \"Euro\", symbol: \"€\", rate: 1 },\r\n\t{ id: 1, code: \"GBP\", label: \"British pound\", symbol: \"£\", rate: 0.88 },\r\n\t{ id: 2, code: \"USD\", label: \"US dollar\", symbol: \"$\", rate: 1.24 },\r\n\t{ id: 3, code: \"CAD\", label: \"Canadian dollar\", symbol: \"ca$\", rate: 1.53 },\r\n\t{ id: 4, code: \"CNY\", label: \"Yuan\", symbol: \"cn¥\", rate: 7.81 },\r\n\t{ id: 5, code: \"JPY\", label: \"Yen\", symbol: \"jp¥\", rate: 136 },\r\n\t{ id: 6, code: \"CHF\", label: \"Swiss franc\", symbol: \"Fr.\", rate: 1.15 }\r\n].reduce((acc, currency) => {\r\n\tcurrency.pk_ = currency.id;\r\n\tcurrency.caption = currency.code;\r\n\tacc[currency.id] = currency;\r\n\treturn acc;\r\n}, {});\r\nexport const getCurrencies = () => {\r\n\treturn new Promise(resolve => resolve(currencies));\r\n};\r\n\r\nexport const shapes = [\r\n\t\"square\",\r\n\t\"cube\",\r\n\t\"rectangle\",\r\n\t\"hexagon\",\r\n\t\"octogon\",\r\n\t\"circle\",\r\n\t\"cube\",\r\n\t\"disc\",\r\n\t\"triangle\",\r\n\t\"pyramid\"\r\n];\r\nexport const sizes = [\"extra small\", \"small\", \"normal\", \"large\", \"extra large\"];\r\nexport const colors = [\r\n\t\"blue\",\r\n\t\"yellow\",\r\n\t\"red\",\r\n\t\"green\",\r\n\t\"cyan\",\r\n\t\"magenta\",\r\n\t\"orange\",\r\n\t\"purple\",\r\n\t\"white\",\r\n\t\"pink\",\r\n\t\"grey\",\r\n\t\"black\"\r\n];\r\nexport const getColors = () => {\r\n\treturn new Promise(resolve => resolve(colors));\r\n};\r\n\r\nexport const products = {};\r\nfor (let i = 0; i < 200; i++) {\r\n\tproducts[i] = {\r\n\t\tpk_: i,\r\n\t\tid: i,\r\n\t\tlabel: `Product ${i}`,\r\n\t\tcaption: `Product ${i}`,\r\n\t\tshape: shapes[Math.ceil(Math.random() * (shapes.length - 1.001))],\r\n\t\tsize: sizes[Math.ceil(Math.random() * (sizes.length - 1.001))],\r\n\t\tprice: 100 * Math.random() + 50,\r\n\t\tcurrency_id: 0,\r\n\t\tcurrency_sym: \"€\"\r\n\t};\r\n}\r\nexport const getProducts = () => {\r\n\treturn new Promise(resolve => resolve(products));\r\n};\r\n\r\nconst users = [\"Margote\", \"Pollux\", \"Zébulon\", \"Azalée\"];\r\nexport const getMockDataset = nRow => {\r\n\tconst timestamp = new Date().getTime();\r\n\tconst d = [];\r\n\taudits = {};\r\n\tconst thp = Object.values(thirdparties);\r\n\tfor (let i = 0; i < nRow; i++) {\r\n\t\tconst row = {};\r\n\t\tconst thp_ = thp[Math.floor(Math.random() * (thp.length - 0.001))];\r\n\t\trow.product_id = Math.floor(\r\n\t\t\tMath.random() * (Object.keys(products).length - 0.001)\r\n\t\t);\r\n\t\trow.id = i;\r\n\t\trow.country_id = Math.floor(\r\n\t\t\tMath.random() * (Object.keys(countries).length - 0.001)\r\n\t\t);\r\n\t\trow.currency_id = countries[row.country_id].currency_id;\r\n\t\trow.thirdparty_id = thp_.id;\r\n\t\trow.thirdparty_cd = thp_.cd;\r\n\t\trow.color = colors[Math.floor(Math.random() * (colors.length - 0.001))];\r\n\t\trow.qty = Math.round(1000 * Math.random()) + 125;\r\n\t\trow.d = new Date(\r\n\t\t\t2017 + Math.round(2 * Math.random()),\r\n\t\t\tMath.round(12 * Math.random()),\r\n\t\t\tMath.round(31 * Math.random())\r\n\t\t);\r\n\t\trow.timestamp_ = timestamp - Math.round(1000000 * Math.random());\r\n\t\td.push(row);\r\n\t\taudits[i] = [\r\n\t\t\t{\r\n\t\t\t\tuser_: users[Math.round(4 * Math.random() - 0.0001)],\r\n\t\t\t\ttimestamp_: timestamp,\r\n\t\t\t\tstatus_: \"new\"\r\n\t\t\t}\r\n\t\t];\r\n\t}\r\n\treturn {\r\n\t\tdata: d,\r\n\t\tcurrencies: getCurrencies(),\r\n\t\tcountries: getCountries(),\r\n\t\tproducts: getProducts(),\r\n\t\tshapes,\r\n\t\tsizes,\r\n\t\tcolors: getColors()\r\n\t};\r\n};\r\nexport let serverData;\r\nexport let audits = {};\r\nexport const dataPk = {};\r\nexport const get_array = ({ params, meta, filters, noJoins }) => {\r\n\tif (!serverData) {\r\n\t\tserverData = getMockDataset(25000).data;\r\n\t\t// this is necessary only because for demo, we are using the same filters and sorts functions as the client\r\n\t\t// to simulate server actions\r\n\t\tserverData.forEach((row, index) => {\r\n\t\t\trow.product = products[row.product_id];\r\n\t\t\trow.country = countries[row.country_id];\r\n\t\t\trow.currency = currencies[row.currency_id];\r\n\t\t\trow.rowId_ = index;\r\n\t\t\tdataPk[row.id] = index;\r\n\t\t});\r\n\t}\r\n\r\n\tconst r = JSON.parse(\r\n\t\tJSON.stringify(serverData.filter(row => !row.deleted_))\r\n\t);\r\n\tif (noJoins) {\r\n\t\tr.forEach(row => {\r\n\t\t\tdelete row.product;\r\n\t\t\tdelete row.country;\r\n\t\t\tdelete row.currency;\r\n\t\t});\r\n\t}\r\n\tconsole.log(\"array\", r === serverData, r.length, serverData.length, r);\r\n\treturn r;\r\n};\r\n// -------------------------------------------\r\n// promise\r\n// -------------------------------------------\r\nexport const get_promise = ({ params, meta, filters }) => {\r\n\treturn new Promise(resolve => {\r\n\t\tlet data_ = get_array({ params, filters });\r\n\t\tconsole.log(\"promise\", data_.length, serverData.length);\r\n\t\t// if the filters are applied on the server data:\r\n\t\tif (filters) {\r\n\t\t\tdata_ = data_\r\n\t\t\t\t.filter(filtersFunction(filters, params, data_))\r\n\t\t\t\t.map(row => ({ ...row }));\r\n\t\t}\r\n\t\tresolve(data_);\r\n\t});\r\n};\r\n// -------------------------------------------\r\n// observable\r\n// -------------------------------------------\r\nexport const get_observable = ({ params, meta, filters, sorts }) => {\r\n\tconst data_ = get_array({ params, filters });\r\n\tif (sorts) {\r\n\t\tdata_.sort(sortsFunction(sorts));\r\n\t}\r\n\tconst data2 = [];\r\n\tlet i = 0;\r\n\twhile (i < data_.length) {\r\n\t\tdata2.push(data_.slice(i, (i += 1000)));\r\n\t}\r\n\t// console.log(\"observable\", i);\r\n\treturn Observable.interval(20)\r\n\t\t.take(data2.length)\r\n\t\t.map(i => {\r\n\t\t\t// console.log(\"observable1\", i, data2.length);\r\n\t\t\treturn data2[i];\r\n\t\t});\r\n};\r\n\r\n// -------------------------------------------\r\n// pagination manager\r\n// -------------------------------------------\r\nexport const get_pagination_manager = e => {\r\n\t// --------------------------------\r\n\t// Simulation of a  server dataset:\r\n\t// --------------------------------\r\n\tconst data = get_array({});\r\n\t// create a primary key and create an index on the primary key\r\n\tconst dataIndex = {};\r\n\tdata.forEach((row, index) => {\r\n\t\trow.index_ = `id${index}`;\r\n\t\tdataIndex[`id${index}`] = index;\r\n\t});\r\n\tconst pageLength = 100;\r\n\t//  initial data, filters and sorts\r\n\tlet filteredData;\r\n\tlet { filters, sorts, params, startIndex, stopIndex } = e;\r\n\tlet lastTimeStamp = new Date().getTime();\r\n\tif (filters) {\r\n\t\tfilteredData = data.filter(filtersFunction(filters, params, data, {}));\r\n\t} else {\r\n\t\tfilteredData = data.map(row => row);\r\n\t}\r\n\t// data must not be sorted to keep valid index\r\n\tif (sorts) {\r\n\t\tfilteredData.sort(sortsFunction(sorts));\r\n\t}\r\n\t// apply updated data on data to keep consistent sorts and filters\r\n\tconst update = updatedRows => {\r\n\t\tlet timeStamp = lastTimeStamp,\r\n\t\t\tupdated = false;\r\n\t\tgetUpdatedRows(updatedRows).forEach(status => {\r\n\t\t\tif (status.timeStamp > lastTimeStamp) {\r\n\t\t\t\tconst row = status.rowUpdated;\r\n\t\t\t\tif (dataIndex[row.index_] === undefined) {\r\n\t\t\t\t\tdataIndex[row.index_] = data.length;\r\n\t\t\t\t\tdata.push(row);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tconst previousRow = data[dataIndex[row.index_]];\r\n\t\t\t\t\tObject.keys(row).forEach(key => {\r\n\t\t\t\t\t\tif (\r\n\t\t\t\t\t\t\tutils.isDate(previousRow[key]) &&\r\n\t\t\t\t\t\t\ttypeof row[key] === \"string\"\r\n\t\t\t\t\t\t) {\r\n\t\t\t\t\t\t\tpreviousRow[key] = new Date(row[key]);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tpreviousRow[key] = row[key];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\t// data[dataIndex[key]] = row;\r\n\t\t\t\t}\r\n\t\t\t\ttimeStamp = Math.max(timeStamp, status.timeStamp);\r\n\t\t\t}\r\n\t\t});\r\n\t\tupdated = lastTimeStamp !== timeStamp;\r\n\t\tlastTimeStamp = timeStamp;\r\n\t\treturn updated;\r\n\t};\r\n\t// sorts\r\n\tconst sort = sorts => {\r\n\t\tif (sorts.length) {\r\n\t\t\tfilteredData.sort(sortsFunction(sorts));\r\n\t\t} else if (filters) {\r\n\t\t\tfilteredData = data.filter(\r\n\t\t\t\tfiltersFunction(filters, params, data, {})\r\n\t\t\t);\r\n\t\t}\r\n\t};\r\n\t// filters\r\n\tconst filter = filters => {\r\n\t\tif (Object.keys(filters).length) {\r\n\t\t\tfilteredData = data.filter(\r\n\t\t\t\tfiltersFunction(filters, params, data, {})\r\n\t\t\t);\r\n\t\t} else {\r\n\t\t\tfilteredData = data.map(row => row);\r\n\t\t\tif (sorts) {\r\n\t\t\t\tfilteredData.sort(sortsFunction(sorts));\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\tconst paginationManager = page => {\r\n\t\tlet updated = false;\r\n\t\tif (page.updatedRows) {\r\n\t\t\tupdated = update(page.updatedRows);\r\n\t\t}\r\n\t\tif (page.filters) {\r\n\t\t\tfilter(page.filters);\r\n\t\t\tfilters = page.filters;\r\n\t\t} else if (updated && filters) {\r\n\t\t\tfilter(filters);\r\n\t\t}\r\n\t\tif (page.sorts) {\r\n\t\t\tsort(page.sorts);\r\n\t\t\tsorts = page.sorts;\r\n\t\t} else if (updated && sorts) {\r\n\t\t\tsort(sorts);\r\n\t\t}\r\n\t\tconst filteredDataLength = filteredData.length;\r\n\t\tlet start =\r\n\t\t\t\tpage.startIndex === undefined ? startIndex : page.startIndex,\r\n\t\t\tstop = page.stopIndex === undefined ? stopIndex : page.stopIndex,\r\n\t\t\tpageStartIndex;\r\n\r\n\t\tif (start >= filteredDataLength) {\r\n\t\t\tstart = 0;\r\n\t\t}\r\n\t\tpageStartIndex = start - (start % pageLength);\r\n\t\tif (stop >= pageStartIndex + pageLength) {\r\n\t\t\tpageStartIndex = Math.max(0, start - 10);\r\n\t\t}\r\n\t\tif (pageStartIndex + pageLength >= filteredDataLength) {\r\n\t\t\tpageStartIndex = Math.max(0, filteredDataLength - pageLength);\r\n\t\t\t// startIndex == index - pageStartIndex;\r\n\t\t}\r\n\t\tconst pageData = JSON.parse(\r\n\t\t\tJSON.stringify(\r\n\t\t\t\tfilteredData.slice(pageStartIndex, pageStartIndex + pageLength)\r\n\t\t\t)\r\n\t\t);\r\n\t\tstartIndex = start;\r\n\t\tstopIndex = stop;\r\n\t\treturn new Promise(resolve => setTimeout(resolve, 20)).then(() => {\r\n\t\t\treturn {\r\n\t\t\t\tpage: pageData,\r\n\t\t\t\tpageStartIndex,\r\n\t\t\t\tpageLength: Math.min(filteredDataLength, pageLength),\r\n\t\t\t\tfilteredDataLength,\r\n\t\t\t\tdataLength: data.length\r\n\t\t\t};\r\n\t\t});\r\n\t};\r\n\r\n\treturn new Promise(resolve => setTimeout(resolve, 20)).then(\r\n\t\t() => paginationManager\r\n\t);\r\n};\r\n","import React, { Component } from \"react\";\r\nimport { ZebulonTable } from \"../table/ZebulonTable\";\r\n// import { functions } from \"../table/MetaDescriptions\";\r\nimport { utils } from \"zebulon-controls\";\r\nimport { filtersFunction } from \"../table/utils/filters.sorts\";\r\nexport const get_thp = ({ params, meta, filters }) => {\r\n\tlet data = Object.values(thirdparties);\r\n\tif (filters) {\r\n\t\tdata = data.filter(filtersFunction(filters, params, data));\r\n\t}\r\n\treturn new Promise(resolve => resolve(data));\r\n};\r\n// export const thirdparty = id => thirdparties[id];\r\nexport const metaThirdparties = {\r\n\ttable: {\r\n\t\tobject: \"thirdparties\",\r\n\t\tselect: get_thp,\r\n\t\tfilteredByServer: true,\r\n\t\tprimaryKey: \"id\",\r\n\t\tcaption: \"Thirdparties\",\r\n\t\tactions: [\r\n\t\t\t{ type: \"insert\", caption: \"New\", enable: true },\r\n\t\t\t{\r\n\t\t\t\ttype: \"delete\",\r\n\t\t\t\tcaption: \"Delete\",\r\n\t\t\t\tenable: \"is_selected\"\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\ttype: \"duplicate\",\r\n\t\t\t\tcaption: \"Duplicate\",\r\n\t\t\t\tenable: \"is_selected\"\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\ttype: \"save\",\r\n\t\t\t\tcaption: \"Save\",\r\n\t\t\t\tenable: true\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\ttype: \"refresh\",\r\n\t\t\t\tcaption: \"Refresh\",\r\n\t\t\t\tenable: true\r\n\t\t\t}\r\n\t\t]\r\n\t},\r\n\trow: {\r\n\t\taudit: undefined //\"audit\"\r\n\t},\r\n\tproperties: [\r\n\t\t{\r\n\t\t\tid: \"id\",\r\n\t\t\tdataType: \"number\",\r\n\t\t\tmandatory: true,\r\n\t\t\thidden: true\r\n\t\t},\r\n\t\t{\r\n\t\t\tid: \"cd\",\r\n\t\t\tcaption: \"Code\",\r\n\t\t\twidth: 100,\r\n\t\t\tdataType: \"string\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tid: \"lb\",\r\n\t\t\tcaption: \"Name\",\r\n\t\t\twidth: 1100,\r\n\t\t\tdataType: \"string\"\r\n\t\t}\r\n\t]\r\n};\r\nexport const getThirdparty = id => thirdparties[id];\r\nexport const thirdparties = [\r\n\t{\r\n\t\tid: 4936,\r\n\t\tcd: \"FRC$F\",\r\n\t\tlb:\r\n\t\t\t\"FIRST REPUBLIC BANK Depositary Shares, each representing a 1/40th interest in a share of 5.70% Noncumulative Perpetual Series F Preferred Stock\"\r\n\t},\r\n\t{ id: 1303, cd: \"GTXI\", lb: \"GTx, Inc. - Common Stock\" },\r\n\t{ id: 4717, cd: \"EVRI\", lb: \"Everi Holdings Inc. Common Stock\" },\r\n\t{\r\n\t\tid: 3836,\r\n\t\tcd: \"CBO\",\r\n\t\tlb: \"CBO (Listing Market - NYSE - Networks A/E) Common Stock\"\r\n\t},\r\n\t{ id: 905, cd: \"EFUT\", lb: \"eFuture Holding Inc. - Ordinary Shares\" },\r\n\t{\r\n\t\tid: 1680,\r\n\t\tcd: \"LIND\",\r\n\t\tlb: \"Lindblad Expeditions Holdings Inc.  - Common Stock\"\r\n\t},\r\n\t{ id: 135, cd: \"AMAT\", lb: \"Applied Materials, Inc. - Common Stock\" },\r\n\t{\r\n\t\tid: 5191,\r\n\t\tcd: \"GS$I\",\r\n\t\tlb: \"Goldman Sachs Group, Inc. (The) Perpetual Preferred Series I\"\r\n\t},\r\n\t{ id: 2212, cd: \"PHII\", lb: \"PHI, Inc. - Voting Common Stock\" },\r\n\t{\r\n\t\tid: 1952,\r\n\t\tcd: \"NEPT\",\r\n\t\tlb: \"Neptune Technologies & Bioresources Inc - Ordinary Shares\"\r\n\t},\r\n\t{\r\n\t\tid: 3116,\r\n\t\tcd: \"ZAIS\",\r\n\t\tlb: \"ZAIS Group Holdings, Inc. - Class A Common Stock\"\r\n\t},\r\n\t{\r\n\t\tid: 162,\r\n\t\tcd: \"AMTD\",\r\n\t\tlb: \"TD Ameritrade Holding Corporation - Common Stock\"\r\n\t},\r\n\t{\r\n\t\tid: 5003,\r\n\t\tcd: \"GAB$D\",\r\n\t\tlb: \"Gabelli Equity Trust, Inc. (The) Preferred Stock Series D\"\r\n\t},\r\n\t{ id: 3878, cd: \"CEMB\", lb: \"iShares Emerging Markets Corporate Bond ETF\" },\r\n\t{ id: 5087, cd: \"GHM\", lb: \"Graham Corporation Common Stock\" },\r\n\t{\r\n\t\tid: 2067,\r\n\t\tcd: \"OHAI\",\r\n\t\tlb: \"OHA Investment Corporation - Closed End Fund\"\r\n\t},\r\n\t{\r\n\t\tid: 4821,\r\n\t\tcd: \"FEI\",\r\n\t\tlb:\r\n\t\t\t\"First Trust MLP and Energy Income Fund Common Shares of Beneficial Interest\"\r\n\t},\r\n\t{ id: 1589, cd: \"JUNO\", lb: \"Juno Therapeutics, Inc. - Common Stock\" },\r\n\t{ id: 2168, cd: \"PCCC\", lb: \"PC Connection, Inc. - Common Stock\" },\r\n\t{ id: 4498, cd: \"EFU\", lb: \"ProShares UltraShort MSCI EAFE\" },\r\n\t{ id: 1832, cd: \"MIDD\", lb: \"The Middleby Corporation - Common Stock\" },\r\n\t{\r\n\t\tid: 4253,\r\n\t\tcd: \"DEZU\",\r\n\t\tlb: \"iShares Adaptive Currency Hedged MSCI Eurozone ETF\"\r\n\t},\r\n\t{ id: 35, cd: \"ACLS\", lb: \"Axcelis Technologies, Inc. - Common Stock\" },\r\n\t{ id: 1192, cd: \"FYX\", lb: \"First Trust Small Cap Core AlphaDEX Fund\" },\r\n\t{ id: 5661, cd: \"IRL\", lb: \"New Ireland Fund, Inc (The) Common Stock\" },\r\n\t{\r\n\t\tid: 3347,\r\n\t\tcd: \"AMID\",\r\n\t\tlb:\r\n\t\t\t\"American Midstream Partners, LP Common Units representing Limited Partner Interests\"\r\n\t},\r\n\t{ id: 2145, cd: \"PACEU\", lb: \"Pace Holdings Corp. - Unit\" },\r\n\t{ id: 2023, cd: \"NVTR\", lb: \"Nuvectra Corporation - Common Stock\" },\r\n\t{ id: 4453, cd: \"ECNS\", lb: \"iShares MSCI China Small-Cap ETF\" },\r\n\t{ id: 507, cd: \"CEMI\", lb: \"Chembio Diagnostics, Inc. - Common Stock\" },\r\n\t{\r\n\t\tid: 2143,\r\n\t\tcd: \"PACB\",\r\n\t\tlb: \"Pacific Biosciences of California, Inc. - Common Stock\"\r\n\t},\r\n\t{ id: 2511, cd: \"SCZ\", lb: \"iShares MSCI EAFE Small-Cap ETF\" },\r\n\t{ id: 1882, cd: \"MRTN\", lb: \"Marten Transport, Ltd. - Common Stock\" },\r\n\t{ id: 1457, cd: \"IFON\", lb: \"InfoSonics Corp - Common Stock\" },\r\n\t{ id: 5008, cd: \"GAL\", lb: \"SPDR SSgA Global Allocation ETF\" },\r\n\t{\r\n\t\tid: 2690,\r\n\t\tcd: \"STPP\",\r\n\t\tlb: \"Barclays PLC - iPath US Treasury Steepener ETN\"\r\n\t},\r\n\t{ id: 713, cd: \"CTBI\", lb: \"Community Trust Bancorp, Inc. - Common Stock\" },\r\n\t{ id: 932, cd: \"EMITF\", lb: \"Elbit Imaging Ltd. - Ordinary Shares\" },\r\n\t{\r\n\t\tid: 4258,\r\n\t\tcd: \"DFP\",\r\n\t\tlb:\r\n\t\t\t\"Flaherty & Crumrine Dynamic Preferred and Income Fund Inc. Common Stock\"\r\n\t},\r\n\t{\r\n\t\tid: 3357,\r\n\t\tcd: \"AMT$B\",\r\n\t\tlb:\r\n\t\t\t\"American Tower Corporation (REIT) Depositary Shares, each representing a 1/10th ownership interest in a share of 5.50% Mandatory Convertible Preferred Stock, Series B\"\r\n\t},\r\n\t{ id: 4392, cd: \"DV\", lb: \"DeVry Education Group Inc. Common Stock\" },\r\n\t{\r\n\t\tid: 3488,\r\n\t\tcd: \"AXL\",\r\n\t\tlb: \"American Axle & Manufacturing Holdings, Inc. Common Stock\"\r\n\t},\r\n\t{\r\n\t\tid: 3968,\r\n\t\tcd: \"CLYH\",\r\n\t\tlb: \"iShares Interest Rate Hedged 10  Year Credit Bond ETF\"\r\n\t},\r\n\t{ id: 4129, cd: \"CUPM\", lb: \"iPath Pure Beta Copper ETN\" },\r\n\t{ id: 5714, cd: \"IWC\", lb: \"iShares Microcap ETF\" },\r\n\t{ id: 3382, cd: \"AON\", lb: \"Aon plc Class A Ordinary Shares (UK)\" },\r\n\t{ id: 4952, cd: \"FSTA\", lb: \"Fidelity MSCI COnsumer Staples Index ETF\" },\r\n\t{ id: 223, cd: \"ARWAR\", lb: \"Arowana Inc. - Rights\" },\r\n\t{ id: 3419, cd: \"ARL\", lb: \"American Realty Investors, Inc. Common Stock\" },\r\n\t{ id: 4063, cd: \"CRBN\", lb: \"iShares MSCI ACWI Low Carbon Target ETF\" },\r\n\t{\r\n\t\tid: 2070,\r\n\t\tcd: \"OIIM\",\r\n\t\tlb:\r\n\t\t\t\"O2Micro International Limited - Ordinary Shares each 50 shares of which are represented by an American Depositary Share\"\r\n\t},\r\n\t{\r\n\t\tid: 4366,\r\n\t\tcd: \"DSL\",\r\n\t\tlb:\r\n\t\t\t\"DoubleLine Income Solutions Fund Common Shares of Beneficial Interests\"\r\n\t},\r\n\t{\r\n\t\tid: 2078,\r\n\t\tcd: \"OMAB\",\r\n\t\tlb:\r\n\t\t\t\"Grupo Aeroportuario del Centro Norte S.A.B. de C.V. - American Depositary Shares each representing 8 Series B shares\"\r\n\t},\r\n\t{\r\n\t\tid: 1335,\r\n\t\tcd: \"HCAPL\",\r\n\t\tlb: \"Harvest Capital Credit Corporation - 7.00% Notes due 2020\"\r\n\t},\r\n\t{ id: 1992, cd: \"NTAP\", lb: \"NetApp, Inc. - Common Stock\" },\r\n\t{ id: 799, cd: \"DGRW\", lb: \"WisdomTree U.S. Quality Dividend Growth Fund\" },\r\n\t{ id: 3419, cd: \"ARL\", lb: \"American Realty Investors, Inc. Common Stock\" },\r\n\t{\r\n\t\tid: 2915,\r\n\t\tcd: \"UVSP\",\r\n\t\tlb: \"Univest Corporation of Pennsylvania - Common Stock\"\r\n\t},\r\n\t{ id: 1933, cd: \"NBIX\", lb: \"Neurocrine Biosciences, Inc. - Common Stock\" },\r\n\t{ id: 1934, cd: \"NBN\", lb: \"Northeast Bancorp - Common Stock\" },\r\n\t{\r\n\t\tid: 3805,\r\n\t\tcd: \"CACI\",\r\n\t\tlb: \"CACI International, Inc. Class A Common Stock\"\r\n\t},\r\n\t{\r\n\t\tid: 4925,\r\n\t\tcd: \"FPT\",\r\n\t\tlb:\r\n\t\t\t\"Federated Premier Intermediate Municipal Income Fund Federated Premier Intermediate Municipal Income Fund\"\r\n\t},\r\n\t{ id: 1932, cd: \"NAVI\", lb: \"Navient Corporation - Common Stock\" },\r\n\t{ id: 2516, cd: \"SELB\", lb: \"Selecta Biosciences, Inc. - Common Stock\" },\r\n\t{\r\n\t\tid: 1320,\r\n\t\tcd: \"HBAN\",\r\n\t\tlb: \"Huntington Bancshares Incorporated - Common Stock\"\r\n\t},\r\n\t{ id: 199, cd: \"ARCB\", lb: \"ArcBest Corporation - Common Stock\" },\r\n\t{ id: 3561, cd: \"BCO\", lb: \"Brinks Company (The) Common Stock\" },\r\n\t{\r\n\t\tid: 2072,\r\n\t\tcd: \"OILU\",\r\n\t\tlb: \"AccuShares S&P GSCI Crude Oil Excess Return Up Shares\"\r\n\t},\r\n\t{ id: 73, cd: \"AEHR\", lb: \"Aehr Test Systems - Common Stock\" },\r\n\t{\r\n\t\tid: 3278,\r\n\t\tcd: \"AHT$F\",\r\n\t\tlb:\r\n\t\t\t\"Ashford Hospitality Trust Inc 7.375% Series F Cumulative Preferred Stock\"\r\n\t},\r\n\t{ id: 2109, cd: \"ORLY\", lb: \"O'Reilly Automotive, Inc. - Common Stock\" },\r\n\t{ id: 3699, cd: \"BPT\", lb: \"BP Prudhoe Bay Royalty Trust Common Stock\" },\r\n\t{ id: 3996, cd: \"CNDA\", lb: \"IQ Canada Small Cap ETF\" },\r\n\t{ id: 3966, cd: \"CLX\", lb: \"Clorox Company (The) Common Stock\" },\r\n\t{ id: 317, cd: \"BELFB\", lb: \"Bel Fuse Inc. - Class B Common Stock\" },\r\n\t{ id: 3620, cd: \"BHP\", lb: \"BHP Billiton Limited Common Stock\" },\r\n\t{ id: 3859, cd: \"CCS\", lb: \"Century Communities, Inc. Common Stock\" },\r\n\t{ id: 1300, cd: \"GTIM\", lb: \"Good Times Restaurants Inc. - Common Stock\" },\r\n\t{\r\n\t\tid: 5573,\r\n\t\tcd: \"IIM\",\r\n\t\tlb: \"Invesco Value Municipal Income Trust Common Stock\"\r\n\t},\r\n\t{ id: 1202, cd: \"GALTW\", lb: \"Galectin Therapeutics Inc. - Warrants\" },\r\n\t{ id: 1993, cd: \"NTCT\", lb: \"NetScout Systems, Inc. - Common Stock\" },\r\n\t{ id: 3375, cd: \"ANTX\", lb: \"Anthem, Inc. Corporate Units\" },\r\n\t{ id: 5594, cd: \"IMS\", lb: \"IMS Health Holdings, Inc. Common Stock\" },\r\n\t{\r\n\t\tid: 5671,\r\n\t\tcd: \"ISF\",\r\n\t\tlb: \"ING Group, N.V. Perp Hybrid Cap Secs (Netherlands)\"\r\n\t},\r\n\t{\r\n\t\tid: 2082,\r\n\t\tcd: \"OMEX\",\r\n\t\tlb: \"Odyssey Marine Exploration, Inc. - Common Stock\"\r\n\t},\r\n\t{ id: 2215, cd: \"PI\", lb: \"Impinj, Inc. - Common Stock\" },\r\n\t{ id: 5416, cd: \"HST\", lb: \"Host Hotels & Resorts, Inc. Common Stock\" },\r\n\t{ id: 3808, cd: \"CAFE\", lb: \"iPath Pure Beta Coffee ETN\" },\r\n\t{\r\n\t\tid: 3831,\r\n\t\tcd: \"CBL\",\r\n\t\tlb: \"CBL & Associates Properties, Inc. Common Stock\"\r\n\t},\r\n\t{\r\n\t\tid: 2223,\r\n\t\tcd: \"PLAY\",\r\n\t\tlb: \"Dave & Buster's Entertainment, Inc. - Common Stock\"\r\n\t},\r\n\t{\r\n\t\tid: 342,\r\n\t\tcd: \"BKEPP\",\r\n\t\tlb: \"Blueknight Energy Partners L.P., L.L.C. - Series A Preferred Units\"\r\n\t},\r\n\t{ id: 580, cd: \"CIVB\", lb: \"Civista Bancshares, Inc.  - Common Stock\" },\r\n\t{\r\n\t\tid: 602,\r\n\t\tcd: \"CLNT\",\r\n\t\tlb: \"Cleantech Solutions International, Inc. - Common Stock\"\r\n\t},\r\n\t{ id: 393, cd: \"BREW\", lb: \"Craft Brew Alliance, Inc. - Common Stock\" },\r\n\t{ id: 5277, cd: \"HCA\", lb: \"HCA Holdings, Inc. Common Stock\" },\r\n\t{\r\n\t\tid: 5577,\r\n\t\tcd: \"IJNK\",\r\n\t\tlb: \"SPDR Barclays International High Yield Bond ETF\"\r\n\t},\r\n\t{ id: 1607, cd: \"KHC\", lb: \"The Kraft Heinz Company - Common Stock\" },\r\n\t{\r\n\t\tid: 4637,\r\n\t\tcd: \"EQWL\",\r\n\t\tlb: \"PowerShares Russell Top 200 Equal Weight Portfolio\"\r\n\t},\r\n\t{ id: 5711, cd: \"IVW\", lb: \"iShares S&P 500 Growth ETF\" },\r\n\t{ id: 556, cd: \"CHMA\", lb: \"Chiasma, Inc. - Common Stock\" },\r\n\t{\r\n\t\tid: 2319,\r\n\t\tcd: \"PZZA\",\r\n\t\tlb: \"Papa John's International, Inc. - Common Stock\"\r\n\t},\r\n\t{ id: 1028, cd: \"FCAN\", lb: \"First Trust Canada AlphaDEX Fund\" },\r\n\t{ id: 212, cd: \"ARLZ\", lb: \"Aralez Pharmaceuticals Inc. - Common Shares\" },\r\n\t{ id: 1112, cd: \"FNJN\", lb: \"Finjan Holdings, Inc. - Common Stock\" },\r\n\t{\r\n\t\tid: 5118,\r\n\t\tcd: \"GLP\",\r\n\t\tlb:\r\n\t\t\t\"Global Partners LP Global Partners LP Common Units representing Limited Partner Interests\"\r\n\t},\r\n\t{ id: 5617, cd: \"INST\", lb: \"Instructure, Inc. Common Stock\" },\r\n\t{ id: 3991, cd: \"CMU\", lb: \"MFS Municipal Income Trust Common Stock\" },\r\n\t{ id: 1010, cd: \"FAD\", lb: \"First Trust Multi Cap Growth AlphaDEX Fund\" },\r\n\t{ id: 164, cd: \"AMWD\", lb: \"American Woodmark Corporation - Common Stock\" },\r\n\t{\r\n\t\tid: 1715,\r\n\t\tcd: \"LONE\",\r\n\t\tlb: \"Lonestar Resources US Inc. - Class A Common Stock\"\r\n\t},\r\n\t{ id: 5647, cd: \"IPOS\", lb: \"Renaissance Capital Greenwich Fund\" },\r\n\t{ id: 2385, cd: \"RELL\", lb: \"Richardson Electronics, Ltd. - Common Stock\" },\r\n\t{ id: 1375, cd: \"HOFT\", lb: \"Hooker Furniture Corporation - Common Stock\" },\r\n\t{\r\n\t\tid: 4088,\r\n\t\tcd: \"CSH\",\r\n\t\tlb: \"Cash America International, Inc. Common Stock\"\r\n\t},\r\n\t{ id: 2602, cd: \"SNAK\", lb: \"Inventure Foods, Inc. - Common Stock\" },\r\n\t{\r\n\t\tid: 1404,\r\n\t\tcd: \"HTGM\",\r\n\t\tlb: \"HTG Molecular Diagnostics, Inc. - Common Stock\"\r\n\t},\r\n\t{ id: 1202, cd: \"GALTW\", lb: \"Galectin Therapeutics Inc. - Warrants\" },\r\n\t{\r\n\t\tid: 679,\r\n\t\tcd: \"CREG\",\r\n\t\tlb: \"China Recycling Energy Corporation - Common Stock\"\r\n\t},\r\n\t{ id: 5174, cd: \"GRF\", lb: \"Eagle Capital Growth Fund, Inc. Common Stock\" },\r\n\t{\r\n\t\tid: 4088,\r\n\t\tcd: \"CSH\",\r\n\t\tlb: \"Cash America International, Inc. Common Stock\"\r\n\t},\r\n\t{ id: 4809, cd: \"FDC\", lb: \"First Data Corporation Class A Common Stock\" },\r\n\t{ id: 5493, cd: \"IBMF\", lb: \"iShares iBonds Sep 2017 Term Muni Bond ETF\" },\r\n\t{ id: 2410, cd: \"RLJE\", lb: \"RLJ Entertainment, Inc. - Common Stock\" },\r\n\t{ id: 2365, cd: \"RBCN\", lb: \"Rubicon Technology, Inc. - Common Stock\" },\r\n\t{ id: 4396, cd: \"DVHI\", lb: \"ETRACS Diversified High Income ETN\" },\r\n\t{\r\n\t\tid: 4371,\r\n\t\tcd: \"DSUM\",\r\n\t\tlb: \"PowerShares Chinese Yuan Dim Sum Bond Portfolio\"\r\n\t},\r\n\t{ id: 355, cd: \"BLRX\", lb: \"BioLineRx Ltd. - American Depositary Shares\" },\r\n\t{ id: 2173, cd: \"PCOM\", lb: \"Points International, Ltd. - Common Shares\" },\r\n\t{\r\n\t\tid: 257,\r\n\t\tcd: \"ATSG\",\r\n\t\tlb: \"Air Transport Services Group, Inc - Common Stock\"\r\n\t},\r\n\t{\r\n\t\tid: 1175,\r\n\t\tcd: \"FTRPR\",\r\n\t\tlb:\r\n\t\t\t\"Frontier Communications Corporation - 11.125% Series A Mandatory Convertible Preferred Stock\"\r\n\t},\r\n\t{ id: 3806, cd: \"CAE\", lb: \"CAE Inc. Ordinary Shares\" },\r\n\t{ id: 3152, cd: \"AADR\", lb: \"WCM BNY Mellon Focused Growth ADR ETF\" },\r\n\t{ id: 3193, cd: \"ADM\", lb: \"Archer-Daniels-Midland Company Common Stock\" },\r\n\t{ id: 2314, cd: \"PXS\", lb: \"Pyxis Tankers Inc. - Common Stock\" },\r\n\t{ id: 1846, cd: \"MKTX\", lb: \"MarketAxess Holdings, Inc. - Common Stock\" },\r\n\t{\r\n\t\tid: 441,\r\n\t\tcd: \"CAPX\",\r\n\t\tlb: \"Elkhorn S&P 500 Capital Expenditures Portfolio\"\r\n\t},\r\n\t{\r\n\t\tid: 3517,\r\n\t\tcd: \"BAC$L\",\r\n\t\tlb:\r\n\t\t\t\"Bank of America Corporation Non Cumulative Perpetual Conv Pfd Ser L\"\r\n\t},\r\n\t{ id: 595, cd: \"CLDX\", lb: \"Celldex Therapeutics, Inc. - Common Stock\" },\r\n\t{\r\n\t\tid: 330,\r\n\t\tcd: \"BIDU\",\r\n\t\tlb:\r\n\t\t\t\"Baidu, Inc. - American Depositary Shares, each representing one tenth Class A ordinary share\"\r\n\t},\r\n\t{ id: 963, cd: \"ESEA\", lb: \"Euroseas Ltd. - Common Stock\" },\r\n\t{ id: 626, cd: \"CNFR\", lb: \"Conifer Holdings, Inc. - Common Stock\" },\r\n\t{ id: 5125, cd: \"GLW\", lb: \"Corning Incorporated Common Stock\" },\r\n\t{ id: 4579, cd: \"ENFR\", lb: \"Alerian Energy Infrastructure ETF\" },\r\n\t{ id: 2253, cd: \"PPH\", lb: \"VanEck Vectors Pharmaceutical ETF\" },\r\n\t{ id: 1973, cd: \"NILE\", lb: \"Blue Nile, Inc. - Common Stock\" },\r\n\t{\r\n\t\tid: 5454,\r\n\t\tcd: \"HYI\",\r\n\t\tlb:\r\n\t\t\t\"Western Asset High Yield Defined Opportunity Fund Inc. Common Stock\"\r\n\t},\r\n\t{ id: 1161, cd: \"FSZ\", lb: \"First Trust Switzerland AlphaDEX Fund\" },\r\n\t{ id: 2206, cd: \"PFPT\", lb: \"Proofpoint, Inc. - Common Stock\" },\r\n\t{ id: 2446, cd: \"RTK\", lb: \"Rentech, Inc. - Common Stock\" },\r\n\t{ id: 5606, cd: \"ING\", lb: \"ING Group, N.V. Common Stock\" },\r\n\t{ id: 1865, cd: \"MOBL\", lb: \"MobileIron, Inc. - Common Stock\" },\r\n\t{\r\n\t\tid: 89,\r\n\t\tcd: \"AGIIL\",\r\n\t\tlb:\r\n\t\t\t\"Argo Group International Holdings, Ltd. - 6.5% Senior Notes Due 2042\"\r\n\t},\r\n\t{ id: 2188, cd: \"PEGA\", lb: \"Pegasystems Inc. - Common Stock\" },\r\n\t{ id: 3125, cd: \"ZGNX\", lb: \"Zogenix, Inc. - Common Stock\" },\r\n\t{ id: 5326, cd: \"HEWW\", lb: \"iShares Currency Hedged MSCI Mexico ETF\" },\r\n\t{ id: 3190, cd: \"ADGE\", lb: \"American DG Energy Inc. Common Stock\" },\r\n\t{ id: 4543, cd: \"EMBB\", lb: \"SPDR MSCI EM Beyond BRIC ETF\" },\r\n\t{ id: 2332, cd: \"QLC\", lb: \"FlexShares US Quality Large Cap Index Fund\" },\r\n\t{ id: 2348, cd: \"QSII\", lb: \"Quality Systems, Inc. - Common Stock\" },\r\n\t{ id: 3911, cd: \"CHIQ\", lb: \"Global X China Consumer ETF\" },\r\n\t{\r\n\t\tid: 3347,\r\n\t\tcd: \"AMID\",\r\n\t\tlb:\r\n\t\t\t\"American Midstream Partners, LP Common Units representing Limited Partner Interests\"\r\n\t},\r\n\t{\r\n\t\tid: 3106,\r\n\t\tcd: \"YIN\",\r\n\t\tlb: \"Yintech Investment Holdings Limited - American Depositary Shares\"\r\n\t},\r\n\t{ id: 3019, cd: \"WEBK\", lb: \"Wellesley Bancorp, Inc. - Common Stock\" },\r\n\t{ id: 1625, cd: \"KOSS\", lb: \"Koss Corporation - Common Stock\" },\r\n\t{\r\n\t\tid: 4226,\r\n\t\tcd: \"DDLS\",\r\n\t\tlb:\r\n\t\t\t\"WisdomTree Dynamic Currency Hedged International SmallCap Equity Fund\"\r\n\t},\r\n\t{ id: 3686, cd: \"BOIL\", lb: \"ProShares Ultra Bloomberg Natural Gas\" },\r\n\t{\r\n\t\tid: 4402,\r\n\t\tcd: \"DVYE\",\r\n\t\tlb: \"iShares Emerging Markets Dividend Index Fund Exchange Traded Fund\"\r\n\t},\r\n\t{ id: 1104, cd: \"FMI\", lb: \"Foundation Medicine, Inc. - Common Stock\" },\r\n\t{ id: 1011, cd: \"FALC\", lb: \"FalconStor Software, Inc. - Common Stock\" },\r\n\t{\r\n\t\tid: 1569,\r\n\t\tcd: \"JGBB\",\r\n\t\tlb: \"WisdomTree Japan Interest Rate Strategy Fund\"\r\n\t},\r\n\t{ id: 3819, cd: \"CAS\", lb: \"Castle (A.M.) & Co. Common Stock\" },\r\n\t{ id: 475, cd: \"CBSH\", lb: \"Commerce Bancshares, Inc. - Common Stock\" },\r\n\t{ id: 851, cd: \"DWAT\", lb: \"Arrow DWA Tactical ETF\" },\r\n\t{\r\n\t\tid: 1340,\r\n\t\tcd: \"HCSG\",\r\n\t\tlb: \"Healthcare Services Group, Inc. - Common Stock\"\r\n\t},\r\n\t{ id: 3793, cd: \"C\", lb: \"Citigroup, Inc. Common Stock\" },\r\n\t{ id: 2971, cd: \"VRML\", lb: \"Vermillion, Inc. - Common Stock\" },\r\n\t{ id: 2063, cd: \"OFIX\", lb: \"Orthofix International N.V. - Common Stock\" },\r\n\t{\r\n\t\tid: 2730,\r\n\t\tcd: \"TANNI\",\r\n\t\tlb: \"TravelCenters of America LLC - 8.25% Senior Notes due 2028\"\r\n\t},\r\n\t{ id: 1258, cd: \"GNTX\", lb: \"Gentex Corporation - Common Stock\" },\r\n\t{\r\n\t\tid: 5119,\r\n\t\tcd: \"GLQ\",\r\n\t\tlb:\r\n\t\t\t\"Clough Global Equity Fund Clough Global Equity Fund Common Shares of Beneficial Interest\"\r\n\t},\r\n\t{\r\n\t\tid: 3750,\r\n\t\tcd: \"BTA\",\r\n\t\tlb:\r\n\t\t\t\"BlackRock Long-Term Municipal Advantage Trust BlackRock Long-Term Municipal Advantage Trust Common Shares of Beneficial Interest\"\r\n\t},\r\n\t{\r\n\t\tid: 4215,\r\n\t\tcd: \"DCUC\",\r\n\t\tlb: \"Dominion Resources, Inc. VA New 2014 Series A Corp Unit\"\r\n\t},\r\n\t{ id: 3476, cd: \"AVX\", lb: \"AVX Corporation Common Stock\" },\r\n\t{ id: 5126, cd: \"GM\", lb: \"General Motors Company Common Stock\" },\r\n\t{ id: 1438, cd: \"ICLDW\", lb: \"InterCloud Systems, Inc - Warrant\" },\r\n\t{\r\n\t\tid: 5290,\r\n\t\tcd: \"HDEE\",\r\n\t\tlb:\r\n\t\t\t\"Deutsche X-trackers MSCI Emerging Markets High Dividend Yield Hedged Equity ETF\"\r\n\t},\r\n\t{ id: 2333, cd: \"QLGC\", lb: \"QLogic Corporation - Common Stock\" },\r\n\t{ id: 5634, cd: \"IPAY\", lb: \"PureFunds ISE Mobile Payments ETF\" },\r\n\t{ id: 180, cd: \"ANY\", lb: \"Sphere 3D Corp. - Common Shares\" },\r\n\t{ id: 2823, cd: \"TSBK\", lb: \"Timberland Bancorp, Inc. - Common Stock\" },\r\n\t{ id: 2007, cd: \"NUROW\", lb: \"NeuroMetrix, Inc. - Warrants\" },\r\n\t{ id: 73, cd: \"AEHR\", lb: \"Aehr Test Systems - Common Stock\" },\r\n\t{\r\n\t\tid: 3831,\r\n\t\tcd: \"CBL\",\r\n\t\tlb: \"CBL & Associates Properties, Inc. Common Stock\"\r\n\t},\r\n\t{\r\n\t\tid: 4514,\r\n\t\tcd: \"EHT\",\r\n\t\tlb:\r\n\t\t\t\"Eaton Vance High Income 2021 Target Term Trust Common Shares of Beneficial Interest\"\r\n\t},\r\n\t{\r\n\t\tid: 4796,\r\n\t\tcd: \"FCE.B\",\r\n\t\tlb: \"Forest City Realty Trust, Inc. Common Stock\"\r\n\t},\r\n\t{\r\n\t\tid: 1997,\r\n\t\tcd: \"NTIC\",\r\n\t\tlb: \"Northern Technologies International Corporation - Common Stock\"\r\n\t},\r\n\t{ id: 4452, cd: \"ECL\", lb: \"Ecolab Inc. Common Stock\" },\r\n\t{ id: 4276, cd: \"DHI\", lb: \"D.R. Horton, Inc. Common Stock\" },\r\n\t{ id: 3940, cd: \"CIT\", lb: \"CIT Group Inc (DEL) Common Stock\" },\r\n\t{ id: 2396, cd: \"RFEU\", lb: \"First Trust RiverFront Dynamic Europe ETF\" }\r\n].reduce((acc, thirdparty) => {\r\n\tacc[thirdparty.id] = thirdparty;\r\n\treturn acc;\r\n}, {});\r\nexport class MyThirdparties extends Component {\r\n\t// constructor(props) {\r\n\t// \tsuper(props);\r\n\t// \tconst functionsObject = {\r\n\t// \t\tthirdparties: {} //thirdpartiesFunctions\r\n\t// \t};\r\n\t// \tthis.state = {\r\n\t// \t\tfunctions: utils.functionsTable(functionsObject),\r\n\t// \t\tstatus: {}\r\n\t// \t};\r\n\t// }\r\n\t// componentWillReceiveProps(nextProps) {\r\n\t// \tconsole.log(nextProps);\r\n\t// }\r\n\t// componentWillUnMount() {\r\n\t// \tconsole.log(\"unmount\");\r\n\t// }\r\n\t// componentDidUnMount() {\r\n\t// \tconsole.log(\"unmount1\");\r\n\t// }\r\n\t// componentDidUnmount() {\r\n\t// \tconsole.log(\"unmount2\");\r\n\t// }\r\n\t// componentWillUnmount() {\r\n\t// \tconsole.log(\"unmount3\");\r\n\t// }\r\n\r\n\trender() {\r\n\t\treturn React.cloneElement(\r\n\t\t\t<ZebulonTable\r\n\t\t\t\tkey=\"thirdparties\"\r\n\t\t\t\tid=\"thirdparties\"\r\n\t\t\t\tmeta={metaThirdparties}\r\n\t\t\t\t// filters={filters}\r\n\t\t\t\t// status={this.state.status}\r\n\t\t\t\t// sizes={{ height: 300, width: 500 }}\r\n\t\t\t\t// functions={this.state.functions}\r\n\t\t\t/>,\r\n\t\t\t{ ...this.props }\r\n\t\t);\r\n\t}\r\n}\r\n","import {\r\n  FiFilter,\r\n  FiPlusSquare,\r\n  FiRefreshCw,\r\n  FiPlus,\r\n  FiSave,\r\n  FiX\r\n} from \"react-icons/fi\";\r\nexport const rollingAverage = {\r\n  id: \"rolling_avg\",\r\n  caption: \"Rolling average\",\r\n  width: 140,\r\n  dataType: \"number\",\r\n  editable: false,\r\n  hidden: true,\r\n  format: \"amt_€\",\r\n  accessor: \"amt_€\",\r\n  analytic: {\r\n    aggregation: \"avg\",\r\n    groupByAccessor: \"row.country.id\",\r\n    comparisonAccessor: \"row.d\",\r\n    sortAccessor: \"row.d\",\r\n    windowStart: \"since30d\",\r\n    windowEnd: x => x\r\n  }\r\n};\r\nexport const totalAmount = {\r\n  id: \"total_amt\",\r\n  caption: \"Total amount\",\r\n  width: 140,\r\n  dataType: \"number\",\r\n  editable: false,\r\n  hidden: true,\r\n  format: \"amt_€\",\r\n  accessor: \"amt_€\",\r\n  analytic: {\r\n    aggregation: \"sum\",\r\n    groupByAccessor: \"row.country.id\"\r\n  }\r\n};\r\nexport const meta = {\r\n  noCache: false,\r\n  table: {\r\n    object: \"dataset\",\r\n    caption: \"dataset\",\r\n    actionIcons: true,\r\n    editable: true,\r\n    select: \"get_array\",\r\n    rowId: \"rowId_\",\r\n    onSave: \"onSave\",\r\n    onSaveAfter: \"onSaveAfter\",\r\n    onSaveBefore: \"onSaveBefore\",\r\n    onTableChange: \"onTableChange\",\r\n    filteredByServer: true,\r\n    statusDraggable: true,\r\n    noFilter: false,\r\n    noStatus: false,\r\n    noOrder: false,\r\n    actions: [\r\n      {\r\n        type: \"insert\",\r\n        caption: \"New\",\r\n        enable: true,\r\n        key: \"f2\",\r\n        icon: FiPlus,\r\n        toolTip: \"insert new row\"\r\n      },\r\n      {\r\n        type: \"delete\",\r\n        caption: \"Delete\",\r\n        enable: \"is_selected\",\r\n        key: \"f3\",\r\n        icon: FiX,\r\n        toolTip: \"delete row\"\r\n      },\r\n      {\r\n        type: \"duplicate\",\r\n        caption: \"Duplicate\",\r\n        enable: \"is_selected\",\r\n        key: \"f4\",\r\n        icon: FiPlusSquare,\r\n        toolTip: \"duplicate row\"\r\n      },\r\n      {\r\n        type: \"save\",\r\n        caption: \"Save\",\r\n        enable: true,\r\n        key: \"f12\",\r\n        icon: FiSave,\r\n        toolTip: \"save\"\r\n      },\r\n      {\r\n        type: \"refresh\",\r\n        caption: \"Refresh\",\r\n        enable: true,\r\n        key: \"f10\",\r\n        icon: FiRefreshCw,\r\n        toolTip: \"refresh\"\r\n      }\r\n    ]\r\n  },\r\n  row: {\r\n    audit: \"audit\"\r\n  },\r\n  properties: [\r\n    {\r\n      id: \"rowId_\"\r\n    },\r\n    {\r\n      id: \"d\",\r\n      caption: \"Date\",\r\n      width: 100,\r\n      // dataType: \"year\",\r\n      dataType: \"date\",\r\n      editable: true,\r\n      mandatory: true,\r\n      filterType: \"between\"\r\n    },\r\n    {\r\n      id: \"id\",\r\n      caption: \"Order #\",\r\n      width: 100,\r\n      dataType: \"number\",\r\n      mandatory: true,\r\n      editable: \"is_new\",\r\n      filterType: \"between\"\r\n    },\r\n    {\r\n      id: \"product\",\r\n      caption: \"Product\",\r\n      width: 100,\r\n      dataType: \"joined object\",\r\n      mandatory: true,\r\n      hidden: true,\r\n      select: \"getProducts\",\r\n      accessor: \"row.product_id\"\r\n    },\r\n    {\r\n      id: \"product_id\",\r\n      caption: \"product_id\",\r\n      width: 100,\r\n      dataType: \"number\",\r\n      hidden: true\r\n    },\r\n    {\r\n      id: \"product_lb\",\r\n      caption: \"Product\",\r\n      width: 120,\r\n      dataType: \"string\",\r\n      editable: true,\r\n      filterType: \"values:row.product.id\",\r\n      accessor: \"row.product.label\",\r\n      sortAccessor: \"product.id\",\r\n      locked: true\r\n    },\r\n    {\r\n      id: \"shape\",\r\n      caption: \"Shape\",\r\n      width: 100,\r\n      dataType: \"string\",\r\n      editable: false,\r\n      accessor: \"row.product.shape\",\r\n      filterType: \"values\"\r\n    },\r\n    {\r\n      id: \"size\",\r\n      caption: \"Size\",\r\n      width: 100,\r\n      dataType: \"string\",\r\n      editable: false,\r\n      accessor: \"row.product.size\",\r\n      filterType: \"values\"\r\n    },\r\n    {\r\n      id: \"color\",\r\n      caption: \"Color\",\r\n      width: 100,\r\n      dataType: \"string\",\r\n      editable: true,\r\n      select: \"getColors\",\r\n      // mandatory: true,\r\n      filterType: \"values\"\r\n    },\r\n\r\n    {\r\n      id: \"price\",\r\n      caption: \"Price\",\r\n      width: 90,\r\n      dataType: \"number\",\r\n      editable: false,\r\n      accessor: \"row.product.price\",\r\n      format: \"price\",\r\n      filterType: \"between\"\r\n    },\r\n    {\r\n      id: \"country_id\",\r\n      width: 100,\r\n      dataType: \"number\",\r\n      hidden: true\r\n    },\r\n    {\r\n      id: \"country\",\r\n      caption: \"Country\",\r\n      mandatory: true,\r\n      width: 100,\r\n      dataType: \"joined object\",\r\n      hidden: true,\r\n      select: \"getCountries\",\r\n      accessor: \"row.country_id\"\r\n    },\r\n    {\r\n      id: \"country_cd\",\r\n      caption: \"Country\",\r\n      width: 100,\r\n      dataType: \"string\",\r\n      editable: true,\r\n      filterType: \"values\",\r\n      accessor: \"row.country.code\",\r\n      onQuit: \"onChangeCountry\"\r\n    },\r\n    {\r\n      id: \"flag\",\r\n      caption: \"Flag\",\r\n      width: 40,\r\n      accessor: \"flag\",\r\n      format: \"image\"\r\n    },\r\n    {\r\n      id: \"currency_id\",\r\n      width: 0,\r\n      dataType: \"number\",\r\n      hidden: true\r\n    },\r\n    {\r\n      id: \"currency\",\r\n      caption: \"Currency\",\r\n      width: 0,\r\n      dataType: \"joined object\",\r\n      mandatory: true,\r\n      hidden: true,\r\n      select: \"getCurrencies\",\r\n      accessor: \"row.currency_id\"\r\n    },\r\n    {\r\n      id: \"currency_cd\",\r\n      caption: \"Currency\",\r\n      width: 100,\r\n      dataType: \"string\",\r\n      accessor: \"row.currency.code\",\r\n      filterType: \"values\",\r\n      editable: true\r\n    },\r\n    {\r\n      id: \"thirdparty_id\",\r\n      width: 0,\r\n      dataType: \"number\",\r\n      mandatory: true,\r\n      hidden: true\r\n    },\r\n    {\r\n      id: \"thirdparty_cd\",\r\n      caption: \"Thirdparty\",\r\n      width: 80,\r\n      dataType: \"string\",\r\n      // accessor: \"row.thirdparty.cd\",\r\n      filterType: \"values\",\r\n      editable: true,\r\n      foreignObject: \"thirdparties\",\r\n      noRefresh: false,\r\n      onChange: ({ value, row }) => {\r\n        row.thirdparty_id = value.id;\r\n        row.thirdparty_cd = value.cd;\r\n      }\r\n    },\r\n    {\r\n      id: \"qty\",\r\n      caption: \"Quantity\",\r\n      mandatory: true,\r\n      width: 90,\r\n      dataType: \"number\",\r\n      editable: true,\r\n      filterType: \"between\"\r\n    },\r\n    {\r\n      id: \"bool\",\r\n      caption: \"Boolean\",\r\n      width: 90,\r\n      dataType: \"boolean\",\r\n      editable: true\r\n    },\r\n    {\r\n      id: \"amt_eur\",\r\n      caption: \"Amount in €\",\r\n      width: 120,\r\n      dataType: \"number\",\r\n      filterType: \">=\",\r\n      editable: false,\r\n      accessor: \"amt_€\",\r\n      format: \"amt_€\"\r\n    },\r\n    {\r\n      id: \"amt\",\r\n      caption: \"Amount\",\r\n      width: 120,\r\n      dataType: \"number\",\r\n      editable: false,\r\n      accessor: \"amt_cur\",\r\n      format: \"amt_cur\"\r\n    },\r\n    totalAmount,\r\n    rollingAverage\r\n  ]\r\n};\r\n","import React from \"react\";\r\nimport { utils } from \"zebulon-controls\";\r\nimport { computeData } from \"../table/utils/compute.data\";\r\nimport { MyThirdparties } from \"./thirdparties\";\r\nimport { getRowErrors, getErrors, manageRowError } from \"../table/utils/utils\";\r\nimport { Observable } from \"rx-lite\";\r\nimport { isEqual, getUpdatedRows } from \"../table/utils/utils\";\r\nimport {\r\n\tget_array,\r\n\tget_promise,\r\n\tget_observable,\r\n\tget_pagination_manager,\r\n\tgetCountries,\r\n\tgetCurrencies,\r\n\tgetProducts,\r\n\tgetColors,\r\n\tserverData,\r\n\taudits,\r\n\tdataPk\r\n} from \"./datasources\";\r\nimport { meta } from \"./dataset.meta\";\r\n// asynchronous function (check on the server simulation)\r\n// ! don't return, as the next step will be executed by the callback\r\n// else it will be done twice\r\n//\r\n// conflicts management\r\n// NB it might be preferable to use a database rowid instead of a primary key\r\n//server side\r\nconst onSaveBefore_ = updatedRows => {\r\n\tconst conflicts = [];\r\n\t// if the timestamp on the server side is > timestamp client side => conflict\r\n\tconsole.log(\"savebefore\", serverData.length);\r\n\tgetUpdatedRows(updatedRows).forEach(status => {\r\n\t\t// const d = data;\r\n\t\tconst row = status.rowUpdated || status.row;\r\n\t\tconst serverRow = serverData[row.rowId_];\r\n\t\tif (serverRow && serverRow.timestamp_ > row.timestamp_) {\r\n\t\t\tconflicts.push({ index_: row.index_, row: { ...serverRow } });\r\n\t\t}\r\n\t});\r\n\tif (conflicts.length) {\r\n\t\treturn conflicts;\r\n\t} else {\r\n\t\treturn true;\r\n\t}\r\n};\r\n//client side\r\nconst onSaveBefore = (message, callback) => {\r\n\tnew Promise(resolve =>\r\n\t\tresolve(onSaveBefore_(JSON.parse(JSON.stringify(message.updatedRows))))\r\n\t).then(ok => {\r\n\t\tif (ok !== true) {\r\n\t\t\tmessage.conflicts = ok.reduce((acc, conflict) => {\r\n\t\t\t\tconst status = message.updatedRows[conflict.index_];\r\n\t\t\t\tacc[conflict.index_] = {\r\n\t\t\t\t\tserver: { ...conflict.row },\r\n\t\t\t\t\tclient: {\r\n\t\t\t\t\t\t...status.rowUpdated,\r\n\t\t\t\t\t\tdeleted_:\r\n\t\t\t\t\t\t\tstatus.deleted_ && !status.new_ ? true : undefined\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t\treturn acc;\r\n\t\t\t}, {});\r\n\t\t} else {\r\n\t\t\tmessage.conflicts = undefined;\r\n\t\t}\r\n\t\tif (callback) {\r\n\t\t\tcallback(message);\r\n\t\t}\r\n\t});\r\n};\r\n// asynchronous function (save on the server simulation)\r\n// !don't return, as the next step will be executed by the callback\r\n// else it will be done twice\r\n//\r\n\r\n// simulation of saving on server + audit management + error management(unique id)\r\n// server side\r\nexport const computeAudit = (\r\n\tuser_,\r\n\ttimestamp_,\r\n\tstatus_,\r\n\tcolumns,\r\n\trow,\r\n\tnextRow\r\n) => {\r\n\tif (status_ === \"updated\" || status_ === \"new\" || status_ === \"deleted\") {\r\n\t\tconst key = nextRow.rowId_ || row.rowId_;\r\n\r\n\t\tif (!audits[key]) {\r\n\t\t\taudits[key] = [];\r\n\t\t}\r\n\t\tlet ok = true;\r\n\t\tconst audits_ = audits[key];\r\n\t\tconst audit = { user_, timestamp_, status_, row: {} };\r\n\t\tif (status_ === \"updated\") {\r\n\t\t\tok = false;\r\n\t\t\tcolumns.forEach(column => {\r\n\t\t\t\tif (!isEqual(nextRow[column], row[column])) {\r\n\t\t\t\t\tok = true;\r\n\t\t\t\t\taudit.row[column] = row[column];\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t\tif (ok) {\r\n\t\t\taudits_.push(audit);\r\n\t\t}\r\n\t}\r\n};\r\n\r\nconst onSave_ = (updatedRows, user) => {\r\n\t//  check unicity of the primary key\r\n\tconst pk = {},\r\n\t\tdeleteds = [];\r\n\tgetUpdatedRows(updatedRows).forEach(status => {\r\n\t\tconst row = status.rowUpdated || status.row;\r\n\t\tif (!pk[row.id]) {\r\n\t\t\tpk[row.id] = {\r\n\t\t\t\tn: 0,\r\n\t\t\t\t// serverIndex_: status.row ? dataPk[status.row.id] : undefined,\r\n\t\t\t\trow\r\n\t\t\t};\r\n\t\t}\r\n\t\tif (status.row && !pk[status.row.id]) {\r\n\t\t\tpk[status.row.id] = {\r\n\t\t\t\tn: 0,\r\n\t\t\t\t// serverIndex_: dataPk[status.row.id],\r\n\t\t\t\trow\r\n\t\t\t};\r\n\t\t}\r\n\t\tif (status.deleted_ && !status.new_) {\r\n\t\t\tpk[status.row.id].n -= 1;\r\n\t\t\tdeleteds.push({\r\n\t\t\t\trowId_: status.row.rowId_,\r\n\t\t\t\tindex_: status.row.index_\r\n\t\t\t});\r\n\t\t} else if (\r\n\t\t\tstatus.updated_ &&\r\n\t\t\t!status.new_ &&\r\n\t\t\tstatus.row.id !== status.rowUpdated.id\r\n\t\t) {\r\n\t\t\tpk[status.row.id].n -= 1;\r\n\t\t\tpk[row.id].n += 1;\r\n\t\t\tpk[row.id].row = row;\r\n\t\t} else if (status.new_ && !status.deleted_) {\r\n\t\t\tpk[row.id].n += 1;\r\n\t\t\tpk[row.id].serverIndex_ = undefined;\r\n\t\t\tpk[row.id].row = row;\r\n\t\t}\r\n\t});\r\n\tconst keys = Object.keys(pk);\r\n\tconst timestamp = new Date().getTime();\r\n\tconst errors = [];\r\n\tkeys.forEach(key => {\r\n\t\tconst pKey = pk[key];\r\n\t\tpKey.n += dataPk[key] !== undefined;\r\n\t\tif (pKey.n > 1) {\r\n\t\t\terrors.push({\r\n\t\t\t\tindex_: pKey.row.index_,\r\n\t\t\t\ttype: \"duplicate key\",\r\n\t\t\t\tid: \"id\",\r\n\t\t\t\tcaption: \"Order#\",\r\n\t\t\t\terror: `Order# - duplicate key: ${key}`\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n\tif (errors.length) {\r\n\t\treturn { ok: false, errors };\r\n\t}\r\n\t// compute audit\r\n\tconst columns = meta.properties\r\n\t\t.filter(column => !column.accessor)\r\n\t\t.map(column => column.id);\r\n\t// saves on server and returns rowid +timestamp to client\r\n\tconst rows = [];\r\n\tkeys.forEach(key => {\r\n\t\tconst pKey = pk[key];\r\n\t\tif (pKey.n === 1) {\r\n\t\t\tconst index_ = pKey.row.index_;\r\n\t\t\tdelete pKey.row.index_;\r\n\t\t\tpKey.row.timestamp_ = timestamp;\r\n\t\t\tif (utils.isNullOrUndefined(pKey.row.rowId_)) {\r\n\t\t\t\tpKey.row.rowId_ = serverData.length;\r\n\t\t\t\tdataPk[key] = pKey.row.rowId_;\r\n\t\t\t\tcomputeAudit(user, timestamp, \"new\", columns, {}, pKey.row);\r\n\t\t\t\tserverData.push(pKey.row);\r\n\t\t\t} else {\r\n\t\t\t\tdataPk[key] = pKey.row.rowId_;\r\n\t\t\t\tcomputeAudit(\r\n\t\t\t\t\tuser,\r\n\t\t\t\t\ttimestamp,\r\n\t\t\t\t\t\"updated\",\r\n\t\t\t\t\tcolumns,\r\n\t\t\t\t\tserverData[pKey.row.rowId_],\r\n\t\t\t\t\tpKey.row\r\n\t\t\t\t);\r\n\t\t\t\tserverData[pKey.row.rowId_] = pKey.row;\r\n\t\t\t}\r\n\t\t\trows.push({\r\n\t\t\t\tindex_,\r\n\t\t\t\trowId_: pKey.row.rowId_,\r\n\t\t\t\ttimestamp_: timestamp\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tdelete dataPk[key];\r\n\t\t}\r\n\t});\r\n\tdeleteds.forEach(deleted => {\r\n\t\tcomputeAudit(\r\n\t\t\tuser,\r\n\t\t\ttimestamp,\r\n\t\t\t\"deleted\",\r\n\t\t\tcolumns,\r\n\t\t\tserverData[deleted.rowId_],\r\n\t\t\t{}\r\n\t\t);\r\n\t\tserverData[deleted.rowId_].deleted_ = true;\r\n\t\tserverData[deleted.rowId_].timestamp_ = timestamp;\r\n\t\trows.push({\r\n\t\t\tindex_: deleted.index_,\r\n\t\t\trowId_: deleted.rowId_,\r\n\t\t\ttimestamp_: timestamp\r\n\t\t});\r\n\t});\r\n\r\n\treturn { ok: true, rows };\r\n};\r\n// client side\r\nconst onSave = (message, callback) => {\r\n\tnew Promise(resolve =>\r\n\t\tresolve(\r\n\t\t\tonSave_(\r\n\t\t\t\tJSON.parse(JSON.stringify(message.updatedRows)),\r\n\t\t\t\tmessage.params.user_\r\n\t\t\t)\r\n\t\t)\r\n\t).then(result => {\r\n\t\tif (!result.ok) {\r\n\t\t\tmessage.serverErrors = [\"Server errors\"].concat(\r\n\t\t\t\tresult.errors.map(error => {\r\n\t\t\t\t\tmanageRowError(\r\n\t\t\t\t\t\tmessage.updatedRows,\r\n\t\t\t\t\t\terror.index_,\r\n\t\t\t\t\t\t{ id: error.id, caption: error.caption },\r\n\t\t\t\t\t\terror.type,\r\n\t\t\t\t\t\terror.error,\r\n\t\t\t\t\t\terror.rowTitle,\r\n\t\t\t\t\t\ttrue\r\n\t\t\t\t\t);\r\n\t\t\t\t\treturn error.error;\r\n\t\t\t\t})\r\n\t\t\t);\r\n\t\t} else {\r\n\t\t\tresult.rows.forEach(serverRow => {\r\n\t\t\t\tconst row = message.updatedRows[serverRow.index_].rowUpdated;\r\n\t\t\t\trow.rowId_ = serverRow.rowId_;\r\n\t\t\t\trow.timestamp_ = serverRow.timestamp_;\r\n\t\t\t});\r\n\t\t\tmessage.serverErrors = undefined;\r\n\t\t}\r\n\r\n\t\tif (callback) {\r\n\t\t\tcallback(message);\r\n\t\t}\r\n\t});\r\n};\r\n\r\n// synchronous function (keep audits of changes)\r\n// return true or false\r\nconst onSaveAfter = message => {\r\n\treturn true;\r\n};\r\nconst getAudits_ = rowId => audits[rowId];\r\nconst getAudits = ({ row }) => {\r\n\treturn new Promise(resolve => resolve(getAudits_(row.rowId_)));\r\n};\r\nexport const get_subscription = ({ params, meta, filters, sorts }) => {\r\n\tconst columns = meta.properties\r\n\t\t.filter(column => !column.accessor)\r\n\t\t.map(column => column.id);\r\n\tconst timestamp = new Date().getTime();\r\n\tconst data2 = [[], [], []];\r\n\tfor (let i = 0; i < 12; i++) {\r\n\t\tconst row = serverData[i];\r\n\t\tconst row0 = { ...serverData[i] };\r\n\t\trow.timestamp_ = timestamp;\r\n\t\trow.qty = Math.floor(2000 * Math.random());\r\n\t\tcomputeAudit(\"Zébulon\", timestamp, \"updated\", columns, row0, row);\r\n\t\tdata2[Math.floor(i / 4)].push({ ...row });\r\n\t}\r\n\treturn Observable.interval(800)\r\n\t\t.take(3)\r\n\t\t.map(i => {\r\n\t\t\treturn data2[i];\r\n\t\t});\r\n};\r\n// errors an user interractions management\r\nexport const errorHandler = {\r\n\tonRowQuit: message => {\r\n\t\tmessage.modalBody = [\"Errors: \"].concat(\r\n\t\t\tgetRowErrors(message.status, message.row.index_)\r\n\t\t\t\t.map(error => `\\n Order# ${message.row.id} : ${error.error}`)\r\n\t\t\t\t.concat([\"Do you wan't to continue?\"])\r\n\t\t);\r\n\t\treturn true;\r\n\t},\r\n\tonTableChange: message => {\r\n\t\tif (message.type !== \"sort\") {\r\n\t\t\tmessage.modalBody = `Do you want to save before ${message.type}?`;\r\n\t\t}\r\n\t\treturn true;\r\n\t},\r\n\tonSaveBefore: message => {\r\n\t\tmessage.modalBody = [\"Can't save with errors: \"].concat(\r\n\t\t\tgetErrors(message.updatedRows).map(\r\n\t\t\t\terror =>\r\n\t\t\t\t\t`\\nOrder# ${message.updatedRows[error.rowIndex].rowUpdated\r\n\t\t\t\t\t\t.id} : ${error.error}`\r\n\t\t\t)\r\n\t\t);\r\n\t\tif (message.modalBody.length > 1) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tmessage.modalBody = null;\r\n\t\treturn true;\r\n\t},\r\n\tonSave: message => {\r\n\t\tif (message.serverErrors) {\r\n\t\t\tmessage.modalBody = message.serverErrors;\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tmessage.modalBody = null;\r\n\t\treturn true;\r\n\t}\r\n};\r\nexport const datasetFunctions = {\r\n\tdataset: {\r\n\t\tselects: {\r\n\t\t\tgetProducts,\r\n\t\t\tgetCountries,\r\n\t\t\tgetCurrencies,\r\n\t\t\tgetColors\r\n\t\t},\r\n\t\tformats: {\r\n\t\t\t// \"mm/yyyy\": ({ value }) =>\r\n\t\t\t// \tutils.isNullOrUndefined(value)\r\n\t\t\t// \t\t? \"\"\r\n\t\t\t// \t\t: utils.formatValue(value, \"mm/yyyy\"),\r\n\t\t\t\"amt_€\": ({ value, row }) => {\r\n\t\t\t\treturn (\r\n\t\t\t\t\t<div\r\n\t\t\t\t\t\tstyle={{\r\n\t\t\t\t\t\t\tdisplay: \"flex\",\r\n\t\t\t\t\t\t\tjustifyContent: \"space-between\"\r\n\t\t\t\t\t\t}}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<div>€</div>\r\n\t\t\t\t\t\t<div style={{ textAlign: \"right\" }}>\r\n\t\t\t\t\t\t\t{utils.formatValue(value, null, 2)}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t);\r\n\t\t\t},\r\n\t\t\tamt_cur: ({ value, row }) => {\r\n\t\t\t\treturn (\r\n\t\t\t\t\t<div\r\n\t\t\t\t\t\tstyle={{\r\n\t\t\t\t\t\t\tdisplay: \"flex\",\r\n\t\t\t\t\t\t\tjustifyContent: \"space-between\"\r\n\t\t\t\t\t\t}}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<div>{(row.currency || {}).symbol}</div>\r\n\t\t\t\t\t\t<div style={{ textAlign: \"right\" }}>\r\n\t\t\t\t\t\t\t{utils.formatValue(value, null, 2)}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t);\r\n\t\t\t},\r\n\t\t\tprice: ({ value }) => {\r\n\t\t\t\treturn (\r\n\t\t\t\t\t<div\r\n\t\t\t\t\t\tstyle={{\r\n\t\t\t\t\t\t\tdisplay: \"flex\",\r\n\t\t\t\t\t\t\tjustifyContent: \"space-between\"\r\n\t\t\t\t\t\t}}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<div>€</div>\r\n\t\t\t\t\t\t<div style={{ textAlign: \"right\" }}>\r\n\t\t\t\t\t\t\t{utils.formatValue(value, null, 2)}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t},\r\n\t\twindows: {\r\n\t\t\tsince30d: x => {\r\n\t\t\t\tconst xx = new Date(x);\r\n\t\t\t\txx.setDate(xx.getDate() - 30);\r\n\t\t\t\treturn xx;\r\n\t\t\t}\r\n\t\t},\r\n\t\tvalidators: {\r\n\t\t\tonChangeCountry: ({ row, column, meta }) => {\r\n\t\t\t\tif (\r\n\t\t\t\t\t!utils.isNullOrUndefined(row.country_id) &&\r\n\t\t\t\t\tutils.isNullOrUndefined(row.currency_id)\r\n\t\t\t\t) {\r\n\t\t\t\t\trow.currency_id = row.country.currency_id;\r\n\t\t\t\t\trow.currency = meta.properties\r\n\t\t\t\t\t\t.find(column => column.id === \"currency\")\r\n\t\t\t\t\t\t.accessorFunction({ row });\r\n\t\t\t\t}\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t},\r\n\t\taccessors: {\r\n\t\t\tqty: ({ row }) => row.qty / 3,\r\n\r\n\t\t\t\"amt_€\": ({ row }) => row.qty * (row.product || {}).price,\r\n\t\t\tamt_cur: ({ row }) => {\r\n\t\t\t\treturn (\r\n\t\t\t\t\trow.qty *\r\n\t\t\t\t\t(row.product || {}).price *\r\n\t\t\t\t\t(row.currency || {}).rate\r\n\t\t\t\t);\r\n\t\t\t},\r\n\t\t\tmth: ({ row }) => {\r\n\t\t\t\tif (utils.isNullOrUndefined(row.d)) {\r\n\t\t\t\t\treturn null;\r\n\t\t\t\t}\r\n\t\t\t\tconst d = new Date(row.d);\r\n\t\t\t\td.setDate(1);\r\n\t\t\t\treturn d;\r\n\t\t\t},\r\n\t\t\tflag: ({ row }) => {\r\n\t\t\t\tif (\r\n\t\t\t\t\t!row.country ||\r\n\t\t\t\t\trow.country.code === \"\" ||\r\n\t\t\t\t\tutils.isNullOrUndefined(row.country.code)\r\n\t\t\t\t) {\r\n\t\t\t\t\treturn null;\r\n\t\t\t\t}\r\n\t\t\t\treturn `//www.drapeauxdespays.fr/data/flags/small/${row.country.code.toLowerCase()}.png`;\r\n\t\t\t},\r\n\t\t\taudit: getAudits\r\n\t\t},\r\n\t\tactions: {\r\n\t\t\tcomputeData,\r\n\t\t\ttoggleFilter: ({ ref }) => ref.toggleFilter()\r\n\t\t},\r\n\t\tdmls: {\r\n\t\t\tget_array,\r\n\t\t\tget_promise,\r\n\t\t\tget_observable,\r\n\t\t\tget_pagination_manager,\r\n\t\t\tget_subscription,\r\n\t\t\tonSave,\r\n\t\t\tonSaveAfter,\r\n\t\t\tonSaveBefore\r\n\t\t\t// onTableChange\r\n\t\t},\r\n\t\tforeignObjects: {\r\n\t\t\tthirdparties: MyThirdparties\r\n\t\t},\r\n\t\tanalytics: {\r\n\t\t\trolling_avg: {\r\n\t\t\t\taggregation: \"avg\",\r\n\t\t\t\tgroupByAccessor: \"row.country.id\",\r\n\t\t\t\tcomparisonAccessor: \"row.d\",\r\n\t\t\t\tsortAccessor: \"row.d\",\r\n\t\t\t\twindowStart: \"since30d\",\r\n\t\t\t\twindowEnd: x => x\r\n\t\t\t},\r\n\t\t\ttotal_amt: {\r\n\t\t\t\taggregation: \"sum\",\r\n\t\t\t\tgroupByAccessor: \"row.country.id\"\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n};\r\n\r\nexport const customMenuFunctions = (state, props) => ({\r\n\t\"row-header-menu\": [\r\n\t\t{\r\n\t\t\tcode: \"toto1\",\r\n\t\t\tcaption: \"Row menu 0\",\r\n\t\t\ttype: \"MenuItem\",\r\n\t\t\tfunction: e => console.log(\"Row menu 0\", e)\r\n\t\t},\r\n\t\t{\r\n\t\t\tcode: \"toto2\",\r\n\t\t\tcaption: \"Row menu 1\",\r\n\t\t\ttype: \"MenuItem\",\r\n\t\t\tfunction: e => console.log(\"Row menu 1\", e)\r\n\t\t}\r\n\t],\r\n\t\"column-header-menu\": [\r\n\t\t{\r\n\t\t\tcode: \"totoa\",\r\n\t\t\tcaption: \"Column menu 0\",\r\n\t\t\ttype: \"MenuItem\",\r\n\t\t\tfunction: e => console.log(\"Column menu 0\", e)\r\n\t\t},\r\n\t\t{\r\n\t\t\tcode: \"totob\",\r\n\t\t\tcaption: \"Column menu 1\",\r\n\t\t\ttype: \"MenuItem\",\r\n\t\t\tfunction: e => console.log(\"Column menu 1\", e)\r\n\t\t}\r\n\t],\r\n\t\"top-left-corner-menu\": [\r\n\t\t{\r\n\t\t\tcode: \"toto1\",\r\n\t\t\tcaption: \"Table menu 0\",\r\n\t\t\ttype: \"MenuItem\",\r\n\t\t\tfunction: e => console.log(\"Table menu 0\", e)\r\n\t\t},\r\n\t\t{\r\n\t\t\tcode: \"toto2\",\r\n\t\t\tcaption: \"Table menu 1\",\r\n\t\t\ttype: \"MenuItem\",\r\n\t\t\tfunction: e => console.log(\"Table menu 1\", e)\r\n\t\t}\r\n\t],\r\n\t\"cell-menu\": [\r\n\t\t{\r\n\t\t\tcode: \"cell0\",\r\n\t\t\tcaption: \"Cell menu 0\",\r\n\t\t\ttype: \"MenuItem\",\r\n\t\t\tfunction: e => console.log(\"Cell menu 0\", e)\r\n\t\t},\r\n\t\t{\r\n\t\t\tcode: \"cell1\",\r\n\t\t\tcaption: \"Cell menu 1\",\r\n\t\t\ttype: \"MenuItem\",\r\n\t\t\tfunction: e => console.log(\"Cell menu 1\", e)\r\n\t\t}\r\n\t]\r\n});\r\n","import React, { Component } from \"react\";\r\nimport { ZebulonTable } from \"../table/ZebulonTable\";\r\nimport { onNext, onCompleted, onError } from \"../table/MetaDescriptions\";\r\nimport { ResizableBox } from \"react-resizable\";\r\n\r\nimport {\r\n  getRowErrors,\r\n  getErrors,\r\n  computeMetaPositions,\r\n  computeAnalytic,\r\n  functions\r\n} from \"../table/utils\";\r\nimport {\r\n  errorHandler,\r\n  get_subscription\r\n  // customMenuFunctions,\r\n  // navigationKeyHandler\r\n} from \"./dataset.functions\";\r\nimport { meta, rollingAverage, totalAmount } from \"./dataset.meta\";\r\n// ;\r\n\r\nexport class MyDataset extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      sizes: {\r\n        height: 500,\r\n        width: 1300,\r\n        rowHeight: 25,\r\n        zoom: 1\r\n      },\r\n      status: {},\r\n      // filters: { qty: { id: \"qty\", filterType: \"between\", v: 123, vTo: 256 } },\r\n      sorts: {\r\n        // d: { id: \"d\", direction: \"asc\", sortOrder: 0 },\r\n        // product_lb: { id: \"product_lb\", direction: \"desc\", sortOrder: 1 },\r\n        id: { id: \"id\", direction: \"asc\", sortOrder: 0 }\r\n      },\r\n      radioDataset: \"get_promise\",\r\n      dataLength: 0,\r\n      filteredDataLength: 0,\r\n      loadedDataLength: 0,\r\n      meta,\r\n      updatedRows: {},\r\n      totalAmount: false,\r\n      rollingAverage: false,\r\n      confirmationModal: false,\r\n      activeTable: \"dataset\",\r\n      closeRequired: false,\r\n      params: { user_: \"Pollux\" },\r\n      userZebulon: false\r\n    };\r\n    this.text =\r\n      \"An array is build locally and used as dataset.\\nfunction: get_array @ demo/datasources.\";\r\n  }\r\n  // componentWillReceiveProps(nextProps) {\r\n  //   const a = 1;\r\n  //   console.log(\"ex\", this.props);\r\n  //   console.log(\"ex\", nextProps);\r\n  // }\r\n  getLengths = ({ data, filteredData }) => {\r\n    // if (Array.isArray(data)) {\r\n    //   this.setState({\r\n    //     dataLength: data.length,\r\n    //     filteredDataLength: filteredData.length,\r\n    //     loadedDataLength: data.length,\r\n    //     pageStartIndex: undefined\r\n    //   });\r\n    // }\r\n  };\r\n  getPageLengths = ({\r\n    pageLength,\r\n    filteredDataLength,\r\n    dataLength,\r\n    pageStartIndex\r\n  }) => {\r\n    this.setState({\r\n      dataLength,\r\n      filteredDataLength,\r\n      loadedDataLength: pageLength,\r\n      pageStartIndex\r\n    });\r\n  };\r\n  handleTotalAmount = () => {\r\n    totalAmount.hidden = this.state.totalAmount;\r\n    if (!totalAmount.hidden) {\r\n      computeAnalytic(this.zebulonTable.state.data, totalAmount);\r\n    }\r\n    meta.visibleIndexes = computeMetaPositions(\r\n      meta,\r\n      this.zebulonTable.state.sizes.zoom\r\n    );\r\n    this.setState({\r\n      totalAmount: !this.state.totalAmount,\r\n      status: this.state.status\r\n    });\r\n    this.zebulonTable.table.onMetaChange(true);\r\n  };\r\n  handleRollingAverage = () => {\r\n    rollingAverage.hidden = this.state.rollingAverage;\r\n    this.setState({ rollingAverage: !this.state.rollingAverage });\r\n    if (!rollingAverage.hidden) {\r\n      computeAnalytic(this.zebulonTable.state.data, rollingAverage);\r\n    }\r\n    meta.visibleIndexes = computeMetaPositions(\r\n      meta,\r\n      this.zebulonTable.state.sizes.zoom\r\n    );\r\n    this.setState({\r\n      rollingAverage: !this.state.rollingAverage,\r\n      status: this.state.status\r\n    });\r\n    this.zebulonTable.table.onMetaChange(true);\r\n  };\r\n  errorHandler = {\r\n    onRowQuit: message => {\r\n      message.modalBody = [\"Errors: \"].concat(\r\n        getRowErrors(message.status, message.row.index_)\r\n          .map(error => `\\n Order# ${message.row.id} : ${error.error}`)\r\n          .concat([\"Do you wan't to continue?\"])\r\n      );\r\n      return true;\r\n    },\r\n    onTableChange: message => {\r\n      if (message.type !== \"sort\") {\r\n        message.modalBody = \"Do you want to save before refresh?\";\r\n      }\r\n      return true;\r\n    },\r\n    onSaveBefore: message => {\r\n      message.modalBody = [\"Can't save with errors: \"].concat(\r\n        getErrors(message.updatedRows).map(\r\n          error =>\r\n            `\\nOrder# ${message.updatedRows[error.rowIndex].rowUpdated.id} : ${\r\n              error.error\r\n            }`\r\n        )\r\n      );\r\n      if (message.modalBody.length > 1) {\r\n        return false;\r\n      }\r\n      message.modalBody = null;\r\n      return true;\r\n    }\r\n  };\r\n  onActivation = table => this.setState({ activeTable: table });\r\n  handleRefresh = () => {\r\n    this.setState({ status: { loading: true } });\r\n  };\r\n  subscribe = () => {\r\n    const { meta, params } = this.zebulonTable.state;\r\n    const subscription = {\r\n      observableFunction: get_subscription,\r\n      observerFunctions: { onNext, onCompleted, onError }\r\n    };\r\n    const message = {\r\n      dataObject: meta.table.object,\r\n      params,\r\n      meta,\r\n      filters: {},\r\n      sorts: []\r\n    };\r\n    this.zebulonTable.subscribe(message, subscription);\r\n  };\r\n  // radio buttons datasource\r\n  onGetData = () => {\r\n    const value = this.state.radioDataset;\r\n    let text;\r\n    if (value === \"get_array\") {\r\n      text =\r\n        \"An array is build locally and used as dataset.\\nfunction: get_array @ demo/datasources.\";\r\n    } else if (value === \"get_promise\") {\r\n      text =\r\n        \"A server is simulated that returns a promise resolved as an array stored in the client.\\nFilters are managed by the server.\\nfunction: get_promise @ demo/datasources.\";\r\n    } else if (value === \"get_observable\") {\r\n      text =\r\n        \"A server is simulated that returns an observable.\\nPages of 1000 rows are pushed by the server and loaded in background by the client .\\nSorting is managed by the server to avoid visible reorders.\\nfunction: get_observable @ demo/datasources.\";\r\n    } else if (value === \"get_pagination_manager\") {\r\n      text =\r\n        \"A server is simulated that returns a pagination manager function.\\nA page of 100 rows including the start and the end row is returned as a promise at each call from the client.\\nOnly the current page is stored by the client.\\nSorting and filtering are managed by the server.\\nfunction: get_pagination_manager @ demo/datasources.\";\r\n    }\r\n    this.setState({ text });\r\n  };\r\n  handleRadioDataset = e => {\r\n    this.setState({\r\n      config: this.config,\r\n      radioDataset: e.target.value,\r\n      status: { loading: true, loaded: false }\r\n    });\r\n    // this.previousConfig = this.config;\r\n    this.config = this.zebulonTable.getConfiguration();\r\n  };\r\n\r\n  //   const value = e.target.value;\r\n  //   this.setState({\r\n  //     closeRequired: ok => {\r\n  //       // console.log(\"confirmation\", ok);\r\n  //       if (ok) {\r\n  //         if (value === \"get_array\") {\r\n  //           this.state.text =\r\n  //             \"An array is build locally and used as dataset.\\nfunction: get_array @ demo/datasources.\";\r\n  //         } else if (value === \"get_promise\") {\r\n  //           this.state.text =\r\n  //             \"A server is simulated that returns a promise resolved as an array stored in the client.\\nFilters are managed by the server.\\nfunction: get_promise @ demo/datasources.\";\r\n  //         } else if (value === \"get_observable\") {\r\n  //           this.state.text =\r\n  //             \"A server is simulated that returns an observable.\\nPages of 1000 rows are pushed by the server and loaded in background by the client .\\nSorting is managed by the server to avoid visible reorders.\\nfunction: get_observable @ demo/datasources.\";\r\n  //         } else if (value === \"get_pagination_manager\") {\r\n  //           this.state.text =\r\n  //             \"A server is simulated that returns a pagination manager function.\\nA page of 100 rows including the start and the end row is returned as a promise at each call from the client.\\nOnly the current page is stored by the client.\\nSorting and filtering are managed by the server.\\nfunction: get_pagination_manager @ demo/datasources.\";\r\n  //         }\r\n  //         this.setState({\r\n  //           radioDataset: value,\r\n  //           status: { loading: true },\r\n  //           closeRequired: false\r\n  //         });\r\n  //       } else {\r\n  //         this.setState({\r\n  //           radioDataset: this.state.radioDataset,\r\n  //           closeRequired: false\r\n  //         });\r\n  //       }\r\n  //     }\r\n  //   });\r\n  // };\r\n  handleUser = () => {\r\n    let params;\r\n    if (!this.state.userZebulon) {\r\n      params = {\r\n        user_: \"Zébulon\",\r\n        privileges_: {\r\n          dataset: {\r\n            table: \"editable\",\r\n            actions: { New: \"hidden\", Duplicate: \"hidden\", Delete: \"hidden\" },\r\n            properties: {\r\n              thirdparty_cd: \"hidden\",\r\n              qty: \"visible\",\r\n              color: \"visible\",\r\n              currency: \"visible\",\r\n              d: \"visible\",\r\n              product_lb: \"visible\",\r\n              country_cd: \"visible\",\r\n              id: \"editable\"\r\n            }\r\n          }\r\n        },\r\n        filter_: [\r\n          {\r\n            filterType: \"values\",\r\n            id: \"country_id\",\r\n            v: { 2: 2 }\r\n          }\r\n        ]\r\n      };\r\n    } else {\r\n      params = { user_: \"Pollux\" };\r\n    }\r\n    this.setState({\r\n      userZebulon: !this.state.userZebulon,\r\n      params,\r\n      status: { loading: true }\r\n    });\r\n  };\r\n  // onResize = (e, data) => {\r\n  //   this.setState({\r\n  //     sizes: {\r\n  //       ...this.state.sizes,\r\n  //       height: data.size.height,\r\n  //       width: data.size.width\r\n  //     }\r\n  //   });\r\n  // };\r\n  // Object.keys(this.previousState).map(key=>({key, ok:this.previousState[key]===this.state[key]}))\r\n  render() {\r\n    const { keyEvent, functions, getComponent } = this.props;\r\n    const {\r\n      filters,\r\n      sorts,\r\n      meta,\r\n      dataLength,\r\n      filteredDataLength,\r\n      loadedDataLength,\r\n      pageStartIndex,\r\n      radioDataset,\r\n      status,\r\n      activeTable,\r\n      params\r\n    } = this.state;\r\n    let header = null,\r\n      footer = null;\r\n    const sizes = { ...this.props.sizes };\r\n    // console.log(\"ex render\", this.props, this.state);\r\n    meta.serverPagination = radioDataset === \"get_pagination_manager\";\r\n    meta.table.select = radioDataset;\r\n    this.previousState = this.state;\r\n    header = (\r\n      <div>\r\n        <div\r\n          style={{\r\n            display: \"block\",\r\n            padding: 5,\r\n            height: 50,\r\n            boxSizing: \"border-box\"\r\n          }}\r\n        >\r\n          Dummy dataset with 5 joined tables: orders (date,#,color,quantitiy),\r\n          products(id, shape, size, price), countries (id, code), currencies\r\n          (id, code, symbol, rate) and thirdparties (id,code). Thirdparties are\r\n          managed with a foreign key controlled by an other zebulon table\r\n          component.\r\n        </div>\r\n        <div style={{ display: \"flex\" }}>\r\n          <div\r\n            style={{\r\n              display: \"block\",\r\n              padding: 5,\r\n              height: 170,\r\n              boxSizing: \"border-box\"\r\n            }}\r\n          >\r\n            <div\r\n              style={{\r\n                display: \"flex\",\r\n                width: 670\r\n                // justifyContent: \"space-between\"\r\n              }}\r\n            >\r\n              Dataset is generated as\r\n              <input\r\n                type=\"radio\"\r\n                id=\"radioArray\"\r\n                name=\"radioDataset\"\r\n                value=\"get_array\"\r\n                checked={radioDataset === \"get_array\"}\r\n                onChange={this.handleRadioDataset}\r\n              />\r\n              <div>an array </div>\r\n              <input\r\n                type=\"radio\"\r\n                id=\"radioPromise\"\r\n                name=\"radioDataset\"\r\n                value=\"get_promise\"\r\n                checked={radioDataset === \"get_promise\"}\r\n                onChange={this.handleRadioDataset}\r\n              />\r\n              <div> a promise or </div>\r\n              <input\r\n                type=\"radio\"\r\n                id=\"radioObservable\"\r\n                name=\"radioDataset\"\r\n                value=\"get_observable\"\r\n                checked={radioDataset === \"get_observable\"}\r\n                onChange={this.handleRadioDataset}\r\n              />\r\n              <div> an observable </div>\r\n            </div>\r\n            <div>\r\n              {`Dataset length : ${dataLength}, filtered : ${filteredDataLength}, loaded :  ${loadedDataLength} ${\r\n                pageStartIndex !== undefined\r\n                  ? \", page start at \" + String(pageStartIndex)\r\n                  : \"\"\r\n              }.`}\r\n            </div>\r\n            <div style={{ marginTop: 5 }}>\r\n              Amount and Amount in € are computed on the fly as quantity*price\r\n              and quantity*price*rate.\r\n            </div>\r\n            <div style={{ marginTop: 5 }}>\r\n              Rolling amount and Total amount are computed initially then on\r\n              demand as :\r\n            </div>\r\n            <div style={{ display: \"flex\" }}>\r\n              <input\r\n                type=\"checkbox\"\r\n                disabled={this.state.radioDataset === \"get_pagination_manager\"}\r\n                checked={\r\n                  this.state.rollingAverage &&\r\n                  this.state.radioDataset !== \"get_pagination_manager\"\r\n                }\r\n                onChange={this.handleRollingAverage}\r\n              />\r\n              rolling average of amounts in € order by date since 30 days.\r\n            </div>\r\n            <div style={{ display: \"flex\" }}>\r\n              <input\r\n                type=\"checkbox\"\r\n                disabled={this.state.radioDataset === \"get_pagination_manager\"}\r\n                checked={\r\n                  this.state.totalAmount &&\r\n                  this.state.radioDataset !== \"get_pagination_manager\"\r\n                }\r\n                onChange={this.handleTotalAmount}\r\n              />\r\n              sum of amounts in € by country.\r\n            </div>\r\n            <div style={{ display: \"flex\", marginTop: 10, height: 30 }}>\r\n              <input\r\n                type=\"checkbox\"\r\n                checked={this.state.userZebulon}\r\n                onChange={this.handleUser}\r\n              />\r\n              Connect with a restricted user only allowed to update # of US\r\n              orders,thirdparty hidden.\r\n            </div>\r\n          </div>\r\n          <div style={{ display: \"block\" }}>\r\n            <textarea\r\n              readOnly\r\n              rows=\"6\"\r\n              cols=\"120\"\r\n              value={this.state.text}\r\n              style={{\r\n                fontFamily: \"sans-serif\",\r\n                border: \"unset\",\r\n                fontSize: \"medium\",\r\n                color: \"blue\",\r\n                marginLeft: 30\r\n              }}\r\n            />\r\n            <button\r\n              onClick={this.subscribe}\r\n              style={{ marginTop: 15, marginLeft: 30 }}\r\n            >\r\n              Subscription to three server events updating the quantity of the\r\n              12th (by four) first rows by order#\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n    const text =\r\n      \"Test key, navigation, zoom, scroll, wheel, accelerators...\\n• resize the grid using the handle at right, down corner. \\n• ctrl +, ctrl - for zoom in zoom out.\\n• ctrl A to select all.\\n• F2 New,F3 Duplicate,F4 Delete,F10 Refresh, F11 toggle from/to filters bar, F12 Save.\\n• shift to extend the selection,\\n• left and right arrows to select previous or next cell in the row,\\n• up and down arrows to select the same cell in previous or next row,\\n• page up and page down to select the same cell at previous or next page,\\n• alt + page up or page down to select on the same row the on previous next, page,\\n• home and end to select the cell on the first or last row,\\n• alt + home or end to select the first or last cell on the row,\\nIn an editable cell, left and right arrow must keep the default behaviour .\\n• Alt key is used to force the navigation.\\n\\nUpdate editable columns\\n• update a product -> linked columns from product object are updated.\\n• update a quantity -> computed columns (amounts) are updated.\\n• update a thirdparty, enter 'a' then quit the cell to select one in the thirdparties beginning by 'a'.\\n• update a date to null -> check the status bar tooltip after row change.\\n• copy paste from excel (ctrl + C to copy selected  range, ctrl + V to paste from the focused cell. Only editables cells are updates. All validations are done.\\n\\nTry filters, sorts...\\n• Click on a column will toggle the sort direction from none to ascending then descending. The column is added to columns allready sorted (multisort). Reset multisort by double click.\\n• Lock and unlock columns with the contectual menu on column headers (right click). \\n• Test 'between filters' (date, quantity...), 'values filters' (product, thirdparties..., 'starts filters' (order).\\n• Test 'status filters' : right click on top left status cells.\\n• Test 'ctrl f' to search values in the grid.\\n• Resize and move columns by drag and drop.\\n• Test conflict resolution by updatating rows in the 10 first rows by order#, subscribe to a server event then save.\\n• Test the 'audit' functionality : right click on status cell on an updated and saved rows (exit of audit by right click on top left status cells).\\n• Test privileges management with the 'Connect with a restricted user' check box  ...\";\r\n    footer = (\r\n      <div style={{ marginTop: 10, marginLeft: 2 }}>\r\n        <textarea\r\n          readOnly\r\n          rows=\"20\"\r\n          cols=\"180\"\r\n          value={text}\r\n          style={{\r\n            fontFamily: \"sans-serif\",\r\n            border: \"unset\"\r\n          }}\r\n        />\r\n      </div>\r\n    );\r\n\r\n    // sizes.height = sizes.height - 245;\r\n    return (\r\n      <div style={{ fontFamily: \"sans-serif\" }} id=\"zebulon\">\r\n        {header}\r\n        <ZebulonTable\r\n          id=\"dataset\"\r\n          style={{ border: \"solid grey 0.06em\" }}\r\n          meta={meta}\r\n          params={params}\r\n          filters={filters}\r\n          sorts={sorts}\r\n          status={status}\r\n          sizes={this.state.sizes}\r\n          functions={functions}\r\n          // keyEvent={null}\r\n          errorHandler={errorHandler}\r\n          // navigationKeyHandler={navigationKeyHandler}\r\n          onFilter={this.getLengths}\r\n          onGetPage={this.getPageLengths}\r\n          // contextualMenu={customMenuFunctions}\r\n          ref={ref => (this.zebulonTable = ref)}\r\n          isActive={activeTable === \"dataset\"}\r\n          onActivation={() => this.onActivation(\"dataset\")}\r\n          // closeRequired={closeRequired}\r\n          getComponent={getComponent}\r\n          config={this.state.config}\r\n          onGetData={this.onGetData}\r\n          scrollbarsOnBox={this.props.scrollbarsOnBox}\r\n        />\r\n        {footer}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n// return (\r\n//    <div style={{ fontFamily: \"sans-serif\" }} id=\"zebulon\">\r\n//      {header}\r\n//      <ResizableBox\r\n//        height={this.state.sizes.height}\r\n//        width={this.state.sizes.width}\r\n//        onResize={this.onResize}\r\n//      >\r\n//        <ZebulonTable\r\n//          id=\"dataset\"\r\n//          style={{ border: \"solid grey 0.06em\" }}\r\n//          meta={meta}\r\n//          params={params}\r\n//          filters={filters}\r\n//          sorts={sorts}\r\n//          status={status}\r\n//          sizes={this.state.sizes}\r\n//          functions={functions}\r\n//          keyEvent={keyEvent}\r\n//          errorHandler={errorHandler}\r\n//          // navigationKeyHandler={navigationKeyHandler}\r\n//          onFilter={this.getLengths}\r\n//          onGetPage={this.getPageLengths}\r\n//          // contextualMenu={customMenuFunctions}\r\n//          ref={ref => (this.zebulonTable = ref)}\r\n//          isActive={activeTable === \"dataset\"}\r\n//          onActivation={() => this.onActivation(\"dataset\")}\r\n//          closeRequired={closeRequired}\r\n//        />\r\n//      </ResizableBox>\r\n//      {footer}\r\n//    </div>\r\n//  );\r\n","import React, { Component } from \"react\";\r\nimport cx from \"classnames\";\r\nimport { utils, accessors } from \"zebulon-controls\";\r\nimport { ZebulonTable } from \"./ZebulonTable\";\r\nimport {\r\n\tmetaDescriptions,\r\n\tmetaFunctions,\r\n\tsetPropertyAccessors\r\n} from \"./MetaDescriptions\";\r\nimport {\r\n\tcomputeMeta,\r\n\tcomputeMetaFromData,\r\n\tgetUpdatedRows,\r\n\tcomputeData,\r\n\tgetRowStatus,\r\n\tcomputeAnalytic\r\n} from \"./utils\";\r\nexport class ZebulonTableAndConfiguration extends Component {\r\n\tconstructor(props) {\r\n\t\tsuper(props);\r\n\t\tlet f = props.functions;\r\n\t\tf.mergeFunctionsObjects([accessors, metaFunctions]);\r\n\t\tf.composeFunction(\r\n\t\t\t\"dataset\",\r\n\t\t\t\"actions\",\r\n\t\t\t\"exportMeta\",\r\n\t\t\tf.getFunctionsObject()\r\n\t\t);\r\n\t\tconst meta = props.meta;\r\n\t\tthis.initMeta(\r\n\t\t\tprops.meta,\r\n\t\t\tprops.callbacks,\r\n\t\t\tprops.data,\r\n\t\t\tf,\r\n\t\t\tprops.sizes.zoom\r\n\t\t);\r\n\t\tcomputeMetaFromData(props.data, meta, props.sizes.zoom, f);\r\n\t\tconst state = {\r\n\t\t\tselectedTab: props.selectedTab || 0,\r\n\t\t\tdata: props.data,\r\n\t\t\tmeta,\r\n\t\t\tupdatedRows: props.updatedRows || {},\r\n\t\t\tpropertiesUpdatedRows: {},\r\n\t\t\tfunctionsUpdatedRows: {},\r\n\t\t\tfunctions: f,\r\n\t\t\tfunctionsData: f.getFunctionsArray(\r\n\t\t\t\t(meta.table || {}).object || \"dataset\",\r\n\t\t\t\tundefined,\r\n\t\t\t\t(meta.table || {}).source\r\n\t\t\t),\r\n\t\t\tsizes: props.sizes,\r\n\t\t\tfilters: props.filters,\r\n\t\t\tstatus: {},\r\n\t\t\tcallbacks: {\r\n\t\t\t\tapplyFunctions: this.applyFunctions,\r\n\t\t\t\tapplyProperties: this.applyProperties,\r\n\t\t\t\t...(props.callbacks || {})\r\n\t\t\t}\r\n\t\t};\r\n\t\tthis.zoomValue = props.sizes.zoom || 1;\r\n\t\t// f = utils.mergeFunctions([accessors, metaFunctions], \"properties\");\r\n\t\tthis.metaDescriptions = metaDescriptions(\r\n\t\t\t(meta.table || {}).object || \"dataset\",\r\n\t\t\t(meta.table || {}).source,\r\n\t\t\tstate.functions,\r\n\t\t\tstate.callbacks\r\n\t\t);\r\n\t\tmeta.table.actions = this.metaDescriptions.dataset.table.actions;\r\n\t\tstate.propertiesMeta = this.metaDescriptions.properties;\r\n\t\tcomputeMeta(state.propertiesMeta, props.sizes.zoom, state.functions);\r\n\t\tstate.functionsProperties = f;\r\n\t\t// f = utils.mergeFunctions([accessors, metaFunctions], \"functions\");\r\n\t\tstate.functionsMeta = this.metaDescriptions.functions;\r\n\t\tcomputeMeta(state.functionsMeta, props.sizes.zoom, state.functions);\r\n\t\tstate.functionsFunctions = f;\r\n\t\tthis.initTabsState(state, props, true);\r\n\t\tthis.initTabs(state, props);\r\n\t\tthis.state = state;\r\n\t\t// this.errorHandler = this.props.errorHandler || {};\r\n\t}\r\n\tinitTabsState = (state, props, constructor) => {\r\n\t\tif (props.tabs) {\r\n\t\t\tprops.tabs.forEach((tab, index) => {\r\n\t\t\t\tif (tab.props === undefined) {\r\n\t\t\t\t\ttab.props = {};\r\n\t\t\t\t}\r\n\t\t\t\tif (tab.selected && state.selectedTab !== index + 3) {\r\n\t\t\t\t\tstate.selectedTab = index + 3;\r\n\t\t\t\t}\r\n\t\t\t\tif (\r\n\t\t\t\t\tconstructor ||\r\n\t\t\t\t\t!this.props.tabs ||\r\n\t\t\t\t\t!this.props.tabs[index] ||\r\n\t\t\t\t\tthis.props.tabs[index].id !== tab.id ||\r\n\t\t\t\t\ttab.data !== this.props.tabs[index].data\r\n\t\t\t\t) {\r\n\t\t\t\t\tif (tab.props.functions) {\r\n\t\t\t\t\t\tstate.functions.mergeFunctionsObjects(\r\n\t\t\t\t\t\t\ttab.props.functions\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tstate[tab.id] = tab.data;\r\n\t\t\t\t\tstate[`${tab.id}Meta`] =\r\n\t\t\t\t\t\ttab.meta || this.metaDescriptions[tab.id];\r\n\t\t\t\t\tif (state[`${tab.id}Meta`]) {\r\n\t\t\t\t\t\tcomputeMetaFromData(\r\n\t\t\t\t\t\t\tstate[tab.id],\r\n\t\t\t\t\t\t\tstate[`${tab.id}Meta`],\r\n\t\t\t\t\t\t\tprops.sizes.zoom,\r\n\t\t\t\t\t\t\tstate.functions\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t\tstate[`${tab.id}UpdatedRows`] = tab.updatedRows;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t\treturn state;\r\n\t};\r\n\tinitMeta = (meta_, callbacks, data, functions, zoom) => {\r\n\t\tif (!meta_.table) {\r\n\t\t\tconst meta = metaDescriptions(\r\n\t\t\t\t\"dataset\",\r\n\t\t\t\tundefined,\r\n\t\t\t\tfunctions,\r\n\t\t\t\tcallbacks\r\n\t\t\t).dataset;\r\n\t\t\tmeta_.table = meta.table;\r\n\t\t\tmeta_.row = meta.row;\r\n\t\t\tmeta_.properties = meta.properties;\r\n\t\t\t// meta = meta_;\r\n\t\t}\r\n\t\tif (data && Array.isArray(data) && data.length && meta_.properties) {\r\n\t\t\tif (meta_.properties.length === 0) {\r\n\t\t\t\tcomputeMetaFromData(data, meta_, zoom, functions);\r\n\t\t\t}\r\n\t\t\tsetPropertyAccessors(meta_.properties, data);\r\n\t\t}\r\n\t};\r\n\tcomponentWillReceiveProps(nextProps) {\r\n\t\tlet state = {};\r\n\t\tif (nextProps.keyEvent !== this.props.keyEvent) {\r\n\t\t\tthis.handleKeyEvent(nextProps.keyEvent);\r\n\t\t} else {\r\n\t\t\tif (\r\n\t\t\t\tnextProps.data !== this.props.data ||\r\n\t\t\t\tnextProps.meta !== this.props.meta ||\r\n\t\t\t\tnextProps.filters !== this.props.filters\r\n\t\t\t) {\r\n\t\t\t\tthis.initMeta(\r\n\t\t\t\t\tnextProps.meta,\r\n\t\t\t\t\tthis.state.callbacks,\r\n\t\t\t\t\tnextProps.data,\r\n\t\t\t\t\tthis.state.functions,\r\n\t\t\t\t\tnextProps.sizes.zoom\r\n\t\t\t\t);\r\n\t\t\t\tstate = {\r\n\t\t\t\t\tdata: nextProps.data,\r\n\t\t\t\t\tmeta: nextProps.meta,\r\n\t\t\t\t\tfunctions: this.state.functions,\r\n\t\t\t\t\tfilters: nextProps.filters\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\tif (\r\n\t\t\t\tnextProps.updatedRows &&\r\n\t\t\t\tnextProps.updatedRows !== this.props.updatedRows\r\n\t\t\t) {\r\n\t\t\t\tstate.updatedRows = nextProps.updatedRows;\r\n\t\t\t}\r\n\t\t\tif (nextProps.sizes !== this.props.sizes) {\r\n\t\t\t\tstate.sizes = nextProps.sizes;\r\n\t\t\t}\r\n\t\t\tif (nextProps.tabs) {\r\n\t\t\t\tstate = this.initTabsState(state, nextProps);\r\n\t\t\t}\r\n\t\t\tthis.setState(state);\r\n\t\t\tthis.initTabProps({ ...this.state, ...state }, nextProps);\r\n\t\t}\r\n\t}\r\n\tshouldComponentUpdate(nextProps, nextState) {\r\n\t\treturn nextProps.keyEvent === this.props.keyEvent;\r\n\t}\r\n\thandleKeyEvent = e => {\r\n\t\tconst tab = this.tabs[this.state.selectedTab].id;\r\n\t\tif (this[tab] && this[tab].handleKeyEvent) {\r\n\t\t\treturn this[tab].handleKeyEvent(e);\r\n\t\t}\r\n\t};\r\n\tonChangeProperties = ({ value, previousValue, column, row }) => {\r\n\t\tif (\r\n\t\t\t[\"select\", \"dataType\"].includes(column.id) &&\r\n\t\t\tvalue !== previousValue &&\r\n\t\t\t[value, previousValue, row.dataType].includes(\"joined object\")\r\n\t\t) {\r\n\t\t\tthis.changedProperties = true;\r\n\t\t}\r\n\t};\r\n\tonRowDelete = ({ row, status }) => {\r\n\t\t// console.log(row, status);\r\n\t\trow.deleted_ = status.deleted_;\r\n\t\tthis.changedProperties = true;\r\n\t};\r\n\tonRowNew = message => {\r\n\t\tthis.changedProperties = true;\r\n\t};\r\n\tonGetData = ({ data, meta, status }) => {\r\n\t\tif (data && meta.table.object === \"dataset\" && this.changedProperties) {\r\n\t\t\tconst { functions, sizes } = this.state;\r\n\t\t\tthis.changedProperties = false;\r\n\t\t\tthis.initMeta(\r\n\t\t\t\tmeta,\r\n\t\t\t\tthis.state.callbacks,\r\n\t\t\t\tdata,\r\n\t\t\t\tfunctions,\r\n\t\t\t\tsizes.zoom\r\n\t\t\t);\r\n\t\t}\r\n\t\treturn true;\r\n\t};\r\n\tapplyFunctions = ({ updatedRows }) => {\r\n\t\tconst { functions } = this.state;\r\n\t\tgetUpdatedRows(updatedRows)\r\n\t\t\t.filter(\r\n\t\t\t\tstatus =>\r\n\t\t\t\t\t(status.row || {}).isLocal ||\r\n\t\t\t\t\t(status.rowUpdated || {}).isLocal\r\n\t\t\t)\r\n\t\t\t.forEach(status => {\r\n\t\t\t\tconst row = status.rowUpdated || status.row;\r\n\t\t\t\tif (status.row) {\r\n\t\t\t\t\tfunctions.removeFunction(\r\n\t\t\t\t\t\tstatus.row.visibility,\r\n\t\t\t\t\t\tstatus.row.tp,\r\n\t\t\t\t\t\tstatus.row.id\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t\tif (status.rowUpdated) {\r\n\t\t\t\t\tfunctions.setInitialFunction(\r\n\t\t\t\t\t\tstatus.rowUpdated.visibility,\r\n\t\t\t\t\t\tstatus.rowUpdated.tp,\r\n\t\t\t\t\t\tstatus.rowUpdated.id,\r\n\t\t\t\t\t\tstatus.rowUpdated.caption,\r\n\t\t\t\t\t\tstatus.rowUpdated.functionText\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\tcomputeMeta(this.state.meta, this.zoomValue, this.state.functions);\r\n\t\treturn true;\r\n\t};\r\n\tapplyProperties = ({ data }) => {\r\n\t\tconst { meta } = this.state;\r\n\t\tcomputeMeta(\r\n\t\t\t{ ...meta, properties: data },\r\n\t\t\tthis.zoomValue,\r\n\t\t\tthis.state.functions\r\n\t\t);\r\n\t\tmeta.properties = data.map(row => ({ ...row }));\r\n\t\t// compute new or modified joined objects\r\n\t\tif (\r\n\t\t\t-1 !==\r\n\t\t\tmeta.properties.findIndex(row => {\r\n\t\t\t\tconst status = getRowStatus(\r\n\t\t\t\t\tthis.state.propertiesUpdatedRows,\r\n\t\t\t\t\trow\r\n\t\t\t\t);\r\n\t\t\t\treturn (\r\n\t\t\t\t\trow.dataType === \"joined object\" &&\r\n\t\t\t\t\trow.accessor !== undefined &&\r\n\t\t\t\t\trow.select !== undefined &&\r\n\t\t\t\t\t(status.new_ ||\r\n\t\t\t\t\t\t(status.updated_ &&\r\n\t\t\t\t\t\t\t(status.row.accessor !==\r\n\t\t\t\t\t\t\t\tstatus.rowUpdated.accessor ||\r\n\t\t\t\t\t\t\t\tstatus.row.select !==\r\n\t\t\t\t\t\t\t\t\tstatus.rowUpdated.select ||\r\n\t\t\t\t\t\t\t\tstatus.row.dataType !== \"joined object\")))\r\n\t\t\t\t);\r\n\t\t\t})\r\n\t\t) {\r\n\t\t\tcomputeData(this.state.data, meta);\r\n\t\t\tsetPropertyAccessors(meta.properties, this.state.data);\r\n\t\t}\r\n\t\t// compute new or modified analytics functions\r\n\t\tconst properties = meta.properties.filter(row => {\r\n\t\t\tconst status = getRowStatus(this.state.propertiesUpdatedRows, row);\r\n\t\t\treturn (\r\n\t\t\t\t(row.aggregation || row.analytic) &&\r\n\t\t\t\ttypeof row.accessorFunction === \"function\" &&\r\n\t\t\t\t!row.hidden &&\r\n\t\t\t\t(status.new_ ||\r\n\t\t\t\t\t(status.updated_ &&\r\n\t\t\t\t\t\t(status.row.accessor !== status.rowUpdated.accessor ||\r\n\t\t\t\t\t\t\tstatus.row.analytic !==\r\n\t\t\t\t\t\t\t\tstatus.rowUpdated.analytic)))\r\n\t\t\t);\r\n\t\t});\r\n\t\tproperties.forEach(property => {\r\n\t\t\tcomputeAnalytic(this.state.data, property);\r\n\t\t});\r\n\t\treturn true;\r\n\t};\r\n\tsetActions = (id, actions) => {\r\n\t\tif (actions) {\r\n\t\t\tconsole.log(\"actions\", id, actions);\r\n\t\t\tthis.tabs[id].actions = actions;\r\n\t\t\tthis.setState({ selectedTab: this.state.selectedTab });\r\n\t\t}\r\n\t};\r\n\tinitTabs = (state, props) => {\r\n\t\tconst {\r\n\t\t\tparams,\r\n\t\t\tutils,\r\n\t\t\tconfigurationMenus,\r\n\t\t\tid,\r\n\t\t\tnavigationKeyHandler,\r\n\t\t\terrorHandler\r\n\t\t} = props;\r\n\t\tconst {\r\n\t\t\tselectedTab,\r\n\t\t\tdata,\r\n\t\t\tmeta,\r\n\t\t\tfilters,\r\n\t\t\tupdatedRows,\r\n\t\t\tfunctions,\r\n\t\t\tstatus,\r\n\t\t\t// functionsFunctions,\r\n\t\t\tfunctionUpdatedRows,\r\n\t\t\tfunctionsMeta,\r\n\t\t\tfunctionsData,\r\n\t\t\tpropertiesMeta,\r\n\t\t\tpropertiesUpdatedRows\r\n\t\t} = state;\r\n\t\tconst menu = configurationMenus || {};\r\n\t\tthis.tabs = [\r\n\t\t\t{\r\n\t\t\t\tid: \"dataset\",\r\n\t\t\t\tcaption: \"Dataset\",\r\n\t\t\t\tindex: 0,\r\n\r\n\t\t\t\tcontent: (\r\n\t\t\t\t\t<ZebulonTable\r\n\t\t\t\t\t\tkey={0}\r\n\t\t\t\t\t\tid={`${id}-dataset`}\r\n\t\t\t\t\t\tdata={data}\r\n\t\t\t\t\t\tmeta={meta}\r\n\t\t\t\t\t\tfilters={filters}\r\n\t\t\t\t\t\tupdatedRows={updatedRows}\r\n\t\t\t\t\t\tfunctions={functions}\r\n\t\t\t\t\t\tparams={params}\r\n\t\t\t\t\t\tkeyEvent={null}\r\n\t\t\t\t\t\tonTableEnter={this.onTableEnter}\r\n\t\t\t\t\t\tref={ref => (this.dataset = ref)}\r\n\t\t\t\t\t\terrorHandler={errorHandler}\r\n\t\t\t\t\t\tnavigationKeyHandler={navigationKeyHandler}\r\n\t\t\t\t\t\tonGetData={this.onGetData}\r\n\t\t\t\t\t\tresizable={false}\r\n\t\t\t\t\t\tutils={utils}\r\n\t\t\t\t\t\tcontextualMenu={\r\n\t\t\t\t\t\t\tmenu.dataset ? menu.dataset(this) : undefined\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tscrollbarsOnBox={this.props.scrollbarsOnBox}\r\n\t\t\t\t\t\tsetActions={actions => this.setActions(0, actions)}\r\n\t\t\t\t\t/>\r\n\t\t\t\t)\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tid: \"properties\",\r\n\t\t\t\tcaption: \"Properties\",\r\n\t\t\t\tindex: 1,\r\n\t\t\t\tcontent: (\r\n\t\t\t\t\t<ZebulonTable\r\n\t\t\t\t\t\tkey={1}\r\n\t\t\t\t\t\tid={`${id}-properties`}\r\n\t\t\t\t\t\tdata={[...meta.properties]}\r\n\t\t\t\t\t\tmeta={propertiesMeta}\r\n\t\t\t\t\t\tupdatedRows={propertiesUpdatedRows}\r\n\t\t\t\t\t\tonChange={this.onChangeProperties}\r\n\t\t\t\t\t\tonRowDelete={this.onRowDelete}\r\n\t\t\t\t\t\tonRowNew={this.onRowNew}\r\n\t\t\t\t\t\tfunctions={functions}\r\n\t\t\t\t\t\tstatus={status}\r\n\t\t\t\t\t\tparams={params}\r\n\t\t\t\t\t\tkeyEvent={null}\r\n\t\t\t\t\t\tref={ref => (this.properties = ref)}\r\n\t\t\t\t\t\terrorHandler={{}}\r\n\t\t\t\t\t\tutils={utils}\r\n\t\t\t\t\t\tresizable={false}\r\n\t\t\t\t\t\tcontextualMenu={\r\n\t\t\t\t\t\t\tmenu.properties ? menu.properties(this) : undefined\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tscrollbarsOnBox={this.props.scrollbarsOnBox}\r\n\t\t\t\t\t\tsetActions={actions => this.setActions(1, actions)}\r\n\t\t\t\t\t/>\r\n\t\t\t\t)\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tid: \"functions\",\r\n\t\t\t\tcaption: \"Functions\",\r\n\t\t\t\tindex: 2,\r\n\r\n\t\t\t\tcontent: (\r\n\t\t\t\t\t<ZebulonTable\r\n\t\t\t\t\t\tkey={2}\r\n\t\t\t\t\t\tid={`${id}-functions`}\r\n\t\t\t\t\t\tdata={functionsData}\r\n\t\t\t\t\t\tmeta={functionsMeta}\r\n\t\t\t\t\t\tupdatedRows={functionUpdatedRows}\r\n\t\t\t\t\t\tfunctions={functions}\r\n\t\t\t\t\t\tparams={params}\r\n\t\t\t\t\t\tkeyEvent={null}\r\n\t\t\t\t\t\tref={ref => (this.functions = ref)}\r\n\t\t\t\t\t\terrorHandler={{}}\r\n\t\t\t\t\t\tutils={utils}\r\n\t\t\t\t\t\tresizable={false}\r\n\t\t\t\t\t\tcontextualMenu={\r\n\t\t\t\t\t\t\tmenu.functions ? menu.functions(this) : undefined\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tscrollbarsOnBox={this.props.scrollbarsOnBox}\r\n\t\t\t\t\t\tsetActions={actions => this.setActions(2, actions)}\r\n\t\t\t\t\t/>\r\n\t\t\t\t)\r\n\t\t\t}\r\n\t\t];\r\n\t\tthis.initTabProps(state, props);\r\n\t\treturn this.tabs;\r\n\t};\r\n\tinitTabProps = (state, props) => {\r\n\t\tconst { selectedTab, sizes } = state;\r\n\t\tconst { params, utils, id, configurationMenus } = props;\r\n\t\tconst menu = configurationMenus || {};\r\n\t\tif (props.tabs) {\r\n\t\t\tprops.tabs.forEach((tab, index) => {\r\n\t\t\t\tif (tab !== this.tabs[3 + index]) {\r\n\t\t\t\t\tconst Content = tab.content ? tab.content : ZebulonTable;\r\n\t\t\t\t\tthis.tabs[3 + index] = {\r\n\t\t\t\t\t\tid: tab.id,\r\n\t\t\t\t\t\tcaption: tab.caption,\r\n\t\t\t\t\t\tprops: tab.props,\r\n\t\t\t\t\t\tindex: 3 + index,\r\n\t\t\t\t\t\tcontent: (\r\n\t\t\t\t\t\t\t<Content\r\n\t\t\t\t\t\t\t\tkey={3 + index}\r\n\t\t\t\t\t\t\t\tid={`${id}-${tab.id}`}\r\n\t\t\t\t\t\t\t\tdata={state[tab.id]}\r\n\t\t\t\t\t\t\t\tmeta={state[`${tab.id}Meta`]}\r\n\t\t\t\t\t\t\t\tupdatedRows={state[`${tab.id}UpdatedRows`]}\r\n\t\t\t\t\t\t\t\tsizes={sizes}\r\n\t\t\t\t\t\t\t\tfunctions={state.functions}\r\n\t\t\t\t\t\t\t\tparams={params}\r\n\t\t\t\t\t\t\t\tkeyEvent={null}\r\n\t\t\t\t\t\t\t\tref={ref => (this[tab.id] = ref)}\r\n\t\t\t\t\t\t\t\terrorHandler={{}}\r\n\t\t\t\t\t\t\t\tutils={utils}\r\n\t\t\t\t\t\t\t\tcontextualMenu={\r\n\t\t\t\t\t\t\t\t\tmenu[tab.id]\r\n\t\t\t\t\t\t\t\t\t\t? menu[tab.id](this)\r\n\t\t\t\t\t\t\t\t\t\t: undefined\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tscrollbarsOnBox={this.props.scrollbarsOnBox}\r\n\t\t\t\t\t\t\t\tsetActions={actions =>\r\n\t\t\t\t\t\t\t\t\tthis.setActions(3 + index, actions)\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t)\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t\tif (this.tabs.length > 3 + (props.tabs || []).length) {\r\n\t\t\tthis.tabs.splice(\r\n\t\t\t\t3 + (props.tabs || []).length,\r\n\t\t\t\tthis.tabs.length - 3\r\n\t\t\t);\r\n\t\t}\r\n\t};\r\n\tonSelectTab = index => {\r\n\t\tconst { selectedTab } = this.state;\r\n\t\tconst canQuit = this[this.tabs[selectedTab].id].table\r\n\t\t\t? this[this.tabs[selectedTab].id].table.canQuit\r\n\t\t\t: null;\r\n\t\tif (canQuit) {\r\n\t\t\tcanQuit(\"quit\", ok => {\r\n\t\t\t\tif (ok) {\r\n\t\t\t\t\tthis.setState({ selectedTab: index });\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tthis.setState({ selectedTab: index });\r\n\t\t}\r\n\t};\r\n\r\n\trender() {\r\n\t\tif (this.props.status.loading || this.props.status.loadingConfig) {\r\n\t\t\treturn <div>Loading data...</div>;\r\n\t\t} else if (this.props.status.error) {\r\n\t\t\tif (this.props.status.error.message === \"No rows retrieved\") {\r\n\t\t\t} else {\r\n\t\t\t\treturn (\r\n\t\t\t\t\t<div style={{ color: \"red\", width: \"max-content\" }}>\r\n\t\t\t\t\t\t<p>{this.props.status.error.type}</p>\r\n\t\t\t\t\t\t<p>{this.props.status.error.message}</p>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t}\r\n\t\tconst zoomValue = this.zoomValue;\r\n\t\treturn (\r\n\t\t\t<div>\r\n\t\t\t\t<div\r\n\t\t\t\t\tstyle={{\r\n\t\t\t\t\t\tdisplay: \"flex\",\r\n\t\t\t\t\t\theight: 25 * zoomValue\r\n\t\t\t\t\t}}\r\n\t\t\t\t\tclassName=\"zebulon-tabs-list\"\r\n\t\t\t\t>\r\n\t\t\t\t\t{this.tabs.map((tab, index) => (\r\n\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\tkey={index}\r\n\t\t\t\t\t\t\tstyle={{\r\n\t\t\t\t\t\t\t\twidth: `${(100 / this.tabs.length).toFixed(2)}%`\r\n\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\tclassName={cx({\r\n\t\t\t\t\t\t\t\t\"zebulon-tabs-tab\": true,\r\n\t\t\t\t\t\t\t\t\"zebulon-tabs-tab-selected\":\r\n\t\t\t\t\t\t\t\t\tindex === this.state.selectedTab\r\n\t\t\t\t\t\t\t})}\r\n\t\t\t\t\t\t\tonClick={() => this.onSelectTab(index)}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t{tab.actions ? (\r\n\t\t\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\t\t\tstyle={{\r\n\t\t\t\t\t\t\t\t\t\tdisplay: \"flex\",\r\n\t\t\t\t\t\t\t\t\t\tjustifyContent: \"space-between\",\r\n\t\t\t\t\t\t\t\t\t\tfontWeight: \"bold\",\r\n\t\t\t\t\t\t\t\t\t\ttextAlign: \"center\"\r\n\t\t\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\t\t\t\tstyle={{\r\n\t\t\t\t\t\t\t\t\t\t\ttextAlign: \"center\",\r\n\t\t\t\t\t\t\t\t\t\t\twidth: \"100%\"\r\n\t\t\t\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t{tab.caption}\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t{tab.actions}\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t) : (\r\n\t\t\t\t\t\t\t\ttab.caption\r\n\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t))}\r\n\t\t\t\t</div>\r\n\t\t\t\t<div\r\n\t\t\t\t\tstyle={{\r\n\t\t\t\t\t\theight: this.props.sizes.height - 30 * zoomValue\r\n\t\t\t\t\t}}\r\n\t\t\t\t>\r\n\t\t\t\t\t{this.tabs.map(tab =>\r\n\t\t\t\t\t\tReact.cloneElement(tab.content, {\r\n\t\t\t\t\t\t\t...tab.props,\r\n\t\t\t\t\t\t\tvisible: tab.index === this.state.selectedTab,\r\n\t\t\t\t\t\t\tisActive: tab.index === this.state.selectedTab,\r\n\t\t\t\t\t\t\tsizes: this.state.sizes\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t)}\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n}\r\n","import React, { Component } from \"react\";\r\nimport { ZebulonTableAndConfiguration } from \"../table/ZebulonTableAndConfiguration\";\r\nimport { meta } from \"./dataset.meta\";\r\nimport { get_array } from \"./datasources\";\r\nimport { ResizableBox } from \"react-resizable\";\r\n\r\n// customMenuFunctions;\r\n\r\nexport class MyDatasetConfiguration extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    const metaDataset = { ...meta };\r\n    metaDataset.table = { ...metaDataset.table };\r\n    metaDataset.table.actions = [\r\n      ...metaDataset.table.actions,\r\n      {\r\n        type: \"action\",\r\n        caption: \"Export Meta\",\r\n        enable: true,\r\n        hidden: true,\r\n        action: \"exportMeta\"\r\n      }\r\n    ];\r\n    metaDataset.properties = [];\r\n    metaDataset.lockedIndex = null;\r\n    metaDataset.lockedWidth = null;\r\n    const data = get_array({ noJoins: true });\r\n    const status = {};\r\n    this.state = {\r\n      status,\r\n      data,\r\n      meta: metaDataset,\r\n      params: { user_: \"Zebulon\" },\r\n      sizes: {\r\n        height: 500,\r\n        width: 1300,\r\n        rowHeight: 25,\r\n        zoom: 1\r\n      }\r\n    };\r\n  }\r\n  onResize = (e, data) => {\r\n    this.setState({\r\n      sizes: {\r\n        ...this.state.sizes,\r\n        height: data.size.height,\r\n        width: data.size.width\r\n      }\r\n    });\r\n  };\r\n  render() {\r\n    const text =\r\n      \"Dataset row object:{d:<date>,id:<number>,product_id:<number>,currency_id:<number>,country_id:<number>,qty:<number>,color:<string>,thirdparty:{id:<number>,cd:<string>,lb:<string>}}.\\nProduct object:{id:<number>,label:<string>,price:<number>,shape:<string>,size:<string>}.\\nCurrency object:{id:<number>,code:<string>,label:<string>,symbol:<string>rate:<number>}.\\nCountry object:{id:<number>,code:<string>,label:<string>,currency_id:<number>,vat:<number>}.\\nN.B. Accessors, formats...exists allready.\\n\\nOn the Properties tab.\\nJoined the objects products, countries, currencies:\\n• create 3 new properties (product, country, currency) with \\n  • type = joined object.\\n  • accessor = respectively row.product_id, row.country_id, row.currency_id.\\n  • select = respectively getProducts, getCountries, currencies.Apply changes on the dataset (apply button) to load the instances of the objects, new accessors on objects keys won't be accessible otherwise.\\n\\nOn the Dataset tab.\\n\\nOn the Properties tab.\\nCreate the 4 new properties for products:\\n• product_cd, data type = string, editable = true, accessor = row.product.label (only the properties used for the select Input must be editable)\\n• price, data type = number, editable = false, accessor = row.product.price\\n• shape, data type = string, editable = false, accessor = row.product.shape\\n• size, data type = string, editable = false, accessor = row.product.size\\nSet the price format to price property,\\nCreate the 2 new properties for countries:\\n• country_cd, data type = string, editable = true, accessor = row.country.code (only the properties used for the select Input must be editable)\\n• flag, editable = false, accessor = flag, format = image, width = 40\\nCreate the new property for currencies:\\n• currency_cd, data type = string, editable = true, accessor = row.currency.code (only the properties used for the select Input must be editable)\\nCreate the new property for thirdparties foreign table object:\\n• thirdparty_cd, data type = string, editable = true, accessor = row.thirdparty.cd, foreign object = thirdparties\\nSet row color select = getColors, data type = string.\\nCreate a new property:\\n• code = month, data type = date, format = mm/yyyy, accessor = mth, filter = values\\nHide the ids (product, currency, country).\\nCreate the 2 calculated properties \\n• amount, data type = number, editable =  false, format = amt_cur, accessor = amt_cur, width = 150\\n• amountEUR, data type = number, editable =  false, format = amt_€, accessor = amt_€, width = 150.\\nApply changes and check on the Dataset tab\\n\\nOn the Functions tab.\\nCreate a new accessor: gross_amount.\\n• code = gross_amt.\\n• visibility = dataset.\\n• type = accessor.\\n• function = ({row})=>accessor('amt_cur')({row})*(1+(row.country||{vat:0}).vat).\\nN.B. The accessor function let you use an other accessor in your function.\\nApply changes and check on the Dataset tab.\\n\\nOn the Properties tab.\\nCreate a new property:\\n• code = gross_amt.\\n• format = amt_cur.\\n• accessor = gross_amt.\\nCreate the 2 new properties calculated by analytics functions:\\n• code = totalAmountByCountry, data type = number, accessor = totalAmt, analytic function = total_amt.\\n• code = rollingAverage, data type = number, accessor = amt_cur, analytic function = rolling_avg.\\nApply changes and check on the Dataset tab. \\n\\nAdd an init function to set country currency by default when country changes and currency is null (country_cd/onChange = onChangeCountry).\\nRename the columns (caption column).\\nSet the appropriate filter type on the properties..\\nApply changes and check on the Dataset tab.\\n.\\nTest the result on the Dataset tab.\";\r\n    const { keyEvent, functions, id } = this.props;\r\n    // ({row})=>{const acc=accessor('amt_cur');return acc({row})*(1+(row.country||{vat:0}).vat);}\r\n    const { data, meta, status, params } = this.state;\r\n    return (\r\n      <div>\r\n        <ResizableBox\r\n          height={this.state.sizes.height}\r\n          width={this.state.sizes.width}\r\n          onResize={this.onResize}\r\n        >\r\n          <ZebulonTableAndConfiguration\r\n            id={id}\r\n            functions={functions}\r\n            params={params}\r\n            data={data}\r\n            meta={meta}\r\n            status={status}\r\n            sizes={{\r\n              ...this.state.sizes,\r\n              height: this.state.sizes.height - 30\r\n            }}\r\n            keyEvent={keyEvent}\r\n            scrollbarsOnBox={this.props.scrollbarsOnBox}\r\n            // errorHandler={this.errorHandler}\r\n          />\r\n        </ResizableBox>\r\n        <div\r\n          style={{\r\n            fontFamily: \"sans-serif\",\r\n            border: \"unset\",\r\n            paddingTop: 50,\r\n            fontWeight: \"bold\"\r\n            // fontSize: \"medium\"\r\n          }}\r\n        >\r\n          Create the configuration from the original dataset as in the 'Dataset\r\n          and server' tab.\r\n        </div>\r\n        <textarea\r\n          readOnly\r\n          rows=\"25\"\r\n          cols=\"180\"\r\n          value={text}\r\n          style={{\r\n            fontFamily: \"sans-serif\",\r\n            border: \"unset\",\r\n            paddingTop: 10\r\n          }}\r\n        />\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","import React, { Component } from \"react\";\r\nimport \"zebulon-controls/lib/index.css\";\r\nimport \"../table/index.css\";\r\n// import { functions } from \"../table/MetaDescriptions\";\r\nimport { functions, utils } from \"zebulon-controls\";\r\nimport { Input } from \"zebulon-controls\";\r\n\r\nimport { MyDataset } from \"./dataset.example\";\r\nimport { datasetFunctions } from \"./dataset.functions\";\r\nimport { MyDatasetConfiguration } from \"./dataset.configuration\";\r\n// import { navigationKeyHandler } from \"./navigation.handler\";\r\nimport cx from \"classnames\";\r\n// console.log(\"datasetFunctions\", toto, functions, datasetFunctions);\r\nclass ZebulonTableDemo extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.options = [200, 40, 3];\r\n    // const functions = { dataset: datasetFunctions };\r\n    this.state = {\r\n      data: null,\r\n      keyEvent: null,\r\n      functions: functions.functions(datasetFunctions),\r\n      updatedRows: {},\r\n      params: {},\r\n      status: {},\r\n      filters: { qty: { id: \"qty\", filterType: \"between\", v: 123, vTo: 256 } },\r\n      sorts: {\r\n        d: { id: \"d\", direction: \"asc\", sortOrder: 0 },\r\n        toto: { id: \"toto\", direction: \"desc\", sortOrder: 1 }\r\n      },\r\n      selectedTab: 0,\r\n      radioDataset: \"get_array\",\r\n      dataLength: 0,\r\n      filteredDataLength: 0,\r\n      loadedDataLength: 0\r\n    };\r\n    this.state.functions.setVisibility(\"dataset\");\r\n    this.text =\r\n      \"\\nAn array is build locally and used as dataset.\\nfunction: get_array @ demo/datasources.\";\r\n  }\r\n  componentDidMount() {\r\n    document.addEventListener(\"copy\", this.handleKeyEvent);\r\n    document.addEventListener(\"paste\", this.handleKeyEvent);\r\n    document.addEventListener(\"keydown\", this.handleKeyEvent);\r\n  }\r\n  componentWillUnmount() {\r\n    document.removeEventListener(\"copy\", this.handleKeyEvent);\r\n    document.removeEventListener(\"paste\", this.handleKeyEvent);\r\n    document.removeEventListener(\"keydown\", this.handleKeyEvent);\r\n  }\r\n\r\n  handleKeyEvent = e => {\r\n    this.setState({ keyEvent: e });\r\n    return true;\r\n  };\r\n  errorHandler = {\r\n    onRowQuit: message => {\r\n      return window.confirm(JSON.stringify(message.status));\r\n    }\r\n  };\r\n  onSelectTab = index => {\r\n    if (index === 1 && this.component && this.component.onClose) {\r\n      this.component.onClose(ok => {\r\n        if (ok) {\r\n          this.setState({ selectedTab: index });\r\n        }\r\n      });\r\n    } else {\r\n      this.setState({ selectedTab: index });\r\n    }\r\n  };\r\n  tabs = [\r\n    {\r\n      id: \"dataset\",\r\n      caption: \"Dataset and server\"\r\n    },\r\n    {\r\n      id: \"selfConfig\",\r\n      caption: \"Manage configuration\",\r\n      disabled: true\r\n    }\r\n  ];\r\n\r\n  getTabContent = tabIndex => {\r\n    const { keyEvent, functions } = this.state;\r\n    // const sizes = { ...this.state.sizes };\r\n    if (tabIndex === 0) {\r\n      return (\r\n        <MyDataset\r\n          id=\"dataset\"\r\n          functions={functions}\r\n          keyEvent={keyEvent}\r\n          getComponent={ref => (this.component = ref)}\r\n          scrollbarsOnBox={true}\r\n        />\r\n      );\r\n    } else if (tabIndex === 1) {\r\n      // sizes.height = sizes.height - 52;\r\n      return (\r\n        <MyDatasetConfiguration\r\n          id=\"dataset\"\r\n          functions={functions}\r\n          keyEvent={keyEvent}\r\n          scrollbarsOnBox={true}\r\n        />\r\n      );\r\n    }\r\n  };\r\n  render() {\r\n    const zoomValue = 1;\r\n    return (\r\n      <div\r\n        style={{\r\n          fontSize: `${zoomValue * 100}%`,\r\n          fontFamily: \"sans-serif\",\r\n          width: 1300\r\n        }}\r\n      >\r\n        <div\r\n          style={{\r\n            display: \"flex\",\r\n            height: 25 * zoomValue\r\n          }}\r\n          className=\"zebulon-tabs-list\"\r\n        >\r\n          {this.tabs.map((tab, index) => (\r\n            <div\r\n              key={index}\r\n              style={{ width: \"50%\" }}\r\n              className={cx({\r\n                \"zebulon-tabs-tab\": true,\r\n                \"zebulon-tabs-tab-selected\": index === this.state.selectedTab\r\n              })}\r\n              onClick={() => this.onSelectTab(index)}\r\n            >\r\n              {tab.caption}\r\n            </div>\r\n          ))}\r\n        </div>\r\n        <div>{this.getTabContent(this.state.selectedTab)}</div>\r\n        <div\r\n          style={{\r\n            height: 55,\r\n            width: 200,\r\n            border: \"solid\",\r\n            position: \"relative\",\r\n            overflow: \"hidden\"\r\n          }}\r\n          onScroll={e => console.log(\"scroll\", e)}\r\n        >\r\n          <input type=\"text\" />\r\n          <input type=\"text\" />\r\n          <Input\r\n            id={-12345}\r\n            style={{\r\n              width: 100,\r\n              height: 25,\r\n              boxSizing: \"border-box\",\r\n              // height: \"inherit\",\r\n              textAlign: \"center\"\r\n            }}\r\n            dataType=\"date\"\r\n            value={new Date()}\r\n            editable={true}\r\n            onScroll={e => console.log(e)}\r\n            // onChange={this.props.onChange}\r\n            hasFocus=\"true\"\r\n          />\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\nexport default ZebulonTableDemo;\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport ZebulonTableDemo from './demo/ZebulonTable.demo';\r\n// import \"./table/utils/polyfill\";\r\nReactDOM.render(<ZebulonTableDemo />, document.getElementById('root'));\r\n"],"sourceRoot":""}